var Live2DCubismCore;!function(t){var e,r=function(){function t(){}return t.getVersion=function(){return l.ccall("csmGetVersion","number",[],[])},t.getLatestMocVersion=function(){return l.ccall("csmGetLatestMocVersion","number",[],[])},t.getMocVersion=function(t,e){return l.ccall("csmGetMocVersion","number",["number","number"],[t,e])},t.getSizeofModel=function(t){return l.ccall("csmGetSizeofModel","number",["number"],[t])},t.reviveMocInPlace=function(t,e){return l.ccall("csmReviveMocInPlace","number",["number","number"],[t,e])},t.initializeModelInPlace=function(t,e,r){return l.ccall("csmInitializeModelInPlace","number",["number","number","number"],[t,e,r])},t.hasMocConsistency=function(t,e){return l.ccall("csmHasMocConsistency","number",["number","number"],[t,e])},t.getParameterCount=function(t){return l.ccall("csmGetParameterCount","number",["number"],[t])},t.getParameterIds=function(t){return l.ccall("csmGetParameterIds","number",["number"],[t])},t.getParameterMinimumValues=function(t){return l.ccall("csmGetParameterMinimumValues","number",["number"],[t])},t.getParameterTypes=function(t){return l.ccall("csmGetParameterTypes","number",["number"],[t])},t.getParameterMaximumValues=function(t){return l.ccall("csmGetParameterMaximumValues","number",["number"],[t])},t.getParameterDefaultValues=function(t){return l.ccall("csmGetParameterDefaultValues","number",["number"],[t])},t.getParameterValues=function(t){return l.ccall("csmGetParameterValues","number",["number"],[t])},t.getParameterKeyCounts=function(t){return l.ccall("csmGetParameterKeyCounts","number",["number"],[t])},t.getParameterKeyValues=function(t){return l.ccall("csmGetParameterKeyValues","number",["number"],[t])},t.getPartCount=function(t){return l.ccall("csmGetPartCount","number",["number"],[t])},t.getPartIds=function(t){return l.ccall("csmGetPartIds","number",["number"],[t])},t.getPartOpacities=function(t){return l.ccall("csmGetPartOpacities","number",["number"],[t])},t.getPartParentPartIndices=function(t){return l.ccall("csmGetPartParentPartIndices","number",["number"],[t])},t.getDrawableCount=function(t){return l.ccall("csmGetDrawableCount","number",["number"],[t])},t.getDrawableIds=function(t){return l.ccall("csmGetDrawableIds","number",["number"],[t])},t.getDrawableConstantFlags=function(t){return l.ccall("csmGetDrawableConstantFlags","number",["number"],[t])},t.getDrawableDynamicFlags=function(t){return l.ccall("csmGetDrawableDynamicFlags","number",["number"],[t])},t.getDrawableTextureIndices=function(t){return l.ccall("csmGetDrawableTextureIndices","number",["number"],[t])},t.getDrawableDrawOrders=function(t){return l.ccall("csmGetDrawableDrawOrders","number",["number"],[t])},t.getDrawableRenderOrders=function(t){return l.ccall("csmGetDrawableRenderOrders","number",["number"],[t])},t.getDrawableOpacities=function(t){return l.ccall("csmGetDrawableOpacities","number",["number"],[t])},t.getDrawableMaskCounts=function(t){return l.ccall("csmGetDrawableMaskCounts","number",["number"],[t])},t.getDrawableMasks=function(t){return l.ccall("csmGetDrawableMasks","number",["number"],[t])},t.getDrawableVertexCounts=function(t){return l.ccall("csmGetDrawableVertexCounts","number",["number"],[t])},t.getDrawableVertexPositions=function(t){return l.ccall("csmGetDrawableVertexPositions","number",["number"],[t])},t.getDrawableVertexUvs=function(t){return l.ccall("csmGetDrawableVertexUvs","number",["number"],[t])},t.getDrawableIndexCounts=function(t){return l.ccall("csmGetDrawableIndexCounts","number",["number"],[t])},t.getDrawableIndices=function(t){return l.ccall("csmGetDrawableIndices","number",["number"],[t])},t.getDrawableMultiplyColors=function(t){return l.ccall("csmGetDrawableMultiplyColors","number",["number"],[t])},t.getDrawableScreenColors=function(t){return l.ccall("csmGetDrawableScreenColors","number",["number"],[t])},t.getDrawableParentPartIndices=function(t){return l.ccall("csmGetDrawableParentPartIndices","number",["number"],[t])},t.mallocMoc=function(t){return l.ccall("csmMallocMoc","number",["number"],[t])},t.mallocModelAndInitialize=function(t){return l.ccall("csmMallocModelAndInitialize","number",["number"],[t])},t.malloc=function(t){return l.ccall("csmMalloc","number",["number"],[t])},t.setLogFunction=function(t){l.ccall("csmSetLogFunction",null,["number"],[t])},t.updateModel=function(t){l.ccall("csmUpdateModel",null,["number"],[t])},t.readCanvasInfo=function(t,e,r,i){l.ccall("csmReadCanvasInfo",null,["number","number","number","number"],[t,e,r,i])},t.resetDrawableDynamicFlags=function(t){l.ccall("csmResetDrawableDynamicFlags",null,["number"],[t])},t.free=function(t){l.ccall("csmFree",null,["number"],[t])},t.initializeAmountOfMemory=function(t){l.ccall("csmInitializeAmountOfMemory",null,["number"],[t])},t}(),i=(t.AlignofMoc=64,t.AlignofModel=16,t.MocVersion_Unknown=0,t.MocVersion_30=1,t.MocVersion_33=2,t.MocVersion_40=3,t.MocVersion_42=4,t.MocVersion_50=5,t.ParameterType_Normal=0,t.ParameterType_BlendShape=1,function(){function t(){}return t.csmGetVersion=function(){return r.getVersion()},t.csmGetLatestMocVersion=function(){return r.getLatestMocVersion()},t.csmGetMocVersion=function(t,e){return r.getMocVersion(t._ptr,e.byteLength)},t}()),s=(i=(t.Version=i,function(){function t(){}return t.csmSetLogFunction=function(e){t.logFunction=e,e=l.addFunction(t.wrapLogFunction,"vi"),r.setLogFunction(e)},t.csmGetLogFunction=function(){return t.logFunction},t.wrapLogFunction=function(e){e=l.UTF8ToString(e),t.logFunction(e)},t}()),i=(t.Logging=i,function(){function t(t){var e=r.mallocMoc(t.byteLength);e&&(new Uint8Array(l.HEAPU8.buffer,e,t.byteLength).set(new Uint8Array(t)),this._ptr=r.reviveMocInPlace(e,t.byteLength),this._ptr||r.free(e))}return t.prototype.hasMocConsistency=function(t){var e=r.mallocMoc(t.byteLength);if(e)return new Uint8Array(l.HEAPU8.buffer,e,t.byteLength).set(new Uint8Array(t)),t=r.hasMocConsistency(e,t.byteLength),r.free(e),t},t.fromArrayBuffer=function(e){return e&&(e=new t(e))._ptr?e:null},t.prototype._release=function(){r.free(this._ptr),this._ptr=0},t}()),i=(t.Moc=i,function(){function t(t){this._ptr=r.mallocModelAndInitialize(t._ptr),this._ptr&&(this.parameters=new n(this._ptr),this.parts=new o(this._ptr),this.drawables=new a(this._ptr),this.canvasinfo=new s(this._ptr))}return t.fromMoc=function(e){return(e=new t(e))._ptr?e:null},t.prototype.update=function(){r.updateModel(this._ptr)},t.prototype.release=function(){r.free(this._ptr),this._ptr=0},t}()),t.Model=i,function(t){var e,i,s,n,o,a,h;t&&(s=(e=new Float32Array(2)).length*e.BYTES_PER_ELEMENT,i=r.malloc(s),(i=new Uint8Array(l.HEAPU8.buffer,i,s)).set(new Uint8Array(e.buffer)),o=(s=new Float32Array(2)).length*s.BYTES_PER_ELEMENT,n=r.malloc(o),(n=new Uint8Array(l.HEAPU8.buffer,n,o)).set(new Uint8Array(s.buffer)),a=(o=new Float32Array(1)).length*o.BYTES_PER_ELEMENT,h=r.malloc(a),(h=new Uint8Array(l.HEAPU8.buffer,h,a)).set(new Uint8Array(o.buffer)),r.readCanvasInfo(t,i.byteOffset,n.byteOffset,h.byteOffset),e=new Float32Array(i.buffer,i.byteOffset,i.length),s=new Float32Array(n.buffer,n.byteOffset,n.length),o=new Float32Array(h.buffer,h.byteOffset,h.length),this.CanvasWidth=e[0],this.CanvasHeight=e[1],this.CanvasOriginX=s[0],this.CanvasOriginY=s[1],this.PixelsPerUnit=o[0],r.free(i.byteOffset),r.free(n.byteOffset),r.free(h.byteOffset))}),n=(t.CanvasInfo=s,function(t){this.count=r.getParameterCount(t),e=r.getParameterCount(t),this.ids=new Array(e);for(var e,i,s=new Uint32Array(l.HEAPU32.buffer,r.getParameterIds(t),e),n=0;n<s.length;n++)this.ids[n]=l.UTF8ToString(s[n]);e=r.getParameterCount(t),this.minimumValues=new Float32Array(l.HEAPF32.buffer,r.getParameterMinimumValues(t),e),e=r.getParameterCount(t),this.types=new Int32Array(l.HEAP32.buffer,r.getParameterTypes(t),e),e=r.getParameterCount(t),this.maximumValues=new Float32Array(l.HEAPF32.buffer,r.getParameterMaximumValues(t),e),e=r.getParameterCount(t),this.defaultValues=new Float32Array(l.HEAPF32.buffer,r.getParameterDefaultValues(t),e),e=r.getParameterCount(t),this.values=new Float32Array(l.HEAPF32.buffer,r.getParameterValues(t),e),e=r.getParameterCount(t),this.keyCounts=new Int32Array(l.HEAP32.buffer,r.getParameterKeyCounts(t),e),e=r.getParameterCount(t),i=new Int32Array(l.HEAP32.buffer,r.getParameterKeyCounts(t),e),this.keyValues=new Array(e);var o=new Uint32Array(l.HEAPU32.buffer,r.getParameterKeyValues(t),e);for(n=0;n<o.length;n++)this.keyValues[n]=new Float32Array(l.HEAPF32.buffer,o[n],i[n])}),o=(t.Parameters=n,function(t){this.count=r.getPartCount(t),e=r.getPartCount(t),this.ids=new Array(e);for(var e,i=new Uint32Array(l.HEAPU32.buffer,r.getPartIds(t),e),s=0;s<i.length;s++)this.ids[s]=l.UTF8ToString(i[s]);e=r.getPartCount(t),this.opacities=new Float32Array(l.HEAPF32.buffer,r.getPartOpacities(t),e),e=r.getPartCount(t),this.parentIndices=new Int32Array(l.HEAP32.buffer,r.getPartParentPartIndices(t),e)}),a=(t.Parts=o,function(){function t(t){this._modelPtr=t;for(var e,i=null,s=(this.count=r.getDrawableCount(t),e=r.getDrawableCount(t),this.ids=new Array(e),new Uint32Array(l.HEAPU32.buffer,r.getDrawableIds(t),e)),n=0;n<s.length;n++)this.ids[n]=l.UTF8ToString(s[n]);e=r.getDrawableCount(t),this.constantFlags=new Uint8Array(l.HEAPU8.buffer,r.getDrawableConstantFlags(t),e),e=r.getDrawableCount(t),this.dynamicFlags=new Uint8Array(l.HEAPU8.buffer,r.getDrawableDynamicFlags(t),e),e=r.getDrawableCount(t),this.textureIndices=new Int32Array(l.HEAP32.buffer,r.getDrawableTextureIndices(t),e),e=r.getDrawableCount(t),this.drawOrders=new Int32Array(l.HEAP32.buffer,r.getDrawableDrawOrders(t),e),e=r.getDrawableCount(t),this.renderOrders=new Int32Array(l.HEAP32.buffer,r.getDrawableRenderOrders(t),e),e=r.getDrawableCount(t),this.opacities=new Float32Array(l.HEAPF32.buffer,r.getDrawableOpacities(t),e),e=r.getDrawableCount(t),this.maskCounts=new Int32Array(l.HEAP32.buffer,r.getDrawableMaskCounts(t),e),e=r.getDrawableCount(t),this.vertexCounts=new Int32Array(l.HEAP32.buffer,r.getDrawableVertexCounts(t),e),e=r.getDrawableCount(t),this.indexCounts=new Int32Array(l.HEAP32.buffer,r.getDrawableIndexCounts(t),e),e=r.getDrawableCount(t),this.multiplyColors=new Float32Array(l.HEAPF32.buffer,r.getDrawableMultiplyColors(t),4*e),e=r.getDrawableCount(t),this.screenColors=new Float32Array(l.HEAPF32.buffer,r.getDrawableScreenColors(t),4*e),e=r.getDrawableCount(t),this.parentPartIndices=new Int32Array(l.HEAP32.buffer,r.getDrawableParentPartIndices(t),e),e=r.getDrawableCount(t),i=new Int32Array(l.HEAP32.buffer,r.getDrawableMaskCounts(t),e),this.masks=new Array(e);var o=new Uint32Array(l.HEAPU32.buffer,r.getDrawableMasks(t),e);for(n=0;n<o.length;n++)this.masks[n]=new Int32Array(l.HEAP32.buffer,o[n],i[n]);e=r.getDrawableCount(t),i=new Int32Array(l.HEAP32.buffer,r.getDrawableVertexCounts(t),e),this.vertexPositions=new Array(e);var a=new Uint32Array(l.HEAPU32.buffer,r.getDrawableVertexPositions(t),e);for(n=0;n<a.length;n++)this.vertexPositions[n]=new Float32Array(l.HEAPF32.buffer,a[n],2*i[n]);e=r.getDrawableCount(t),i=new Int32Array(l.HEAP32.buffer,r.getDrawableVertexCounts(t),e),this.vertexUvs=new Array(e);var h=new Uint32Array(l.HEAPU32.buffer,r.getDrawableVertexUvs(t),e);for(n=0;n<h.length;n++)this.vertexUvs[n]=new Float32Array(l.HEAPF32.buffer,h[n],2*i[n]);e=r.getDrawableCount(t),i=new Int32Array(l.HEAP32.buffer,r.getDrawableIndexCounts(t),e),this.indices=new Array(e);var u=new Uint32Array(l.HEAPU32.buffer,r.getDrawableIndices(t),e);for(n=0;n<u.length;n++)this.indices[n]=new Uint16Array(l.HEAPU16.buffer,u[n],i[n])}return t.prototype.resetDynamicFlags=function(){r.resetDrawableDynamicFlags(this._modelPtr)},t}()),h=(i=(t.Drawables=a,function(){function t(){}return t.hasBlendAdditiveBit=function(t){return!(1&~t)},t.hasBlendMultiplicativeBit=function(t){return!(2&~t)},t.hasIsDoubleSidedBit=function(t){return!(4&~t)},t.hasIsInvertedMaskBit=function(t){return!(8&~t)},t.hasIsVisibleBit=function(t){return!(1&~t)},t.hasVisibilityDidChangeBit=function(t){return!(2&~t)},t.hasOpacityDidChangeBit=function(t){return!(4&~t)},t.hasDrawOrderDidChangeBit=function(t){return!(8&~t)},t.hasRenderOrderDidChangeBit=function(t){return!(16&~t)},t.hasVertexPositionsDidChangeBit=function(t){return!(32&~t)},t.hasBlendColorDidChangeBit=function(t){return!(64&~t)},t}()),i=(t.Utils=i,function(){function t(){}return t.initializeAmountOfMemory=function(t){16777216<t&&r.initializeAmountOfMemory(t)},t}()),t.Memory=i,e="undefined"!=typeof document&&document.currentScript?document.currentScript.src:void 0,function(t){t=t||{};var r,i,s={};for(i in r=r||(void 0!==t?t:{}))r.hasOwnProperty(i)&&(s[i]=r[i]);var n,o,a,h,l="object"==typeof window,u="function"==typeof importScripts,c="object"==typeof process&&"object"==typeof process.versions&&"string"==typeof process.versions.node&&!l&&!u,d=!l&&!c&&!u,f="",p=(c?(f=__dirname+"/",a=function(t,e){var r=Q(t);return r||(n=n||require("fs"),t=(o=o||require("path")).normalize(t),r=n.readFileSync(t)),e?r:r.toString()},h=function(t){return A((t=(t=a(t,!0)).buffer?t:new Uint8Array(t)).buffer),t},1<process.argv.length&&process.argv[1].replace(/\\/g,"/"),process.argv.slice(2),process.on("uncaughtException",(function(t){throw t})),process.on("unhandledRejection",V),r.inspect=function(){return"[Emscripten Module object]"}):d?("undefined"!=typeof read&&(a=function(t){var e=Q(t);return e?q(e):read(t)}),h=function(t){var e;if(!(e=Q(t))){if("function"==typeof readbuffer)return new Uint8Array(readbuffer(t));A("object"==typeof(e=read(t,"binary")))}return e},"undefined"!=typeof print&&((console="undefined"==typeof console?{}:console).log=print,console.warn=console.error="undefined"!=typeof printErr?printErr:print)):(l||u)&&(u?f=self.location.href:document.currentScript&&(f=document.currentScript.src),f=0!==(f=e||f).indexOf("blob:")?f.substr(0,f.lastIndexOf("/")+1):"",a=function(t){try{var e=new XMLHttpRequest;return e.open("GET",t,!1),e.send(null),e.responseText}catch(e){if(t=Q(t))return q(t);throw e}},u)&&(h=function(t){try{var e=new XMLHttpRequest;return e.open("GET",t,!1),e.responseType="arraybuffer",e.send(null),new Uint8Array(e.response)}catch(e){if(t=Q(t))return t;throw e}}),r.print||console.log.bind(console)),_=r.printErr||console.warn.bind(console);for(i in s)s.hasOwnProperty(i)&&(r[i]=s[i]);function m(){return{exports:function(t,e,r){var i=new ArrayBuffer(8),s=new Int32Array(i),n=new Float32Array(i),o=new Float64Array(i);function a(t,e){s[t]=e}function h(){return o[0]}function l(t){o[0]=t}function u(t){n[0]=t}function c(){return n[0]}i=e.buffer;var d,f,p,_,m,g,y,b,v,x,A,T,E,w,S,C,P,M,$,I,R,D,L,F,O=new Uint8Array(i);return(i=function(t,e){var r,i;if("undefined"==typeof Buffer)for(r=atob(e),i=0;i<r.length;i++)O[t+i]=r.charCodeAt(i);else for(r=Buffer.from(e,"base64"),i=0;i<r.length;i++)O[t+i]=r[i]})(1024,"QW4gZXJyb3Igb2NjdXJyZWQgaW4gdGhlIGludGVycG9sYXRpb24gZm9yIGJsZW5kIHNoYXBlcy4gQ29tYmluYXRpb25Db3VudCBpcyAlZC4ACgBbQ1NNXSBbRV1XYXJwRGVmb3JtZXI6OlRyYW5zZm9ybVRhcmdldCgpIGVycm9yLiBbJWRdIHAwMT0oJS40ZiAsICUuNGYpCgBbQ1NNXSBbRV1Jbml0aWFsaXplRGVmb3JtZXJzKCk6IFVua25vd24gRGVmb3JtZXIgVHlwZS4KAFtDU01dIFtFXWNzbUhhc01vY0NvbnNpc3RlbmN5OiBUaGlzIG1vYzMgc2l6ZSBpcyBpbnZhbGlkLgoAW0NTTV0gW0VdJXM6ICVzCgBbQ1NNXSBbV11Sb3RhdGlvbkRlZm9ybWVyOiBOb3QgZm91bmQgdHJhbnNmb3JtZWQgRGlyZWN0aW9uLgoAW0NTTV0gW0VdVXBkYXRlRGVmb3JtZXJIaWVyYXJjaHkoKTogVW5rbm93biBEZWZvcm1lciBUeXBlLgoAJXMKACAgAE1PQzMAImFkZHJlc3MiIGlzIG51bGwuACUwMlggAFtDU01dIFtFXWNzbUhhc01vY0NvbnNpc3RlbmN5OiBGaWxlVHlwZSBpcyBpbnZhbGlkLgoAImFkZHJlc3MiIGFsaWdubWVudCBpcyBpbnZhbGlkLgBbQ1NNXSBbRV1jc21IYXNNb2NDb25zaXN0ZW5jeTogVGhpcyBtb2MzIHZlciBpcyBpbnZhbGlkIFt2ZXI6JWRdLgoAInNpemUiIGlzIGludmFsaWQuAFtDU01dIFtFXWNzbUhhc01vY0NvbnNpc3RlbmN5OiBUaGUgQ29yZSB1bnN1cHBvcnQgbGF0ZXIgdGhhbiBtb2MzIHZlcjpbJWRdLiBUaGlzIG1vYzMgdmVyIGlzIFslZF0uCgAibW9kZWwiIGlzIGludmFsaWQuAFtDU01dIFtFXWNzbUhhc01vY0NvbnNpc3RlbmN5OiBIZWFkZXIgc2VjdGlvbiBpcyBpbnZhbGlkLgoAIm91dFNpemVJblBpeGVscyIgaXMgbnVsbC4AW0NTTV0gW0VdY3NtSGFzTW9jQ29uc2lzdGVuY3k6IERhdGEgc2VjdGlvbiBpcyBpbnZhbGlkLgoAIm91dE9yaWdpbkluUGl4ZWxzIiBpcyBudWxsLgBbQ1NNXSBbRV1jc21SZXZpdmVNb2NJblBsYWNlIGlzIGZhaWxlZC4gQ29ycnVwdGVkICBtb2MzIGZpbGUuCgAib3V0UGl4ZWxzUGVyVW5pdCIgaXMgbnVsbC4AW0NTTV0gW0VdY3NtUmV2aXZlTW9jSW5QbGFjZSBpcyBmYWlsZWQuIFRoZSBDb3JlIHVuc3VwcG9ydCBsYXRlciB0aGFuIG1vYzMgdmVyOlslZF0uIFRoaXMgbW9jMyB2ZXIgaXMgWyVkXS4KACJtb2MiIGlzIGludmFsaWQuAFtDU01dIFtFXWNzbUdldE1vY1ZlcnNpb24gaXMgZmFpbGVkLiBDb3JydXB0ZWQgbW9jMyBmaWxlLgoAInNpemUiIGlzIGludmFsaWQATGl2ZTJEIEN1YmlzbSBTREsgQ29yZSBWZXJzaW9uICVkLiVkLiVkAGNzbUdldE1vY1ZlcnNpb24AY3NtSGFzTW9jQ29uc2lzdGVuY3kAY3NtUmV2aXZlTW9jSW5QbGFjZQBjc21SZWFkQ2FudmFzSW5mbwBjc21HZXRTaXplb2ZNb2RlbABjc21Jbml0aWFsaXplTW9kZWxJblBsYWNlAGNzbVVwZGF0ZU1vZGVsAGNzbUdldFBhcmFtZXRlckNvdW50AGNzbUdldFBhcmFtZXRlcklkcwBjc21HZXRQYXJhbWV0ZXJUeXBlcwBjc21HZXRQYXJhbWV0ZXJNaW5pbXVtVmFsdWVzAGNzbUdldFBhcmFtZXRlck1heGltdW1WYWx1ZXMAY3NtR2V0UGFyYW1ldGVyRGVmYXVsdFZhbHVlcwBjc21HZXRQYXJhbWV0ZXJWYWx1ZXMAY3NtR2V0UGFydENvdW50AGNzbUdldFBhcnRJZHMAY3NtR2V0UGFydE9wYWNpdGllcwBjc21HZXRQYXJ0UGFyZW50UGFydEluZGljZXMAY3NtR2V0RHJhd2FibGVDb3VudABjc21HZXREcmF3YWJsZUlkcwBjc21HZXREcmF3YWJsZUNvbnN0YW50RmxhZ3MAY3NtR2V0RHJhd2FibGVEeW5hbWljRmxhZ3MAY3NtR2V0RHJhd2FibGVUZXh0dXJlSW5kaWNlcwBjc21HZXREcmF3YWJsZURyYXdPcmRlcnMAY3NtR2V0RHJhd2FibGVSZW5kZXJPcmRlcnMAY3NtR2V0RHJhd2FibGVPcGFjaXRpZXMAY3NtR2V0RHJhd2FibGVNYXNrQ291bnRzAGNzbUdldERyYXdhYmxlTWFza3MAY3NtR2V0RHJhd2FibGVWZXJ0ZXhDb3VudHMAY3NtR2V0RHJhd2FibGVWZXJ0ZXhQb3NpdGlvbnMAY3NtR2V0RHJhd2FibGVWZXJ0ZXhVdnMAY3NtR2V0RHJhd2FibGVJbmRleENvdW50cwBjc21HZXREcmF3YWJsZUluZGljZXMAY3NtR2V0RHJhd2FibGVNdWx0aXBseUNvbG9ycwBjc21HZXREcmF3YWJsZVNjcmVlbkNvbG9ycwBjc21HZXREcmF3YWJsZVBhcmVudFBhcnRJbmRpY2VzAGNzbVJlc2V0RHJhd2FibGVEeW5hbWljRmxhZ3MAY3NtR2V0UGFyYW1ldGVyS2V5Q291bnRzAGNzbUdldFBhcmFtZXRlcktleVZhbHVlcw=="),i(3228,"Cg=="),i(3267,"//////8="),i(3336,"LSsgICAwWDB4AChudWxsKQ=="),i(3360,"EQAKABEREQAAAAAFAAAAAAAACQAAAAAL"),i(3392,"EQAPChEREQMKBwABEwkLCwAACQYLAAALAAYRAAAAERER"),i(3441,"Cw=="),i(3450,"EQAKChEREQAKAAACAAkLAAAACQALAAAL"),i(3499,"DA=="),i(3511,"DAAAAAAMAAAAAAkMAAAAAAAMAAAM"),i(3557,"Dg=="),i(3569,"DQAAAAQNAAAAAAkOAAAAAAAOAAAO"),i(3615,"EA=="),i(3627,"DwAAAAAPAAAAAAkQAAAAAAAQAAAQAAASAAAAEhIS"),i(3682,"EgAAABISEgAAAAAAAAk="),i(3731,"Cw=="),i(3743,"CgAAAAAKAAAAAAkLAAAAAAALAAAL"),i(3789,"DA=="),i(3801,"DAAAAAAMAAAAAAkMAAAAAAAMAAAMAAAwMTIzNDU2Nzg5QUJDREVGLTBYKzBYIDBYLTB4KzB4IDB4AGluZgBJTkYAbmFuAE5BTgAuAAAAAKgaAAAAAAAAAwAAAAQAAAAEAAAABgAAAIP5ogBETm4A/CkVANFXJwDdNPUAYtvAADyZlQBBkEMAY1H+ALveqwC3YcUAOm4kANJNQgBJBuAACeouAByS0QDrHf4AKbEcAOg+pwD1NYIARLsuAJzphAC0JnAAQX5fANaROQBTgzkAnPQ5AItfhAAo+b0A+B87AN7/lwAPmAUAES/vAApaiwBtH20Az342AAnLJwBGT7cAnmY/AC3qXwC6J3UA5evHAD178QD3OQcAklKKAPtr6gAfsV8ACF2NADADVgB7/EYA8KtrACC8zwA29JoA46kdAF5hkQAIG+YAhZllAKAUXwCNQGgAgNj/ACdzTQAGBjEAylYVAMmocwB74mAAa4zAABnERwDNZ8MACejcAFmDKgCLdsQAphyWAESv3QAZV9EApT4FAAUH/wAzfj8AwjLoAJhP3gC7fTIAJj3DAB5r7wCf+F4ANR86AH/yygDxhx0AfJAhAGokfADVbvoAMC13ABU7QwC1FMYAwxmdAK3EwgAsTUEADABdAIZ9RgDjcS0Am8aaADNiAAC00nwAtKeXADdV1QDXPvYAoxAYAE12/ABknSoAcNerAGN8+AB6sFcAFxXnAMBJVgA71tkAp4Q4ACQjywDWincAWlQjAAAfuQDxChsAGc7fAJ8x/wBmHmoAmVdhAKz7RwB+f9gAImW3ADLoiQDmv2AA78TNAGw2CQBdP9QAFt7XAFg73gDem5IA0iIoACiG6ADiWE0AxsoyAAjjFgDgfcsAF8BQAPMdpwAY4FsALhM0AIMSYgCDSAEA9Y5bAK2wfwAe6fIASEpDABBn0wCq3dgArl9CAGphzgAKKKQA05m0AAam8gBcd38Ao8KDAGE8iACKc3gAr4xaAG/XvQAtpmMA9L/LAI2B7wAmwWcAVcpFAMrZNgAoqNIAwmGNABLJdwAEJhQAEkabAMRZxADIxUQATbKRAAAX8wDUQ60AKUnlAP3VEAAAvvwAHpTMAHDO7gATPvUA7PGAALPnwwDH+CgAkwWUAMFxPgAuCbMAC0XzAIgSnACrIHsALrWfAEeSwgB7Mi8ADFVtAHKnkABr5x8AMcuWAHkWSgBBeeIA9N+JAOiUlwDi5oQAmTGXAIjtawBfXzYAu/0OAEiatABnpGwAcXJCAI1dMgCfFbgAvOUJAI0xJQD3dDkAMAUcAA0MAQBLCGgALO5YAEeqkAB05wIAvdYkAPd9pgBuSHIAnxbvAI6UpgC0kfYA0VNRAM8K8gAgmDMA9Ut+ALJjaADdPl8AQF0DAIWJfwBVUikAN2TAAG3YEAAySDIAW0x1AE5x1ABFVG4ACwnBACr1aQAUZtUAJwedAF0EUAC0O9sA6nbFAIf5FwBJa30AHSe6AJZpKQDGzKwArRRUAJDiagCI2YkALHJQAASkvgB3B5QA8zBwAAD8JwDqcagAZsJJAGTgPQCX3YMAoz+XAEOU/QANhowAMUHeAJI5nQDdcIwAF7fnAAjfOwAVNysAXICgAFqAkwAQEZIAD+jYAGyArwDb/0sAOJAPAFkYdgBipRUAYcu7AMeJuQAQQL0A0vIEAEl1JwDrtvYA2yK7AAoUqgCJJi8AZIN2AAk7MwAOlBoAUTqqAB2jwgCv7a4AXCYSAG3CTQAtepwAwFaXAAM/gwAJ8PYAK0CMAG0xmQA5tAcADCAVANjDWwD1ksQAxq1LAE7KpQCnN80A5qk2AKuSlADdQmgAGWPeAHaM7wBoi1IA/Ns3AK6hqwDfFTEAAK6hAAz72gBkTWYA7QW3ACllMABXVr8AR/86AGr5uQB1vvMAKJPfAKuAMABmjPYABMsVAPoiBgDZ5B0APbOkAFcbjwA2zQkATkLpABO+pAAzI7UA8KoaAE9lqADSwaUACz8PAFt4zQAj+XYAe4sEAIkXcgDGplMAb27iAO/rAACbSlgAxNq3AKpmugB2z88A0QIdALHxLQCMmcEAw613AIZI2gD3XaAAxoD0AKzwLwDd7JoAP1y8ANDebQCQxx8AKtu2AKMlOgAAr5oArVOTALZXBAApLbQAS4B+ANoHpwB2qg4Ae1mhABYSKgDcty0A+uX9AInb/gCJvv0A5HZsAAap/AA+gHAAhW4VAP2H/wAoPgcAYWczACoYhgBNveoAs+evAI9tbgCVZzkAMb9bAITXSAAw3xYAxy1DACVhNQDJcM4AMMu4AL9s/QCkAKIABWzkAFrdoAAhb0cAYhLSALlchABwYUkAa1bgAJlSAQBQVTcAHtW3ADPxxAATbl8AXTDkAIUuqQAdssMAoTI2AAi3pADqsdQAFvchAI9p5AAn/3cADAOAAI1ALQBPzaAAIKWZALOi0wAvXQoAtPlCABHaywB9vtAAm9vBAKsXvQDKooEACGpcAC5VFwAnAFUAfxTwAOEHhgAUC2QAlkGNAIe+3gDa/SoAayW2AHuJNAAF8/4Aub+eAGhqTwBKKqgAT8RaAC34vADXWpgA9MeVAA1NjQAgOqYApFdfABQ/sQCAOJUAzCABAHHdhgDJ3rYAv2D1AE1lEQABB2sAjLCsALLA0ABRVUgAHvsOAJVywwCjBjsAwEA1AAbcewDgRcwATin6ANbKyADo80EAfGTeAJtk2ADZvjEApJfDAHdY1ABp48UA8NoTALo6PABGGEYAVXVfANK99QBuksYArC5dAA5E7QAcPkIAYcSHACn96QDn1vMAInzKAG+RNQAI4MUA/9eNAG5q4gCw/cYAkwjBAHxddABrrbIAzW6dAD5yewDGEWoA98+pAClz3wC1yboAtwBRAOKyDQB0uiQA5X1gAHTYigANFSwAgRgMAH5mlAABKRYAn3p2AP39vgBWRe8A2X42AOzZEwCLurkAxJf8ADGoJwDxbsMAlMU2ANioVgC0qLUAz8wOABKJLQBvVzQALFaJAJnO4wDWILkAa16qAD4qnAARX8wA/QtKAOH0+wCOO20A4oYsAOnUhAD8tKkA7+7RAC41yQAvOWEAOCFEABvZyACB/AoA+0pqAC8c2ABTtIQATpmMAFQizAAqVdwAwMbWAAsZlgAacLgAaZVkACZaYAA/Uu4AfxEPAPS1EQD8y/UANLwtADS87gDoXcwA3V5gAGeOmwCSM+8AyRe4AGFYmwDhV7wAUYPGANg+EADdcUgALRzdAK8YoQAhLEYAWfPXANl6mACeVMAAT4b6AFYG/ADlea4AiSI2ADitIgBnk9wAVeiqAIImOADK55sAUQ2kAJkzsQCp1w4AaQVIAGWy8AB/iKcAiEyXAPnRNgAhkrMAe4JKAJjPIQBAn9wA3EdVAOF0OgBn60IA/p3fAF7UXwB7Z6QAuqx6AFX2ogAriCMAQbpVAFluCAAhKoYAOUeDAInj5gDlntQASftAAP9W6QAcD8oAxVmKAJT6KwDTwcUAD8XPANtargBHxYYAhUNiACGGOwAseZQAEGGHACpMewCALBoAQ78SAIgmkAB4PIkAqMTkAOXbewDEOsIAJvTqAPdnigANkr8AZaMrAD2TsQC9fAsApFHcACfdYwBp4d0AmpQZAKgplQBozigACe20AESfIABOmMoAcIJjAH58IwAPuTIAp/WOABRW5wAh8QgAtZ0qAG9+TQClGVEAtfmrAILf1gCW3WEAFjYCAMQ6nwCDoqEAcu1tADmNegCCuKkAazJcAEYnWwAANO0A0gB3APz0VQABWU0A4HGA"),i(6675,"QPsh+T8AAAAALUR0PgAAAICYRvg8AAAAYFHMeDsAAACAgxvwOQAAAEAgJXo4AAAAgCKC4zYAAAAAHfNpNThj7T7aD0k/Xph7P9oPyT9pN6wxaCEiM7QPFDNoIaIz2w9JP9sPSb/kyxZA5MsWwAAAAAAAAACA2w9JQNsPScAAAIA/AADAPwAAAADcz9E1AAAAAADAFT8="),i(6824,"BQ=="),i(6836,"DQ=="),i(6860,"DgAAAA8AAABYHAAAAAQ="),i(6884,"AQ=="),i(6899,"Cv////8="),i(7156,"gCA="),d={Int8Array:Int8Array,Int16Array:Int16Array,Int32Array:Int32Array,Uint8Array:Uint8Array,Uint16Array:Uint16Array,Uint32Array:Uint32Array,Float32Array:Float32Array,Float64Array:Float64Array,NaN:NaN,Infinity:1/0,Math:Math},f=e.buffer,p=(i=t).memory,_=r,m=new d.Int8Array(f),g=new d.Int16Array(f),y=new d.Int32Array(f),b=new d.Uint8Array(f),v=new d.Uint16Array(f),x=new d.Uint32Array(f),A=new d.Float32Array(f),T=new d.Float64Array(f),E=d.Math.imul,w=d.Math.fround,S=d.Math.abs,C=d.Math.clz32,P=d.Math.min,d.Math.max,M=d.Math.floor,d.Math.ceil,d.Math.sqrt,i.abort,d.NaN,$=d.Infinity,I=i.a,R=i.b,D=i.c,L=5251744,F=0,_[1]=function(t,e,r,i,s){t|=0,e|=0,r|=0,i|=0,s|=0;var n,o,a,h,l,u,c,d,f,p,_,m,g,b,v,x,C,P,M,$,I,R,D,F,O=0,k=w(0),N=w(0),U=0,G=w(0),V=w(0),H=w(0),z=w(0),X=w(0),W=w(0),Y=w(0),j=w(0),q=w(0),Z=w(0),Q=w(0),J=w(0),K=w(0),tt=w(0),et=w(0),rt=w(0),it=w(0),st=w(0),nt=w(0),ot=(w(0),w(0),w(0),w(0),w(0),w(0),w(0),w(0),w(0),0);if(L=F=L-32|0,1<=(0|s))for(n=y[16+(y[t+308>>2]+(e<<5)|0)>>2],O=y[t+60>>2]+E(n,24)|0,e=(o=y[O+8>>2])+-1|0,m=(l=y[O+4>>2])+-1|0,g=f=(n=y[y[t+152>>2]+(n<<2)>>2])+(o<<3)|0,b=p=n+((d=E(l,a=o+1|0))<<3)|0,v=_=n+(o+d<<3)|0,D=y[O+12>>2],u=w(0|l),c=w(0|o),t=0;H=A[4+(O=(h=t<<3)+r|0)>>2],N=w(H*u),z=A[O>>2],k=w(z*c),O=H>=w(1),N=!(H<w(0)^1)||O|z>=w(1)|z<w(0)?(ot||(q=A[4+v>>2],x=A[n+4>>2],X=w(q-x),C=A[4+g>>2],P=A[4+b>>2],W=w(C-P),Z=w(w(X-W)*w(.5)),M=A[_>>2],$=A[n>>2],Y=w(M-$),I=A[f>>2],R=A[p>>2],j=w(I-R),Q=w(w(Y-j)*w(.5)),W=w(w(W+X)*w(.5)),j=w(w(j+Y)*w(.5)),ot=1,X=w(w(w(w(w(x+C)+P)+q)*w(.25))-w(X*w(.5))),Y=w(w(w(w(w($+I)+R)+M)*w(.25))-w(Y*w(.5)))),H<w(3)^1|z>w(-2)^1|z<w(3)^1|H>w(-2)^1?(A[i+h>>2]=w(H*Q)+w(w(z*j)+Y),k=w(H*Z),w(w(z*W)+X)):(z<=w(0)?H<=w(0)?(V=w(w(H+w(2))*w(.5)),G=w(w(z+w(2))*w(.5)),k=w(Z+Z),st=w(X-k),N=w(Q+Q),nt=w(Y-N),rt=w(X-w(W+W)),J=w(rt-k),it=w(Y-w(j+j)),K=w(it-N),tt=A[n+4>>2],et=A[n>>2]):O?(k=w(Z*w(3)),N=w(X-w(W+W)),rt=w(k+N),J=w(Q*w(3)),K=w(Y-w(j+j)),it=w(J+K),V=w(w(H+w(-1))*w(.5)),G=w(w(z+w(2))*w(.5)),tt=w(k+X),et=w(J+Y),J=w(Z+N),K=w(Q+K),st=A[4+b>>2],nt=A[p>>2]):(k=w(X-w(W+W)),O=m,U=w(S(N))<w(2147483648)?~~N:-2147483648,V=w(0|(O=(0|U)==(0|l)?O:U)),G=w(V/u),J=w(w(G*Z)+k),q=w(G*Q),G=w(Y-w(j+j)),K=w(q+G),H=w(w(0|(U=O+1|0))/u),rt=w(w(H*Z)+k),it=w(w(H*Q)+G),G=w(w(z+w(2))*w(.5)),V=w(N-V),O=n+(E(O,a)<<3)|0,st=A[O+4>>2],nt=A[O>>2],O=n+(E(U,a)<<3)|0,tt=A[O+4>>2],et=A[O>>2]):z>=w(1)?H<=w(0)?(V=w(w(H+w(2))*w(.5)),G=w(w(z+w(-1))*w(.5)),k=w(Z+Z),J=w(w(W+X)-k),N=w(Q+Q),K=w(w(j+Y)-N),tt=w(w(W*w(3))+X),st=w(tt-k),et=w(w(j*w(3))+Y),nt=w(et-N),rt=A[4+g>>2],it=A[f>>2]):O?(k=w(Z*w(3)),rt=w(k+w(W+X)),N=w(Q*w(3)),it=w(N+w(j+Y)),q=k,k=w(w(W*w(3))+X),tt=w(q+k),q=N,N=w(w(j*w(3))+Y),et=w(q+N),V=w(w(H+w(-1))*w(.5)),G=w(w(z+w(-1))*w(.5)),st=w(Z+k),nt=w(Q+N),J=A[4+v>>2],K=A[_>>2]):(k=w(w(W*w(3))+X),O=m,U=w(S(N))<w(2147483648)?~~N:-2147483648,V=w(0|(O=(0|U)==(0|l)?O:U)),G=w(V/u),st=w(w(G*Z)+k),q=w(G*Q),G=w(w(j*w(3))+Y),nt=w(q+G),H=w(w(0|(U=O+1|0))/u),tt=w(w(H*Z)+k),et=w(w(H*Q)+G),G=w(w(z+w(-1))*w(.5)),V=w(N-V),O=n+(E(O,a)+o<<3)|0,J=A[O+4>>2],K=A[O>>2],O=n+(E(U,a)+o<<3)|0,rt=A[O+4>>2],it=A[O>>2]):H<=w(0)?(V=w(w(H+w(2))*w(.5)),O=e,U=w(S(N=k))<w(2147483648)?~~k:-2147483648,k=w(0|(O=(0|U)==(0|o)?O:U)),G=w(N-k),k=w(k/c),N=w(Z+Z),J=w(w(w(k*W)+X)-N),q=w(w(k*j)+Y),k=w(Q+Q),K=w(q-k),H=w(w(0|(U=O+1|0))/c),st=w(w(w(H*W)+X)-N),nt=w(w(w(H*j)+Y)-k),rt=A[4+(O=n+(O<<3)|0)>>2],it=A[O>>2],tt=A[4+(O=n+(U<<3)|0)>>2],et=A[O>>2]):O?(q=N=w(Z*w(3)),O=e,U=w(S(k))<w(2147483648)?~~k:-2147483648,G=w(0|(O=(0|U)==(0|o)?O:U)),V=w(G/c),rt=w(q+w(w(V*W)+X)),z=w(Q*w(3)),it=w(z+w(w(V*j)+Y)),q=N,N=w(w(0|(U=O+1|0))/c),tt=w(q+w(w(N*W)+X)),et=w(z+w(w(N*j)+Y)),V=w(w(H+w(-1))*w(.5)),G=w(k-G),J=A[4+(O=n+(O+d<<3)|0)>>2],K=A[O>>2],st=A[4+(O=n+(U+d<<3)|0)>>2],nt=A[O>>2]):(T[16+F>>3]=H,y[F>>2]=t,T[8+F>>3]=z,B(4,1107,F)),w(G+V)<=w(1)?(A[i+h>>2]=w(K+w(w(nt-K)*G))+w(w(it-K)*V),k=w(J+w(w(st-J)*G)),w(w(rt-J)*V)):(k=w(w(1)-G),N=w(w(1)-V),A[i+h>>2]=w(et+w(w(it-et)*k))+w(w(nt-et)*N),k=w(tt+w(w(rt-tt)*k)),w(w(st-tt)*N)))):(O=w(S(q=N))<w(2147483648)?~~N:-2147483648,V=w(q-w(0|O)),U=w(S(N=k))<w(2147483648)?~~k:-2147483648,G=w(N-w(0|U)),O=U+E(O,a)|0,D?(k=w(w(1)-V),N=w(w(1)-G),U=n+(O<<3)|0,O=n+(O+a<<3)|0,A[i+h>>2]=w(w(w(k*w(N*A[U>>2]))+w(k*w(G*A[U+8>>2])))+w(V*w(N*A[O>>2])))+w(V*w(G*A[O+8>>2])),k=w(w(w(k*w(N*A[U+4>>2]))+w(k*w(G*A[U+12>>2])))+w(V*w(N*A[O+4>>2]))),w(V*w(G*A[O+12>>2]))):w(G+V)<=w(1)?(k=w(w(w(1)-G)-V),U=n+(O<<3)|0,O=n+(O+a<<3)|0,A[i+h>>2]=w(w(k*A[U>>2])+w(G*A[U+8>>2]))+w(V*A[O>>2]),k=w(w(k*A[U+4>>2])+w(G*A[U+12>>2])),w(V*A[O+4>>2])):(k=w(w(G+w(-1))+V),U=n+(O+a<<3)|0,N=w(w(1)-G),H=w(w(1)-V),O=n+(O<<3)|0,A[i+h>>2]=w(w(k*A[U+8>>2])+w(N*A[U>>2]))+w(H*A[O+8>>2]),k=w(w(k*A[U+12>>2])+w(N*A[U+4>>2])),w(H*A[O+12>>2]))),A[4+(i+h|0)>>2]=k+N,(0|s)!=(0|(t=t+1|0)););L=32+F|0},_[2]=function(t,e){t|=0,e|=0;var r=0,i=0,s=0,n=0,o=0,a=w(0),h=0,l=0,u=(w(0),0),c=0;n=y[t+320>>2],r=y[t+316>>2],o=y[t+308>>2];-1==(0|(i=y[8+(s=o+(e<<5)|0)>>2]))?(y[(c=r)+(r=e<<2)>>2]=y[y[t+148>>2]+(y[s+16>>2]<<2)>>2],y[r+n>>2]=1065353216):(h=y[s+16>>2],l=y[y[t+152>>2]+(h<<2)>>2],_[y[24+(o+(i<<5)|0)>>2]](t,i,l,l,y[16+(y[t+60>>2]+E(h,24)|0)>>2]),a=A[y[t+148>>2]+(y[s+16>>2]<<2)>>2],s=y[s+8>>2]<<2,A[(i=e<<2)+r>>2]=a*A[s+r>>2],y[i+n>>2]=y[s+n>>2]),4<=b[y[t>>2]+4|0]&&(n=e<<2,r=y[t+308>>2]+(e<<5)|0,i=y[r+16>>2]<<2,s=y[t+328>>2],e=y[t+324>>2],-1==(0|(o=y[r+8>>2]))?(o=y[t+156>>2],y[(r=n<<2)+e>>2]=y[o+(i<<=2)>>2],y[(h=4|r)+e>>2]=y[(l=4|i)+o>>2],y[(u=8|r)+e>>2]=y[o+(c=8|i)>>2],y[e+((n|=3)<<2)>>2]=1065353216,t=y[t+160>>2],y[r+s>>2]=y[t+i>>2],y[s+h>>2]=y[t+l>>2],y[s+u>>2]=y[t+c>>2]):(i=(l=i<<2)+y[t+156>>2]|0,A[(r=(h=n<<2)+e|0)>>2]=A[i>>2]*A[(o=(u=o<<4)+e|0)>>2],A[r+4>>2]=A[i+4>>2]*A[o+4>>2],A[r+8>>2]=A[i+8>>2]*A[o+8>>2],y[e+((n|=3)<<2)>>2]=1065353216,t=l+y[t+160>>2]|0,c=A[t>>2],a=A[(r=s+u|0)>>2],A[(e=s+h|0)>>2]=w(c+a)-w(c*a),c=A[t+4>>2],a=A[r+4>>2],A[e+4>>2]=w(c+a)-w(c*a),c=A[t+8>>2],a=A[r+8>>2],A[e+8>>2]=w(c+a)-w(c*a)),y[s+(n<<2)>>2]=1065353216)},_[3]=function(t,e,r,i,n){t|=0,e|=0,r|=0,i|=0,n|=0;var o,a,h,l,c,d=0,f=(d=(w(0),w(0),w(0),w(0),w(0),w(0),w(0),w(0),(e=y[16+(y[t+308>>2]+(e<<5)|0)>>2])<<2),function(t){var e,r,i,n,o=w(0);L=i=L-16|0,u(t);t:if((e=2147483647&(n=s[0]))>>>0<=1061752794)o=w(1),e>>>0<964689920||(o=H(+t));else if(e>>>0<=1081824209)r=+t,o=1075235812<=e>>>0?w(-H(((0|n)<0?3.141592653589793:-3.141592653589793)+r)):V((0|n)<=-1?1.5707963267948966+r:1.5707963267948966-r);else if(e>>>0<=1088565717)o=1085271520<=e>>>0?H(+t+((0|n)<0?6.283185307179586:-6.283185307179586)):V((0|n)<=-1?-4.71238898038469-+t:+t-4.71238898038469);else if(o=w(t-t),!(2139095040<=e>>>0))if((e=3&gt(t,8+i|0))>>>0<=2){switch(e-1|0){default:o=H(T[8+i>>3]);break t;case 0:o=V(-T[8+i>>3]);break t;case 1:}o=w(-H(T[8+i>>3]))}else o=V(T[8+i>>3]);return L=16+i|0,o}(m=w(w(w(A[4+(y[t+168>>2]+E(e,12)|0)>>2]+A[d+y[t+284>>2]>>2])*w(3.1415927410125732))/w(180)))),p=A[d+y[t+272>>2]>>2],_=y[d+y[t+292>>2]>>2],m=function(t){var e,r,i,n=0;L=r=L-16|0,u(t);t:if((e=2147483647&(i=s[0]))>>>0<=1061752794)e>>>0<964689920||(t=V(+t));else if(e>>>0<=1081824209)n=+t,t=e>>>0<=1075235811?(0|i)<=-1?w(-H(n+1.5707963267948966)):H(n+-1.5707963267948966):V(-(((0|i)<0?3.141592653589793:-3.141592653589793)+n));else if(e>>>0<=1088565717)n=+t,t=e>>>0<=1085271519?(0|i)<=-1?H(n+4.71238898038469):w(-H(n+-4.71238898038469)):V(((0|i)<0?6.283185307179586:-6.283185307179586)+n);else if(2139095040<=e>>>0)t=w(t-t);else if((e=3&gt(t,8+r|0))>>>0<=2){switch(e-1|0){default:t=V(T[8+r>>3]);break t;case 0:t=H(T[8+r>>3]);break t;case 1:}t=V(-T[8+r>>3])}else t=w(-H(T[8+r>>3]));return L=16+r|0,t}(m);if((e=0)<(0|n))for(f=w(p*f),a=w(_?-1:1),l=w(f*a),o=y[d+y[t+288>>2]>>2]?w(-1):w(1),c=w(w(p*m)*o),f=w(f*o),p=w(w(p*w(-m))*a),m=A[d+y[t+280>>2]>>2],a=A[d+y[t+276>>2]>>2];d=(t=e<<3)+i|0,o=A[(t=t+r|0)>>2],h=A[t+4>>2],A[d+4>>2]=m+w(w(c*o)+w(l*h)),A[d>>2]=a+w(w(f*o)+w(p*h)),(0|n)!=(0|(e=e+1|0)););},_[4]=function(t,e){t|=0,e|=0;var r,i,s,n,o,a,h=0,l=0,u=0,c=w(0),d=0,f=0,p=w(0),m=0,g=0,v=0;if(w(0),w(0),w(0),w(0),L=a=L+-64|0,m=y[t+320>>2],g=y[t+316>>2],l=y[t+308>>2],-1==(0|(d=y[8+(u=l+(e<<5)|0)>>2])))h=y[u+16>>2]<<2,y[(l=e<<2)+g>>2]=y[h+y[t+268>>2]>>2],y[l+m>>2]=y[h+y[t+272>>2]>>2];else{h=y[u+16>>2]<<2,v=y[h+y[t+276>>2]>>2],y[24+a>>2]=v,h=y[h+y[t+280>>2]>>2],y[28+a>>2]=h,y[16+a>>2]=0,i=1==y[12+(f=l+(d<<5)|0)>>2]?w(-10):w(-.10000000149011612),A[20+a>>2]=i,y[60+a>>2]=h,y[56+a>>2]=v,_[y[f+24>>2]](t,d,56+a|0,48+a|0,1),c=w(1),l=9;t:{for(;;){if(h=l,p=w(c*w(0)),A[32+a>>2]=p+A[56+a>>2],r=w(i*c),A[36+a>>2]=r+A[60+a>>2],_[y[f+24>>2]](t,d,32+a|0,40+a|0,1),s=w(A[44+a>>2]-A[52+a>>2]),A[44+a>>2]=s,n=w(A[40+a>>2]-A[48+a>>2]),A[40+a>>2]=n,s!=w(0)||n!=w(0)){l=y[44+a>>2],y[8+a>>2]=y[40+a>>2],y[12+a>>2]=l;break t}if(A[32+a>>2]=A[56+a>>2]-p,A[36+a>>2]=A[60+a>>2]-r,_[y[f+24>>2]](t,d,32+a|0,40+a|0,1),p=w(A[40+a>>2]-A[48+a>>2]),A[40+a>>2]=p,r=w(A[44+a>>2]-A[52+a>>2]),(A[44+a>>2]=r)!=w(0)||p!=w(0)){A[12+a>>2]=-r,A[8+a>>2]=-p;break t}if(l=h+-1|0,c=w(c*w(.10000000149011612)),!h)break}B(3,1311,0)}c=function(t,e){var r=w(0);if((r=w(_t(A[4+t>>2],A[t>>2])-_t(A[4+e>>2],A[e>>2])))<w(-3.1415927410125732))for(;(r=w(r+w(6.2831854820251465)))<w(-3.1415927410125732););if(r>w(3.1415927410125732))for(;(r=w(r+w(-6.2831854820251465)))>w(3.1415927410125732););return r}(16+a|0,8+a|0),_[y[f+24>>2]](t,y[u+8>>2],24+a|0,24+a|0,1),l=y[u+16>>2]<<2,y[l+y[t+276>>2]>>2]=y[24+a>>2],y[l+y[t+280>>2]>>2]=y[28+a>>2],h=l+y[t+284>>2]|0,A[h>>2]=A[h>>2]+w(w(c*w(-180))/w(3.1415927410125732)),u=y[u+8>>2]<<2,A[(h=e<<2)+g>>2]=A[l+y[t+268>>2]>>2]*A[u+g>>2],l=l+y[t+272>>2]|0,c=w(A[l>>2]*A[u+m>>2]),A[h+m>>2]=c,A[l>>2]=c}4<=b[y[t>>2]+4|0]&&(h=e<<2,u=y[t+308>>2]+(e<<5)|0,d=y[u+16>>2]<<2,l=y[t+328>>2],e=y[t+324>>2],-1==(0|(f=y[u+8>>2]))?(f=y[t+296>>2],y[(u=h<<2)+e>>2]=y[f+(d<<=2)>>2],y[(m=4|u)+e>>2]=y[(g=4|d)+f>>2],y[(v=8|u)+e>>2]=y[f+(o=8|d)>>2],y[e+((h|=3)<<2)>>2]=1065353216,t=y[t+300>>2],y[l+u>>2]=y[t+d>>2],y[l+m>>2]=y[t+g>>2],y[l+v>>2]=y[t+o>>2]):(d=(g=d<<2)+y[t+296>>2]|0,A[(u=(m=h<<2)+e|0)>>2]=A[d>>2]*A[(f=(v=f<<4)+e|0)>>2],A[u+4>>2]=A[d+4>>2]*A[f+4>>2],A[u+8>>2]=A[d+8>>2]*A[f+8>>2],y[e+((h|=3)<<2)>>2]=1065353216,t=g+y[t+300>>2]|0,c=A[t>>2],p=A[(u=l+v|0)>>2],A[(e=l+m|0)>>2]=w(c+p)-w(c*p),c=A[t+4>>2],p=A[u+4>>2],A[e+4>>2]=w(c+p)-w(c*p),c=A[t+8>>2],p=A[u+8>>2],A[e+8>>2]=w(c+p)-w(c*p)),y[l+(h<<2)>>2]=1065353216),L=64+a|0},_[5]=function(t,e){return t|=0,e|=0,w(0),w(0),0|((t=A[t>>2])<(e=A[e>>2])?-1:e<t)},_[6]=function(t,e,r,i){t|=0,e|=0,r|=0,i|=0;var s=0,n=0,o=w(0),a=0,h=0,l=0,u=0,c=0;if(1<=(0|(a=y[t+8>>2])))for(l=y[t+12>>2],h=y[t+20>>2];A[(n=s<<2)+l>>2]=A[e+n>>2]*A[n+h>>2],(0|(s=s+1|0))<(0|a););if(!((0|(a=y[t>>2]))<1))if(l=y[t+4>>2],i)for(n=e=0;;){if(y[i>>2]){if((0|(s=y[(h=e<<2)+y[t+16>>2]>>2]))<1)o=w(0);else for(u=s+n|0,c=y[t+12>>2],o=w(0),s=n;o=w(o+A[c+(s<<2)>>2]),(0|(s=s+1|0))<(0|u););A[r+h>>2]=o}if(i=i+4|0,n=y[l+(e<<2)>>2]+n|0,!((0|(e=e+1|0))<(0|a)))break}else for(h=y[t+16>>2],e=i=0;;){if((0|(s=y[(n=i<<2)+h>>2]))<=0)o=w(0);else for(u=e+s|0,c=y[t+12>>2],o=w(0),s=e;o=w(o+A[c+(s<<2)>>2]),(0|(s=s+1|0))<(0|u););if(A[r+n>>2]=o,e=y[n+l>>2]+e|0,!((0|(i=i+1|0))<(0|a)))break}},_[7]=function(t,e,r,i){t|=0,e|=0,r|=0,i|=0;var s=0,n=w(0),o=0,a=0,h=0,l=0,u=0;if(1<=(0|(l=y[t+8>>2])))for(a=y[t+12>>2],h=y[t+20>>2];A[(o=s<<2)+a>>2]=A[e+o>>2]*A[o+h>>2],(0|(s=s+1|0))<(0|l););if(!((0|(s=y[t>>2]))<1))if(l=y[t+4>>2],i)for(o=e=0;;){if(y[i>>2]){if((0|(s=y[(a=e<<2)+y[t+16>>2]>>2]))<1)n=w(0);else for(h=s+o|0,u=y[t+12>>2],n=w(0),s=o;n=w(n+A[u+(s<<2)>>2]),(0|(s=s+1|0))<(0|h););s=r+a|0,n=w(n+w(.0010000000474974513)),a=w(S(n))<w(2147483648)?~~n:-2147483648,y[s>>2]=a,s=y[t>>2]}if(i=i+4|0,o=y[l+(e<<2)>>2]+o|0,!((0|(e=e+1|0))<(0|s)))break}else for(a=y[t+16>>2],e=i=0;;){if((0|(s=y[(o=i<<2)+a>>2]))<=0)n=w(0);else for(h=e+s|0,u=y[t+12>>2],n=w(0),s=e;n=w(n+A[u+(s<<2)>>2]),(0|(s=s+1|0))<(0|h););if(s=r+o|0,n=w(n+w(.0010000000474974513)),h=w(S(n))<w(2147483648)?~~n:-2147483648,y[s>>2]=h,e=y[o+l>>2]+e|0,!((0|(i=i+1|0))<y[t>>2]))break}},_[8]=function(t,e,r,i,s,n){t|=0,e|=0,r|=0,i|=0,s|=0,n|=0;var o,a,h=0,l=0,u=0,c=0,d=0,f=0,p=0,_=0,m=0,g=0,b=w(0),v=0,x=y[t>>2];if(!((0|x)<1))if(o=s<<2,a=y[t+4>>2],n)for(;;){if(y[n>>2]&&(u=y[(h=c<<2)+y[t+16>>2]>>2],p=y[r+h>>2],l=y[i+h>>2],(h=(0|(_=E(l,s)))<1)||z(p,0,E(l,o)),!(h|(0|u)<1)))for(m=u+f|0,g=y[t+20>>2],h=f;;){for(b=A[(l=h<<2)+g>>2],v=y[e+l>>2],d=0;A[(l=(u=d<<2)+p|0)>>2]=A[l>>2]+w(b*A[u+v>>2]),(0|_)!=(0|(d=d+1|0)););if(!((0|(h=h+1|0))<(0|m)))break}if(n=n+4|0,f=y[(c<<2)+a>>2]+f|0,!((0|(c=c+1|0))<(0|x)))break}else for(n=0;;){if(u=y[(c=n<<2)+y[t+16>>2]>>2],p=y[r+c>>2],l=y[i+c>>2],(h=(0|(_=E(l,s)))<1)||z(p,0,E(l,o)),!(h|(0|u)<=0))for(m=u+f|0,g=y[t+20>>2],h=f;;){for(b=A[(l=h<<2)+g>>2],v=y[e+l>>2],d=0;A[(l=(u=d<<2)+p|0)>>2]=A[l>>2]+w(b*A[u+v>>2]),(0|_)!=(0|(d=d+1|0)););if(!((0|(h=h+1|0))<(0|m)))break}if(f=y[c+a>>2]+f|0,!((0|(n=n+1|0))<(0|x)))break}},_[9]=function(t){var e,r,i,s=0,n=0,o=0,a=0;if(!(y[648+(t|=0)>>2]||(0|(s=y[t+332>>2]))<1))for(r=(n=y[t+336>>2])+E(s,20)|0,s=y[t+424>>2],a=y[t+444>>2];;){if(y[s>>2]&&!((0|(o=y[n+16>>2]))<(t=1)))for(o<<=1,i=y[a>>2];A[(e=(t<<2)+i|0)>>2]=-A[e>>2],(0|(t=t+2|0))<(0|o););if(a=a+4|0,s=s+4|0,!((n=n+20|0)>>>0<r>>>0))break}},_[10]=function(t,e,r){var i;return G(i=y[20+(t|=0)>>2],e|=0,e=(r|=0)>>>0<(e=y[t+16>>2]-i|0)>>>0?r:e),y[t+20>>2]=e+y[t+20>>2],0|r},_[11]=function(t,e,r,i,n,o){t|=0,e=+e,r|=0,i|=0,n|=0,o|=0;var u,c,d,f,p=0,_=0,g=0,v=0,x=0,A=0,T=0,w=0,C=0,P=0,M=0,$=0,I=0,R=0,D=0;if(y[44+(L=d=L-560|0)>>2]=0,l(+e),p=0|s[1],c=4294967295<s[0]>>>0?0:1,f=(0|p)<-1||(0|p)<=-1&&c?(l(e=-e),p=0|s[1],s[0],R=1,3840):2048&n?(R=1,3843):(R=1&n)?3846:3841,2146435072&~p)if(e=function t(e,r){var i,n,o=0;if(l(+e),o=0|s[1],i=0|s[0],2047!=(0|(o=(n=o)>>>20&2047))){if(!o)return o=r,r=0==e?0:(e=t(0x10000000000000000*e,r),y[r>>2]+-64|0),y[o>>2]=r,e;y[r>>2]=o+-1022,a(0,0|i),a(1,-2146435073&n|1071644672),e=+h()}return e}(e,44+d|0),0!=(e+=e)&&(y[44+d>>2]=y[44+d>>2]+-1),u=16+d|0,97==(0|(c=32|o))){if(M=(P=32&o)?9+f|0:f,!(11<i>>>0)&&(p=12-i|0)){for($=8;$*=16,p=p+-1|0;);e=45==b[0|M]?-($+(-e-$)):e+$-$}for((0|u)==(0|(p=j((g=(p=y[44+d>>2])>>31)^p+g,0,u)))&&(m[15+d|0]=48,p=15+d|0),x=2|R,g=y[44+d>>2],m[0|(C=p+-2|0)]=o+15,m[p+-1|0]=(0|g)<0?45:43,p=8&n,_=16+d|0;o=_,w=P,g=S(e)<2147483648?~~e:-2147483648,m[0|_]=w|b[g+3824|0],1!=((_=o+1|0)-(16+d|0)|0)|(0==(e=16*(e-(0|g)))?!(p|0<(0|i)):0)||(m[o+1|0]=46,_=o+2|0),0!=e;);U(t,32,r,A=(o=!i|(0|i)<=((_-d|0)-18|0)?((u-(16+d|0)|0)-C|0)+_|0:2+((i+u|0)-C|0)|0)+x|0,n),N(t,M,x),U(t,48,r,A,65536^n),N(t,16+d|0,i=_-(16+d|0)|0),U(t,48,o-((p=i)+(i=u-C|0)|0)|0,0,0),N(t,C,i)}else{for(p=(0|i)<0,0==e?v=y[44+d>>2]:(v=y[44+d>>2]+-28|0,y[44+d>>2]=v,e*=268435456),T=p?6:i,g=P=(0|v)<0?48+d|0:336+d|0;g=(i=g)+4|0,0!=(e=1e9*(e-((y[i>>2]=p=e<4294967296&0<=e?~~e>>>0:0)>>>0))););if((0|v)<1)p=g,_=P;else for(_=P;;){if(C=(0|v)<29?v:29,!((p=g+-4|0)>>>0<_>>>0)){for(i=C,w=0;D=w,w=y[(M=p)>>2],x=31&i,x=32<=(63&i)>>>(A=0)?(v=w<<x,0):(v=(1<<x)-1&w>>>32-x,w<<x),A=v+A|0,A=(w=D+x|0)>>>0<x>>>0?A+1|0:A,D=M,M=Mt(w=$t(x=w,A,1e9),F,1e9),y[D>>2]=x-M,_>>>0<=(p=p+-4|0)>>>0;);(i=w)&&(y[(_=_+-4|0)>>2]=i)}for(;_>>>0<(p=g)>>>0&&!y[(g=p+-4|0)>>2];);if(v=y[44+d>>2]-C|0,g=p,!(0<(0|(y[44+d>>2]=v))))break}if((0|v)<=-1)for(I=1+((T+25|0)/9|0)|0,C=102==(0|c);;){if(w=(0|v)<-9?9:0-v|0,p>>>0<=_>>>0)_=y[_>>2]?_:_+4|0;else{for(M=1e9>>>w,x=~(-1<<w),v=0,g=_;i=y[g>>2],y[g>>2]=(i>>>w)+v,v=E(M,i&x),(g=g+4|0)>>>0<p>>>0;);_=y[_>>2]?_:_+4|0,v&&(y[p>>2]=v,p=p+4|0)}if(v=w+y[44+d>>2]|0,p=(0|I)<p-(i=C?P:_)>>2?i+(I<<2)|0:p,!((0|(y[44+d>>2]=v))<0))break}if(!(p>>>(g=0)<=_>>>0||(g=E(P-_>>2,9),(i=y[_>>2])>>>0<(v=10))))for(;g=g+1|0,(v=E(v,10))>>>0<=i>>>0;);if((0|(i=(T-(102==(0|c)?0:g)|0)-(103==(0|c)&!!(0|T))|0))<(E(p-P>>2,9)+-9|0)){if(A=(P+((i=(0|(x=i+9216|0))/9|0)<<2)|0)-4092|0,v=10,(0|(i=1+(x-E(i,9)|0)|0))<=8)for(;v=E(v,10),9!=(0|(i=i+1|0)););if(I=A+4|0,((C=(M=y[A>>2])-E(v,x=(M>>>0)/(v>>>0)|0)|0)||(0|I)!=(0|p))&&($=C>>>0<(i=v>>>1)>>>0?.5:(0|p)==(0|I)&&(0|i)==(0|C)?1:1.5,e=1&x?9007199254740994:9007199254740992,!R|45!=b[0|f]||($=-$,e=-e),y[A>>2]=i=M-C|0,e+$!=e)){if(1e9<=(y[A>>2]=i=i+v|0)>>>0)for(;(A=A+-4|(y[A>>2]=0))>>>0<_>>>0&&(y[(_=_+-4|0)>>2]=0),i=y[A>>2]+1|0,999999999<(y[A>>2]=i)>>>0;);if(g=E(P-_>>2,9),!((i=y[_>>2])>>>0<(v=10)))for(;g=g+1|0,(v=E(v,10))>>>0<=i>>>0;);}p=(i=A+4|0)>>>0<p>>>0?i:p}t:{for(;;){if((C=p)>>>(M=0)<=_>>>0)break t;if(y[(p=C+-4|0)>>2])break}M=1}if(103!=(0|c))x=8&n;else if(T=((i=(0|g)<(0|(p=T||1))&-5<(0|g))?~g:-1)+p|0,o=(i?-1:-2)+o|0,!(x=8&n)){if(p=9,M&&(x=y[C+-4>>2])&&!((x>>>(p=0))%(i=10)))for(;p=p+1|0,!((x>>>0)%((i=E(i,10))>>>0)););i=E(C-P>>2,9)+-9|0,T=102==(32|o)?((x=0)|T)<(0|(i=0<(0|(i=i-p|0))?i:0))?T:i:((x=0)|T)<(0|(i=0<(0|(i=(i+g|0)-p|0))?i:0))?T:i}if(A=!!(0|(v=T|x)),i=t,D=r,p=0<(0|g)?g:0,102!=(0|(w=32|o))){if((u-(p=j((p=g>>31)+g^p,0,u))|0)<=1)for(;m[0|(p=p+-1|0)]=48,(u-p|0)<2;);m[0|(I=p+-2|0)]=o,m[p+-1|0]=(0|g)<0?45:43,p=u-I|0}if(U(i,32,D,A=1+(p+(A+(T+R|0)|0)|0)|0,n),N(t,f,R),U(t,48,r,A,65536^n),102==(0|w)){for(i=16+d|8,g=16+d|9,_=o=P>>>0<_>>>0?P:_;;){if(p=j(y[_>>2],0,g),(0|o)!=(0|_)){if(!(p>>>0<=16+d>>>0))for(;m[0|(p=p+-1|0)]=48,16+d>>>0<p>>>0;);}else(0|p)==(0|g)&&(m[24+d|0]=48,p=i);if(N(t,p,g-p|0),!((_=_+4|0)>>>0<=P>>>0))break}v&&N(t,3875,1);t:if(!((0|T)<1|C>>>0<=_>>>0))for(;;){if(16+d>>>0<(p=j(y[_>>2],0,g))>>>0)for(;m[0|(p=p+-1|0)]=48,16+d>>>0<p>>>0;);if(N(t,p,(0|T)<9?T:9),T=T+-9|0,C>>>0<=(_=_+4|0)>>>0)break t;if(!(0<(0|T)))break}U(t,48,T+9|0,9,0)}else{t:if(!((0|T)<0))for(o=M?C:_+4|0,i=16+d|8,P=16+d|9,g=_;;){if((0|P)==(0|(p=j(y[g>>2],0,P)))&&(m[24+d|0]=48,p=i),(0|_)!=(0|g)){if(!(p>>>0<=16+d>>>0))for(;m[0|(p=p+-1|0)]=48,16+d>>>0<p>>>0;);}else N(t,p,1),p=p+1|0,(0|T)<1&&!x||N(t,3875,1);if(N(t,w=p,(0|(p=P-p|0))<(0|T)?p:T),T=T-p|0,o>>>0<=(g=g+4|0)>>>0)break t;if(!(-1<(0|T)))break}U(t,48,T+18|0,18,0),N(t,I,u-I|0)}}else U(t,32,r,A=R+3|0,-65537&n),N(t,f,R),i=o>>>5&1,N(t,e!=e?i?3867:3871:i?3859:3863,3);return U(t,32,r,A,8192^n),L=560+d|0,0|((0|A)<(0|r)?r:A)},_[12]=function(t,e){t|=0;var r=e|=0;e=y[e>>2]+15&-16,y[r>>2]=e+16,r=t,t=function(t,e,r,i){var s,n,o,l=0,u=0,c=0;return L=n=L-32|0,l=(o=l=2147483647&i)-1006698496|0,u=l=(s=u=c=r)>>>0<0?l+1|0:l,l=o-1140785152|0,(0|(l=c>>>0<0?l+1|0:l))==(0|u)&s>>>0<c>>>0|u>>>0<l>>>0?(l=i<<4|r>>>28,r=r<<4|e>>>28,134217728==(0|(c=e&=268435455))&1<=t>>>0|134217728<e>>>0?(l=l+1073741824|0,(t=r+1|0)>>>0<1&&(l=l+1|0),u=t):(l=l-(((u=r)>>>0<0)+-1073741824|0)|0,t|134217728^c||((t=u+(1&u)|0)>>>0<u>>>0&&(l=l+1|0),u=t))):(!c&2147418112==(0|o)?!(t|e):2147418112==(0|o)&c>>>0<0|o>>>0<2147418112)?(l=2146435072,1140785151==((u=0)|o)&4294967295<c>>>0|1140785151<o>>>0||(c=o>>>16)>>>(l=0)<15249||(function(t,e,r,i,s,n){var o,a,h=0,l=0;64&n?(e=31&(r=n-64|0),e=32<=(63&r)>>>0?(r=0,s>>>e):(r=s>>>e,((1<<e)-1&s)<<32-e|i>>>e),s=i=0):n&&(l=s,h=31&(a=64-n|0),a=32<=(63&a)>>>0?(l=i<<h,0):(l=(1<<h)-1&i>>>32-h|l<<h,i<<h),o=e,e=31&(h=n),e=32<=(63&h)>>>0?(h=0,r>>>e):(h=r>>>e,((1<<e)-1&r)<<32-e|o>>>e),e|=a,r=h|l,h=i,i=31&n,i=32<=(63&n)>>>0?(l=0,s>>>i):(l=s>>>i,((1<<i)-1&s)<<32-i|h>>>i),s=l),y[t>>2]=e,y[4+t>>2]=r,y[8+t>>2]=i,y[12+t>>2]=s}(n,t,e,r,l=65535&i|65536,15361-c|0),function(t,e,r,i,s,n){var o,a,h=0;64&n?(i=e,e=31&(s=n+-64|0),32<=(63&s)>>>0?(s=i<<e,i=0):(s=(1<<e)-1&i>>>32-e|r<<e,i<<=e),r=e=0):n&&(a=i,i=31&(o=n),a=32<=(63&n)>>>0?(h=a<<i,0):(h=(1<<i)-1&a>>>32-i|s<<i,a<<i),i=r,s=31&(n=64-n|0),32<=(63&n)>>>0?(n=0,i>>>=s):(n=i>>>s,i=((1<<s)-1&i)<<32-s|e>>>s),i|=a,s=n|h,n=e,e=31&o,e=32<=(63&o)>>>0?(h=n<<e,0):(h=(1<<e)-1&n>>>32-e|r<<e,n<<e),r=h),y[t>>2]=e,y[4+t>>2]=r,y[8+t>>2]=i,y[12+t>>2]=s}(16+n|0,t,e,r,l,c+-15233|0),r=y[4+n>>2],t=y[8+n>>2],l=y[12+n>>2]<<4|t>>>28,u=t<<4|r>>>28,134217728==(0|(r=t=268435455&r))&1<=(e=y[n>>2]|!!(y[16+n>>2]|y[24+n>>2])|!!(y[20+n>>2]|y[28+n>>2]))>>>0|134217728<t>>>0?((t=u+1|0)>>>0<1&&(l=l+1|0),u=t):e|134217728^r||((t=u+(1&u)|0)>>>0<u>>>0&&(l=l+1|0),u=t))):(u=r<<4|e>>>28,l=524287&(l=i<<4|r>>>28)|2146959360),L=32+n|0,a(0,0|u),a(1,-2147483648&i|l),+h()}(y[e>>2],y[e+4>>2],y[e+8>>2],y[e+12>>2]),T[r>>3]=t},_[13]=function(t){return 0},_[14]=function(t,e,r){e|=0,r|=0;var i,s,n=0,o=0,a=0,h=0;for(L=s=L-32|0,n=y[28+(t|=0)>>2],y[16+s>>2]=n,a=y[t+20>>2],y[28+s>>2]=r,y[24+s>>2]=e,a=(y[20+s>>2]=e=a-n|0)+r|0,h=2,e=16+s|0;;){t:{if((o=(n=0)|D(y[t+60>>2],0|e,0|h,12+s|0))&&(y[2086]=o,n=-1),(0|(n=n?y[12+s>>2]=-1:y[12+s>>2]))==(0|a))e=y[t+44>>2],y[t+28>>2]=e,y[t+20>>2]=e,y[t+16>>2]=e+y[t+48>>2],t=r;else{if(-1<(0|n))break t;y[t+28>>2]=0,y[t+16>>2]=0,y[t+20>>2]=0,y[t>>2]=32|y[t>>2],2!=((t=0)|h)&&(t=r-y[e+4>>2]|0)}return L=32+s|0,0|t}o=y[e+4>>2],y[(e=(i=o>>>0<n>>>0)?e+8|0:e)>>2]=(o=n-(i?o:0)|0)+y[e>>2],y[e+4>>2]=y[e+4>>2]-o,a=a-n|0,h=h-i|0}},_[15]=function(t,e,r,i){return F=0},{d:function(){},e:function(){return 83886080},f:function(){return 5},g:function(t,e){return e|=0,L=e=L-16|0,t=(t|=0)?ot(t)?(B(4,2150,0),0):b[t+4|0]:(y[e+4>>2]=1444,y[e>>2]=2267,B(4,1294,e),0),L=e+16|0,0|t},h:function(t,e){var r;return e|=0,L=r=L-48|0,t=(t|=0)?(t+63&-64)!=(0|t)?(y[36+r>>2]=1522,y[32+r>>2]=2284,B(4,1294,32+r|0),0):(e+63&-64)==(0|e)&&e?function(t,e){var r,i=0,s=0,n=0,o=0,a=0,h=0,l=0,u=0,c=0,d=0,f=0,p=0,_=0,g=0,A=0,T=0,w=0,S=0,C=0,P=0,M=0;L=a=(r=s=L)-704&-64;t:if(e>>>0<=1343)B(4,1235,0);else if(ot(t))B(4,1469,0);else if(s=b[0|(P=t+4|0)]){if(!(6<=s>>>0)){(T=1==(0|!b[t+5|0]))||(X(P,1),k(t- -64|0,4,160)),z(a- -64|0,0,640),et(t,a- -64|0),s=t+e|0,e=y[a+64>>2];e:{r:{i:{if(5<=(A=b[t+4|0])>>>0){if(e>>>0<t>>>0|s>>>0<e>>>0)break r;if((o=e+256|0)>>>0<t>>>0)break r;if(o>>>0<=s>>>0)break i;break r}if(e>>>0<t>>>0|s>>>0<e>>>0)break r;if((o=e+128|0)>>>0<t>>>0|s>>>0<o>>>0)break r}if(!((n=y[a+68>>2])>>>0<t>>>0|s>>>0<n>>>0|n>>>0<o>>>0||(n=n- -64|0)>>>0<t>>>0|s>>>0<n>>>0||(0|(d=y[e>>2]))<0||(o=y[a+72>>2])>>>0<t>>>0|s>>>0<o>>>0|o>>>0<n>>>0||(n=(i=o)+(o=d<<2)|0)>>>0<t>>>0|s>>>0<n>>>0||(l=y[a+76>>2])>>>0<t>>>0|s>>>0<l>>>0|l>>>0<n>>>0||(i=(d<<6)+l|0)>>>0<t>>>0|s>>>0<i>>>0||(n=y[a+80>>2])>>>0<t>>>0|s>>>0<n>>>0|n>>>0<i>>>0||(i=n+o|0)>>>0<t>>>0|s>>>0<i>>>0||(n=y[a+84>>2])>>>0<t>>>0|s>>>0<n>>>0|n>>>0<i>>>0||(i=n+o|0)>>>0<t>>>0|s>>>0<i>>>0||(n=y[a+88>>2])>>>0<t>>>0|s>>>0<n>>>0|n>>>0<i>>>0||(i=n+o|0)>>>0<t>>>0|s>>>0<i>>>0||(n=y[a+92>>2])>>>0<t>>>0|s>>>0<n>>>0|n>>>0<i>>>0||(i=n+o|0)>>>0<t>>>0|s>>>0<i>>>0||(n=y[a+96>>2])>>>0<t>>>0|s>>>0<n>>>0|n>>>0<i>>>0||(i=n+o|0)>>>0<t>>>0|s>>>0<i>>>0||(n=y[a+100>>2])>>>0<t>>>0|s>>>0<n>>>0|n>>>0<i>>>0||(n=n+o|0)>>>0<t>>>0|s>>>0<n>>>0||(0|(i=y[e+4>>2]))<0||(o=y[a+104>>2])>>>0<t>>>0|s>>>0<o>>>0|o>>>0<n>>>0||(h=(n=o)+(o=i<<2)|0)>>>0<t>>>0|s>>>0<h>>>0||(n=y[a+108>>2])>>>0<t>>>0|s>>>0<n>>>0|n>>>0<h>>>0||(i=n+(i<<6)|0)>>>0<t>>>0|s>>>0<i>>>0||(n=y[a+112>>2])>>>0<t>>>0|s>>>0<n>>>0|n>>>0<i>>>0||(i=n+o|0)>>>0<t>>>0|s>>>0<i>>>0||(n=y[a+116>>2])>>>0<t>>>0|s>>>0<n>>>0|n>>>0<i>>>0||(i=n+o|0)>>>0<t>>>0|s>>>0<i>>>0||(n=y[a+120>>2])>>>0<t>>>0|s>>>0<n>>>0|n>>>0<i>>>0||(i=n+o|0)>>>0<t>>>0|s>>>0<i>>>0||(n=y[a+124>>2])>>>0<t>>>0|s>>>0<n>>>0|n>>>0<i>>>0||(i=n+o|0)>>>0<t>>>0|s>>>0<i>>>0||(n=y[a+128>>2])>>>0<t>>>0|s>>>0<n>>>0|n>>>0<i>>>0||(i=n+o|0)>>>0<t>>>0|s>>>0<i>>>0||(n=y[a+132>>2])>>>0<t>>>0|s>>>0<n>>>0|n>>>0<i>>>0||(i=n+o|0)>>>0<t>>>0|s>>>0<i>>>0||(n=y[a+136>>2])>>>0<t>>>0|s>>>0<n>>>0|n>>>0<i>>>0||(n=n+o|0)>>>0<t>>>0|s>>>0<n>>>0||(0|(i=y[e+8>>2]))<0||(o=y[a+140>>2])>>>0<t>>>0|s>>>0<o>>>0|o>>>0<n>>>0||(n=(f=i<<2)+o|0)>>>0<t>>>0|s>>>0<n>>>0||(o=y[a+144>>2])>>>0<t>>>0|s>>>0<o>>>0|o>>>0<n>>>0||(n=o+f|0)>>>0<t>>>0|s>>>0<n>>>0||(o=y[a+148>>2])>>>0<t>>>0|s>>>0<o>>>0|o>>>0<n>>>0||(n=o+f|0)>>>0<t>>>0|s>>>0<n>>>0||(o=y[a+156>>2])>>>0<t>>>0|s>>>0<o>>>0|o>>>0<n>>>0||(n=o+f|0)>>>0<t>>>0|s>>>0<n>>>0||(o=y[a+160>>2])>>>0<t>>>0|s>>>0<o>>>0|o>>>0<n>>>0||(n=o+f|0)>>>0<t>>>0|s>>>0<n>>>0||(o=y[a+164>>2])>>>0<t>>>0|s>>>0<o>>>0|o>>>0<n>>>0||(n=o+f|0)>>>0<t>>>0|s>>>0<n>>>0||(0|(i=y[e+12>>2]))<0||(o=y[a+172>>2])>>>0<t>>>0|s>>>0<o>>>0|o>>>0<n>>>0||(n=(p=i<<2)+o|0)>>>0<t>>>0|s>>>0<n>>>0||(o=y[a+176>>2])>>>0<t>>>0|s>>>0<o>>>0|o>>>0<n>>>0||(n=o+p|0)>>>0<t>>>0|s>>>0<n>>>0||(o=y[a+180>>2])>>>0<t>>>0|s>>>0<o>>>0|o>>>0<n>>>0||(n=o+p|0)>>>0<t>>>0|s>>>0<n>>>0||(o=y[a+188>>2])>>>0<t>>>0|s>>>0<o>>>0|o>>>0<n>>>0||(i=o+p|0)>>>0<t>>>0|s>>>0<i>>>0||(0|(n=y[e+16>>2]))<0||(o=y[a+192>>2])>>>0<t>>>0|s>>>0<o>>>0|o>>>0<i>>>0||(h=(i=o)+(o=n<<2)|0)>>>0<t>>>0|s>>>0<h>>>0||(i=y[a+196>>2])>>>0<t>>>0|s>>>0<i>>>0|i>>>0<h>>>0||(h=i+o|0)>>>0<t>>>0|s>>>0<h>>>0||(i=y[a+200>>2])>>>0<t>>>0|s>>>0<i>>>0|i>>>0<h>>>0||(h=i+o|0)>>>0<t>>>0|s>>>0<h>>>0||(i=y[a+204>>2])>>>0<t>>>0|s>>>0<i>>>0|i>>>0<h>>>0||(h=i+o|0)>>>0<t>>>0|s>>>0<h>>>0||(i=y[a+208>>2])>>>0<t>>>0|s>>>0<i>>>0|i>>>0<h>>>0||(h=i+(n<<6)|0)>>>0<t>>>0|s>>>0<h>>>0||(i=y[a+212>>2])>>>0<t>>>0|s>>>0<i>>>0|i>>>0<h>>>0||(h=i+o|0)>>>0<t>>>0|s>>>0<h>>>0||(i=y[a+216>>2])>>>0<t>>>0|s>>>0<i>>>0|i>>>0<h>>>0||(h=i+o|0)>>>0<t>>>0|s>>>0<h>>>0||(i=y[a+220>>2])>>>0<t>>>0|s>>>0<i>>>0|i>>>0<h>>>0||(h=i+o|0)>>>0<t>>>0|s>>>0<h>>>0||(i=y[a+228>>2])>>>0<t>>>0|s>>>0<i>>>0|i>>>0<h>>>0||(h=i+o|0)>>>0<t>>>0|s>>>0<h>>>0||(i=y[a+232>>2])>>>0<t>>>0|s>>>0<i>>>0|i>>>0<h>>>0||(h=i+o|0)>>>0<t>>>0|s>>>0<h>>>0||(i=y[a+236>>2])>>>0<t>>>0|s>>>0<i>>>0|i>>>0<h>>>0||(h=i+o|0)>>>0<t>>>0|s>>>0<h>>>0||(i=y[a+240>>2])>>>0<t>>>0|s>>>0<i>>>0|i>>>0<h>>>0||(h=i+o|0)>>>0<t>>>0|s>>>0<h>>>0||(i=y[a+244>>2])>>>0<t>>>0|s>>>0<i>>>0|i>>>0<h>>>0||(h=i+o|0)>>>0<t>>>0|s>>>0<h>>>0||(i=y[a+248>>2])>>>0<t>>>0|s>>>0<i>>>0|i>>>0<h>>>0||(i=i+n|0)>>>0<t>>>0|s>>>0<i>>>0||(n=y[a+252>>2])>>>0<t>>>0|s>>>0<n>>>0|n>>>0<i>>>0||(i=n+o|0)>>>0<t>>>0|s>>>0<i>>>0||(n=y[a+256>>2])>>>0<t>>>0|s>>>0<n>>>0|n>>>0<i>>>0||(i=n+o|0)>>>0<t>>>0|s>>>0<i>>>0||(n=y[a+260>>2])>>>0<t>>>0|s>>>0<n>>>0|n>>>0<i>>>0||(i=n+o|0)>>>0<t>>>0|s>>>0<i>>>0||(n=y[a+264>>2])>>>0<t>>>0|s>>>0<n>>>0|n>>>0<i>>>0||(i=n+o|0)>>>0<t>>>0|s>>>0<i>>>0||(n=y[a+268>>2])>>>0<t>>>0|s>>>0<n>>>0|n>>>0<i>>>0||(i=n+o|0)>>>0<t>>>0|s>>>0<i>>>0||(n=y[a+272>>2])>>>0<t>>>0|s>>>0<n>>>0|n>>>0<i>>>0||(i=n+o|0)>>>0<t>>>0|s>>>0<i>>>0||(0|(h=y[e+20>>2]))<0||(n=y[a+276>>2])>>>0<t>>>0|s>>>0<n>>>0|n>>>0<i>>>0||(_=(i=n)+(n=h<<2)|0)>>>0<t>>>0|s>>>0<_>>>0||(i=y[a+280>>2])>>>0<t>>>0|s>>>0<i>>>0|i>>>0<_>>>0||(h=i+(h<<6)|0)>>>0<t>>>0|s>>>0<h>>>0||(i=y[a+284>>2])>>>0<t>>>0|s>>>0<i>>>0|i>>>0<h>>>0||(h=i+n|0)>>>0<t>>>0|s>>>0<h>>>0||(i=y[a+288>>2])>>>0<t>>>0|s>>>0<i>>>0|i>>>0<h>>>0||(h=i+n|0)>>>0<t>>>0|s>>>0<h>>>0||(i=y[a+292>>2])>>>0<t>>>0|s>>>0<i>>>0|i>>>0<h>>>0||(h=i+n|0)>>>0<t>>>0|s>>>0<h>>>0||(i=y[a+296>>2])>>>0<t>>>0|s>>>0<i>>>0|i>>>0<h>>>0||(h=i+n|0)>>>0<t>>>0|s>>>0<h>>>0||(i=y[a+300>>2])>>>0<t>>>0|s>>>0<i>>>0|i>>>0<h>>>0||(h=i+n|0)>>>0<t>>>0|s>>>0<h>>>0||(i=y[a+308>>2])>>>0<t>>>0|s>>>0<i>>>0|i>>>0<h>>>0||(h=i+n|0)>>>0<t>>>0|s>>>0<h>>>0||(i=y[a+312>>2])>>>0<t>>>0|s>>>0<i>>>0|i>>>0<h>>>0||(h=i+n|0)>>>0<t>>>0|s>>>0<h>>>0||(0|(_=y[e+24>>2]))<0||(i=y[a+336>>2])>>>0<t>>>0|s>>>0<i>>>0|i>>>0<h>>>0||(h=i+(_<<2)|0)>>>0<t>>>0|s>>>0<h>>>0||(0|(_=y[e+28>>2]))<0||(i=y[a+340>>2])>>>0<t>>>0|s>>>0<i>>>0|i>>>0<h>>>0||(h=(S=_<<2)+i|0)>>>0<t>>>0|s>>>0<h>>>0||(i=y[a+344>>2])>>>0<t>>>0|s>>>0<i>>>0|i>>>0<h>>>0||(h=i+S|0)>>>0<t>>>0|s>>>0<h>>>0||(0|(_=y[e+32>>2]))<0||(i=y[a+356>>2])>>>0<t>>>0|s>>>0<i>>>0|i>>>0<h>>>0||(_=(h=_<<2)+i|0)>>>0<t>>>0|s>>>0<_>>>0||(i=y[a+360>>2])>>>0<t>>>0|s>>>0<i>>>0|i>>>0<_>>>0||(_=i+h|0)>>>0<t>>>0|s>>>0<_>>>0||(i=y[a+364>>2])>>>0<t>>>0|s>>>0<i>>>0|i>>>0<_>>>0||(_=i+h|0)>>>0<t>>>0|s>>>0<_>>>0||(i=y[a+368>>2])>>>0<t>>>0|s>>>0<i>>>0|i>>>0<_>>>0||(_=i+h|0)>>>0<t>>>0|s>>>0<_>>>0||(i=y[a+372>>2])>>>0<t>>>0|s>>>0<i>>>0|i>>>0<_>>>0||(_=i+h|0)>>>0<t>>>0|s>>>0<_>>>0||(i=y[a+376>>2])>>>0<t>>>0|s>>>0<i>>>0|i>>>0<_>>>0||(_=i+h|0)>>>0<t>>>0|s>>>0<_>>>0||(i=y[a+380>>2])>>>0<t>>>0|s>>>0<i>>>0|i>>>0<_>>>0||(_=i+h|0)>>>0<t>>>0|s>>>0<_>>>0||(0|(u=y[e+36>>2]))<0||(i=y[a+392>>2])>>>0<t>>>0|s>>>0<i>>>0|i>>>0<_>>>0||(u=(_=u<<2)+i|0)>>>0<t>>>0|s>>>0<u>>>0||(i=y[a+396>>2])>>>0<t>>>0|s>>>0<i>>>0|i>>>0<u>>>0||(u=i+_|0)>>>0<t>>>0|s>>>0<u>>>0||(i=y[a+400>>2])>>>0<t>>>0|s>>>0<i>>>0|i>>>0<u>>>0||(u=i+_|0)>>>0<t>>>0|s>>>0<u>>>0||(0|(c=y[e+40>>2]))<0||(i=y[a+412>>2])>>>0<t>>>0|s>>>0<i>>>0|i>>>0<u>>>0||(u=i+(c<<2)|0)>>>0<t>>>0|s>>>0<u>>>0||(0|(c=y[e+44>>2]))<0||(i=y[a+424>>2])>>>0<t>>>0|s>>>0<i>>>0|i>>>0<u>>>0||(u=i+(c<<2)|0)>>>0<t>>>0|s>>>0<u>>>0||(0|(c=y[e+48>>2]))<0||(i=y[a+428>>2])>>>0<t>>>0|s>>>0<i>>>0|i>>>0<u>>>0||(u=(c<<=2)+i|0)>>>0<t>>>0|s>>>0<u>>>0||(i=y[a+432>>2])>>>0<t>>>0|s>>>0<i>>>0|i>>>0<u>>>0||(u=i+c|0)>>>0<t>>>0|s>>>0<u>>>0||(0|(c=y[e+52>>2]))<0||(i=y[a+416>>2])>>>0<t>>>0|s>>>0<i>>>0|i>>>0<u>>>0||(u=(c<<=2)+i|0)>>>0<t>>>0|s>>>0<u>>>0||(i=y[a+420>>2])>>>0<t>>>0|s>>>0<i>>>0|i>>>0<u>>>0||(u=i+c|0)>>>0<t>>>0|s>>>0<u>>>0||(0|(c=y[e+56>>2]))<0||(i=y[a+552>>2])>>>0<t>>>0|s>>>0<i>>>0|i>>>0<u>>>0||(u=i+(c<<2)|0)>>>0<t>>>0|s>>>0<u>>>0||(0|(c=y[e+60>>2]))<0||(i=y[a+556>>2])>>>0<t>>>0|s>>>0<i>>>0|i>>>0<u>>>0||(u=i+(c<<2)|0)>>>0<t>>>0|s>>>0<u>>>0||(0|(c=y[e+64>>2]))<0||(i=y[a+560>>2])>>>0<t>>>0|s>>>0<i>>>0|i>>>0<u>>>0||(u=i+(c<<1)|0)>>>0<t>>>0|s>>>0<u>>>0||(0|(c=y[e+68>>2]))<0||(i=y[a+564>>2])>>>0<t>>>0|s>>>0<i>>>0|i>>>0<u>>>0||(u=i+(c<<2)|0)>>>0<t>>>0|s>>>0<u>>>0||(0|(c=y[e+72>>2]))<0||(i=y[a+568>>2])>>>0<t>>>0|s>>>0<i>>>0|i>>>0<u>>>0||(c=(u=i)+(i=c<<2)|0)>>>0<t>>>0|s>>>0<c>>>0||(u=y[a+572>>2])>>>0<t>>>0|s>>>0<u>>>0|u>>>0<c>>>0||(c=i+u|0)>>>0<t>>>0|s>>>0<c>>>0||(u=y[a+576>>2])>>>0<t>>>0|s>>>0<u>>>0|u>>>0<c>>>0||(c=i+u|0)>>>0<t>>>0|s>>>0<c>>>0||(u=y[a+580>>2])>>>0<t>>>0|s>>>0<u>>>0|u>>>0<c>>>0||(c=i+u|0)>>>0<t>>>0|s>>>0<c>>>0||(u=y[a+584>>2])>>>0<t>>>0|s>>>0<u>>>0|u>>>0<c>>>0||(u=i+u|0)>>>0<t>>>0|s>>>0<u>>>0||(0|(c=y[e+76>>2]))<0||(i=y[a+588>>2])>>>0<t>>>0|s>>>0<i>>>0|i>>>0<u>>>0||(c=(u=c<<2)+i|0)>>>0<t>>>0|s>>>0<c>>>0||(i=y[a+592>>2])>>>0<t>>>0|s>>>0<i>>>0|i>>>0<c>>>0||(c=i+u|0)>>>0<t>>>0|s>>>0<c>>>0||(i=y[a+596>>2])>>>0<t>>>0|s>>>0<i>>>0|i>>>0<c>>>0||(u=i+u|0)>>>0<t>>>0|s>>>0<u>>>0||(0|(c=y[e+80>>2]))<0||(i=y[a+600>>2])>>>0<t>>>0|s>>>0<i>>>0|i>>>0<u>>>0||(g=(u=i)+(i=c<<2)|0)>>>0<t>>>0|s>>>0<g>>>0||(u=y[a+604>>2])>>>0<t>>>0|s>>>0<u>>>0|u>>>0<g>>>0||(c=u+(c<<6)|0)>>>0<t>>>0|s>>>0<c>>>0||(u=y[a+608>>2])>>>0<t>>>0|s>>>0<u>>>0|u>>>0<c>>>0||(c=i+u|0)>>>0<t>>>0|s>>>0<c>>>0||(u=y[a+612>>2])>>>0<t>>>0|s>>>0<u>>>0|u>>>0<c>>>0||(c=i+u|0)>>>0<t>>>0|s>>>0<c>>>0||(u=y[a+616>>2])>>>0<t>>>0|s>>>0<u>>>0|u>>>0<c>>>0||(c=i+u|0)>>>0<t>>>0|s>>>0<c>>>0||(u=y[a+620>>2])>>>0<t>>>0|s>>>0<u>>>0|u>>>0<c>>>0||(c=i+u|0)>>>0<t>>>0|s>>>0<c>>>0||(u=y[a+624>>2])>>>0<t>>>0|s>>>0<u>>>0|u>>>0<c>>>0||(c=i+u|0)>>>0<t>>>0|s>>>0<c>>>0||(u=y[a+628>>2])>>>0<t>>>0|s>>>0<u>>>0|u>>>0<c>>>0||(c=i+u|0)>>>0<t>>>0|s>>>0<c>>>0||(u=y[a+632>>2])>>>0<t>>>0|s>>>0<u>>>0|u>>>0<c>>>0||(u=i+u|0)>>>0<t>>>0|s>>>0<u>>>0||(0|(c=y[e+84>>2]))<0||(i=y[a+636>>2])>>>0<t>>>0|s>>>0<i>>>0|i>>>0<u>>>0||(u=i+(c<<2)|0)>>>0<t>>>0|s>>>0<u>>>0||(i=y[a+640>>2])>>>0<t>>>0|s>>>0<i>>>0|i>>>0<u>>>0||(u=i+(c<<1)|0)>>>0<t>>>0|s>>>0<u>>>0||(0|(c=y[e+88>>2]))<0||(i=y[a+644>>2])>>>0<t>>>0|s>>>0<i>>>0|i>>>0<u>>>0||(i=i+(c<<2)|0)>>>0<t>>>0|s>>>0<i>>>0)){if(!(A>>>0<2)){if((u=y[a+168>>2])>>>0<t>>>0|s>>>0<u>>>0|u>>>0<i>>>0)break r;if((i=u+f|0)>>>0<t>>>0|s>>>0<i>>>0)break r;if(!(A>>>0<4)){if((u=y[a+324>>2])>>>0<t>>>0|s>>>0<u>>>0|u>>>0<i>>>0)break r;if((u=n+u|0)>>>0<t>>>0|s>>>0<u>>>0)break r;if((i=y[a+328>>2])>>>0<t>>>0|s>>>0<i>>>0|i>>>0<u>>>0)break r;if((u=i+n|0)>>>0<t>>>0|s>>>0<u>>>0)break r;if((i=y[a+332>>2])>>>0<t>>>0|s>>>0<i>>>0|i>>>0<u>>>0)break r;if((u=i+n|0)>>>0<t>>>0|s>>>0<u>>>0)break r;if((i=y[a+152>>2])>>>0<t>>>0|s>>>0<i>>>0|i>>>0<u>>>0)break r;if((f=i+f|0)>>>0<t>>>0|s>>>0<f>>>0)break r;if((i=y[a+184>>2])>>>0<t>>>0|s>>>0<i>>>0|i>>>0<f>>>0)break r;if((f=i+p|0)>>>0<t>>>0|s>>>0<f>>>0)break r;if((i=y[a+224>>2])>>>0<t>>>0|s>>>0<i>>>0|i>>>0<f>>>0)break r;if((i=i+o|0)>>>0<t>>>0|s>>>0<i>>>0)break r;if((0|(f=y[e+92>>2]))<0)break r;if((o=y[a+648>>2])>>>0<t>>>0|s>>>0<o>>>0|o>>>0<i>>>0)break r;if((f=(i=f<<2)+o|0)>>>0<t>>>0|s>>>0<f>>>0)break r;if((o=y[a+652>>2])>>>0<t>>>0|s>>>0<o>>>0|o>>>0<f>>>0)break r;if((f=i+o|0)>>>0<t>>>0|s>>>0<f>>>0)break r;if((o=y[a+656>>2])>>>0<t>>>0|s>>>0<o>>>0|o>>>0<f>>>0)break r;if((i=i+o|0)>>>0<t>>>0|s>>>0<i>>>0)break r;if((0|(f=y[e+96>>2]))<0)break r;if((o=y[a+660>>2])>>>0<t>>>0|s>>>0<o>>>0|o>>>0<i>>>0)break r;if((f=(i=f<<2)+o|0)>>>0<t>>>0|s>>>0<f>>>0)break r;if((o=y[a+664>>2])>>>0<t>>>0|s>>>0<o>>>0|o>>>0<f>>>0)break r;if((f=i+o|0)>>>0<t>>>0|s>>>0<f>>>0)break r;if((o=y[a+668>>2])>>>0<t>>>0|s>>>0<o>>>0|o>>>0<f>>>0)break r;if((i=i+o|0)>>>0<t>>>0|s>>>0<i>>>0)break r;if((o=y[a+304>>2])>>>0<t>>>0|s>>>0<o>>>0|o>>>0<i>>>0)break r;if((i=n+o|0)>>>0<t>>>0|s>>>0<i>>>0)break r;if((o=y[a+316>>2])>>>0<t>>>0|s>>>0<o>>>0|o>>>0<i>>>0)break r;if((i=n+o|0)>>>0<t>>>0|s>>>0<i>>>0)break r;if((o=y[a+320>>2])>>>0<t>>>0|s>>>0<o>>>0|o>>>0<i>>>0)break r;if((n=n+o|0)>>>0<t>>>0|s>>>0<n>>>0)break r;if((0|(i=y[e+100>>2]))<0)break r;if((o=y[a+436>>2])>>>0<t>>>0|s>>>0<o>>>0|o>>>0<n>>>0)break r;if((i=(n=i<<2)+o|0)>>>0<t>>>0|s>>>0<i>>>0)break r;if((o=y[a+440>>2])>>>0<t>>>0|s>>>0<o>>>0|o>>>0<i>>>0)break r;if((i=n+o|0)>>>0<t>>>0|s>>>0<i>>>0)break r;if((o=y[a+444>>2])>>>0<t>>>0|s>>>0<o>>>0|o>>>0<i>>>0)break r;if((n=n+o|0)>>>0<t>>>0|s>>>0<n>>>0)break r;if((0|(i=y[e+104>>2]))<0)break r;if((o=y[a+448>>2])>>>0<t>>>0|s>>>0<o>>>0|o>>>0<n>>>0)break r;if((i=(n=o)+(o=i<<2)|0)>>>0<t>>>0|s>>>0<i>>>0)break r;if((n=y[a+452>>2])>>>0<t>>>0|s>>>0<n>>>0|n>>>0<i>>>0)break r;if((i=n+o|0)>>>0<t>>>0|s>>>0<i>>>0)break r;if((n=y[a+456>>2])>>>0<t>>>0|s>>>0<n>>>0|n>>>0<i>>>0)break r;if((i=n+o|0)>>>0<t>>>0|s>>>0<i>>>0)break r;if((n=y[a+460>>2])>>>0<t>>>0|s>>>0<n>>>0|n>>>0<i>>>0)break r;if((i=n+o|0)>>>0<t>>>0|s>>>0<i>>>0)break r;if((n=y[a+464>>2])>>>0<t>>>0|s>>>0<n>>>0|n>>>0<i>>>0)break r;if((n=n+o|0)>>>0<t>>>0|s>>>0<n>>>0)break r;if((0|(i=y[e+108>>2]))<0)break r;if((o=y[a+480>>2])>>>0<t>>>0|s>>>0<o>>>0|o>>>0<n>>>0)break r;if((i=(n=i<<2)+o|0)>>>0<t>>>0|s>>>0<i>>>0)break r;if((o=y[a+484>>2])>>>0<t>>>0|s>>>0<o>>>0|o>>>0<i>>>0)break r;if((i=n+o|0)>>>0<t>>>0|s>>>0<i>>>0)break r;if((o=y[a+488>>2])>>>0<t>>>0|s>>>0<o>>>0|o>>>0<i>>>0)break r;if((n=n+o|0)>>>0<t>>>0|s>>>0<n>>>0)break r;if((0|(i=y[e+112>>2]))<0)break r;if((o=y[a+504>>2])>>>0<t>>>0|s>>>0<o>>>0|o>>>0<n>>>0)break r;if((i=(n=i<<2)+o|0)>>>0<t>>>0|s>>>0<i>>>0)break r;if((o=y[a+508>>2])>>>0<t>>>0|s>>>0<o>>>0|o>>>0<i>>>0)break r;if((i=n+o|0)>>>0<t>>>0|s>>>0<i>>>0)break r;if((o=y[a+512>>2])>>>0<t>>>0|s>>>0<o>>>0|o>>>0<i>>>0)break r;if((n=n+o|0)>>>0<t>>>0|s>>>0<n>>>0)break r;if((0|(i=y[e+116>>2]))<0)break r;if((o=y[a+528>>2])>>>0<t>>>0|s>>>0<o>>>0|o>>>0<n>>>0)break r;if((n=o+(i<<2)|0)>>>0<t>>>0|s>>>0<n>>>0)break r;if((0|(i=y[e+120>>2]))<0)break r;if((o=y[a+532>>2])>>>0<t>>>0|s>>>0<o>>>0|o>>>0<n>>>0)break r;if((i=(n=i<<2)+o|0)>>>0<t>>>0|s>>>0<i>>>0)break r;if((o=y[a+536>>2])>>>0<t>>>0|s>>>0<o>>>0|o>>>0<i>>>0)break r;if((i=n+o|0)>>>0<t>>>0|s>>>0<i>>>0)break r;if((o=y[a+540>>2])>>>0<t>>>0|s>>>0<o>>>0|o>>>0<i>>>0)break r;if((n=n+o|0)>>>0<t>>>0|s>>>0<n>>>0)break r;if((0|(i=y[e+124>>2]))<0)break r;if((o=y[a+544>>2])>>>0<t>>>0|s>>>0<o>>>0|o>>>0<n>>>0)break r;if((n=(i<<=2)+o|0)>>>0<t>>>0|s>>>0<n>>>0)break r;if((o=y[a+548>>2])>>>0<t>>>0|s>>>0<o>>>0|o>>>0<n>>>0)break r;if((i=i+o|0)>>>0<t>>>0|s>>>0<i>>>0)break r}}if(A>>>0<5)break e;if(!((o=y[a+348>>2])>>>0<t>>>0|s>>>0<o>>>0|o>>>0<i>>>0||(n=o+S|0)>>>0<t>>>0|s>>>0<n>>>0||(o=y[a+352>>2])>>>0<t>>>0|s>>>0<o>>>0|o>>>0<n>>>0||(n=o+S|0)>>>0<t>>>0|s>>>0<n>>>0||(o=y[a+384>>2])>>>0<t>>>0|s>>>0<o>>>0|o>>>0<n>>>0||(n=o+h|0)>>>0<t>>>0|s>>>0<n>>>0||(o=y[a+388>>2])>>>0<t>>>0|s>>>0<o>>>0|o>>>0<n>>>0||(n=o+h|0)>>>0<t>>>0|s>>>0<n>>>0||(o=y[a+404>>2])>>>0<t>>>0|s>>>0<o>>>0|o>>>0<n>>>0||(n=o+_|0)>>>0<t>>>0|s>>>0<n>>>0||(o=y[a+408>>2])>>>0<t>>>0|s>>>0<o>>>0|o>>>0<n>>>0||(n=o+_|0)>>>0<t>>>0|s>>>0<n>>>0||(0|(i=y[e+128>>2]))<0||(o=y[a+468>>2])>>>0<t>>>0|s>>>0<o>>>0|o>>>0<n>>>0||(i=(n=i<<2)+o|0)>>>0<t>>>0|s>>>0<i>>>0||(o=y[a+472>>2])>>>0<t>>>0|s>>>0<o>>>0|o>>>0<i>>>0||(i=n+o|0)>>>0<t>>>0|s>>>0<i>>>0||(o=y[a+476>>2])>>>0<t>>>0|s>>>0<o>>>0|o>>>0<i>>>0||(n=n+o|0)>>>0<t>>>0|s>>>0<n>>>0||(0|(i=y[e+132>>2]))<0||(o=y[a+492>>2])>>>0<t>>>0|s>>>0<o>>>0|o>>>0<n>>>0||(i=(n=i<<2)+o|0)>>>0<t>>>0|s>>>0<i>>>0||(o=y[a+496>>2])>>>0<t>>>0|s>>>0<o>>>0|o>>>0<i>>>0||(i=n+o|0)>>>0<t>>>0|s>>>0<i>>>0||(o=y[a+500>>2])>>>0<t>>>0|s>>>0<o>>>0|o>>>0<i>>>0||(n=n+o|0)>>>0<t>>>0|s>>>0<n>>>0||(0|(i=y[e+136>>2]))<0||(o=y[a+516>>2])>>>0<t>>>0|s>>>0<o>>>0|o>>>0<n>>>0||(i=(n=i<<2)+o|0)>>>0<t>>>0|s>>>0<i>>>0||(o=y[a+520>>2])>>>0<t>>>0|s>>>0<o>>>0|o>>>0<i>>>0||(i=n+o|0)>>>0<t>>>0|s>>>0<i>>>0||(o=y[a+524>>2])>>>0<t>>>0|s>>>0<o>>>0|o>>>0<i>>>0||(o=n+o|0)>>>0<t>>>0)&&o>>>0<=s>>>0)break e}}B(4,1760,0),X(P,1),k(t- -64|0,4,160);break t}T||(dt(t),m[t+5|0]=0,e=y[a+64>>2],d=y[e>>2],l=y[a+76>>2],A=b[t+4|0]);e:{if((t=0)<(0|d)){for(;;){if(63<Z((t<<6)+l|0)>>>0)break e;if((0|d)==(0|(t=t+1|0)))break}if(i=e+48|0,(s=0)<(0|(t=y[e>>2]))){for(o=y[e+48>>2],n=y[a+80>>2];;){if((0|(l=y[n+(s<<2)>>2]))<0|(0|o)<=(0|l))break e;if((0|t)==(0|(s=s+1|0)))break}for(_=e+24|0,o=y[e+24>>2],h=y[a+88>>2],d=y[a+84>>2],s=0;;){if(n=y[(l=s<<2)+h>>2]){if((0|n)<0|(0|o)<(0|n))break e;if((0|(l=y[l+d>>2]))<0|(0|o)<=(0|l))break e;if((n=n+l|0)>>>31|(0|o)<(0|n))break e}if((0|t)==(0|(s=s+1|0)))break}for(s=0,o=y[a+92>>2];;){if(1<x[o+(s<<2)>>2])break e;if((0|t)==(0|(s=s+1|0)))break}for(s=0,o=y[a+96>>2];;){if(1<x[o+(s<<2)>>2])break e;if((0|t)==(0|(s=s+1|0)))break}for(s=0,o=y[a+100>>2];;){if((0|(n=y[o+(s<<2)>>2]))<-1|(0|t)<=(0|n))break e;if((0|t)==(0|(s=s+1|0)))break}}else _=e+24|0}else _=e+24|0,i=e+48|0;if((t=0)<(0|(s=y[e+4>>2]))){for(o=y[a+108>>2];;){if(63<Z(o+(t<<6)|0)>>>0)break e;if((0|s)==(0|(t=t+1|0)))break}if(h=(o=y[e+48>>2])+-1|0,!(((s=0)|(t=y[e+4>>2]))<=0)){for(n=y[a+112>>2];;){if((0|(l=y[n+(s<<2)>>2]))<0|(0|o)<=(0|l))break e;if((0|t)==(0|(s=s+1|0)))break}for(s=0,o=y[a+116>>2];;){if(1<x[o+(s<<2)>>2])break e;if((0|t)==(0|(s=s+1|0)))break}for(s=0,o=y[a+120>>2];;){if(1<x[o+(s<<2)>>2])break e;if((0|t)==(0|(s=s+1|0)))break}for(o=y[e>>2],s=0,n=y[a+124>>2];;){if((0|(l=y[n+(s<<2)>>2]))<-1|(0|o)<=(0|l))break e;if((0|t)==(0|(s=s+1|0)))break}for(s=0,o=y[a+128>>2];;){if((0|(n=y[o+(s<<2)>>2]))<-1|(0|t)<=(0|n))break e;if((0|t)==(0|(s=s+1|0)))break}for(s=0,o=y[a+132>>2];;){if(1<x[o+(s<<2)>>2])break e;if((0|t)==(0|(s=s+1|0)))break}for(n=e+8|0,l=e+12|0,d=y[a+136>>2],s=0;;){if(1<(p=y[(f=s<<2)+o>>2])>>>0)break e;if((0|(f=y[d+f>>2]))<0|(0|f)>=y[(p-1|0?n:l)>>2])break e;if((0|t)==(0|(s=s+1|0)))break}}}else h=y[i>>2]+-1|0;if((t=0)<(0|(s=y[e+8>>2]))){for(o=y[a+140>>2];;){if((0|(n=y[o+(t<<2)>>2]))<0|(0|h)<(0|n))break e;if((0|s)==(0|(t=t+1|0)))break}for(S=e+28|0,o=y[e+28>>2],d=y[a+148>>2],f=y[a+144>>2],t=0;;){if(n=y[(l=t<<2)+d>>2]){if((0|n)<0|(0|o)<(0|n))break e;if((0|(l=y[l+f>>2]))<0|(0|o)<=(0|l))break e;if((n=n+l|0)>>>31|(0|o)<(0|n))break e}if((0|s)==(0|(t=t+1|0)))break}for(t=0,n=y[a+156>>2],l=y[a+164>>2],d=y[a+160>>2];;){if((0|(f=y[(o=t<<2)+d>>2]))<1)break e;if((0|(p=y[o+l>>2]))<1)break e;if((0|(o=y[n+o>>2]))<1|(0|o)!=(0|E(p+1|0,f+1|0)))break e;if((0|s)==(0|(t=t+1|0)))break}}else S=e+28|0;if((t=0)<(0|(n=y[e+12>>2]))){for(s=y[a+172>>2];;){if((0|(o=y[s+(t<<2)>>2]))<0|(0|h)<(0|o))break e;if((0|n)==(0|(t=t+1|0)))break}for(u=e+32|0,s=y[e+32>>2],h=y[a+180>>2],d=y[a+176>>2],t=0;;){if(o=y[(l=t<<2)+h>>2]){if((0|o)<0|(0|s)<(0|o))break e;if((0|(l=y[l+d>>2]))<0|(0|s)<=(0|l))break e;if((o=o+l|0)>>>31|(0|s)<(0|o))break e}if((0|n)==(0|(t=t+1|0)))break}}else u=e+32|0;o=e+16|0;r:{i:{if(!(((t=0)|(s=y[e+16>>2]))<=0)){for(n=y[a+208>>2];;){if(63<Z(n+(t<<6)|0)>>>0)break e;if((0|s)==(0|(t=t+1|0)))break}if(!(((s=0)|(t=y[o>>2]))<=0)){for(n=y[i>>2],l=y[a+212>>2];;){if((0|(h=y[l+(s<<2)>>2]))<0|(0|n)<=(0|h))break e;if((0|t)==(0|(s=s+1|0)))break}for(P=e+36|0,n=y[e+36>>2],d=y[a+220>>2],f=y[a+216>>2],s=0;;){if(l=y[(h=s<<2)+d>>2]){if((0|l)<0|(0|n)<(0|l))break e;if((0|(h=y[h+f>>2]))<0|(0|n)<=(0|h))break e;if((l=l+h|0)>>>31|(0|n)<(0|l))break e}if((0|t)==(0|(s=s+1|0)))break}for(s=0,n=y[a+228>>2];;){if(1<x[n+(s<<2)>>2])break e;if((0|t)==(0|(s=s+1|0)))break}for(s=0,n=y[a+232>>2];;){if(1<x[n+(s<<2)>>2])break e;if((0|t)==(0|(s=s+1|0)))break}for(n=y[e>>2],s=0,l=y[a+236>>2];;){if((0|(h=y[l+(s<<2)>>2]))<-1|(0|n)<=(0|h))break e;if((0|t)==(0|(s=s+1|0)))break}for(n=y[e+4>>2],s=0,l=y[a+240>>2];;){if((0|(h=y[l+(s<<2)>>2]))<-1|(0|n)<=(0|h))break e;if((0|t)==(0|(s=s+1|0)))break}for(n=y[a+244>>2],s=0;;){if(y[n+(s<<2)>>2]<0)break e;if((0|t)==(0|(s=s+1|0)))break}break i}}l=e+68|0,P=e+36|0;break r}for(n=y[a+252>>2],s=0;;){if(y[n+(s<<2)>>2]<0)break e;if((0|t)==(0|(s=s+1|0)))break}for(l=y[e+60>>2],s=0,h=y[a+256>>2];;){if((d=y[(d=s<<2)+h>>2]+(y[n+d>>2]<<1)|0)>>>31|(0|l)<(0|d))break e;if((0|t)==(0|(s=s+1|0)))break}for(n=y[e+64>>2],d=y[a+264>>2],f=y[a+260>>2],s=0;;){if(l=y[(h=s<<2)+d>>2]){if((0|l)<0|(0|n)<(0|l))break e;if((0|(h=y[h+f>>2]))<0|(0|n)<=(0|h))break e;if((l=l+h|0)>>>31|(0|n)<(0|l))break e}if((0|t)==(0|(s=s+1|0)))break}for(l=e+68|0,n=y[e+68>>2],f=y[a+272>>2],p=y[a+268>>2],s=0;;){if(h=y[(d=s<<2)+f>>2]){if((0|h)<0|(0|n)<(0|h))break e;if((0|(d=y[d+p>>2]))<0|(0|n)<=(0|d))break e;if((h=h+d|0)>>>31|(0|n)<(0|h))break e}if((0|t)==(0|(s=s+1|0)))break}}r:{i:{if(!(((t=0)|(s=y[e+20>>2]))<=0)){for(n=y[a+280>>2];;){if(63<Z(n+(t<<6)|0)>>>0)break e;if((0|s)==(0|(t=t+1|0)))break}if(!(((t=0)|(s=y[e+20>>2]))<=0)){for(n=y[a+296>>2];;){if(1<x[n+(t<<2)>>2])break e;if((0|s)==(0|(t=t+1|0)))break}for(n=y[a+300>>2],t=0;;){if(y[n+(t<<2)>>2]<0)break e;if((0|s)==(0|(t=t+1|0)))break}break i}}t=y[e+52>>2];break r}for(t=y[e+52>>2],f=y[a+312>>2],p=y[a+308>>2],h=0;;){if(n=y[(d=h<<2)+f>>2]){if((0|n)<0|(0|t)<(0|n))break e;if((0|(d=y[d+p>>2]))<0|(0|t)<=(0|d))break e;if((n=n+d|0)>>>31|(0|t)<(0|n))break e}if((0|s)==(0|(h=h+1|0)))break}}if(n=y[e+40>>2],(s=0)<(0|(h=y[e+8>>2])))for(d=y[a+344>>2],f=y[a+156>>2];;){if((p=y[(p=s<<2)+d>>2]+(y[f+p>>2]<<1)|0)>>>31|(0|n)<(0|p))break e;if((0|h)==(0|(s=s+1|0)))break}if((s=0)<(0|(h=y[u>>2]))){for(d=y[a+376>>2];;){if(1<x[d+(s<<2)>>2])break e;if((0|h)==(0|(s=s+1|0)))break}for(s=0,d=y[a+380>>2];;){if(1<x[d+(s<<2)>>2])break e;if((0|h)==(0|(s=s+1|0)))break}}if((s=0)<(0|(h=y[o>>2])))for(d=y[a+400>>2],f=y[a+252>>2];;){if((p=y[(p=s<<2)+d>>2]+(y[f+p>>2]<<1)|0)>>>31|(0|n)<(0|p))break e;if((0|h)==(0|(s=s+1|0)))break}if((s=0)<(0|(n=y[e+44>>2])))for(d=y[a+424>>2];;){if((0|(f=y[d+(s<<2)>>2]))<0|(0|t)<=(0|f))break e;if((0|n)==(0|(s=s+1|0)))break}if(1<=(0|(f=y[i>>2])))for(s=0,p=y[a+432>>2],c=y[a+428>>2];;){if(i=y[(d=s<<2)+p>>2]){if((0|i)<0|(0|n)<(0|i))break e;if((0|(d=y[c+d>>2]))<0|(0|n)<=(0|d))break e;if((i=i+d|0)>>>31|(0|n)<(0|i))break e}if((0|f)==(0|(s=s+1|0)))break}if(1<=(0|t))for(n=y[e+56>>2],s=0,f=y[a+420>>2],p=y[a+416>>2];;){if(i=y[(d=s<<2)+f>>2]){if((0|i)<0|(0|n)<(0|i))break e;if((0|(d=y[d+p>>2]))<0|(0|n)<=(0|d))break e;if((i=i+d|0)>>>31|(0|n)<(0|i))break e}if((0|(s=s+1|0))==(0|t))break}if((t=0)<(0|(s=y[l>>2])))for(n=y[a+564>>2];;){if((0|(l=y[n+(t<<2)>>2]))<-1|(0|h)<=(0|l))break e;if((0|s)==(0|(t=t+1|0)))break}if(t=y[e+76>>2],1<=(0|(l=y[e+72>>2])))for(s=0,h=y[a+572>>2],d=y[a+568>>2];;){if(n=y[(i=s<<2)+h>>2]){if((0|n)<0|(0|t)<(0|n))break e;if((0|(i=y[i+d>>2]))<0|(0|t)<=(0|i))break e;if((n=i+n|0)>>>31|(0|t)<(0|n))break e}if((0|l)==(0|(s=s+1|0)))break}if((s=0)<(0|t)){for(n=y[a+588>>2];;){if(1<x[n+(s<<2)>>2])break e;if((0|t)==(0|(s=s+1|0)))break}for(i=y[a+592>>2],s=0;;){if(1<(d=y[(h=s<<2)+n>>2])>>>0)break e;if((0|(h=y[i+h>>2]))<0|(0|h)>=y[(d-1|0?o:e)>>2])break e;if((0|t)==(0|(s=s+1|0)))break}for(s=0,n=y[a+596>>2];;){if((0|(i=y[n+(s<<2)>>2]))<-1|(0|l)<=(0|i))break e;if((0|t)==(0|(s=s+1|0)))break}}r:{if(!(((t=0)|(h=y[e+80>>2]))<=0)){for(s=y[a+604>>2];;){if(63<Z(s+(t<<6)|0)>>>0)break e;if((0|h)==(0|(t=t+1|0)))break}if(!(((t=0)|(h=y[e+80>>2]))<=0)){for(s=y[e+48>>2],n=y[a+608>>2];;){if((0|(l=y[n+(t<<2)>>2]))<0|(0|s)<=(0|l))break e;if((0|h)==(0|(t=t+1|0)))break}for(f=y[e+88>>2],l=y[a+616>>2],i=y[a+612>>2],t=0;;){if(s=y[(n=t<<2)+l>>2]){if((0|s)<0|(0|f)<(0|s))break e;if((0|(n=y[i+n>>2]))<0|(0|f)<=(0|n))break e;if((s=s+n|0)>>>31|(0|f)<(0|s))break e}if((0|h)==(0|(t=t+1|0)))break}for(o=y[o>>2],l=y[a+620>>2],t=0;;){if((0|(s=y[l+(t<<2)>>2]))<0|(0|o)<=(0|s))break e;if((0|h)==(0|(t=t+1|0)))break}for(i=y[a+624>>2],t=0;;){if((0|(s=y[i+(t<<2)>>2]))<0|(0|o)<=(0|s))break e;if((0|h)==(0|(t=t+1|0)))break}for(s=y[e+84>>2],d=y[a+632>>2],p=y[a+628>>2],t=0;;){if(n=y[(c=t<<2)+d>>2]){if((0|n)<0|(0|s)<(0|n))break e;if((0|(c=y[c+p>>2]))<0|(0|s)<=(0|c))break e;if((n=n+c|0)>>>31|(0|s)<(0|n))break e}if((0|h)==(0|(t=t+1|0)))break}for(g=y[a+640>>2],s=y[a+252>>2],n=0;;){if(0<(0|(T=y[(t=n<<2)+d>>2])))for(c=g+(y[t+p>>2]<<1)|0,M=y[s+(y[t+i>>2]<<2)>>2],w=y[s+(y[t+l>>2]<<2)>>2],t=0;;){if((0|M)<=v[c+(2|(C=t<<1))>>1]|(0|w)<=v[c+C>>1])break e;if(!((0|(t=t+2|0))<(0|T)))break}if((0|h)==(0|(n=n+1|0)))break}break r}}o=y[e+16>>2],f=y[e+88>>2]}if(!((255&A)>>>0<2)){if((t=0)<(0|(d=y[e+8>>2])))for(s=y[a+168>>2];;){if(1<x[s+(t<<2)>>2])break e;if((0|d)==(0|(t=t+1|0)))break}if(!((255&A)>>>0<4)){if(l=y[e+56>>2],1<=(0|(p=y[e+20>>2])))for(i=y[a+332>>2],c=y[a+328>>2],t=0;;){if(s=y[(n=t<<2)+i>>2]){if((0|s)<0|(0|l)<(0|s))break e;if((0|(n=y[n+c>>2]))<0|(0|l)<=(0|n))break e;if((s=s+n|0)>>>31|(0|l)<(0|s))break e}if((0|p)==(0|(t=t+1|0)))break}if((0|(t=y[e+92>>2]))!=y[e+96>>2])break e;if(1<=(0|d))for(c=y[a+152>>2],s=0,g=y[a+148>>2];;){if(n=y[(i=s<<2)+g>>2]){if((0|n)<0|(0|t)<(0|n))break e;if((0|(i=y[i+c>>2]))<0|(0|t)<=(0|i))break e;if((n=i+n|0)>>>31|(0|t)<(0|n))break e}if((0|d)==(0|(s=s+1|0)))break}if(1<=(0|(M=y[e+12>>2])))for(c=y[a+184>>2],s=0,g=y[a+180>>2];;){if(n=y[(i=s<<2)+g>>2]){if((0|n)<0|(0|t)<(0|n))break e;if((0|(i=y[i+c>>2]))<0|(0|t)<=(0|i))break e;if((n=i+n|0)>>>31|(0|t)<(0|n))break e}if((0|M)==(0|(s=s+1|0)))break}if(1<=(0|o))for(c=y[a+224>>2],s=0,g=y[a+220>>2];;){if(n=y[(i=s<<2)+g>>2]){if((0|n)<0|(0|t)<(0|n))break e;if((0|(i=y[i+c>>2]))<0|(0|t)<=(0|i))break e;if((n=i+n|0)>>>31|(0|t)<(0|n))break e}if((0|o)==(0|(s=s+1|0)))break}if((s=0)<(0|p)){for(n=y[a+304>>2];;){if(1<x[n+(s<<2)>>2])break e;if((0|p)==(0|(s=s+1|0)))break}for(n=y[e+100>>2],g=y[a+320>>2],T=y[a+316>>2],s=0;;){if(i=y[(c=s<<2)+g>>2]){if((0|i)<0|(0|n)<(0|i))break e;if((0|(c=y[c+T>>2]))<0|(0|n)<=(0|c))break e;if((i=i+c|0)>>>31|(0|n)<(0|i))break e}if((0|p)==(0|(s=s+1|0)))break}}else n=y[e+100>>2];if(1<=(0|n)){for(c=y[a+440>>2],s=0,T=y[a+436>>2];;){if(i=y[(g=s<<2)+c>>2]){if((0|i)<0|(0|l)<(0|i))break e;if((0|(g=y[g+T>>2]))<0|(0|l)<=(0|g))break e;if((i=i+g|0)>>>31|(0|l)<(0|i))break e}if((0|n)==(0|(s=s+1|0)))break}for(l=y[a+444>>2],s=0;;){if((0|(g=y[(i=s<<2)+l>>2]))<0|(0|g)>=y[i+c>>2])break e;if((0|n)==(0|(s=s+1|0)))break}}if((l=0)<(0|(s=y[e+104>>2]))){for(i=y[a+448>>2];;){if((0|(c=y[i+(l<<2)>>2]))<0|(0|n)<=(0|c))break e;if((0|s)==(0|(l=l+1|0)))break}for(i=y[e+116>>2],g=y[a+464>>2],T=y[a+460>>2],n=0;;){if(l=y[(c=n<<2)+g>>2]){if((0|l)<0|(0|i)<(0|l))break e;if((0|(c=y[c+T>>2]))<0|(0|i)<=(0|c))break e;if((l=l+c|0)>>>31|(0|i)<(0|l))break e}if((0|s)==(0|(n=n+1|0)))break}}else i=y[e+116>>2];if((n=0)<(0|(c=y[e+108>>2]))){for(l=y[a+480>>2];;){if((0|(g=y[l+(n<<2)>>2]))<0|(0|d)<=(0|g))break e;if((0|c)==(0|(n=n+1|0)))break}for(g=y[a+488>>2],w=y[a+484>>2],n=0;;){if(l=y[(d=n<<2)+g>>2]){if((0|l)<0|(0|s)<(0|l))break e;if((0|(d=y[d+w>>2]))<0|(0|s)<=(0|d))break e;if((l=l+d|0)>>>31|(0|s)<(0|l))break e}if((0|c)==(0|(n=n+1|0)))break}for(g=y[S>>2],n=y[a+456>>2],d=y[a+452>>2],l=0;;){if(C=y[w+(l<<2)>>2]<<2,T=y[C+n>>2]){if((0|T)<0|(0|g)<(0|T))break e;if((0|(C=y[d+C>>2]))<0|(0|g)<=(0|C))break e;if((0|(T=T+C|0))<0|(0|g)<(0|T))break e}if((0|c)==(0|(l=l+1|0)))break}}else n=y[a+456>>2],d=y[a+452>>2];if((l=0)<(0|(c=y[e+112>>2]))){for(g=y[a+504>>2];;){if((0|(T=y[g+(l<<2)>>2]))<0|(0|o)<=(0|T))break e;if((0|c)==(0|(l=l+1|0)))break}for(w=y[a+512>>2],T=y[a+508>>2],o=0;;){if(l=y[(g=o<<2)+w>>2]){if((0|l)<0|(0|s)<(0|l))break e;if((0|(g=y[g+T>>2]))<0|(0|s)<=(0|g))break e;if((l=l+g|0)>>>31|(0|s)<(0|l))break e}if((0|c)==(0|(o=o+1|0)))break}for(l=y[P>>2],o=0;;){if(w=y[T+(o<<2)>>2]<<2,g=y[w+n>>2]){if((0|g)<0|(0|l)<(0|g))break e;if((0|(w=y[d+w>>2]))<0|(0|l)<=(0|w))break e;if((0|(g=g+w|0))<0|(0|l)<(0|g))break e}if((0|c)==(0|(o=o+1|0)))break}}if(l=y[e+120>>2],(o=0)<(0|i))for(c=y[a+528>>2];;){if((0|(g=y[c+(o<<2)>>2]))<0|(0|l)<=(0|g))break e;if((0|(o=o+1|0))==(0|i))break}if((o=0)<(0|l)){for(i=y[a+532>>2];;){if((0|(c=y[i+(o<<2)>>2]))<-1|(0|p)<=(0|c))break e;if((0|l)==(0|(o=o+1|0)))break}for(i=y[e+124>>2],g=y[a+540>>2],T=y[a+536>>2],o=0;;){if(p=y[(c=o<<2)+g>>2]){if((0|p)<0|(0|i)<(0|p))break e;if((0|(c=y[c+T>>2]))<0|(0|i)<=(0|c))break e;if((p=c+p|0)>>>31|(0|i)<(0|p))break e}if((0|l)==(0|(o=o+1|0)))break}}if(!((255&A)>>>0<5)){if((o=0)<(0|(A=y[S>>2]))){for(l=y[a+348>>2];;){if((0|(i=y[l+(o<<2)>>2]))<0|(0|t)<(0|i))break e;if((0|A)==(0|(o=o+1|0)))break}for(l=y[a+352>>2],o=0;;){if((0|(i=y[l+(o<<2)>>2]))<0|(0|t)<(0|i))break e;if((0|A)==(0|(o=o+1|0)))break}}if((A=0)<(0|(o=y[u>>2]))){for(l=y[a+384>>2];;){if((0|(i=y[l+(A<<2)>>2]))<0|(0|t)<(0|i))break e;if((0|o)==(0|(A=A+1|0)))break}for(l=y[a+388>>2],A=0;;){if((0|(i=y[l+(A<<2)>>2]))<0|(0|t)<(0|i))break e;if((0|o)==(0|(A=A+1|0)))break}}if((A=0)<(0|(l=y[P>>2]))){for(i=y[a+404>>2];;){if((0|(p=y[i+(A<<2)>>2]))<0|(0|t)<(0|p))break e;if((0|l)==(0|(A=A+1|0)))break}for(i=y[a+408>>2],A=0;;){if((0|(p=y[i+(A<<2)>>2]))<0|(0|t)<(0|p))break e;if((0|l)==(0|(A=A+1|0)))break}}if((t=0)<(0|(A=y[e+128>>2]))){for(l=y[e>>2],i=y[a+468>>2];;){if((0|(p=y[i+(t<<2)>>2]))<0|(0|l)<=(0|p))break e;if((0|A)==(0|(t=t+1|0)))break}for(S=y[a+476>>2],p=y[a+472>>2],t=0;;){if(l=y[(i=t<<2)+S>>2]){if((0|l)<0|(0|s)<(0|l))break e;if((0|(i=y[i+p>>2]))<0|(0|s)<=(0|i))break e;if((l=i+l|0)>>>31|(0|s)<(0|l))break e}if((0|A)==(0|(t=t+1|0)))break}for(l=y[_>>2],t=0;;){if(_=y[p+(t<<2)>>2]<<2,i=y[_+n>>2]){if((0|i)<0|(0|l)<(0|i))break e;if((0|(_=y[d+_>>2]))<0|(0|l)<=(0|_))break e;if((0|(i=i+_|0))<0|(0|l)<(0|i))break e}if((0|A)==(0|(t=t+1|0)))break}}if((t=0)<(0|(A=y[e+132>>2]))){for(l=y[a+492>>2];;){if((0|(i=y[l+(t<<2)>>2]))<0|(0|M)<=(0|i))break e;if((0|A)==(0|(t=t+1|0)))break}for(_=y[a+500>>2],i=y[a+496>>2],t=0;;){if(l=y[(p=t<<2)+_>>2]){if((0|l)<0|(0|s)<(0|l))break e;if((0|(p=y[i+p>>2]))<0|(0|s)<=(0|p))break e;if((l=l+p|0)>>>31|(0|s)<(0|l))break e}if((0|A)==(0|(t=t+1|0)))break}for(t=0;;){if(p=y[i+(t<<2)>>2]<<2,l=y[p+n>>2]){if((0|l)<0|(0|o)<(0|l))break e;if((0|(p=y[d+p>>2]))<0|(0|o)<=(0|p))break e;if((0|(l=l+p|0))<0|(0|o)<(0|l))break e}if((0|A)==(0|(t=t+1|0)))break}}if(!(((t=0)|(e=y[e+136>>2]))<=0)){for(o=y[a+516>>2];;){if((0|(A=y[o+(t<<2)>>2]))<0|(0|h)<=(0|A))break e;if((0|e)==(0|(t=t+1|0)))break}for(l=y[a+524>>2],o=y[a+520>>2],t=0;;){if(a=y[(A=t<<2)+l>>2]){if((0|a)<0|(0|s)<(0|a))break e;if((0|(A=y[o+A>>2]))<0|(0|s)<=(0|A))break e;if((a=a+A|0)>>>31|(0|s)<(0|a))break e}if((0|e)==(0|(t=t+1|0)))break}for(t=0;;){if(a=y[o+(t<<2)>>2]<<2,s=y[a+n>>2]){if((0|s)<0|(0|f)<(0|s))break e;if((0|(a=y[a+d>>2]))<0|(0|f)<=(0|a))break e;if((0|(s=s+a|0))<0|(0|f)<(0|s))break e}if((0|e)==(0|(t=t+1|0)))break}}}}}return L=r,1}return B(4,1846,0),L=r,0}y[a+52>>2]=s,y[a+48>>2]=5,B(4,1640,a+48|0)}else y[a+32>>2]=s,B(4,1554,a+32|0);return L=r,0}(t,e):(y[20+r>>2]=1621,y[16+r>>2]=2284,B(4,1294,16+r|0),0):(y[4+r>>2]=1444,y[r>>2]=2284,B(4,1294,r),0),L=48+r|0,0|t},i:function(t){y[1805]=t|=0},j:function(t,e){var r;return e|=0,L=r=L-48|0,t=(t|=0)?(t+63&-64)!=(0|t)?(y[36+r>>2]=1522,y[32+r>>2]=2305,B(4,1294,32+r|0),0):(e+63&-64)==(0|e)&&e?function(t){var e,r,i,s,n=0,o=0,a=0,h=0,l=0,u=0,c=0,d=0;y[24+(L=e=L-32|0)>>2]=0,y[16+e>>2]=5,y[20+e>>2]=0,Tt(16+(L=s=L-272|0)|0,2227,y[12+s>>2]=16+e|0),function(t){var e;y[(L=e=L-16|0)>>2]=t,function(t,e){var r;y[12+(L=r=L-16|0)>>2]=e,At(t,1432,e,0,0),L=16+r|0}(y[970],e),L=16+e|0}(16+s|0),L=272+s|0;t:{if(ot(t))B(4,1932,0);else{if(!(6<=(a=b[t+4|0])>>>0)){if(1!=(0|!b[t+5|0])?(X(t+4|0,1),k(t- -64|0,4,160),et(t,t+704|(m[t+5|0]=0)),dt(t)):et(t,t+704|0),b[7224]||(y[1807]=6,m[7224]=1,y[1808]=7,y[1809]=8,y[1810]=9),o=y[t+704>>2],1<=(0|(a=y[o+16>>2]))){for(d=(h=y[t+912>>2])+(a<<2)|0,l=y[t+908>>2];;){c=y[t+1204>>2]+(y[l>>2]<<2)|0;e:if(!(((o=0)|(n=(a=y[h>>2])+-1|0))<1))r:for(;;){for(;;){if(y[(u=c+(o<<2)|0)>>2]<=-1){if(function(t,e,r){var i=0,s=0;i:if((0|t)!=(0|e)){if(!(t>>>0<e+r>>>0&&e>>>0<(s=t+r|0)>>>0))return G(t,e,r);if(i=3&(t^e),t>>>0<e>>>0){if(!i){if(3&t)for(;;){if(!r)break i;if(m[0|t]=b[0|e],e=e+1|0,r=r+-1|0,!(3&(t=t+1|0)))break}if(!(r>>>0<=3)){for(i=r;y[t>>2]=y[e>>2],e=e+4|0,t=t+4|0,3<(i=i+-4|0)>>>0;);r&=3}}if(r)for(;m[0|t]=b[0|e],t=t+1|0,e=e+1|0,r=r+-1|0;);}else{if(!i){if(3&s)for(;;){if(!r)break i;if(m[0|(i=(r=r+-1|0)+t|0)]=b[e+r|0],!(3&i))break}if(!(r>>>0<=3))for(;y[(r=r+-4|0)+t>>2]=y[e+r>>2],3<r>>>0;);}if(r)for(;m[(r=r+-1|0)+t|0]=b[e+r|0],r;);}}}(u,u+4|0,~o+a<<2),(0|o)<(0|(n=(a=n)+-1|0)))continue r;break e}if(!((0|(o=o+1|0))<(0|n)))break}break}if(o=h,0<(0|a)&&(a=y[c+(n<<2)>>2]<0?n:a),y[o>>2]=a,l=l+4|0,!((h=h+4|0)>>>0<d>>>0))break}o=y[t+704>>2]}if(1<=y[o>>2])for(n=0;y[y[t+712>>2]+(n<<2)>>2]=y[t+716>>2]+(n<<6),o=y[t+704>>2],(0|(n=n+1|0))<y[o>>2];);if(1<=y[o+4>>2])for(n=0;y[y[t+744>>2]+(n<<2)>>2]=y[t+748>>2]+(n<<6),o=y[t+704>>2],(0|(n=n+1|0))<y[o+4>>2];);if(1<=y[o+16>>2])for(n=0;y[(a=n<<2)+y[t+832>>2]>>2]=y[t+848>>2]+(n<<6),y[a+y[t+836>>2]>>2]=y[t+1196>>2]+(y[a+y[t+896>>2]>>2]<<2),y[a+y[t+840>>2]>>2]=y[t+1200>>2]+(y[a+y[t+900>>2]>>2]<<1),y[a+y[t+844>>2]>>2]=y[t+1204>>2]+(y[a+y[t+908>>2]>>2]<<2),o=y[t+704>>2],(0|(n=n+1|0))<y[o+16>>2];);if(1<=y[o+20>>2])for(n=0;y[y[t+916>>2]+(n<<2)>>2]=y[t+920>>2]+(n<<6),o=y[t+704>>2],(0|(n=n+1|0))<y[o+20>>2];);if(1<=y[o+80>>2])for(n=0;y[y[t+1240>>2]+(n<<2)>>2]=y[t+1244>>2]+(n<<6),o=y[t+704>>2],(0|(n=n+1|0))<y[o+80>>2];);if(1&m[y[t+708>>2]+20|0])break t;if((0|(h=y[o+16>>2]))<1)break t;for(n=y[t+904>>2],c=y[t+900>>2],u=y[t+1200>>2],l=0;;){if(0<(0|(d=y[(a=l<<2)+n>>2]+-1|0)))for(r=u+(y[a+c>>2]<<1)|0,o=0;i=v[(a=r+(o<<1)|0)>>1],g[a>>1]=v[a+4>>1],g[a+4>>1]=i,(0|(o=o+3|0))<(0|d););if((0|h)==(0|(l=l+1|0)))break}for(a=y[t+892>>2],l=y[t+896>>2],c=y[t+1196>>2],n=0;;){if(1<=(0|(u=y[(o=n<<2)+a>>2])))for(u=(o=c+(y[o+l>>2]<<2)|0)+(u<<3)|0,o=o+4|0;A[o>>2]=w(1)-A[o>>2],(o=o+8|0)>>>0<u>>>0;);if((0|h)==(0|(n=n+1|0)))break}break t}y[4+e>>2]=a,y[e>>2]=5,B(4,2023,e)}t=0}return L=32+e|0,t}(t):(y[20+r>>2]=1621,y[16+r>>2]=2305,B(4,1294,16+r|0),0):(y[4+r>>2]=1444,y[r>>2]=2305,B(4,1294,r),0),L=48+r|0,0|t},k:function(t,e,r,i){var s;e|=0,r|=0,i|=0,L=s=L+-64|0,(t|=0)?e?r?i?(t=y[y[t>>2]+708>>2],y[e>>2]=y[t+12>>2],y[e+4>>2]=y[t+16>>2],y[r>>2]=y[t+4>>2],y[r+4>>2]=y[t+8>>2],y[i>>2]=y[t>>2]):(y[52+s>>2]=1995,y[48+s>>2]=2325,B(4,1294,48+s|0)):(y[36+s>>2]=1903,y[32+s>>2]=2325,B(4,1294,32+s|0)):(y[20+s>>2]=1819,y[16+s>>2]=2325,B(4,1294,16+s|0)):(y[4+s>>2]=1740,y[s>>2]=2325,B(4,1294,s)),L=64+s|0},l:ct,m:ut,n:function(t){var e;L=e=L-16|0,(t|=0)?ht(t):(y[4+e>>2]=1740,y[e>>2]=2387,B(4,1294,e)),L=16+e|0},o:function(t){var e;return L=e=L-16|0,t=(t|=0)?y[t+540>>2]:(y[4+e>>2]=1740,y[e>>2]=2402,B(4,1294,e),-1),L=16+e|0,0|t},p:function(t){var e;return L=e=L-16|0,t=(t|=0)?y[y[t>>2]+916>>2]:(y[4+e>>2]=1740,y[e>>2]=2423,B(4,1294,e),0),L=16+e|0,0|t},q:function(t){var e;return L=e=L-16|0,t=(t|=0)?y[t+548>>2]:(y[4+e>>2]=1740,y[e>>2]=2442,B(4,1294,e),0),L=16+e|0,0|t},r:function(t){var e;return L=e=L-16|0,t=(t|=0)?y[y[t>>2]+928>>2]:(y[4+e>>2]=1740,y[e>>2]=2463,B(4,1294,e),0),L=16+e|0,0|t},s:function(t){var e;return L=e=L-16|0,t=(t|=0)?y[y[t>>2]+924>>2]:(y[4+e>>2]=1740,y[e>>2]=2492,B(4,1294,e),0),L=16+e|0,0|t},t:function(t){var e;return L=e=L-16|0,t=(t|=0)?y[y[t>>2]+932>>2]:(y[4+e>>2]=1740,y[e>>2]=2521,B(4,1294,e),0),L=16+e|0,0|t},u:function(t){var e;return L=e=L-16|0,t=(t|=0)?y[t+552>>2]:(y[4+e>>2]=1740,y[e>>2]=2550,B(4,1294,e),0),L=16+e|0,0|t},v:function(t){var e;return L=e=L-16|0,t=(t|=0)?y[t+4>>2]:(y[4+e>>2]=1740,y[e>>2]=2572,B(4,1294,e),-1),L=16+e|0,0|t},w:function(t){var e;return L=e=L-16|0,t=(t|=0)?y[y[t>>2]+712>>2]:(y[4+e>>2]=1740,y[e>>2]=2588,B(4,1294,e),0),L=16+e|0,0|t},x:function(t){var e;return L=e=L-16|0,t=(t|=0)?y[t+52>>2]:(y[4+e>>2]=1740,y[e>>2]=2602,B(4,1294,e),0),L=16+e|0,0|t},y:function(t){var e;return L=e=L-16|0,t=(t|=0)?y[y[t>>2]+740>>2]:(y[4+e>>2]=1740,y[e>>2]=2622,B(4,1294,e),0),L=16+e|0,0|t},z:function(t){var e;return L=e=L-16|0,t=(t|=0)?y[t+332>>2]:(y[4+e>>2]=1740,y[e>>2]=2650,B(4,1294,e),-1),L=16+e|0,0|t},A:function(t){var e;return L=e=L-16|0,t=(t|=0)?y[y[t>>2]+832>>2]:(y[4+e>>2]=1740,y[e>>2]=2670,B(4,1294,e),0),L=16+e|0,0|t},B:function(t){var e;return L=e=L-16|0,t=(t|=0)?y[y[t>>2]+888>>2]:(y[4+e>>2]=1740,y[e>>2]=2688,B(4,1294,e),0),L=16+e|0,0|t},C:function(t){var e;return L=e=L-16|0,t=(t|=0)?y[t+432>>2]:(y[4+e>>2]=1740,y[e>>2]=2716,B(4,1294,e),0),L=16+e|0,0|t},D:function(t){var e;return L=e=L-16|0,t=(t|=0)?y[y[t>>2]+884>>2]:(y[4+e>>2]=1740,y[e>>2]=2743,B(4,1294,e),0),L=16+e|0,0|t},E:function(t){var e;return L=e=L-16|0,t=(t|=0)?y[t+440>>2]:(y[4+e>>2]=1740,y[e>>2]=2772,B(4,1294,e),0),L=16+e|0,0|t},F:function(t){var e;return L=e=L-16|0,t=(t|=0)?y[t+436>>2]:(y[4+e>>2]=1740,y[e>>2]=2797,B(4,1294,e),0),L=16+e|0,0|t},G:function(t){var e;return L=e=L-16|0,t=(t|=0)?y[t+448>>2]:(y[4+e>>2]=1740,y[e>>2]=2824,B(4,1294,e),0),L=16+e|0,0|t},H:function(t){var e;return L=e=L-16|0,t=(t|=0)?y[y[t>>2]+912>>2]:(y[4+e>>2]=1740,y[e>>2]=2848,B(4,1294,e),0),L=16+e|0,0|t},I:function(t){var e;return L=e=L-16|0,t=(t|=0)?y[y[t>>2]+844>>2]:(y[4+e>>2]=1740,y[e>>2]=2873,B(4,1294,e),0),L=16+e|0,0|t},J:function(t){var e;return L=e=L-16|0,t=(t|=0)?y[y[t>>2]+892>>2]:(y[4+e>>2]=1740,y[e>>2]=2893,B(4,1294,e),0),L=16+e|0,0|t},K:function(t){var e;return L=e=L-16|0,t=(t|=0)?y[t+444>>2]:(y[4+e>>2]=1740,y[e>>2]=2920,B(4,1294,e),0),L=16+e|0,0|t},L:function(t){var e;return L=e=L-16|0,t=(t|=0)?y[y[t>>2]+836>>2]:(y[4+e>>2]=1740,y[e>>2]=2950,B(4,1294,e),0),L=16+e|0,0|t},M:function(t){var e;return L=e=L-16|0,t=(t|=0)?y[y[t>>2]+904>>2]:(y[4+e>>2]=1740,y[e>>2]=2974,B(4,1294,e),0),L=16+e|0,0|t},N:function(t){var e;return L=e=L-16|0,t=(t|=0)?y[y[t>>2]+840>>2]:(y[4+e>>2]=1740,y[e>>2]=3e3,B(4,1294,e),0),L=16+e|0,0|t},O:function(t){var e;return L=e=L-16|0,t=(t|=0)?y[t+452>>2]:(y[4+e>>2]=1740,y[e>>2]=3022,B(4,1294,e),0),L=16+e|0,0|t},P:function(t){var e;return L=e=L-16|0,t=(t|=0)?y[t+456>>2]:(y[4+e>>2]=1740,y[e>>2]=3051,B(4,1294,e),0),L=16+e|0,0|t},Q:function(t){var e;return L=e=L-16|0,t=(t|=0)?y[y[t>>2]+876>>2]:(y[4+e>>2]=1740,y[e>>2]=3078,B(4,1294,e),0),L=16+e|0,0|t},R:function(t){var e;L=e=L-16|0,(t|=0)?y[t+428>>2]=1:(y[4+e>>2]=1740,y[e>>2]=3110,B(4,1294,e)),L=16+e|0},S:function(t){var e;return L=e=L-16|0,t=(t|=0)?y[t+640>>2]:(y[4+e>>2]=1740,y[e>>2]=3139,B(4,1294,e),0),L=16+e|0,0|t},T:function(t){var e;return L=e=L-16|0,t=(t|=0)?y[t+636>>2]:(y[4+e>>2]=1740,y[e>>2]=3164,B(4,1294,e),0),L=16+e|0,0|t},U:function(t){var e;return rt(12+(L=e=L-16|0)|0,64,t|=0),L=16+e|0,y[12+e>>2]},V:function(t){var e,r,i=0;return L=r=L-16|0,!(t|=0)||rt(12+r|0,16,e=ct(t))||(i=ut(t,y[12+r>>2],e))||(it(y[12+r>>2]),i=0),L=16+r|0,0|i},W:function(t){return 0|st(t|=0)},X:function(t){it(t|=0)},Y:function(t){var e;rt(12+(L=e=L-16|0)|0,64,t|=0),it(y[12+e>>2]),L=16+e|0},Z:function(){return 0|L},_:function(t){return 0|(L=L-(0|t)&-16)},$:function(t){L=0|t},aa:function(t){return 0|(t=0|(t|=0),(r=0|Rt())<(t=r+(t|=0)|0)&&t<65536&&(t=new ArrayBuffer(E(t,65536)),(e=new d.Int8Array(t)).set(m),m=e,m=new d.Int8Array(t),g=new d.Int16Array(t),y=new d.Int32Array(t),b=new d.Uint8Array(t),v=new d.Uint16Array(t),x=new d.Uint32Array(t),A=new d.Float32Array(t),T=new d.Float64Array(t),f=t,p.buffer=t),r);var e,r},ba:function(t,e){_[t|=0](e|=0)}};function k(t,e,r){var i,s,n=0;if(r)for(;;){if(r=r+-1|0,t>>>0<(n=(i=t+e|0)-1|0)>>>0)for(;s=b[0|t],m[0|t]=b[0|n],m[0|n]=s,(t=t+1|0)>>>0<(n=n+-1|0)>>>0;);if(t=i,!r)break}}function B(t,e,r){var i;L=i=L-272|0,x[1804]>t>>>0||(t=y[1805])&&(Tt(16+i|0,e,y[12+i>>2]=r),_[t](16+i|0)),L=272+i|0}function N(t,e,r){32&b[0|t]||function(t,e,r){var i=0,s=0,n=0;t:{if(!(i=y[r+16>>2])){if(function(t){var e;return e=b[t+74|0],m[t+74|0]=e+-1|e,8&(e=y[t>>2])?(y[t>>2]=32|e,1):(y[t+4>>2]=0,y[t+8>>2]=0,e=y[t+44>>2],y[t+28>>2]=e,y[t+20>>2]=e,y[t+16>>2]=e+y[t+48>>2],0)}(r))break t;i=y[r+16>>2]}if(i-(n=y[r+20>>2])>>>0<e>>>0)return _[y[r+36>>2]](r,t,e);e:if(!(m[r+75|0]<0)){for(i=e;;){if(!(s=i))break e;if(10==b[(i=s+-1|0)+t|0])break}if(_[y[r+36>>2]](r,t,s)>>>0<s>>>0)break t;e=e-s|0,t=t+s|0,n=y[r+20>>2]}G(n,t,e),y[r+20>>2]=y[r+20>>2]+e}}(e,r,t)}function U(t,e,r,i,s){var n,o,a;if(L=a=L-256|0,!(73728&s|(0|r)<=(0|i))){if(z(a,e,(n=(s=r-i|0)>>>0<256)?s:256),e=t,o=a,!n){for(r=r-i|0;N(t,a,256),255<(s=s+-256|0)>>>0;);s=255&r}N(e,o,s)}L=256+a|0}function G(t,e,r){var i,s=0;if(8192<=r>>>0)I(0|t,0|e,0|r);else{if(i=t+r|0,3&(t^e))if(i>>>0<4)r=t;else if((s=i-4|0)>>>0<t>>>0)r=t;else for(r=t;m[0|r]=b[0|e],m[r+1|0]=b[e+1|0],m[r+2|0]=b[e+2|0],m[r+3|0]=b[e+3|0],e=e+4|0,(r=r+4|0)>>>0<=s>>>0;);else{t:if((0|r)<1)r=t;else if(3&t)for(r=t;;){if(m[0|r]=b[0|e],e=e+1|0,i>>>0<=(r=r+1|0)>>>0)break t;if(!(3&r))break}else r=t;if(!((t=-4&i)>>>0<64||(s=t+-64|0)>>>0<r>>>0))for(;y[r>>2]=y[e>>2],y[r+4>>2]=y[e+4>>2],y[r+8>>2]=y[e+8>>2],y[r+12>>2]=y[e+12>>2],y[r+16>>2]=y[e+16>>2],y[r+20>>2]=y[e+20>>2],y[r+24>>2]=y[e+24>>2],y[r+28>>2]=y[e+28>>2],y[r+32>>2]=y[e+32>>2],y[r+36>>2]=y[e+36>>2],y[r+40>>2]=y[e+40>>2],y[r+44>>2]=y[e+44>>2],y[r+48>>2]=y[e+48>>2],y[r+52>>2]=y[e+52>>2],y[r+56>>2]=y[e+56>>2],y[r+60>>2]=y[e+60>>2],e=e- -64|0,(r=r- -64|0)>>>0<=s>>>0;);if(!(t>>>0<=r>>>0))for(;y[r>>2]=y[e>>2],e=e+4|0,(r=r+4|0)>>>0<t>>>0;);}if(r>>>0<i>>>0)for(;m[0|r]=b[0|e],e=e+1|0,(0|i)!=(0|(r=r+1|0)););}}function V(t){var e,r;return w((e=t*t)*e*(r=e*t)*(2718311493989822e-21*e-.00019839334836096632)+(r*(.008333329385889463*e-.16666666641626524)+t))}function H(t){var e;return w(-.499999997251031*(t*=t)+1+.04166662332373906*(e=t*t)+t*e*(2439044879627741e-20*t-.001388676377460993))}function z(t,e,r){var i,s,n,o;if(r&&(m[(i=t+r|0)-1|0]=e,m[0|t]=e,!(r>>>0<3||(m[i-2|0]=e,m[t+1|0]=e,m[i-3|0]=e,m[t+2|0]=e,r>>>0<7)||(m[i-4|0]=e,m[t+3|0]=e,r>>>0<9)||(s=(i=0-t&3)+t|0,e=E(255&e,16843009),y[s>>2]=e,y[(i=(r=r-i&-4)+s|0)-4>>2]=e,r>>>0<9)||(y[8+s>>2]=e,y[4+s>>2]=e,y[i-8>>2]=e,y[i-12>>2]=e,r>>>0<25)||(y[24+s>>2]=e,y[20+s>>2]=e,y[16+s>>2]=e,y[12+s>>2]=e,y[i-16>>2]=e,y[i-20>>2]=e,y[i-24>>2]=e,y[i-28>>2]=e,(r=r-(o=4&s|24)|0)>>>0<32))))for(n=i=e,e=s+o|0;y[e+24>>2]=n,y[e+28>>2]=i,y[e+16>>2]=n,y[e+20>>2]=i,y[e+8>>2]=n,y[e+12>>2]=i,y[e>>2]=n,y[e+4>>2]=i,e=e+32|0,31<(r=r+-32|0)>>>0;);return t}function X(t,e){var r;if(t>>>0<(e=(t+e|0)-1|0)>>>0)for(;r=b[0|t],m[0|t]=b[0|e],m[0|e]=r,(t=t+1|0)>>>0<(e=e+-1|0)>>>0;);}function W(t){var e,r=Rt();return(t=(e=y[2216])+t|0)>>>0<=r<<16>>>0||R(0|t)?(y[2216]=t,e):(y[2086]=48,-1)}function Y(t,e,r,i,s,n,o){var a,h,l,u,c,d,f,p,_,m,g=0,b=w(0),v=w(0),x=w(0);if(w(0),w(0),w(0),w(0),L=m=L-16|0,1<=(0|t))for(d=E(t,12)+e|0;;){if(1<=(0|(h=y[e+4>>2])))for(f=(t=y[e+8>>2])+E(h,48)|0,h=(a=y[e>>2]<<4)+o|0,l=(8|a)+o|0,a=(4|a)+o|0;(g=y[t+8>>2])&&((p=g+-1|0)>>>0<=1?(_=(y[t+4>>2]<<2)+r|0,g=y[_+(y[t+12>>2]<<2)>>2]<<2,b=A[g+n>>2],c=A[s+g>>2],v=A[i+g>>2],p-1?(x=v,v=A[t+20>>2],A[h>>2]=A[h>>2]+w(A[t+44>>2]*w(x*v)),A[a>>2]=A[a>>2]+w(w(c*v)*A[t+44>>2]),A[l>>2]=A[l>>2]+w(w(b*v)*A[t+44>>2])):(g=y[(y[t+16>>2]<<2)+_>>2]<<2,p=A[g+n>>2],_=A[s+g>>2],x=v,v=A[t+20>>2],u=A[t+24>>2],A[h>>2]=A[h>>2]+w(A[t+44>>2]*w(w(x*v)+w(A[i+g>>2]*u))),A[a>>2]=A[a>>2]+w(w(w(c*v)+w(_*u))*A[t+44>>2]),A[l>>2]=A[l>>2]+w(w(w(b*v)+w(p*u))*A[t+44>>2]))):(y[m>>2]=g,B(4,1024,m))),(t=t+48|0)>>>0<f>>>0;);if(t=(y[e>>2]<<4)+o|0,b=A[t>>2],A[t>>2]=b<w(0)?w(0):w(P(b,w(1))),b=A[t+4>>2],A[t+4>>2]=b<w(0)?w(0):w(P(b,w(1))),b=A[t+8>>2],A[t+8>>2]=b<w(0)?w(0):w(P(b,w(1))),!((e=e+12|0)>>>0<d>>>0))break}L=16+m|0}function j(t,e,r){var i,s,n=0;if(1==(0|e)&t>>>0<0|e>>>0<1)n=t;else for(;i=Mt(n=$t(t,e,10),s=F,10),m[0|(r=r+-1|0)]=t-i|48,i=9==(0|e)&4294967295<t>>>0|9<e>>>0,t=n,e=s,i;);if(n)for(;m[0|(r=r+-1|0)]=n-E(t=(n>>>0)/10|0,10)|48,e=9<n>>>0,n=t,e;);return r}function q(t){return t+-48>>>0<10}function Z(t){var e;return(e=Et(t,64))?e-t|0:64}function Q(t,e){var r=0;return 1024<=(0|e)?(t*=898846567431158e293,e=(0|(r=e+-1023|0))<1024?r:(t*=898846567431158e293,((0|e)<3069?e:3069)+-2046|0)):-1023<(0|e)||(t*=22250738585072014e-324,e=-1023<(0|(r=e+1022|0))?r:(t*=22250738585072014e-324,(-3066<(0|e)?e:-3066)+2044|0)),a(0,0),a(1,e+1023<<20),t*+h()}function J(t,e){var r=0,i=t,s=e>>>0<=31?(r=y[t+4>>2],y[t>>2]):(r=y[t>>2],y[t+4>>2]=r,e=e+-32|(y[t>>2]=0),0);y[i>>2]=s<<e,y[t+4>>2]=r<<e|s>>>32-e}function K(t,e,r,i,s){var n,o=0,a=0,h=0;L=n=L-240|0,o=y[e>>2],y[232+n>>2]=o,e=y[e+4>>2],y[n>>2]=t,a=1;t:{e:{r:{if(((y[236+n>>2]=e)||1!=(0|o))&&(o=t-y[(r<<2)+s>>2]|0,!((0|_[5](o,t))<1))){for(h=!i;;){i:{if(e=o,!(!h|(0|r)<2)){if(i=y[((r<<2)+s|0)-8>>2],-1<(0|_[5](o=t+-4|0,e)))break i;if(-1<(0|_[5](o-i|0,e)))break i}if(y[(a<<2)+n>>2]=e,a=a+1|0,tt(232+n|0,t=Ct(232+n|0)),r=t+r|0,!y[236+n>>2]&&1==y[232+n>>2])break e;if(h=1,o=(t=e)-y[(r<<2)+s>>2]|(i=0),0<(0|_[5](o,y[n>>2])))continue;break r}break}e=t;break e}e=t}if(i)break t}St(n,a),at(e,r,s)}L=240+n|0}function tt(t,e){var r=0,i=t,s=e>>>0<=31?(r=y[t>>2],y[t+4>>2]):(r=y[t+4>>2],y[t+4>>2]=0,y[t>>2]=r,e=e+-32|0,0);y[i+4>>2]=s>>>e,y[t>>2]=s<<32-e|r>>>e}function et(t,e){var r=b[t+4|0];y[e>>2]=y[t+64>>2]+t,y[e+4>>2]=y[t+68>>2]+t,y[e+8>>2]=y[t+72>>2]+t,y[e+12>>2]=y[t+76>>2]+t,y[e+16>>2]=y[t+80>>2]+t,y[e+20>>2]=y[t+84>>2]+t,y[e+24>>2]=y[t+88>>2]+t,y[e+28>>2]=y[t+92>>2]+t,y[e+32>>2]=y[t+96>>2]+t,y[e+36>>2]=y[t+100>>2]+t,y[e+40>>2]=y[t+104>>2]+t,y[e+44>>2]=y[t+108>>2]+t,y[e+48>>2]=y[t+112>>2]+t,y[e+52>>2]=y[t+116>>2]+t,y[e+56>>2]=y[t+120>>2]+t,y[e+60>>2]=y[t+124>>2]+t,y[e- -64>>2]=y[t+128>>2]+t,y[e+68>>2]=y[t+132>>2]+t,y[e+72>>2]=y[t+136>>2]+t,y[e+76>>2]=y[t+140>>2]+t,y[e+80>>2]=y[t+144>>2]+t,y[e+84>>2]=y[t+148>>2]+t,y[e+92>>2]=y[t+152>>2]+t,y[e+96>>2]=y[t+156>>2]+t,y[e+100>>2]=y[t+160>>2]+t,y[e+108>>2]=y[t+164>>2]+t,y[e+112>>2]=y[t+168>>2]+t,y[e+116>>2]=y[t+172>>2]+t,y[e+124>>2]=y[t+176>>2]+t,y[e+128>>2]=y[t+180>>2]+t,y[e+132>>2]=y[t+184>>2]+t,y[e+136>>2]=y[t+188>>2]+t,y[e+140>>2]=y[t+192>>2]+t,y[e+144>>2]=y[t+196>>2]+t,y[e+148>>2]=y[t+200>>2]+t,y[e+152>>2]=y[t+204>>2]+t,y[e+156>>2]=y[t+208>>2]+t,y[e+164>>2]=y[t+212>>2]+t,y[e+168>>2]=y[t+216>>2]+t,y[e+172>>2]=y[t+220>>2]+t,y[e+176>>2]=y[t+224>>2]+t,y[e+180>>2]=y[t+228>>2]+t,y[e+184>>2]=y[t+232>>2]+t,y[e+188>>2]=y[t+236>>2]+t,y[e+192>>2]=y[t+240>>2]+t,y[e+196>>2]=y[t+244>>2]+t,y[e+200>>2]=y[t+248>>2]+t,y[e+204>>2]=y[t+252>>2]+t,y[e+208>>2]=y[t+256>>2]+t,y[e+212>>2]=y[t+260>>2]+t,y[e+216>>2]=y[t+264>>2]+t,y[e+220>>2]=y[t+268>>2]+t,y[e+224>>2]=y[t+272>>2]+t,y[e+228>>2]=y[t+276>>2]+t,y[e+232>>2]=y[t+280>>2]+t,y[e+236>>2]=y[t+284>>2]+t,y[e+244>>2]=y[t+288>>2]+t,y[e+248>>2]=y[t+292>>2]+t,y[e+272>>2]=y[t+296>>2]+t,y[e+276>>2]=y[t+300>>2]+t,y[e+280>>2]=y[t+304>>2]+t,y[e+292>>2]=y[t+308>>2]+t,y[e+296>>2]=y[t+312>>2]+t,y[e+300>>2]=y[t+316>>2]+t,y[e+304>>2]=y[t+320>>2]+t,y[e+308>>2]=y[t+324>>2]+t,y[e+312>>2]=y[t+328>>2]+t,y[e+316>>2]=y[t+332>>2]+t,y[e+328>>2]=y[t+336>>2]+t,y[e+332>>2]=y[t+340>>2]+t,y[e+336>>2]=y[t+344>>2]+t,y[e+348>>2]=y[t+348>>2]+t,y[e+360>>2]=y[t+352>>2]+t,y[e+364>>2]=y[t+356>>2]+t,y[e+368>>2]=y[t+360>>2]+t,y[e+352>>2]=y[t+364>>2]+t,y[e+356>>2]=y[t+368>>2]+t,y[e+488>>2]=y[t+372>>2]+t,y[e+492>>2]=y[t+376>>2]+t,y[e+496>>2]=y[t+380>>2]+t,y[e+500>>2]=y[t+384>>2]+t,y[e+504>>2]=y[t+388>>2]+t,y[e+508>>2]=y[t+392>>2]+t,y[e+512>>2]=y[t+396>>2]+t,y[e+516>>2]=y[t+400>>2]+t,y[e+520>>2]=y[t+404>>2]+t,y[e+524>>2]=y[t+408>>2]+t,y[e+528>>2]=y[t+412>>2]+t,y[e+532>>2]=y[t+416>>2]+t,y[e+536>>2]=y[t+420>>2]+t,y[e+540>>2]=y[t+424>>2]+t,y[e+544>>2]=y[t+428>>2]+t,y[e+548>>2]=y[t+432>>2]+t,y[e+552>>2]=y[t+436>>2]+t,y[e+556>>2]=y[t+440>>2]+t,y[e+560>>2]=y[t+444>>2]+t,y[e+564>>2]=y[t+448>>2]+t,y[e+568>>2]=y[t+452>>2]+t,y[e+572>>2]=y[t+456>>2]+t,y[e+576>>2]=y[t+460>>2]+t,y[e+580>>2]=y[t+464>>2]+t,r>>>0<2||(y[e+104>>2]=y[t+468>>2]+t,r>>>0<4)||(y[e+260>>2]=y[t+472>>2]+t,y[e+264>>2]=y[t+476>>2]+t,y[e+268>>2]=y[t+480>>2]+t,y[e+88>>2]=y[t+484>>2]+t,y[e+120>>2]=y[t+488>>2]+t,y[e+160>>2]=y[t+492>>2]+t,y[e+584>>2]=y[t+496>>2]+t,y[e+588>>2]=y[t+500>>2]+t,y[e+592>>2]=y[t+504>>2]+t,y[e+596>>2]=y[t+508>>2]+t,y[e+600>>2]=y[t+512>>2]+t,y[e+604>>2]=y[t+516>>2]+t,y[e+240>>2]=y[t+520>>2]+t,y[e+252>>2]=y[t+524>>2]+t,y[e+256>>2]=y[t+528>>2]+t,y[e+372>>2]=y[t+532>>2]+t,y[e+376>>2]=y[t+536>>2]+t,y[e+380>>2]=y[t+540>>2]+t,y[e+384>>2]=y[t+544>>2]+t,y[e+388>>2]=y[t+548>>2]+t,y[e+392>>2]=y[t+552>>2]+t,y[e+396>>2]=y[t+556>>2]+t,y[e+400>>2]=y[t+560>>2]+t,y[e+416>>2]=y[t+564>>2]+t,y[e+420>>2]=y[t+568>>2]+t,y[e+424>>2]=y[t+572>>2]+t,y[e+440>>2]=y[t+576>>2]+t,y[e+444>>2]=y[t+580>>2]+t,y[e+448>>2]=y[t+584>>2]+t,y[e+464>>2]=y[t+588>>2]+t,y[e+468>>2]=y[t+592>>2]+t,y[e+472>>2]=y[t+596>>2]+t,y[e+476>>2]=y[t+600>>2]+t,y[e+480>>2]=y[t+604>>2]+t,y[e+484>>2]=y[t+608>>2]+t,4!=(0|r)&&(y[e+284>>2]=y[t+612>>2]+t,y[e+288>>2]=y[t+616>>2]+t,y[e+320>>2]=y[t+620>>2]+t,y[e+324>>2]=y[t+624>>2]+t,y[e+340>>2]=y[t+628>>2]+t,y[e+344>>2]=y[t+632>>2]+t,y[e+404>>2]=y[t+636>>2]+t,y[e+408>>2]=y[t+640>>2]+t,y[e+412>>2]=y[t+644>>2]+t,y[e+428>>2]=y[t+648>>2]+t,y[e+432>>2]=y[t+652>>2]+t,y[e+436>>2]=y[t+656>>2]+t,y[e+452>>2]=y[t+660>>2]+t,y[e+456>>2]=y[t+664>>2]+t,y[e+460>>2]=y[t+668>>2]+t))}function rt(t,e,r){var i=0;t:{if(8==(0|e))e=st(r);else{if(i=28,3&e|1!=(0|function(t){for(var e=0,r=0;r=e,t;)t&=t-1,e=e+1|0;return r}(e>>>2)))break t;if(i=48,-64-e>>>0<r>>>0)break t;e=function(t,e){var r,i,s=0,n=0,o=0;if((n=t>>>0>(s=16)?t:16)+-1&n)for(;s=(t=s)<<1,t>>>0<n>>>0;);else t=n;return-64-t>>>0<=e>>>0?(y[2086]=48,0):(s=st(12+((n=e>>>0<11?16:e+11&-8)+t|0)|0))?(e=s+-8|0,s&t+-1?(o=(-8&(i=y[(r=s+-4|0)>>2]))-(s=(t=15<(s=((t+s|0)-1&0-t)-8|0)-e>>>0?s:t+s|0)-e|0)|0,3&i?(y[t+4>>2]=o|1&y[t+4>>2]|2,y[4+(o=t+o|0)>>2]=1|y[4+o>>2],y[r>>2]=s|1&y[r>>2]|2,y[t+4>>2]=1|y[t+4>>2],ft(e,s)):(e=y[e>>2],y[t+4>>2]=o,y[t>>2]=e+s)):t=e,3&(e=y[t+4>>2])&&((s=-8&e)>>>0<=n+16>>>0||(y[t+4>>2]=n|1&e|2,y[4+(e=t+n|0)>>2]=3|(n=s-n|0),y[4+(s=t+s|0)>>2]=1|y[s+4>>2],ft(e,n))),t+8|0):0}(16<e>>>0?e:16,r)}if(!e)return 1;y[t>>2]=e,i=0}return i}function it(t){var e,r=0,i=0,s=0,n=0,o=0,a=0,h=0;t:if(t){e=(s=t+-8|0)+(t=-8&(i=y[t+-4>>2]))|0;e:if(!(1&i)){if(!(3&i))break t;if((s=s-(i=y[s>>2])|0)>>>0<x[2091])break t;if(t=t+i|0,y[2092]!=(0|s))if(i>>>0<=255)n=y[s+8>>2],i>>>=3,(0|(r=y[s+12>>2]))==(0|n)?(h=y[2087]&It(i),y[2087]=h):(y[n+12>>2]=r,y[r+8>>2]=n);else{if(a=y[s+24>>2],(0|s)!=(0|(i=y[s+12>>2])))r=y[s+8>>2],y[r+12>>2]=i,y[i+8>>2]=r;else if(r=(r=y[(n=s+20|0)>>2])||y[(n=s+16|0)>>2]){for(;o=n,(r=y[(n=(i=r)+20|0)>>2])||(n=i+16|0,r=y[i+16>>2]););y[o>>2]=0}else i=0;if(a){n=y[s+28>>2];r:{if(y[(r=8652+(n<<2)|0)>>2]==(0|s)){if(y[r>>2]=i)break r;h=y[2088]&It(n),y[2088]=h;break e}if(!(y[a+(y[a+16>>2]==(0|s)?16:20)>>2]=i))break e}y[i+24>>2]=a,(r=y[s+16>>2])&&(y[i+16>>2]=r,y[r+24>>2]=i),(r=y[s+20>>2])&&(y[i+20>>2]=r,y[r+24>>2]=i)}}else if(!(3&~(i=y[4+e>>2])))return y[2089]=t,y[4+e>>2]=-2&i,y[s+4>>2]=1|t,y[t+s>>2]=t}if(!(e>>>0<=s>>>0)&&1&(i=y[4+e>>2])){e:{if(!(2&i)){if(y[2093]==(0|e)){if(y[2093]=s,t=y[2090]+t|0,y[2090]=t,y[s+4>>2]=1|t,y[2092]!=(0|s))break t;return y[2089]=0,y[2092]=0}if(y[2092]==(0|e))return y[2092]=s,t=y[2089]+t|0,y[2089]=t,y[s+4>>2]=1|t,y[t+s>>2]=t;t=(-8&i)+t|0;r:if(i>>>0<=255)i>>>=3,(0|(r=y[8+e>>2]))==(0|(n=y[12+e>>2]))?(h=y[2087]&It(i),y[2087]=h):(y[r+12>>2]=n,y[n+8>>2]=r);else{if(a=y[24+e>>2],(0|e)!=(0|(i=y[12+e>>2])))r=y[8+e>>2],y[r+12>>2]=i,y[i+8>>2]=r;else if(r=(r=y[(n=20+e|0)>>2])||y[(n=16+e|0)>>2]){for(;o=n,(r=y[(n=(i=r)+20|0)>>2])||(n=i+16|0,r=y[i+16>>2]););y[o>>2]=0}else i=0;if(a){n=y[28+e>>2];i:{if(y[(r=8652+(n<<2)|0)>>2]==(0|e)){if(y[r>>2]=i)break i;h=y[2088]&It(n),y[2088]=h;break r}if(!(y[a+(y[a+16>>2]==(0|e)?16:20)>>2]=i))break r}y[i+24>>2]=a,(r=y[16+e>>2])&&(y[i+16>>2]=r,y[r+24>>2]=i),(r=y[20+e>>2])&&(y[i+20>>2]=r,y[r+24>>2]=i)}}if(y[s+4>>2]=1|t,y[t+s>>2]=t,y[2092]!=(0|s))break e;return y[2089]=t}y[4+e>>2]=-2&i,y[s+4>>2]=1|t,y[t+s>>2]=t}if(t>>>0<=255)return i=8388+((t>>>=3)<<3)|0,t=(r=y[2087])&(t=1<<t)?y[i+8>>2]:(y[2087]=t|r,i),y[i+8>>2]=s,y[t+12>>2]=s,y[s+12>>2]=i,y[s+8>>2]=t;y[s+16>>2]=0,r=y[s+20>>2]=0,(n=t>>>8)&&(r=31,16777215<t>>>0||(r=n,r=28+((r=((r=(r<<=n=n+1048320>>>16&8)<<(a=r+520192>>>16&4))<<(o=r+245760>>>16&2)>>>15)-(o|n|a)|0)<<1|t>>>r+21&1)|0)),o=8652+((y[(i=s)+28>>2]=r)<<2)|0;e:if((n=y[2088])&(i=1<<r)){n=t<<(31==(0|r)?0:25-(r>>>1)),i=y[o>>2];r:{for(;;){if((-8&y[(r=i)+4>>2])==(0|t))break r;if(i=n>>>29,n<<=1,!(i=y[16+(o=r+(4&i)|0)>>2]))break}y[o+16>>2]=s,y[s+12>>2]=s,y[s+24>>2]=r,y[s+8>>2]=s;break e}t=y[r+8>>2],y[t+12>>2]=s,y[r+8>>2]=s,y[s+24>>2]=0,y[s+12>>2]=r,y[s+8>>2]=t}else y[2088]=i|n,y[o>>2]=s,y[s+12>>2]=s,y[s+24>>2]=o,y[s+8>>2]=s;if(t=y[2095]+-1|0,!(y[2095]=t)){for(s=8804;s=(t=y[s>>2])+8|0,t;);y[2095]=-1}}}}function st(t){var e,r=0,i=0,s=0,n=0,o=0,a=0,h=0,l=0,u=0,c=0,d=0;L=e=L-16|0;t:{e:{r:{i:{s:{n:{o:{a:{h:{l:{u:{if(t>>>0<=244){if(3&(r=(o=y[2087])>>>(t=(a=t>>>0<11?16:t+11&-8)>>>3))){t=(r=y[8396+(n=(i=t+(1&~r)|0)<<3)>>2])+8|0,(0|(s=y[r+8>>2]))==(0|(n=n+8388|0))?(d=It(i)&o,y[2087]=d):(y[s+12>>2]=n,y[n+8>>2]=s),y[r+4>>2]=3|(i<<=3),y[4+(r=r+i|0)>>2]=1|y[r+4>>2];break t}if(a>>>0<=(l=y[2089])>>>0)break u;if(r){i=r=(t=(0-(t=(0-(i=2<<t)|i)&r<<t)&t)-1|0)>>>12&16,r=y[8396+(s=(i=((i=(i|=r=(t>>>=r)>>>5&8)|(r=(t>>>=r)>>>2&4)|(r=(t>>>=r)>>>1&2))|(r=(t>>>=r)>>>1&1))+(t>>>r)|0)<<3)>>2],(0|(t=y[r+8>>2]))==(0|(s=s+8388|0))?(o=It(i)&o,y[2087]=o):(y[t+12>>2]=s,y[s+8>>2]=t),t=r+8|0,y[r+4>>2]=3|a,y[4+(h=r+a|0)>>2]=1|(n=(i<<=3)-a|0),y[r+i>>2]=n,l&&(r=8388+((i=l>>>3)<<3)|0,s=y[2092],i=(i=1<<i)&o?y[r+8>>2]:(y[2087]=i|o,r),y[r+8>>2]=s,y[i+12>>2]=s,y[s+12>>2]=r,y[s+8>>2]=i),y[2092]=h,y[2089]=n;break t}if(!(c=y[2088]))break u;for(i=r=(t=(c&0-c)-1|0)>>>12&16,r=y[8652+(((i=(i|=r=(t>>>=r)>>>5&8)|(r=(t>>>=r)>>>2&4)|(r=(t>>>=r)>>>1&2))|(r=(t>>>=r)>>>1&1))+(t>>>r)<<2)>>2],s=(-8&y[r+4>>2])-a|0,i=r;t=(t=y[i+16>>2])||y[i+20>>2];)s=(i=(n=(-8&y[t+4>>2])-a|0)>>>0<s>>>0)?n:s,r=i?t:r,i=t;if(u=y[r+24>>2],(0|(n=y[r+12>>2]))!=(0|r)){t=y[r+8>>2],y[t+12>>2]=n,y[n+8>>2]=t;break e}if(!(t=y[(i=r+20|0)>>2])){if(!(t=y[r+16>>2]))break l;i=r+16|0}for(;h=i,(t=y[(i=(n=t)+20|0)>>2])||(i=n+16|0,t=y[n+16>>2]););y[h>>2]=0;break e}if(a=-1,!(4294967231<t>>>0)&&(a=-8&(r=t+11|0),l=y[2088])){i=0-a|0,o=0,(r>>>=8)&&(o=31,16777215<a>>>0||(o=28+((t=((o=(r<<=s=r+1048320>>>16&8)<<(t=r+520192>>>16&4))<<(r=o+245760>>>16&2)>>>15)-(r|t|s)|0)<<1|a>>>t+21&1)|0));c:{d:{if(s=y[8652+(o<<2)>>2])for(r=a<<(31==(0|o)?0:25-(o>>>1)),t=0;;){if(!(i>>>0<=(h=(-8&y[s+4>>2])-a|0)>>>0||(n=s,i=h))){i=0,t=s;break d}if(h=y[s+20>>2],s=y[16+((r>>>29&4)+s|0)>>2],t=h&&(0|h)!=(0|s)?h:t,r<<=!!(0|s),!s)break}else t=0;if(!(t|n)){if(!(t=(0-(t=2<<o)|t)&l))break u;s=r=(t=(t&0-t)-1|0)>>>12&16,t=y[8652+(((s=(s|=r=(t>>>=r)>>>5&8)|(r=(t>>>=r)>>>2&4)|(r=(t>>>=r)>>>1&2))|(r=(t>>>=r)>>>1&1))+(t>>>r)<<2)>>2]}if(!t)break c}for(;i=(r=(s=(-8&y[t+4>>2])-a|0)>>>0<i>>>0)?s:i,n=r?t:n,t=(r=y[t+16>>2])||y[t+20>>2];);}if(!(!n|i>>>0>=y[2089]-a>>>0)){if(h=y[n+24>>2],(0|n)!=(0|(r=y[n+12>>2]))){t=y[n+8>>2],y[t+12>>2]=r,y[r+8>>2]=t;break r}if(!(t=y[(s=n+20|0)>>2])){if(!(t=y[n+16>>2]))break h;s=n+16|0}for(;o=s,(t=y[(s=(r=t)+20|0)>>2])||(s=r+16|0,t=y[r+16>>2]););y[o>>2]=0;break r}}}if(a>>>0<=(r=y[2089])>>>0){t=y[2092],16<=(i=r-a|0)>>>0?(y[2089]=i,y[2092]=s=t+a|0,y[s+4>>2]=1|i,y[t+r>>2]=i,y[t+4>>2]=3|a):(y[2092]=0,y[2089]=0,y[t+4>>2]=3|r,y[4+(r=t+r|0)>>2]=1|y[r+4>>2]),t=t+8|0;break t}if(a>>>0<(s=y[2090])>>>0){y[2090]=r=s-a|0,t=y[2093],y[2093]=i=t+a|0,y[i+4>>2]=1|r,y[t+4>>2]=3|a,t=t+8|0;break t}if((i=(o=(i=n=a+47|(t=0))+(r=y[2205]?y[2207]:(y[2208]=-1,y[2209]=-1,y[2206]=4096,y[2207]=4096,y[2205]=12+e&-16^1431655768,y[2210]=0,y[2198]=0,4096))|0)&(h=0-r|0))>>>0<=a>>>0)break t;if((r=y[2197])&&(u=(l=y[2195])+i|0)>>>0<=l>>>0|r>>>0<u>>>0)break t;if(4&b[8792])break n;u:{c:{if(r=y[2093])for(t=8796;;){if((l=y[t>>2])+y[t+4>>2]>>>0>r>>>0&&l>>>0<=r>>>0)break c;if(!(t=y[t+8>>2]))break}if(-1==(0|(r=W(0))))break o;if(o=i,(o=(s=(t=y[2206])+-1|0)&r?(i-r|0)+(r+s&0-t)|0:o)>>>0<=a>>>0|2147483646<o>>>0)break o;if((t=y[2197])&&(h=(s=y[2195])+o|0)>>>0<=s>>>0|t>>>0<h>>>0)break o;if((0|r)!=(0|(t=W(o))))break u;break s}if(2147483646<(o=h&o-s)>>>0)break o;if((0|(r=W(o)))==(y[t>>2]+y[t+4>>2]|0))break a;t=r}if(!(a+48>>>0<=o>>>0|2147483646<o>>>0|-1==(0|(r=t)))){if(2147483646<(t=(t=y[2207])+(n-o|0)&0-t)>>>0)break s;if(-1!=(0|W(t))){o=t+o|0;break s}W(0-o|0);break o}if(-1!=(0|r))break s;break o}n=0;break e}r=0;break r}if(-1!=(0|r))break s}y[2198]=4|y[2198]}if(2147483646<i>>>0)break i;if(r=W(i),(t=W(0))>>>0<=r>>>0|-1==(0|r)|-1==(0|t))break i;if((o=t-r|0)>>>0<=a+40>>>0)break i}t=y[2195]+o|0,(y[2195]=t)>>>0>x[2196]&&(y[2196]=t);s:{n:{o:{if(i=y[2093]){for(t=8796;;){if(((s=y[t>>2])+(n=y[t+4>>2])|0)==(0|r))break o;if(!(t=y[t+8>>2]))break}break n}for((t=y[2091])>>>0<=r>>>0&&t||(y[2091]=r),t=0,y[2200]=o,y[2199]=r,y[2095]=-1,y[2096]=y[2205],y[2202]=0;y[8396+(i=t<<3)>>2]=s=i+8388|0,y[i+8400>>2]=s,32!=(0|(t=t+1|0)););y[2090]=s=(t=o+-40|0)-(i=r+8&7?-8-r&7:0)|0,y[2093]=i=r+i|0,y[i+4>>2]=1|s,y[4+(t+r|0)>>2]=40,y[2094]=y[2209];break s}if(!(8&b[t+12|0]|r>>>0<=i>>>0|i>>>0<s>>>0)){y[t+4>>2]=n+o,y[2093]=r=(t=i+8&7?-8-i&7:0)+i|0,s=y[2090]+o|0,y[2090]=t=s-t|0,y[r+4>>2]=1|t,y[4+(i+s|0)>>2]=40,y[2094]=y[2209];break s}}r>>>0<(n=y[2091])>>>0&&(y[2091]=r,n=0),s=r+o|0,t=8796;n:{o:{a:{h:{l:{u:{for(;(0|s)!=y[t>>2];)if(!(t=y[t+8>>2]))break u;if(!(8&b[t+12|0]))break l}for(t=8796;;){if((s=y[t>>2])>>>0<=i>>>0&&i>>>0<(n=s+y[t+4>>2]|0)>>>0)break h;t=y[t+8>>2]}}if(y[t>>2]=r,y[t+4>>2]=y[t+4>>2]+o,y[4+(u=(r+8&7?-8-r&7:0)+r|0)>>2]=3|a,t=((r=s+(s+8&7?-8-s&7:0)|0)-u|0)-a|0,h=a+u|0,(0|r)==(0|i)){y[2093]=h,t=y[2090]+t|0,y[2090]=t,y[h+4>>2]=1|t;break o}if(y[2092]==(0|r)){y[2092]=h,t=y[2089]+t|0,y[2089]=t,y[h+4>>2]=1|t,y[t+h>>2]=t;break o}if(1==(3&(i=y[r+4>>2]))){c=-8&i;l:if(i>>>0<=255)n=i>>>3,i=y[r+8>>2],(0|(s=y[r+12>>2]))==(0|i)?(d=y[2087]&It(n),y[2087]=d):(y[i+12>>2]=s,y[s+8>>2]=i);else{if(l=y[r+24>>2],(0|(o=y[r+12>>2]))!=(0|r))i=y[r+8>>2],y[i+12>>2]=o,y[o+8>>2]=i;else if(a=(a=y[(s=r+20|0)>>2])||y[(s=r+16|0)>>2]){for(;i=s,(a=y[(s=(o=a)+20|0)>>2])||(s=o+16|0,a=y[o+16>>2]););y[i>>2]=0}else o=0;if(l){i=y[r+28>>2];u:{if(y[(s=8652+(i<<2)|0)>>2]==(0|r)){if(y[s>>2]=o)break u;d=y[2088]&It(i),y[2088]=d;break l}if(!(y[l+(y[l+16>>2]==(0|r)?16:20)>>2]=o))break l}y[o+24>>2]=l,(i=y[r+16>>2])&&(y[o+16>>2]=i,y[i+24>>2]=o),(i=y[r+20>>2])&&(y[o+20>>2]=i,y[i+24>>2]=o)}}r=r+c|0,t=t+c|0}if(y[r+4>>2]=-2&y[r+4>>2],y[h+4>>2]=1|t,(y[t+h>>2]=t)>>>0<=255){t=8388+((r=t>>>3)<<3)|0,r=(i=y[2087])&(r=1<<r)?y[t+8>>2]:(y[2087]=r|i,t),y[t+8>>2]=h,y[r+12>>2]=h,y[h+12>>2]=t,y[h+8>>2]=r;break o}if(r=0,(s=t>>>8)&&(r=31,16777215<t>>>0||(r=28+((r=((a=(s<<=n=s+1048320>>>16&8)<<(r=s+520192>>>16&4))<<(s=a+245760>>>16&2)>>>15)-(s|r|n)|0)<<1|t>>>r+21&1)|0)),y[(i=h)+28>>2]=r,y[h+16>>2]=0,i=8652+(r<<2)|(y[h+20>>2]=0),(s=y[2088])&(n=1<<r)){for(s=t<<(31==(0|r)?0:25-(r>>>1)),r=y[i>>2];;){if((-8&y[(i=r)+4>>2])==(0|t))break a;if(r=s>>>29,s<<=1,!(r=y[16+(n=(4&r)+i|0)>>2]))break}y[n+16>>2]=h}else y[2088]=s|n,y[i>>2]=h;y[h+24>>2]=i,y[h+12>>2]=h,y[h+8>>2]=h;break o}for(y[2090]=h=(t=o+-40|0)-(s=r+8&7?-8-r&7:0)|0,y[2093]=s=r+s|0,y[s+4>>2]=1|h,y[4+(t+r|0)>>2]=40,y[2094]=y[2209],y[(s=(t=(n+(n+-39&7?39-n&7:0)|0)-47|0)>>>0<i+16>>>0?i:t)+4>>2]=27,t=y[2202],y[s+16>>2]=y[2201],y[s+20>>2]=t,t=y[2200],y[s+8>>2]=y[2199],y[s+12>>2]=t,y[2201]=s+8,y[2200]=o,y[2199]=r,t=s+24|(y[2202]=0);y[t+4>>2]=7,r=t+8|0,t=t+4|0,r>>>0<n>>>0;);if((0|i)==(0|s))break s;if(y[s+4>>2]=-2&y[s+4>>2],y[i+4>>2]=1|(n=s-i|0),(y[s>>2]=n)>>>0<=255){t=8388+((r=n>>>3)<<3)|0,r=(s=y[2087])&(r=1<<r)?y[t+8>>2]:(y[2087]=r|s,t),y[t+8>>2]=i,y[r+12>>2]=i,y[i+12>>2]=t,y[i+8>>2]=r;break s}if(y[i+16>>2]=0,t=y[i+20>>2]=0,(s=n>>>8)&&(t=31,16777215<n>>>0||(t=28+((t=((h=(s<<=o=s+1048320>>>16&8)<<(t=s+520192>>>16&4))<<(s=h+245760>>>16&2)>>>15)-(s|t|o)|0)<<1|n>>>t+21&1)|0)),r=8652+((y[(r=i)+28>>2]=t)<<2)|0,(s=y[2088])&(o=1<<t)){for(t=n<<(31==(0|t)?0:25-(t>>>1)),r=y[r>>2];;){if((0|n)==(-8&y[(s=r)+4>>2]))break n;if(r=t>>>29,t<<=1,!(r=y[16+(o=s+(4&r)|0)>>2]))break}y[o+16>>2]=i,y[i+24>>2]=s}else y[2088]=s|o,y[r>>2]=i,y[i+24>>2]=r;y[i+12>>2]=i,y[i+8>>2]=i;break s}t=y[i+8>>2],y[t+12>>2]=h,y[i+8>>2]=h,y[h+24>>2]=0,y[h+12>>2]=i,y[h+8>>2]=t}t=u+8|0;break t}t=y[s+8>>2],y[t+12>>2]=i,y[s+8>>2]=i,y[i+24>>2]=0,y[i+12>>2]=s,y[i+8>>2]=t}if(!((t=y[2090])>>>0<=a>>>0)){y[2090]=r=t-a|0,t=y[2093],y[2093]=i=t+a|0,y[i+4>>2]=1|r,y[t+4>>2]=3|a,t=t+8|0;break t}}y[2086]=48,t=0;break t}r:if(h){t=y[n+28>>2];i:{if(y[(s=8652+(t<<2)|0)>>2]==(0|n)){if(y[s>>2]=r)break i;l=It(t)&l,y[2088]=l;break r}if(!(y[h+(y[h+16>>2]==(0|n)?16:20)>>2]=r))break r}y[r+24>>2]=h,(t=y[n+16>>2])&&(y[r+16>>2]=t,y[t+24>>2]=r),(t=y[n+20>>2])&&(y[r+20>>2]=t,y[t+24>>2]=r)}r:if(i>>>0<=15)y[n+4>>2]=3|(t=i+a|0),y[4+(t=t+n|0)>>2]=1|y[t+4>>2];else if(y[n+4>>2]=3|a,y[4+(s=n+a|0)>>2]=1|i,(y[i+s>>2]=i)>>>0<=255)t=8388+((r=i>>>3)<<3)|0,r=(i=y[2087])&(r=1<<r)?y[t+8>>2]:(y[2087]=r|i,t),y[t+8>>2]=s,y[r+12>>2]=s,y[s+12>>2]=t,y[s+8>>2]=r;else{t=0,(a=i>>>8)&&(t=31,16777215<i>>>0||(t=28+((t=((h=(a<<=o=a+1048320>>>16&8)<<(t=a+520192>>>16&4))<<(a=h+245760>>>16&2)>>>15)-(a|t|o)|0)<<1|i>>>t+21&1)|0)),y[(r=s)+28>>2]=t,y[s+16>>2]=0,r=8652+(t<<2)|(y[s+20>>2]=0);i:{if((a=1<<t)&l){for(t=i<<(31==(0|t)?0:25-(t>>>1)),a=y[r>>2];;){if((-8&y[(r=a)+4>>2])==(0|i))break i;if(a=t>>>29,t<<=1,!(a=y[16+(o=(4&a)+r|0)>>2]))break}y[o+16>>2]=s}else y[2088]=a|l,y[r>>2]=s;y[s+24>>2]=r,y[s+12>>2]=s,y[s+8>>2]=s;break r}t=y[r+8>>2],y[t+12>>2]=s,y[r+8>>2]=s,y[s+24>>2]=0,y[s+12>>2]=r,y[s+8>>2]=t}t=n+8|0;break t}e:if(u){t=y[r+28>>2];r:{if(y[(i=8652+(t<<2)|0)>>2]==(0|r)){if(y[i>>2]=n)break r;d=It(t)&c,y[2088]=d;break e}if(!(y[u+(y[u+16>>2]==(0|r)?16:20)>>2]=n))break e}y[n+24>>2]=u,(t=y[r+16>>2])&&(y[n+16>>2]=t,y[t+24>>2]=n),(t=y[r+20>>2])&&(y[n+20>>2]=t,y[t+24>>2]=n)}s>>>0<=15?(y[r+4>>2]=3|(t=s+a|0),y[4+(t=t+r|0)>>2]=1|y[t+4>>2]):(y[r+4>>2]=3|a,y[4+(a=r+a|0)>>2]=1|s,y[s+a>>2]=s,l&&(t=8388+((i=l>>>3)<<3)|0,n=y[2092],i=(i=1<<i)&o?y[t+8>>2]:(y[2087]=i|o,t),y[t+8>>2]=n,y[i+12>>2]=n,y[n+12>>2]=t,y[n+8>>2]=i),y[2092]=a,y[2089]=s),t=r+8|0}return L=16+e|0,t}function nt(t,e,r,i,s,n,o){var a,h,l,u=0,c=0,d=0,f=0,p=0,v=0,x=0,A=0,w=0,S=0,C=0,P=0;y[76+(L=l=L-80|0)>>2]=e,h=55+l|0,a=56+l|0,e=0;t:{e:{r:for(;;){(0|w)<0||(w=(2147483647-w|0)<(0|e)?(y[2086]=61,-1):e+w|0);i:{s:{n:{o:{a:{h:{l:{u:{c:{d:{f:{p:{_:{if(f=y[76+l>>2],d=b[0|(e=f)]){for(;;){m:{g:{y:if(u=255&d){if(37!=(0|u))break g;for(d=e;;){if(37!=b[e+1|0])break y;if(y[76+l>>2]=u=e+2|0,d=d+1|0,c=b[e+2|0],e=u,37!=(0|c))break}}else d=e;if(e=d-f|0,t&&N(t,f,e),e)continue r;S=-1,p=!q(m[y[76+(u=l)>>2]+(d=1)|0]),e=y[76+l>>2],p|36!=b[e+2|0]||(S=m[e+1|0]+-48|0,C=1,d=3),y[u+76>>2]=e=d+e|0;y:if(31<(c=(x=m[(d=0)|e])+-32|0)>>>0)u=e;else if(u=e,75913&(c=1<<c))for(;;){if(y[76+l>>2]=u=e+1|0,d|=c,31<(c=(x=m[e+1|0])+-32|0)>>>0)break y;if(e=u,!(75913&(c=1<<c)))break}if(42==(0|x)){if(p=l,q(m[u+1|0])&&(e=y[76+l>>2],36==b[e+2|0]))y[((m[e+1|0]<<2)+s|0)-192>>2]=10,A=y[((m[e+1|0]<<3)+i|0)-384>>2],C=1,e=e+3|0;else{if(C)break e;A=C=0,t&&(e=y[r>>2],y[r>>2]=e+4,A=y[e>>2]),e=y[76+l>>2]+1|0}y[p+76>>2]=e,-1<(0|A)||(A=0-A|0,d|=8192)}else{if((0|(A=xt(76+l|0)))<0)break e;e=y[76+l>>2]}if(c=-1,46==b[0|e])if(42==b[e+1|0])if(q(m[e+2|0])&&(e=y[76+l>>2],36==b[e+3|0]))y[((m[e+2|0]<<2)+s|0)-192>>2]=10,c=y[((m[e+2|0]<<3)+i|0)-384>>2],y[76+l>>2]=e=e+4|0;else{if(C)break e;c=t?(e=y[r>>2],y[r>>2]=e+4,y[e>>2]):0,e=y[76+l>>2]+2|0,y[76+l>>2]=e}else y[76+l>>2]=e+1,c=xt(76+l|0),e=y[76+l>>2];for(u=0;;){if(P=u,v=-1,57<m[0|e]+-65>>>0)break t;if(y[76+l>>2]=x=e+1|0,u=m[0|e],e=x,!((u=b[3295+(u+E(P,58)|0)|0])+-1>>>0<8))break}if(!u)break t;y:{b:{v:{if(19==(0|u)){if((0|S)<=-1)break v;break t}if((0|S)<0)break b;y[(S<<2)+s>>2]=u,u=y[4+(e=(S<<3)+i|0)>>2],y[64+l>>2]=y[e>>2],y[68+l>>2]=u}if(e=0,t)break y;continue r}if(!t)break i;vt(64+l|0,u,r,o),x=y[76+l>>2]}if(p=-65537&d,d=8192&d?p:d,S=3336,u=a,e=m[x+-1|(v=0)],(x=(e=P&&3==(15&e)?-33&e:e)+-88|0)>>>0<=32)break m;y:{b:{v:{x:{if(6<(p=e+-65|0)>>>0){if(83!=(0|e))break s;if(!c)break x;u=y[64+l>>2];break b}switch(p-1|0){case 1:break v;case 0:case 2:break s;default:break _}}U(t,32,A,e=0,d);break y}y[12+l>>2]=0,y[8+l>>2]=y[64+l>>2],y[64+l>>2]=8+l,c=-1,u=8+l|0}e=0;b:{for(;;){if(!(f=y[u>>2]))break b;if((p=(0|(f=yt(4+l|0,f)))<0)|c-e>>>0<f>>>0)break;if(u=u+4|0,!((e=e+f|0)>>>0<c>>>0))break b}if(v=-1,p)break t}if(U(t,32,A,e,d),e)for(c=0,u=y[64+l>>2];;){if(!(f=y[u>>2]))break y;if((0|e)<(0|(c=(f=yt(4+l|0,f))+c|0)))break y;if(N(t,4+l|0,f),u=u+4|0,!(c>>>0<e>>>0))break}else e=0}U(t,32,A,e,8192^d),e=(0|e)<(0|A)?A:e;continue r}y[76+l>>2]=u=e+1|0,d=b[e+1|0],e=u;continue}break}switch(x-1|0){case 28:break a;case 21:break h;case 23:break u;case 22:break c;case 11:case 16:break d;case 10:break f;case 26:break p;case 8:case 12:case 13:case 14:break _;case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:case 9:case 15:case 17:case 18:case 19:case 20:case 24:case 25:case 27:case 29:case 30:break s;default:break l}}if(v=w,t)break t;if(!C)break i;for(e=1;;){if(t=y[(e<<2)+s>>2]){if(vt((e<<3)+i|0,t,r,o),10!=(0|(e=e+(v=1)|0)))continue;break t}break}if(v=1,9<e>>>0)break t;if(v=-1,y[(e<<2)+s>>2])break t;for(;!y[((e=e+1|0)<<2)+s>>2]&&10!=(0|e););v=e>>>0<10?-1:1;break t}e=0|_[n](t,T[64+l>>3],A,c,d,e);continue}u=(e=Et(f=(e=y[64+l>>2])||3346,c))||c+f|0,d=p,c=e?e-f|0:c;break s}m[55+l|0]=y[64+l>>2],c=1,f=h,d=p;break s}if(e=p=y[68+l>>2],f=y[64+l>>2],(0|e)<-1||(0|e)<=-1&&!(4294967295<f>>>0)){e=0-(e+(0<f>>>0)|0)|0,y[64+l>>2]=f=0-f|0,y[68+l>>2]=e,v=1,S=3336;break o}if(2048&d){v=1,S=3337;break o}S=(v=1&d)?3338:3336;break o}if(f=function(t,e,r){if(t|e)for(;m[0|(r=r+-1|0)]=7&t|48,(t=(7&e)<<29|t>>>3)|(e>>>=3););return r}(y[64+l>>2],y[68+l>>2],a),!(8&d))break n;c=(0|(e=a-f|0))<(0|c)?c:e+1|0;break n}c=8<c>>>0?c:8,d|=8,e=120}if(f=function(t,e,r,i){if(t|e)for(;m[0|(r=r+-1|0)]=b[3824+(15&t)|0]|i,(t=(15&e)<<28|t>>>4)|(e>>>=4););return r}(y[64+l>>2],y[68+l>>2],a,32&e),!(8&d)|!(y[64+l>>2]|y[68+l>>2]))break n;S=3336+(e>>>4)|0,v=2;break n}if(7<(u=255&P)>>>(e=0))continue;switch(u-1|0){default:case 0:case 5:y[y[64+l>>2]>>2]=w;continue;case 1:u=y[64+l>>2],y[u>>2]=w,y[u+4>>2]=w>>31;continue;case 2:g[y[64+l>>2]>>1]=w;continue;case 3:m[y[64+l>>2]]=w;continue;case 4:continue;case 6:}u=y[64+l>>2],y[u>>2]=w,y[u+4>>2]=w>>31;continue}f=y[64+l>>2],e=y[68+l>>2],S=3336}f=j(f,e,a)}d=-1<(0|c)?-65537&d:d,c=!!((p=e=y[68+l>>2])|(x=y[64+l>>2]))|c?(0|(e=!(p|x)+(a-f|0)|0))<(0|c)?c:e:(f=a,0)}U(t,32,e=(0|A)<(0|(u=(c=(0|c)<(0|(p=u-f|0))?p:c)+v|0))?u:A,u,d),N(t,S,v),U(t,48,e,u,65536^d),U(t,48,c,p,0),N(t,f,p),U(t,32,e,u,8192^d);continue}break}v=0;break t}v=-1}return L=80+l|0,v}function ot(t){var e,r=0,i=0,s=0,n=0;s=4,i=1439;t:if(r=b[0|t]){for(;!((0|(e=b[0|i]))!=(0|r)||!(s=s+-1|0)|!e);)if(i=i+1|0,r=b[t+1|0],t=t+1|0,!r)break t;n=r}return(255&n)-b[0|i]|0}function at(t,e,r){var i,s,n=0,o=0,a=0;y[(L=s=L-240|0)>>2]=t,o=1;t:if(!((0|e)<2))for(n=t;;){if(n=(i=n+-4|0)-y[((a=e+-2|0)<<2)+r>>2]|0,0<=(0|_[5](t,n))&&-1<(0|_[5](t,i)))break t;if(t=(o<<2)+s|0,0<=(0|_[5](n,i))?(y[t>>2]=n,a=e+-1|0):n=y[t>>2]=i,o=o+1|0,(0|a)<2)break t;t=y[s>>2],e=a}St(s,o),L=240+s|0}function ht(t){var e,r,i=0;if(w(0),function(t){var e,r;y[t+428>>2]&&(r=y[t+332>>2],G(y[t+460>>2],y[t+436>>2],e=r<<2),G(y[t+464>>2],y[t+440>>2],e),G(y[t+468>>2],y[t+448>>2],e),b[y[t>>2]+4|0]<4||(G(y[t+472>>2],y[t+452>>2],e=r<<4),G(y[t+476>>2],y[t+456>>2],e)))}(t),function(t){var e,r,i,s=0,n=w(0),o=w(0),a=0,h=w(0);if(w(0),w(0),1<=(0|(a=y[t>>2])))for(i=(s=y[t+4>>2])+E(a,52)|0,t=y[t+12>>2];n=A[t>>2],A[s+44>>2]!=(n=(e=y[s+16>>2])?(o=n,n=A[s+4>>2],h=A[s+12>>2],o=w(w(o-n)/h),r=w(M(o)),a=w(S(r))<w(2147483648)?~~r:-2147483648,w(n+w(h*w(o-w(0|a))))):(h=A[s+4>>2],o=A[s+8>>2],n<h?h:o<n?o:n))?(A[s+44>>2]=n,y[s+48>>2]=1):y[s+48>>2]=0,e||(A[t>>2]=n),t=t+4|0,(s=s+52|0)>>>0<i>>>0;);}(t+540|0),function(t){var e,r,i,s,n,o,a=0,h=0,l=w(0),u=0,c=w(0),d=(w(0),w(0),0),f=w(0),p=0,_=0,m=0;if(w(0),1<=(0|(u=y[t+540>>2])))for(n=(d=y[t+544>>2])+E(u,52)|0,o=y[t+644>>2];;){t:if(!(y[d>>2]||(0|(u=y[d+32>>2]))<1))if(i=(t=y[d+28>>2])+E(u,28)|0,s=A[d+24>>2],r=A[d+20>>2],e=A[d+44>>2],o)for(;;){f=w(_=0);e:{r:{i:{if((0|(h=y[t>>2]))<1)a=u=0;else if(p=y[t+4>>2],c=A[p>>2],l=w(c-r),1==(0|h))u=e<w(r+c)^1|l<e^1,a=0;else{if(e<l){u=1,a=0;break r}if(u=0,e<w(r+c))a=0;else{if(a=1,l=A[p+4>>2],!(e<w(r+l)))for(;;){if((0|h)==(0|(a=a+1|0)))break i;if(c=l,l=A[p+(a<<2)>>2],e<w(r+l))break}w(l-r)<e||(a=a+-1|0,(l=w(l-c))<s)||(f=w(w(e-c)/l))}}if(u)break r;if(p=h=1,y[t+16>>2])break e;break r}a=h+-1|0,u=1}p=(h=(c=A[t+12>>2])!=f)&(f==w(0)|c==w(0))|y[t+8>>2]!=(0|a),_=u}if(y[t+20>>2]=p,y[t+24>>2]=h,A[t+12>>2]=f,y[t+16>>2]=_,y[t+8>>2]=a,!((t=t+28|0)>>>0<i>>>0))break}else{if(!y[d+48>>2])for(;;)if(y[t+20>>2]=0,!((t=t+28|(y[t+24>>2]=0))>>>0<i>>>0))break t;for(;;){f=w(_=0);e:{r:{i:{s:if(!(((h=0)|(a=y[(p=t)>>2]))<1)){if(u=y[t+4>>2],c=A[u>>2],l=w(c-r),1!=(0|a)){if(!(e<l)){if(h=0,e<w(r+c))break s;h=1;n:if(l=A[u+4>>2],!(e<w(r+l))){for(a=a+-1|0;c=l,(0|a)!=(0|h);)if(l=A[u+((h=h+1|0)<<2)>>2],e<w(r+l))break n;u=1;break r}if(u=0,w(l-r)<e){a=h;break i}if(a=h+-1|0,(l=w(l-c))<s)break i;f=w(w(e-c)/l);break i}u=1,a=0;break r}h=e<w(r+c)^1|l<e^1}u=h,a=0}if(!u&&(m=h=1,y[t+16>>2]))break e}_=u,m=(h=(c=A[t+12>>2])!=f)&(f==w(0)|c==w(0))|y[t+8>>2]!=(0|a)}if(y[p+20>>2]=m,y[t+24>>2]=h,A[t+12>>2]=f,y[t+16>>2]=_,y[t+8>>2]=a,!((t=t+28|0)>>>0<i>>>0))break}}if(!((d=d+52|0)>>>0<n>>>0))break}}(t),function(t){var e,r,i,s,n,o=0,a=w(0),h=0,l=0,u=w(0),c=0,d=w(0);if(w(0),!(b[y[t>>2]+4|0]<4||(0|(o=y[t+540>>2]))<1))for(s=(c=y[t+544>>2])+E(o,52)|0,n=y[t+644>>2];;){t:if(1==y[c>>2]&&!((0|(o=y[c+40>>2]))<1))if(r=(t=y[c+36>>2])+E(o,28)|0,e=A[c+44>>2],n)for(;;){d=w(o=0);e:if(!((0|(l=y[t>>2]))<2||(h=y[t+4>>2],e<=(a=A[h>>2])))){o=1;r:if(!(e<(u=A[h+4>>2]))){for(;a=u,(0|l)!=(0|(o=o+1|0));)if(e<(u=A[h+(o<<2)>>2]))break r;o=l+-1|0;break e}d=w(w(e-a)/w(u-a)),o=o+-1|0}if(a=A[t+16>>2],A[t+16>>2]=d,l=y[t+12>>2],y[t+12>>2]=o,y[t+24>>2]=h=a!=d,y[t+20>>2]=h&(d==w(0)|a==w(0))|(0|o)!=(0|l),!((t=t+28|0)>>>0<r>>>0))break}else{if(!y[c+48>>2])for(;;)if(y[t+20>>2]=0,!((t=t+28|(y[t+24>>2]=0))>>>0<r>>>0))break t;for(;;){d=w(l=0);e:if(!((0|(i=y[t>>2]))<2||(h=y[t+4>>2],e<=(a=A[h>>2])))){if(o=1,!(e<(u=A[h+4>>2])))for(l=i+-1|0;;){if(a=u,(0|o)==(0|l))break e;if(e<(u=A[h+((o=o+1|0)<<2)>>2]))break}d=w(w(e-a)/w(u-a)),l=o+-1|0}if(a=A[t+16>>2],A[t+16>>2]=d,o=y[t+12>>2],y[t+12>>2]=l,y[t+24>>2]=h=a!=d,y[t+20>>2]=h&(d==w(0)|a==w(0))|(0|o)!=(0|l),!((t=t+28|0)>>>0<r>>>0))break}}if(!((c=c+52|0)>>>0<s>>>0))break}}(t),function(t){var e,r,i,s,n,o,a,h=0,l=0,u=0,c=0,d=0,f=0,p=0,_=w(0),m=0,g=0,b=0,v=0,x=0;if(1<=(0|(l=y[t+564>>2])))for(o=(d=y[t+568>>2])+E(l,36)|0,s=y[t+644>>2];;){t:{if(!(f=((u=c=l=0)|(r=y[d+4>>2]))<1))for(m=y[d>>2],t=v=0;;){if(h=y[m+(t<<2)>>2],y[h+16>>2]){h=1,x=0;break t}if(u=u||y[h+24>>2],l=l||y[h+20>>2],c=(A[h+12>>2]!=w(0))+c|0,(0|r)==(0|(t=t+1|0)))break}if(h=0,(v=s?1:u)|(x=s?1:l)&&(y[d+12>>2]=m=1<<c,31!=(0|c))){for(l=y[d+20>>2],n=y[d>>2],u=(t=y[d+16>>2])+(p=m<<2)|0,u=z(t,0,4+(~t+((t=t+4|0)>>>0<u>>>0?u:t)|0)&-4),p=l+p|0,t=l;y[t>>2]=1065353216,(t=t+4|0)>>>0<p>>>0;);if(!f){if(f=0,p=h=1,c)for(;;){if(c=y[(f<<2)+n>>2],g=y[c+8>>2],b=E(g,h),(_=A[c+12>>2])!=w(t=0)){for(y[u>>2]=b+y[u>>2],A[l>>2]=w(w(1)-_)*A[l>>2],g=E(g+(t=1)|0,h);_=A[c+12>>2],a=y[(i=(e=t<<2)+u|0)>>2],y[i>>2]=a+((i=t&p)?g:b),A[(e=l+e|0)>>2]=(i?_:w(w(1)-_))*A[e>>2],(0|m)!=(0|(t=t+1|0)););p<<=1}else for(;y[(g=u+(t<<2)|0)>>2]=b+y[g>>2],(0|m)!=(0|(t=t+1|0)););if(h=E(y[c>>2],h),(0|r)==(0|(f=f+1|0)))break}else for(;;){if(c=y[(f<<2)+n>>2],p=E(y[c+8>>2],h),(_=A[c+12>>2])!=w(t=0))y[u>>2]=p+y[u>>2],A[l>>2]=w(w(1)-_)*A[l>>2];else for(;y[(b=u+(t<<2)|0)>>2]=p+y[b>>2],(0|m)!=(0|(t=t+1|0)););if(h=E(y[c>>2],h),(0|r)==(0|(f=f+1|0)))break}h=0}}}if(y[d+32>>2]=h,y[d+24>>2]=x,y[d+28>>2]=v,!((d=d+36|0)>>>0<o>>>0))break}}(t),function(t){var e,r,i,s,n=w(0),o=0,a=0,h=0,l=0,u=0,c=w(0),d=w(0),f=w(0),p=0,_=0,m=0;if(!(b[y[t>>2]+4|0]<4||(0|(o=y[t+588>>2]))<1))for(s=(h=y[t+592>>2])+E(o,48)|0,e=y[t+644>>2];;){if(t=y[h>>2],(_=e?1:y[t+20>>2])|(m=e?1:y[t+24>>2])){t:{e:{u=h,l=y[t+8>>2],o=y[t+12>>2],n=A[t+16>>2],t=(0|l)!=(0|o);r:{if(n!=w(0)){if(t=o+1|0,(0|o)==(0|l)){y[h+8>>2]=_=1,n=w(w(1)-n),m=1;break r}t=(0|t)==(0|l)?1:2}if(y[u+8>>2]=t,!m)break e;t=o}A[h+24>>2]=n,A[h+20>>2]=w(1)-n;break t}m=0,t=o}_?(y[h+12>>2]=t,y[h+16>>2]=t+1):_=0}else _=m=0;t:if((0|(r=y[h+36>>2]))<1)f=w(1);else{if(i=y[h+40>>2],t=0,f=w(1),!e)for(;;){e:{r:{if(o=y[(t<<2)+i>>2],a=y[o>>2]){if(!y[a+48>>2]){n=A[o+16>>2];break e}if((0|(l=y[o+12>>2]))<1){n=w(1),A[o+16>>2]=1;break e}if(p=y[o+8>>2],1!=(0|l)&&(c=A[a+44>>2],u=y[o+4>>2],!(c<=(d=A[u>>2]))))break r;n=A[p>>2],A[o+16>>2]=n;break e}y[o+16>>2]=1065353216,n=w(1);break e}a=1;r:if(!(c<(n=A[u+4>>2]))){for(;d=n,(0|l)!=(0|(a=a+1|0));)if(c<(n=A[u+(a<<2)>>2]))break r;n=A[(p+(l<<2)|0)-4>>2],A[o+16>>2]=n;break e}u=o,n=w(w(c-d)/w(n-d)),n=w(w(n*A[(o=p+(a<<2)|0)>>2])+w(A[o+-4>>2]*w(w(1)-n))),A[u+16>>2]=n}if(f=f<n?f:n,(0|r)==(0|(t=t+1|0)))break t}for(;;){o=y[(t<<2)+i>>2],a=y[o>>2],n=w(1);e:if(a&&(p=y[o+12>>2],n=w(1),!((0|p)<1))&&(l=y[o+8>>2],n=A[l>>2],1!=(0|p))){r:{if(c=A[a+44>>2],u=y[o+4>>2],c<=(d=A[u>>2])){n=A[l>>2];break e}if(a=1,!(c<(n=A[u+4>>2]))){for(;d=n,(0|p)!=(0|(a=a+1|0));)if(c<(n=A[u+(a<<2)>>2]))break r;n=A[(l+(p<<2)|0)-4>>2];break e}}n=w(w(c-d)/w(n-d)),n=w(w(n*A[(a=l+(a<<2)|0)>>2])+w(A[a+-4>>2]*w(w(1)-n)))}if(f=f<(A[o+16>>2]=n)?f:n,(0|r)==(0|(t=t+1|0)))break}}if(y[h+32>>2]=m,y[h+28>>2]=_,A[h+44>>2]=f,!((h=h+48|0)>>>0<s>>>0))break}}(t),1<=(0|(e=y[t+4>>2])))for(e=(i=y[t+52>>2])+(e<<2)|0;r=A[i>>2],A[i>>2]=r<w(0)?w(0):w(P(r,w(1))),(i=i+4|0)>>>0<e>>>0;);!function(t){var e,r,i,s=0,n=0;if(1<=(0|(n=y[t+4>>2])))for(i=(s=y[t+8>>2])+E(n,12)|0,t=e=y[t+40>>2];n=0,y[s+8>>2]&&(r=y[s+4>>2],!y[(r<<2)+e>>2]&&-1!=(0|r)||(n=!y[y[s>>2]+32>>2])),y[t>>2]=n,t=t+4|0,(s=s+12|0)>>>0<i>>>0;);}(t),function(t){var e,r,i,s,n,o,a,h=0,l=0,u=0,c=0,d=0;if(1<=(0|(r=y[t+4>>2])))for(s=y[t+8>>2],i=y[t>>2],n=y[i+724>>2];;){if(e=y[E(c,12)+s>>2],(y[e+28>>2]||y[e+24>>2])&&(y[(h=c<<2)+y[t+28>>2]>>2]=y[e+12>>2],y[e+24>>2])&&!((0|(u=y[e+12>>2]))<1))for(u=(l=y[e+16>>2])+(u<<2)|0,o=y[h+n>>2],h=y[t+36>>2]+(d<<2)|0,a=y[i+976>>2];y[h>>2]=y[(y[l>>2]+o<<2)+a>>2],h=h+4|0,(l=l+4|0)>>>0<u>>>0;);if(y[e+28>>2]&&!((0|(h=y[e+12>>2]))<1))for(u=(l=y[e+20>>2])+(h<<2)|0,h=y[t+32>>2]+(d<<2)|0;y[h>>2]=y[l>>2],h=h+4|0,(l=l+4|0)>>>0<u>>>0;);if(d=y[e+8>>2]+d|0,(0|r)==(0|(c=c+1|0)))break}}(t),_[y[1808]](t+12|0,y[t+36>>2],y[t+44>>2],y[t+40>>2]),function(t){var e,r,i,s,n,o,a=0,h=0,l=0;if(1<=(0|(l=y[t+304>>2])))for(i=(a=y[t+308>>2])+(l<<5)|0,s=y[t+264>>2],n=y[t+144>>2],o=y[t+40>>2],l=r=y[t+312>>2];e=l,h=0,t=h=!y[a+28>>2]||-1!=(0|(t=y[a+4>>2]))&&(h=0,!y[(t<<2)+o>>2])||-1!=(0|(t=y[a+8>>2]))&&(h=0,!y[(t<<2)+r>>2])?h:!y[y[a>>2]+32>>2],y[e>>2]=t,(e=y[a+12>>2])>>>0<=1?e-1?y[(y[a+16>>2]<<2)+n>>2]=t:y[(y[a+16>>2]<<2)+s>>2]=t:B(4,1372,0),l=l+4|0,(a=a+32|0)>>>0<i>>>0;);}(t),function(t){var e,r,i,s,n,o,a,h,l,u=0,c=0,d=0,f=0,p=0,_=0,m=0,g=0,v=0,x=0,A=0,T=0,w=0,S=0;p=y[t>>2];if(1<=(0|(g=y[t+56>>2]))){for(v=y[t+60>>2],x=y[p+1052>>2],A=y[p+784>>2];;){if(u=y[v+E(_,24)>>2],(y[u+28>>2]||y[u+24>>2])&&(y[(c=_<<2)+y[t+80>>2]>>2]=y[u+12>>2],y[u+24>>2])&&!((0|(f=y[u+12>>2]))<1))for(T=(d=y[u+16>>2])+(f<<2)|0,w=y[c+A>>2],c=(f=m<<2)+y[t+92>>2]|0,f=f+y[t+88>>2]|0;S=w+y[d>>2]<<2,y[c>>2]=x+(y[S+y[p+984>>2]>>2]<<2),y[f>>2]=y[S+y[p+980>>2]>>2],f=f+4|0,c=c+4|0,(d=d+4|0)>>>0<T>>>0;);if(y[u+28>>2]&&!((0|(c=y[u+12>>2]))<1))for(f=(d=y[u+20>>2])+(c<<2)|0,c=y[t+84>>2]+(m<<2)|0;y[c>>2]=y[d>>2],c=c+4|0,(d=d+4|0)>>>0<f>>>0;);if(m=y[u+8>>2]+m|0,(0|g)==(0|(_=_+1|0)))break}p=y[t>>2]}if(!(b[p+4|0]<4||(0|(w=y[t+56>>2]))<1))for(S=y[p+792>>2],e=y[t+60>>2],d=m=0;;){if(_=y[E(d,24)+e>>2],y[_+24>>2]&&!((0|(u=y[_+12>>2]))<1))for(r=(c=y[_+16>>2])+(u<<2)|0,i=y[S+(d<<2)>>2],f=(u=m<<2)+y[t+96>>2]|0,g=u+y[t+100>>2]|0,v=u+y[t+104>>2]|0,x=u+y[t+108>>2]|0,A=u+y[t+112>>2]|0,T=u+y[t+116>>2]|0,s=y[p+1308>>2],n=y[p+1304>>2],o=y[p+1300>>2],a=y[p+1296>>2],h=y[p+1292>>2],l=y[p+1288>>2];u=y[c>>2]+i<<2,y[f>>2]=y[u+l>>2],y[g>>2]=y[u+h>>2],y[v>>2]=y[u+a>>2],y[x>>2]=y[u+o>>2],y[A>>2]=y[u+n>>2],y[T>>2]=y[u+s>>2],T=T+4|0,A=A+4|0,x=x+4|0,v=v+4|0,g=g+4|0,f=f+4|0,(c=c+4|0)>>>0<r>>>0;);if(m=y[_+8>>2]+m|0,(0|w)==(0|(d=d+1|0)))break}}(t),function(t){var e=0,r=0,i=0,s=0,n=0,o=0,a=0,h=0,l=0,u=0,c=0,d=0,f=0,p=0,_=0,m=0,g=0,v=0,x=0,A=0,T=0,w=y[t+168>>2],S=y[t>>2];if(1<=(0|(f=y[t+164>>2])))for(_=y[S+816>>2];;){if(i=y[E(a,12)+w>>2],(y[i+28>>2]||y[i+24>>2])&&(y[(h=a<<2)+y[t+188>>2]>>2]=y[i+12>>2],y[i+24>>2])){if(r=y[i+16>>2],p=y[h+_>>2],1<=(0|(e=y[i+12>>2])))for(m=r+(e<<2)|0,s=(e=o<<2)+y[t+200>>2]|0,l=e+y[t+204>>2]|0,u=e+y[t+208>>2]|0,c=e+y[t+212>>2]|0,d=e+y[t+196>>2]|0,g=y[S+996>>2],v=y[S+1012>>2],x=y[S+1008>>2],A=y[S+1004>>2],T=y[S+1e3>>2],e=r;n=p+y[e>>2]<<2,y[s>>2]=y[n+T>>2],y[l>>2]=y[n+A>>2],y[u>>2]=y[n+x>>2],y[c>>2]=y[n+v>>2],y[d>>2]=y[n+g>>2],d=d+4|0,c=c+4|0,u=u+4|0,l=l+4|0,s=s+4|0,(e=e+4|0)>>>0<m>>>0;);e=p+y[r>>2]<<2,y[h+y[t+288>>2]>>2]=y[e+y[S+1016>>2]>>2],y[h+y[t+292>>2]>>2]=y[e+y[S+1020>>2]>>2]}if(y[i+28>>2]&&!((0|(r=y[i+12>>2]))<1))for(r=(e=y[i+20>>2])+(r<<2)|0,s=y[t+192>>2]+(o<<2)|0;y[s>>2]=y[e>>2],s=s+4|0,(e=e+4|0)>>>0<r>>>0;);if(o=y[i+8>>2]+o|0,(0|f)==(0|(a=a+1|0)))break}if(!(b[S+4|0]<4||(0|(h=y[t+164>>2]))<1))for(p=y[S+824>>2],o=i=0;;){if(n=y[E(o,12)+w>>2],y[n+24>>2]&&!((0|(e=y[n+12>>2]))<1))for(f=(s=y[n+16>>2])+(e<<2)|0,_=y[p+(o<<2)>>2],l=(r=i<<2)+y[t+216>>2]|0,u=r+y[t+220>>2]|0,c=r+y[t+224>>2]|0,d=r+y[t+228>>2]|0,e=r+y[t+232>>2]|0,a=r+y[t+236>>2]|0,m=y[S+1308>>2],g=y[S+1304>>2],v=y[S+1300>>2],x=y[S+1296>>2],A=y[S+1292>>2],T=y[S+1288>>2];r=_+y[s>>2]<<2,y[l>>2]=y[r+T>>2],y[u>>2]=y[r+A>>2],y[c>>2]=y[r+x>>2],y[d>>2]=y[r+v>>2],y[e>>2]=y[r+g>>2],y[a>>2]=y[r+m>>2],a=a+4|0,e=e+4|0,d=d+4|0,c=c+4|0,u=u+4|0,l=l+4|0,(s=s+4|0)>>>0<f>>>0;);if(i=y[n+8>>2]+i|0,(0|h)==(0|(o=o+1|0)))break}}(t),function(t){var e,r=0,i=0,s=0,n=0,o=0,a=0,h=0,l=0;r=t- -64|0;if(_[y[1807]](r,y[t+88>>2],y[t+148>>2],y[t+144>>2]),_[y[1809]](r,y[t+92>>2],y[t+152>>2],y[y[t>>2]+796>>2],2,y[t+144>>2]),!(b[y[t>>2]+4|0]<4||(_[y[1807]](r,y[t+96>>2],y[t+120>>2],y[t+144>>2]),_[y[1807]](r,y[t+100>>2],y[t+124>>2],y[t+144>>2]),_[y[1807]](r,y[t+104>>2],y[t+128>>2],y[t+144>>2]),_[y[1807]](r,y[t+108>>2],y[t+132>>2],y[t+144>>2]),_[y[1807]](r,y[t+112>>2],y[t+136>>2],y[t+144>>2]),_[y[1807]](r,y[t+116>>2],y[t+140>>2],y[t+144>>2]),(0|(a=y[t+56>>2]))<1))){for(h=y[t+128>>2],l=y[t+124>>2],e=y[t+120>>2],i=y[t+156>>2],r=0;y[(s=n<<2)+i>>2]=y[(o=r<<2)+e>>2],y[i+(4|s)>>2]=y[o+l>>2],y[i+(8|s)>>2]=y[o+h>>2],n=n+4|0,(0|a)!=(0|(r=r+1|0)););for(i=y[t+160>>2],o=y[t+140>>2],h=y[t+136>>2],l=y[t+132>>2],r=t=0;y[(n=t<<2)+i>>2]=y[(s=r<<2)+l>>2],y[i+(4|n)>>2]=y[s+h>>2],y[i+(8|n)>>2]=y[s+o>>2],t=t+4|0,(0|a)!=(0|(r=r+1|0)););}}(t),function(t){var e,r=0,i=0,s=0,n=0,o=0,a=0,h=0,l=0;r=t+172|0;if(_[y[1807]](r,y[t+196>>2],y[t+268>>2],y[t+264>>2]),_[y[1807]](r,y[t+200>>2],y[t+284>>2],y[t+264>>2]),_[y[1807]](r,y[t+204>>2],y[t+276>>2],y[t+264>>2]),_[y[1807]](r,y[t+208>>2],y[t+280>>2],y[t+264>>2]),_[y[1807]](r,y[t+212>>2],y[t+272>>2],y[t+264>>2]),!(b[y[t>>2]+4|0]<4||(_[y[1807]](r,y[t+216>>2],y[t+240>>2],y[t+264>>2]),_[y[1807]](r,y[t+220>>2],y[t+244>>2],y[t+264>>2]),_[y[1807]](r,y[t+224>>2],y[t+248>>2],y[t+264>>2]),_[y[1807]](r,y[t+228>>2],y[t+252>>2],y[t+264>>2]),_[y[1807]](r,y[t+232>>2],y[t+256>>2],y[t+264>>2]),_[y[1807]](r,y[t+236>>2],y[t+260>>2],y[t+264>>2]),(0|(a=y[t+164>>2]))<1))){for(h=y[t+248>>2],l=y[t+244>>2],e=y[t+240>>2],i=y[t+296>>2],r=0;y[(s=n<<2)+i>>2]=y[(o=r<<2)+e>>2],y[i+(4|s)>>2]=y[o+l>>2],y[i+(8|s)>>2]=y[o+h>>2],n=n+4|0,(0|a)!=(0|(r=r+1|0)););for(i=y[t+300>>2],o=y[t+260>>2],h=y[t+256>>2],l=y[t+252>>2],r=t=0;y[(n=t<<2)+i>>2]=y[(s=r<<2)+l>>2],y[i+(4|n)>>2]=y[s+h>>2],y[i+(8|n)>>2]=y[s+o>>2],t=t+4|0,(0|a)!=(0|(r=r+1|0)););}}(t),function(t){var e,r,i,s=0,n=0,o=0;if(1<=(0|(n=y[t+332>>2])))for(e=(s=y[t+336>>2])+E(n,20)|0,r=y[t+312>>2],i=y[t+40>>2],t=y[t+424>>2];n=0,y[s+12>>2]&&(o=y[s+4>>2],y[(o<<2)+i>>2]||-1==(0|o))&&(o=y[s+8>>2],y[(o<<2)+r>>2]||-1==(0|o))&&(n=!y[y[s>>2]+32>>2]),y[t>>2]=n,t=t+4|0,(s=s+20|0)>>>0<e>>>0;);}(t),function(t){var e,r,i,s,n,o,a,h,l=0,u=0,c=0,d=0,f=0,p=0,_=0,m=0,g=0,v=0,x=0,A=0,T=0,w=0,S=0;d=y[t>>2];if(1<=(0|(v=y[t+332>>2]))){for(x=y[t+336>>2],A=y[d+1052>>2],T=y[d+856>>2];;){if(l=y[x+E(_,20)>>2],(y[l+28>>2]||y[l+24>>2])&&(y[(u=_<<2)+y[t+356>>2]>>2]=y[l+12>>2],y[l+24>>2])&&!((0|(f=y[l+12>>2]))<1))for(w=(c=y[l+16>>2])+(f<<2)|0,S=y[u+T>>2],u=(p=m<<2)+y[t+372>>2]|0,f=p+y[t+364>>2]|0,p=p+y[t+368>>2]|0;g=S+y[c>>2]<<2,y[u>>2]=A+(y[g+y[d+1040>>2]>>2]<<2),y[f>>2]=y[g+y[d+1032>>2]>>2],y[p>>2]=y[g+y[d+1036>>2]>>2],p=p+4|0,f=f+4|0,u=u+4|0,(c=c+4|0)>>>0<w>>>0;);if(y[l+28>>2]&&!((0|(u=y[l+12>>2]))<1))for(f=(c=y[l+20>>2])+(u<<2)|0,u=y[t+360>>2]+(m<<2)|0;y[u>>2]=y[c>>2],u=u+4|0,(c=c+4|0)>>>0<f>>>0;);if(m=y[l+8>>2]+m|0,(0|v)==(0|(_=_+1|0)))break}d=y[t>>2]}if(!(b[d+4|0]<4||(0|(T=y[t+332>>2]))<1))for(w=y[d+864>>2],S=y[t+336>>2],c=m=0;;){if(_=y[S+E(c,20)>>2],y[_+24>>2]&&!((0|(l=y[_+12>>2]))<1))for(e=(u=y[_+16>>2])+(l<<2)|0,r=y[w+(c<<2)>>2],f=(l=m<<2)+y[t+376>>2]|0,p=l+y[t+380>>2]|0,g=l+y[t+384>>2]|0,v=l+y[t+388>>2]|0,x=l+y[t+392>>2]|0,A=l+y[t+396>>2]|0,i=y[d+1308>>2],s=y[d+1304>>2],n=y[d+1300>>2],o=y[d+1296>>2],a=y[d+1292>>2],h=y[d+1288>>2];l=y[u>>2]+r<<2,y[f>>2]=y[l+h>>2],y[p>>2]=y[l+a>>2],y[g>>2]=y[l+o>>2],y[v>>2]=y[l+n>>2],y[x>>2]=y[l+s>>2],y[A>>2]=y[l+i>>2],A=A+4|0,x=x+4|0,v=v+4|0,g=g+4|0,p=p+4|0,f=f+4|0,(u=u+4|0)>>>0<e>>>0;);if(m=y[_+8>>2]+m|0,(0|T)==(0|(c=c+1|0)))break}}(t),function(t){var e,r=0,i=0,s=0,n=0,o=0,a=0,h=0,l=0;r=t+340|0;if(_[y[1807]](r,y[t+364>>2],y[t+448>>2],y[t+424>>2]),_[y[1808]](r,y[t+368>>2],y[t+440>>2],y[t+424>>2]),_[y[1809]](r,y[t+372>>2],y[t+444>>2],y[y[t>>2]+892>>2],2,y[t+424>>2]),!(b[y[t>>2]+4|0]<4||(_[y[1807]](r,y[t+376>>2],y[t+400>>2],y[t+424>>2]),_[y[1807]](r,y[t+380>>2],y[t+404>>2],y[t+424>>2]),_[y[1807]](r,y[t+384>>2],y[t+408>>2],y[t+424>>2]),_[y[1807]](r,y[t+388>>2],y[t+412>>2],y[t+424>>2]),_[y[1807]](r,y[t+392>>2],y[t+416>>2],y[t+424>>2]),_[y[1807]](r,y[t+396>>2],y[t+420>>2],y[t+424>>2]),(0|(a=y[t+332>>2]))<1))){for(h=y[t+408>>2],l=y[t+404>>2],e=y[t+400>>2],i=y[t+452>>2],r=0;y[(s=n<<2)+i>>2]=y[(o=r<<2)+e>>2],y[i+(4|s)>>2]=y[o+l>>2],y[i+(8|s)>>2]=y[o+h>>2],n=n+4|0,(0|a)!=(0|(r=r+1|0)););for(i=y[t+456>>2],o=y[t+420>>2],h=y[t+416>>2],l=y[t+412>>2],r=t=0;y[(n=t<<2)+i>>2]=y[(s=r<<2)+l>>2],y[i+(4|n)>>2]=y[s+h>>2],y[i+(8|n)>>2]=y[s+o>>2],t=t+4|0,(0|a)!=(0|(r=r+1|0)););}}(t),function(t){var e,r,i,s,n,o,a,h=0,l=0,u=0,c=0,d=0;if(1<=(0|(r=y[t+500>>2])))for(s=y[t+504>>2],i=y[t>>2],n=y[i+1252>>2];;){if(e=y[E(c,24)+s>>2],(y[e+28>>2]||y[e+24>>2])&&(y[(h=c<<2)+y[t+524>>2]>>2]=y[e+12>>2],y[e+24>>2])&&!((0|(u=y[e+12>>2]))<1))for(u=(l=y[e+16>>2])+(u<<2)|0,o=y[h+n>>2],h=y[t+532>>2]+(d<<2)|0,a=y[i+1284>>2];y[h>>2]=y[(y[l>>2]+o<<2)+a>>2],h=h+4|0,(l=l+4|0)>>>0<u>>>0;);if(y[e+28>>2]&&!((0|(h=y[e+12>>2]))<1))for(u=(l=y[e+20>>2])+(h<<2)|0,h=y[t+528>>2]+(d<<2)|0;y[h>>2]=y[l>>2],h=h+4|0,(l=l+4|0)>>>0<u>>>0;);if(d=y[e+8>>2]+d|0,(0|r)==(0|(c=c+1|0)))break}}(t),_[y[1807]](t+508|0,y[t+532>>2],y[t+536>>2],0),function(t){var e,r,i,s,n,o,a=w(0),h=0,l=0,u=0,c=0;if(w(0),L=e=L-16|0,u=y[t>>2],!(b[u+4|0]<5||(0|(c=y[t+596>>2]))<1))for(s=(l=y[t+600>>2])+E(c,12)|0,n=y[t+44>>2],c=y[u+976>>2];;){if(u=(y[l>>2]<<2)+n|0,a=w(y[u>>2]),1<=(0|(h=y[l+4>>2])))for(o=(t=y[l+8>>2])+E(h,48)|0;(h=y[t+8>>2])&&((r=h+-1|0)>>>0<=1?(h=y[t+4>>2],i=A[c+(h+y[t+12>>2]<<2)>>2],a=w(r-1?a+w(A[t+44>>2]*w(i*A[t+20>>2])):a+w(A[t+44>>2]*w(w(i*A[t+20>>2])+w(A[c+(h+y[t+16>>2]<<2)>>2]*A[t+24>>2]))))):(y[e>>2]=h,B(4,1024,e))),(t=t+48|0)>>>0<o>>>0;);if(a=(a=w(a+w(.0010000000474974513)))<w(0)?w(0):w(P(a,w(1e3))),t=w(S(a))<w(2147483648)?~~a:-2147483648,y[u>>2]=t,!((l=l+12|0)>>>0<s>>>0))break}L=16+e|0}(t),function(t){var e,r,i,n,o,h,l,d,f,p=0,_=0,m=0,g=0,v=0,x=w(0);if(L=e=L-16|0,p=y[t>>2],!(b[p+4|0]<4||(lt(t,y[t+604>>2],y[t+608>>2],y[p+984>>2],y[t+152>>2],y[p+796>>2]),_=y[t>>2],b[_+4|0]<5))){if(m=y[t+608>>2],o=y[_+992>>2],h=y[_+988>>2],1<=(0|(p=y[t+604>>2]))){for(l=E(p,12)+m|0,d=y[t+148>>2],r=y[_+980>>2];;){if(i=(y[m>>2]<<2)+d|0,v=y[i>>2],1<=(0|(g=y[m+4>>2])))for(f=(p=y[m+8>>2])+E(g,48)|0;(g=y[p+8>>2])&&((n=g+-1|0)>>>0<=1?(g=y[p+4>>2],x=A[(g+y[p+12>>2]<<2)+r>>2],u(w(n-1?w(A[p+44>>2]*w(x*A[p+20>>2]))+(a(0,v),c()):w(A[p+44>>2]*w(w(x*A[p+20>>2])+w(A[(g+y[p+16>>2]<<2)+r>>2]*A[p+24>>2])))+(a(0,v),c()))),v=s[0]):(y[e>>2]=g,B(4,1024,e))),(p=p+48|0)>>>0<f>>>0;);if(a(0,v),x=c(),A[i>>2]=x<w(0)?w(0):w(P(x,w(1))),!((m=m+12|0)>>>0<l>>>0))break}m=y[t+608>>2],p=y[t+604>>2]}Y(p,m,h,y[_+1288>>2],y[_+1292>>2],y[_+1296>>2],y[t+156>>2]),Y(y[t+604>>2],y[t+608>>2],o,y[_+1300>>2],y[_+1304>>2],y[_+1308>>2],y[t+160>>2])}L=16+e|0}(t),function(t){var e,r=0,i=0,n=0,o=0,h=0,l=w(0),d=0,f=0,p=0,_=0,m=0,g=0,v=0,x=0;if(L=e=L-80|0,h=y[t>>2],!(b[h+4|0]<5)){if(g=y[h+1028>>2],v=y[h+1024>>2],n=i=y[t+616>>2],!((0|(r=y[t+612>>2]))<1)){for(f=E(r,12)+i|0,p=y[t+276>>2],d=y[h+1004>>2];;){if(_=p+(y[i>>2]<<2)|0,n=y[_>>2],1<=(0|(o=y[i+4>>2])))for(x=(r=y[i+8>>2])+E(o,48)|0;(o=y[r+8>>2])&&((m=o+-1|0)>>>0<=1?(o=y[r+4>>2],l=A[d+(o+y[r+12>>2]<<2)>>2],u(w(m-1?w(A[r+44>>2]*w(l*A[r+20>>2]))+(a(0,n),c()):w(A[r+44>>2]*w(w(l*A[r+20>>2])+w(A[d+(o+y[r+16>>2]<<2)>>2]*A[r+24>>2])))+(a(0,n),c()))),n=s[0]):(y[64+e>>2]=o,B(4,1024,64+e|0))),(r=r+48|0)>>>0<x>>>0;);if(y[_>>2]=n,!((i=i+12|0)>>>0<f>>>0))break}if(n=i=y[t+616>>2],!((0|(r=y[t+612>>2]))<1)){for(f=E(r,12)+i|0,p=y[t+280>>2],d=y[y[t>>2]+1008>>2];;){if(_=p+(y[i>>2]<<2)|0,n=y[_>>2],1<=(0|(o=y[i+4>>2])))for(x=(r=y[i+8>>2])+E(o,48)|0;(o=y[r+8>>2])&&((m=o+-1|0)>>>0<=1?(o=y[r+4>>2],l=A[d+(o+y[r+12>>2]<<2)>>2],u(w(m-1?w(A[r+44>>2]*w(l*A[r+20>>2]))+(a(0,n),c()):w(A[r+44>>2]*w(w(l*A[r+20>>2])+w(A[d+(o+y[r+16>>2]<<2)>>2]*A[r+24>>2])))+(a(0,n),c()))),n=s[0]):(y[48+e>>2]=o,B(4,1024,48+e|0))),(r=r+48|0)>>>0<x>>>0;);if(y[_>>2]=n,!((i=i+12|0)>>>0<f>>>0))break}if(n=i=y[t+616>>2],!((0|(r=y[t+612>>2]))<1)){for(f=E(r,12)+i|0,p=y[t+268>>2],d=y[y[t>>2]+996>>2];;){if(_=p+(y[i>>2]<<2)|0,n=y[_>>2],1<=(0|(o=y[i+4>>2])))for(x=(r=y[i+8>>2])+E(o,48)|0;(o=y[r+8>>2])&&((m=o+-1|0)>>>0<=1?(o=y[r+4>>2],l=A[d+(o+y[r+12>>2]<<2)>>2],u(w(m-1?w(A[r+44>>2]*w(l*A[r+20>>2]))+(a(0,n),c()):w(A[r+44>>2]*w(w(l*A[r+20>>2])+w(A[d+(o+y[r+16>>2]<<2)>>2]*A[r+24>>2])))+(a(0,n),c()))),n=s[0]):(y[32+e>>2]=o,B(4,1024,32+e|0))),(r=r+48|0)>>>0<x>>>0;);if(a(0,n),l=c(),A[_>>2]=l<w(0)?w(0):w(P(l,w(1))),!((i=i+12|0)>>>0<f>>>0))break}r=y[t+612>>2],n=y[t+616>>2]}}}if(Y(r,n,v,y[h+1288>>2],y[h+1292>>2],y[h+1296>>2],y[t+296>>2]),Y(y[t+612>>2],y[t+616>>2],g,y[h+1300>>2],y[h+1304>>2],y[h+1308>>2],y[t+300>>2]),!((0|(r=y[t+612>>2]))<1)){for(o=(i=y[t+616>>2])+E(r,12)|0,g=y[t+284>>2],h=y[y[t>>2]+1e3>>2];;){if(v=g+(y[i>>2]<<2)|0,n=y[v>>2],1<=(0|(d=y[i+4>>2])))for(f=(r=y[i+8>>2])+E(d,48)|0;(d=y[r+8>>2])&&((p=d+-1|0)>>>0<=1?(d=y[r+4>>2],l=A[h+(d+y[r+12>>2]<<2)>>2],u(w(p-1?w(A[r+44>>2]*w(l*A[r+20>>2]))+(a(0,n),c()):w(A[r+44>>2]*w(w(l*A[r+20>>2])+w(A[h+(d+y[r+16>>2]<<2)>>2]*A[r+24>>2])))+(a(0,n),c()))),n=s[0]):(y[16+e>>2]=d,B(4,1024,16+e|0))),(r=r+48|0)>>>0<f>>>0;);if(a(0,n),l=c(),A[v>>2]=l<w(-3600)?w(-3600):w(P(l,w(3600))),!((i=i+12|0)>>>0<o>>>0))break}if(!((0|(r=y[t+612>>2]))<1))for(d=(i=y[t+616>>2])+E(r,12)|0,o=y[t+272>>2],t=y[y[t>>2]+1012>>2];;){if(g=o+(y[i>>2]<<2)|0,n=y[g>>2],1<=(0|(h=y[i+4>>2])))for(v=(r=y[i+8>>2])+E(h,48)|0;(h=y[r+8>>2])&&((f=h+-1|0)>>>0<=1?(h=y[r+4>>2],l=A[t+(h+y[r+12>>2]<<2)>>2],u(w(f-1?w(A[r+44>>2]*w(l*A[r+20>>2]))+(a(0,n),c()):w(A[r+44>>2]*w(w(l*A[r+20>>2])+w(A[t+(h+y[r+16>>2]<<2)>>2]*A[r+24>>2])))+(a(0,n),c()))),n=s[0]):(y[e>>2]=h,B(4,1024,e))),(r=r+48|0)>>>0<v>>>0;);if(a(0,n),l=c(),A[g>>2]=l<w(9999999747378752e-20)?w(9999999747378752e-20):w(P(l,w(100))),!((i=i+12|0)>>>0<d>>>0))break}}}L=80+e|0}(t),function(t){var e,r,i,n,o,h=0,l=0,d=0,f=0,p=w(0),_=0,m=0,g=0,v=0,x=0,T=0;if(w(0),L=e=L-32|0,d=y[t>>2],!(b[d+4|0]<4||(lt(t,y[t+620>>2],y[t+624>>2],y[d+1040>>2],y[t+444>>2],y[d+892>>2]),_=y[t>>2],b[_+4|0]<5))){if(n=y[_+1048>>2],o=y[_+1044>>2],d=f=y[t+624>>2],!((0|(h=y[t+620>>2]))<1)){for(x=E(h,12)+f|0,T=y[t+440>>2],m=y[_+1036>>2];;){if(d=T+(y[f>>2]<<2)|0,p=w(y[d>>2]),1<=(0|(l=y[f+4>>2])))for(g=(h=y[f+8>>2])+E(l,48)|0;(l=y[h+8>>2])&&((v=l+-1|0)>>>0<=1?(l=y[h+4>>2],r=A[m+(l+y[h+12>>2]<<2)>>2],p=w(v-1?p+w(A[h+44>>2]*w(r*A[h+20>>2])):p+w(A[h+44>>2]*w(w(r*A[h+20>>2])+w(A[m+(l+y[h+16>>2]<<2)>>2]*A[h+24>>2]))))):(y[16+e>>2]=l,B(4,1024,16+e|0))),(h=h+48|0)>>>0<g>>>0;);if(p=(p=w(p+w(.0010000000474974513)))<w(0)?w(0):w(P(p,w(1e3))),h=w(S(p))<w(2147483648)?~~p:-2147483648,y[d>>2]=h,!((f=f+12|0)>>>0<x>>>0))break}if(d=f=y[t+624>>2],!((0|(h=y[t+620>>2]))<1)){for(x=E(h,12)+f|0,T=y[t+448>>2],m=y[y[t>>2]+1032>>2];;){if(g=T+(y[f>>2]<<2)|0,d=y[g>>2],1<=(0|(l=y[f+4>>2])))for(v=(h=y[f+8>>2])+E(l,48)|0;(l=y[h+8>>2])&&((i=l+-1|0)>>>0<=1?(l=y[h+4>>2],p=A[m+(l+y[h+12>>2]<<2)>>2],u(w(i-1?w(A[h+44>>2]*w(p*A[h+20>>2]))+(a(0,d),c()):w(A[h+44>>2]*w(w(p*A[h+20>>2])+w(A[m+(l+y[h+16>>2]<<2)>>2]*A[h+24>>2])))+(a(0,d),c()))),d=s[0]):(y[e>>2]=l,B(4,1024,e))),(h=h+48|0)>>>0<v>>>0;);if(a(0,d),p=c(),A[g>>2]=p<w(0)?w(0):w(P(p,w(1))),!((f=f+12|0)>>>0<x>>>0))break}h=y[t+620>>2],d=y[t+624>>2]}}Y(h,d,o,y[_+1288>>2],y[_+1292>>2],y[_+1296>>2],y[t+452>>2]),Y(y[t+620>>2],y[t+624>>2],n,y[_+1300>>2],y[_+1304>>2],y[_+1308>>2],y[t+456>>2])}L=32+e|0}(t),function(t){var e,r,i,n,o,h,l=0,d=0,f=0,p=0,_=w(0);if(L=e=L-16|0,d=y[t>>2],!(b[d+4|0]<5||(0|(p=y[t+628>>2]))<1))for(n=(f=y[t+632>>2])+E(p,12)|0,o=y[t+536>>2],p=y[d+1284>>2];;){if(r=(y[f>>2]<<2)+o|0,d=y[r>>2],1<=(0|(l=y[f+4>>2])))for(h=(t=y[f+8>>2])+E(l,48)|0;(l=y[t+8>>2])&&((i=l+-1|0)>>>0<=1?(l=y[t+4>>2],_=A[p+(l+y[t+12>>2]<<2)>>2],u(w(i-1?w(A[t+44>>2]*w(_*A[t+20>>2]))+(a(0,d),c()):w(A[t+44>>2]*w(w(_*A[t+20>>2])+w(A[p+(l+y[t+16>>2]<<2)>>2]*A[t+24>>2])))+(a(0,d),c()))),d=s[0]):(y[e>>2]=l,B(4,1024,e))),(t=t+48|0)>>>0<h>>>0;);if(a(0,d),_=c(),A[r>>2]=_<w(0)?w(0):w(P(_,w(1))),!((f=f+12|0)>>>0<n>>>0))break}L=16+e|0}(t),function(t){var e,r,i=0,s=0,n=0,o=w(0),a=0;if(1<=(0|(i=y[t+4>>2])))for(r=(s=y[t+8>>2])+E(i,12)|0,i=y[t+40>>2],n=y[t+52>>2],t=e=y[t+48>>2];y[i>>2]&&(o=A[n>>2],A[t>>2]=o,-1!=(0|(a=y[s+4>>2])))&&(A[t>>2]=o*A[(a<<2)+e>>2]),t=t+4|0,n=n+4|0,i=i+4|0,(s=s+12|0)>>>0<r>>>0;);}(t),function(t){var e,r=0,i=0,s=0;if(1<=(0|(e=y[t+304>>2])))for(r=y[t+308>>2],i=y[t+312>>2];y[i>>2]&&_[y[r+20>>2]](t,s),i=i+4|0,r=r+32|0,(0|e)!=(0|(s=s+1|0)););}(t),function(t){var e,r,i,s,n,o=0,a=0,h=(w(0),w(0),0),l=0,u=0,c=(w(0),0),d=0,f=0;if(1<=(0|(o=y[t+332>>2])))for(d=(a=y[t+336>>2])+E(o,20)|0,f=y[t+308>>2],c=y[t+316>>2],n=y[t+48>>2],o=y[t+448>>2],h=y[t+444>>2],u=y[t+424>>2];y[u>>2]&&(-1!=(0|(l=y[a+4>>2]))&&(A[o>>2]=A[(l<<2)+n>>2]*A[o>>2]),-1!=(0|(l=y[a+8>>2])))&&(A[o>>2]=A[c+(l<<2)>>2]*A[o>>2],s=y[h>>2],_[y[24+(f+(l<<5)|0)>>2]](t,l,s,s,y[a+16>>2])),h=h+4|0,o=o+4|0,u=u+4|0,(a=a+20|0)>>>0<d>>>0;);if(!(b[y[t>>2]+4|0]<4||(0|(o=y[t+332>>2]))<1))for(l=(h=y[t+336>>2])+E(o,20)|0,d=y[t+328>>2],f=y[t+324>>2],a=y[t+452>>2],o=y[t+456>>2],u=y[t+424>>2];y[u>>2]&&-1!=(0|(t=y[h+8>>2]))&&(t=(c=t<<4)+f|0,e=w(A[a>>2]*A[t>>2]),A[a>>2]=e,r=w(A[a+4>>2]*A[t+4>>2]),A[a+4>>2]=r,i=A[t+8>>2],y[a+12>>2]=1065353216,A[a+4>>2]=r<w(0)?w(0):w(P(r,w(1))),A[a>>2]=e<w(0)?w(0):w(P(e,w(1))),e=w(i*A[a+8>>2]),A[a+8>>2]=e<w(0)?w(0):w(P(e,w(1))),e=A[o>>2],r=A[(t=d+c|0)>>2],e=w(w(e+r)-w(e*r)),A[o>>2]=e,r=A[o+4>>2],i=A[t+4>>2],r=w(w(r+i)-w(r*i)),A[o+4>>2]=r,i=A[t+8>>2],y[o+12>>2]=1065353216,A[o+4>>2]=r<w(0)?w(0):w(P(r,w(1))),A[o>>2]=e<w(0)?w(0):w(P(e,w(1))),e=A[o+8>>2],e=w(w(i+e)-w(e*i)),A[o+8>>2]=e<w(0)?w(0):w(P(e,w(1)))),o=o+16|0,a=a+16|0,u=u+4|0,(h=h+20|0)>>>0<l>>>0;);}(t),function(t){var e,r,i,s,n,o,a,h,l,u,c,d,f,p,_,m,g,b,x,T,S=0;if(w(0),w(0),w(0),w(0),w(0),w(0),w(0),1<=(0|(h=y[t+500>>2])))for(x=y[t+536>>2],l=y[t+444>>2],T=y[t+504>>2];;){if(t=E(S,24)+T|0,0<(0|(u=y[t+12>>2])))for(i=A[(S<<2)+x>>2],c=y[t+20>>2],d=y[t+16>>2],f=y[(y[t+4>>2]<<2)+l>>2],p=y[(y[t+8>>2]<<2)+l>>2],t=0;_=A[((e=1|t)<<2)+d>>2],r=v[(t<<1)+c>>1]<<3&262136,s=A[(m=(4|r)+f|0)>>2],e=v[(e<<1)+c>>1]<<3&262136,n=A[(g=(4|e)+p|0)>>2],o=A[(r=r+f|0)>>2],b=A[(t<<2)+d>>2],a=A[(e=e+p|0)>>2],A[r>>2]=o+w(i*w(b*w(a-o))),A[m>>2]=s+w(i*w(b*w(n-s))),A[e>>2]=a+w(i*w(_*w(o-a))),A[g>>2]=n+w(i*w(_*w(s-n))),(0|(t=t+2|0))<(0|u););if(!((0|(S=S+1|0))<(0|h)))break}}(t),_[y[1810]](t),function(t){var e,r,i,s,n=0,o=0,a=0,h=0,l=0,u=0,c=0,d=0,f=0,p=0,_=0;if(!((0|(e=y[t+480>>2]))<1)){for(h=(r=y[t+484>>2])+E(e,28)|0,c=y[t+424>>2],d=y[t+40>>2],l=y[t+44>>2],_=y[t+440>>2],n=r;;){if(1<=(0|(u=y[n+4>>2])))for(p=n+20|0,f=y[n+12>>2],o=0;i=y[4+(a=f+(o<<4)|0)>>2]<<2,a=1==y[(s=a)>>2],y[s+12>>2]=y[(y[(a?d:c)+i>>2]?(a?l:_)+i:p)>>2],(0|(o=o+1|0))<(0|u););if(!((n=n+28|0)>>>0<h>>>0))break}if(!((0|e)<1))for(_=y[t+436>>2],d=0;;){if(h=E(d,28)+r|0,!(y[(c=h)+24>>2]<1)){for(a=y[t+488>>2],o=0;y[a+(o<<2)>>2]=-1,(0|(o=o+1|0))<(0|(n=y[c+24>>2])););if(!((0|n)<1))for(n=y[t+496>>2],o=0;y[n+(o<<2)>>2]=-1,(0|(o=o+1|0))<y[c+24>>2];);}if(!(y[h+4>>2]<1)){for(l=y[t+492>>2],o=0;y[l+(o<<2)>>2]=-1,(0|(o=o+1|0))<(0|(n=y[h+4>>2])););if(!((0|n)<1))for(u=y[h+12>>2],p=y[t+496>>2],o=0;f=y[12+(u+(o<<4)|0)>>2]-y[h+20>>2]<<2,n=-1==(0|(n=y[(a=f+p|0)>>2]))?f+y[t+488>>2]|0:l+(n<<2)|0,y[n>>2]=o,(0|(o=(y[a>>2]=o)+1|0))<y[h+4>>2];);}if(1<=(0|(n=y[c+24>>2])))for(l=y[h+8>>2],p=y[t+488>>2],u=0;;){if(-1!=(0|(o=y[p+(u<<2)>>2]))){for(f=y[t+492>>2],a=y[h+12>>2];l=(n=1==y[(n=a+(o<<4)|0)>>2]?(n=E(y[n+8>>2],28)+r|0,y[n+8>>2]=l,y[n>>2]):(y[_+(y[n+4>>2]<<2)>>2]=l,1))+l|0,(0|o)<(0|(n=y[f+(o<<2)>>2]))&&-1!=(0|(o=n)););n=y[c+24>>2]}if(!((0|(u=u+1|0))<(0|n)))break}if((0|e)==(0|(d=d+1|0)))break}}}(t),function(t){var e=0,r=0,i=0,s=0,n=0,o=w(0),a=0,h=0,l=y[t+332>>2];if(y[t+644>>2]){if(!(((y[t+428>>2]=0)|l)<1))for(;e=126,a=y[t+432>>2]+i|0,!y[(r=i<<2)+y[t+424>>2]>>2]|A[r+y[t+448>>2]>>2]==w(0)||(e=127),m[0|a]=e,(0|l)!=(0|(i=i+1|0)););}else if(y[t+428>>2]){if(e=b[y[t>>2]+4|0],!(((y[t+428>>2]=0)|l)<1))if(4<=e>>>0)for(;o=A[(e=i<<2)+y[t+448>>2]>>2],s=y[e+y[t+424>>2]>>2],r=o!=w(0)&!!(0|s),a=y[t+432>>2]+i|0,r=(0|r)==(1&m[0|a])?r:2|r,r=o!=A[e+y[t+468>>2]>>2]?4|r:r,r=y[e+y[t+440>>2]>>2]==y[e+y[t+464>>2]>>2]?r:8|r,e=y[e+y[t+436>>2]>>2]==y[e+y[t+460>>2]>>2]?r:16|r,e=s?32|e:e,s=(r=h<<2)+y[t+452>>2]|0,n=r+y[t+472>>2]|0,(A[s>>2]!=A[n>>2]|A[s+4>>2]!=A[n+4>>2]|A[s+8>>2]!=A[n+8>>2]|A[s+12>>2]!=A[n+12>>2]||(s=r+y[t+456>>2]|0,r=r+y[t+476>>2]|0,A[s>>2]!=A[r>>2]|A[s+4>>2]!=A[r+4>>2]|A[s+8>>2]!=A[r+8>>2])||A[s+12>>2]!=A[r+12>>2])&&(e|=64),m[0|a]=e,h=h+4|0,(0|l)!=(0|(i=i+1|0)););else for(;o=A[(e=i<<2)+y[t+448>>2]>>2],s=y[e+y[t+424>>2]>>2],r=o!=w(0)&!!(0|s),n=y[t+432>>2]+i|0,r=(0|r)==(1&m[0|n])?r:2|r,r=o!=A[e+y[t+468>>2]>>2]?4|r:r,r=y[e+y[t+440>>2]>>2]==y[e+y[t+464>>2]>>2]?r:8|r,e=y[e+y[t+436>>2]>>2]==y[e+y[t+460>>2]>>2]?r:16|r,m[0|n]=s?32|e:e,(0|l)!=(0|(i=i+1|0)););}else if(!((0|l)<1))for(;!y[(e=i<<2)+y[t+424>>2]>>2]|A[e+y[t+448>>2]>>2]==w(0)?(e=y[t+432>>2]+i|0,m[0|e]=254&b[0|e]):(e=y[t+432>>2]+i|0,m[0|e]=1|b[0|e]),(0|l)!=(0|(i=i+1|0)););}(t),y[t+644>>2]=0}function lt(t,e,r,i,s,n){var o,a,h,l,u,c,d,f=0,p=0,_=0,m=0;if(L=c=L-32|0,1<=(0|e))for(u=E(e,12)+r|0;;){if(!((0|(f=y[r+4>>2]))<1))if(o=(e=y[r+8>>2])+E(f,48)|0,f=y[r>>2]<<2,1<=(0|(d=y[f+n>>2])))for(d<<=1,a=y[y[t>>2]+1052>>2],h=y[s+f>>2];;){t:if(f=y[e+8>>2]){e:{if((p=f+-1|0)>>>0<=1){if(f=(y[e+4>>2]<<2)+i|0,m=(y[f+(y[e+12>>2]<<2)>>2]<<2)+a|0,p-1)break e;for(_=(y[f+(y[e+16>>2]<<2)>>2]<<2)+a|0,f=0;A[(l=(p=f<<2)+h|0)>>2]=A[l>>2]+w(A[e+44>>2]*w(w(A[p+m>>2]*A[e+20>>2])+w(A[p+_>>2]*A[e+24>>2]))),(0|d)!=(0|(f=f+1|0)););break t}y[c>>2]=f,B(4,1024,c);break t}for(f=0;A[(_=(p=f<<2)+h|0)>>2]=A[_>>2]+w(A[e+44>>2]*w(A[p+m>>2]*A[e+20>>2])),(0|d)!=(0|(f=f+1|0)););}if(!((e=e+48|0)>>>0<o>>>0))break}else for(;3<=(f=y[e+8>>2])>>>0&&(y[16+c>>2]=f,B(4,1024,16+c|0)),(e=e+48|0)>>>0<o>>>0;);if(!((r=r+12|0)>>>0<u>>>0))break}L=32+c|0}function ut(t,e,r){var i;e|=0,r|=0,L=i=L+-64|0;t:{if(t|=0)if(e)if((e+15&-16)!=(0|e))y[52+i>>2]=1522,y[48+i>>2]=2361,B(4,1294,48+i|0);else{if(e=function(t,e,r){var i,s=0,n=0,o=0,a=0,h=0,l=0,u=0,c=0,d=0,f=0,p=0,_=0,g=0,v=w(0),T=0,S=0,C=0,P=0,M=0;if(z(16+(L=i=L-576|0)|0,0,560),bt(t,16+i|0,12+i|0),(a=y[12+i>>2])>>>0<=r>>>0){if(s=(n=z(e,0,a))+y[16+i>>2]|0,y[s+8>>2]=n+y[20+i>>2],y[s+40>>2]=n+y[24+i>>2],y[s+44>>2]=n+y[28+i>>2],y[s+48>>2]=n+y[32+i>>2],y[s+52>>2]=n+y[36+i>>2],y[s+16>>2]=n+y[40+i>>2],y[s+24>>2]=n+y[44+i>>2],y[s+28>>2]=n+y[48+i>>2],y[s+32>>2]=n+y[52+i>>2],y[s+36>>2]=n+y[56+i>>2],e=y[t+704>>2],y[s+308>>2]=n+y[60+i>>2],y[s+312>>2]=n+y[64+i>>2],y[s+316>>2]=n+y[68+i>>2],y[s+320>>2]=n+y[72+i>>2],y[s+324>>2]=n+y[76+i>>2],y[s+328>>2]=n+y[80+i>>2],y[s+60>>2]=n+y[84+i>>2],y[s+144>>2]=n+y[88+i>>2],y[s+148>>2]=n+y[92+i>>2],r=n+y[96+i>>2]|0,y[s+152>>2]=r,!((0|(a=y[e+8>>2]))<1)&&(e=n+y[100+i>>2]|0,y[r>>2]=e,1!=(0|a)))for(r=1;e=(15+(y[y[t+796>>2]+(o<<2)>>2]<<3)&-16)+e|0,y[y[s+152>>2]+(r<<2)>>2]=e,(0|a)!=(0|(r=(o=r)+1|0)););if(y[s+156>>2]=n+y[104+i>>2],y[s+160>>2]=n+y[108+i>>2],y[s+68>>2]=n+y[112+i>>2],y[s+76>>2]=n+y[116+i>>2],y[s+80>>2]=n+y[120+i>>2],y[s+84>>2]=n+y[124+i>>2],y[s+88>>2]=n+y[128+i>>2],y[s+92>>2]=n+y[132+i>>2],y[s+96>>2]=n+y[136+i>>2],y[s+100>>2]=n+y[140+i>>2],y[s+104>>2]=n+y[144+i>>2],y[s+108>>2]=n+y[148+i>>2],y[s+112>>2]=n+y[152+i>>2],y[s+116>>2]=n+y[156+i>>2],y[s+120>>2]=n+y[160+i>>2],y[s+124>>2]=n+y[164+i>>2],y[s+128>>2]=n+y[168+i>>2],y[s+132>>2]=n+y[172+i>>2],y[s+136>>2]=n+y[176+i>>2],y[s+140>>2]=n+y[180+i>>2],y[s+168>>2]=n+y[184+i>>2],y[s+264>>2]=n+y[188+i>>2],y[s+268>>2]=n+y[192+i>>2],y[s+272>>2]=n+y[196+i>>2],y[s+276>>2]=n+y[200+i>>2],y[s+280>>2]=n+y[204+i>>2],y[s+284>>2]=n+y[208+i>>2],y[s+288>>2]=n+y[212+i>>2],y[s+292>>2]=n+y[216+i>>2],y[s+296>>2]=n+y[220+i>>2],y[s+300>>2]=n+y[224+i>>2],y[s+176>>2]=n+y[228+i>>2],y[s+184>>2]=n+y[232+i>>2],y[s+188>>2]=n+y[236+i>>2],y[s+192>>2]=n+y[240+i>>2],y[s+196>>2]=n+y[244+i>>2],y[s+200>>2]=n+y[248+i>>2],y[s+204>>2]=n+y[252+i>>2],y[s+208>>2]=n+y[256+i>>2],y[s+212>>2]=n+y[260+i>>2],y[s+216>>2]=n+y[264+i>>2],y[s+220>>2]=n+y[268+i>>2],y[s+224>>2]=n+y[272+i>>2],y[s+228>>2]=n+y[276+i>>2],y[s+232>>2]=n+y[280+i>>2],y[s+236>>2]=n+y[284+i>>2],y[s+240>>2]=n+y[288+i>>2],y[s+244>>2]=n+y[292+i>>2],y[s+248>>2]=n+y[296+i>>2],y[s+252>>2]=n+y[300+i>>2],y[s+256>>2]=n+y[304+i>>2],y[s+260>>2]=n+y[308+i>>2],e=y[t+704>>2],y[s+336>>2]=n+y[312+i>>2],y[s+424>>2]=n+y[316+i>>2],y[s+432>>2]=n+y[320+i>>2],y[s+436>>2]=n+y[324+i>>2],y[s+440>>2]=n+y[328+i>>2],r=n+y[332+i>>2]|0,y[s+444>>2]=r,!((0|(a=y[e+16>>2]))<1)&&(o=n+y[336+i>>2]|0,y[r>>2]=o,(r=1)!=(0|a)))for(e=0;o=(15+(y[y[t+892>>2]+(e<<2)>>2]<<3)&-16)+o|0,y[y[s+444>>2]+(r<<2)>>2]=o,(0|a)!=(0|(r=(e=r)+1|0)););if(y[s+448>>2]=n+y[340+i>>2],y[s+452>>2]=n+y[344+i>>2],y[s+456>>2]=n+y[348+i>>2],y[s+460>>2]=n+y[352+i>>2],y[s+464>>2]=n+y[356+i>>2],y[s+468>>2]=n+y[360+i>>2],y[s+472>>2]=n+y[364+i>>2],y[s+476>>2]=n+y[368+i>>2],y[s+344>>2]=n+y[372+i>>2],y[s+352>>2]=n+y[376+i>>2],y[s+356>>2]=n+y[380+i>>2],y[s+360>>2]=n+y[384+i>>2],y[s+364>>2]=n+y[388+i>>2],y[s+368>>2]=n+y[392+i>>2],y[s+372>>2]=n+y[396+i>>2],y[s+376>>2]=n+y[400+i>>2],y[s+380>>2]=n+y[404+i>>2],y[s+384>>2]=n+y[408+i>>2],y[s+388>>2]=n+y[412+i>>2],y[s+392>>2]=n+y[416+i>>2],y[s+396>>2]=n+y[420+i>>2],y[s+400>>2]=n+y[424+i>>2],y[s+404>>2]=n+y[428+i>>2],y[s+408>>2]=n+y[432+i>>2],y[s+412>>2]=n+y[436+i>>2],y[s+416>>2]=n+y[440+i>>2],y[s+420>>2]=n+y[444+i>>2],e=y[448+i>>2],r=y[452+i>>2],y[s+552>>2]=n+y[456+i>>2],y[s+548>>2]=r+n,y[s+544>>2]=e+n,y[s+560>>2]=n+y[460+i>>2],e=y[t+704>>2],u=n+y[464+i>>2]|0,y[s+568>>2]=u,1<=(0|(l=y[e+48>>2])))for(o=n+y[468+i>>2]|0,e=n+y[472+i>>2]|0,h=n+y[476+i>>2]|0,c=y[t+1072>>2],r=0;a=u+E(r,36)|0,y[a+20>>2]=h,y[a+16>>2]=e,y[a>>2]=o,o=((a=y[c+(r<<2)>>2])<<2)+o|0,h=(a=1<<a<<2)+h|0,e=e+a|0,(0|l)!=(0|(r=r+1|0)););if(e=y[t+704>>2],a=n+y[516+i>>2]|0,y[s+484>>2]=a,1<=(0|(e=y[e+72>>2])))for(o=n+y[520+i>>2]|0,h=y[t+1212>>2],r=0;y[12+(a+E(r,28)|0)>>2]=o,o=(y[h+(r<<2)>>2]<<4)+o|0,(0|e)!=(0|(r=r+1|0)););y[s+488>>2]=n+y[524+i>>2],y[s+492>>2]=n+y[528+i>>2],y[s+496>>2]=n+y[532+i>>2],y[s+504>>2]=n+y[536+i>>2],y[s+536>>2]=n+y[540+i>>2],y[s+512>>2]=n+y[544+i>>2],y[s+520>>2]=n+y[548+i>>2],y[s+524>>2]=n+y[552+i>>2],y[s+528>>2]=n+y[556+i>>2],y[s+532>>2]=n+y[560+i>>2];e:{if(4<=(l=b[t+4|0])>>>0){if(y[s+576>>2]=n+y[480+i>>2],y[s+584>>2]=n+y[484+i>>2],e=y[t+704>>2],r=y[492+i>>2],a=n+y[488+i>>2]|0,y[s+592>>2]=a,1<=(0|(e=y[e+104>>2])))for(o=r+n|0,h=y[t+1104>>2],r=0;y[40+(a+E(r,48)|0)>>2]=o,o=(y[h+(r<<2)>>2]<<2)+o|0,(0|e)!=(0|(r=r+1|0)););y[s+608>>2]=n+y[500+i>>2],y[s+624>>2]=n+y[508+i>>2]}else{if(e=y[572+i>>2],r=y[568+i>>2],y[s+636>>2]=n+y[564+i>>2],y[s+640>>2]=r+n,y[y[t+704>>2]+20>>2]<1)break e;for(a=e+n|0,u=0;;){r:{if((0|(o=y[(e=u<<2)+y[t+952>>2]>>2]))<=0)e=e+y[s+636>>2]|0;else{for(h=o+(r=y[e+y[t+948>>2]>>2])|0,c=y[t+1060>>2],o=0;o=y[c+(r<<2)>>2]+o|0,(0|(r=r+1|0))<(0|h););if(e=e+y[s+636>>2]|0,r=a,o)break r}r=o=0}if(y[e>>2]=r,a=(o<<2)+a|0,!((0|(u=u+1|0))<y[y[t+704>>2]+20>>2]))break}}l>>>0<5||(y[s+600>>2]=n+y[496+i>>2],y[s+616>>2]=n+y[504+i>>2],y[s+632>>2]=n+y[512+i>>2])}y[s+644>>2]=1,y[s>>2]=t,y[s+648>>2]=1&m[y[t+708>>2]+20|0],n=y[t+704>>2],u=y[n+20>>2];e:if(!((0|(y[s+540>>2]=u))<1)){if(e=u+-1|0,c=y[t+952>>2],d=y[t+940>>2],f=y[t+932>>2],p=y[t+936>>2],_=y[t+924>>2],g=y[t+928>>2],T=y[s+552>>2],C=y[s+544>>2],l>>>0<4)for(;;)if(r=C+E(e,52)|0,o=(a=e<<2)+g|(y[r>>2]=0),y[r+4>>2]=y[o>>2],y[r+8>>2]=y[(h=a+_|0)>>2],A[r+12>>2]=A[h>>2]-A[o>>2],y[r+16>>2]=y[a+p>>2],y[r+44>>2]=y[(o=a+f|0)>>2],v=pt(w(y[a+d>>2])),A[r+20>>2]=v,A[r+24>>2]=v*w(1.5),S=y[a+c>>2],h=0,h=(y[r+32>>2]=S)?y[s+560>>2]+E(y[a+y[t+948>>2]>>2],28)|0:h,y[r+48>>2]=1,y[r+28>>2]=h,y[a+T>>2]=y[o>>2],r=0<(0|e),e=e+-1|0,!r)break e;for(S=y[t+960>>2],M=y[t+944>>2];r=C+E(e,52)|0,y[r>>2]=y[(o=e<<2)+M>>2],y[r+4>>2]=y[(a=o+g|0)>>2],y[r+8>>2]=y[(h=o+_|0)>>2],A[r+12>>2]=A[h>>2]-A[a>>2],y[r+16>>2]=y[o+p>>2],y[r+44>>2]=y[(P=o+f|0)>>2],v=pt(w(y[o+d>>2])),A[r+20>>2]=v,A[r+24>>2]=v*w(1.5),h=y[o+c>>2],y[r+32>>2]=h,y[r+28>>2]=h?y[s+560>>2]+E(y[o+y[t+948>>2]>>2],28)|0:0,a=y[o+S>>2],a=(y[r+40>>2]=a)?y[s+584>>2]+E(y[o+y[t+956>>2]>>2],28)|0:0,y[r+48>>2]=1,y[r+36>>2]=a,y[o+T>>2]=y[P>>2],r=0<(0|e),e=e+-1|0,r;);}if(4<=l>>>0?(y[s+548>>2]=y[t+944>>2],a=t):(z(y[s+548>>2],0,u<<2),a=y[s>>2],n=y[a+704>>2]),o=y[n+52>>2],1<=(0|(y[s+556>>2]=o)))for(r=y[a+1056>>2],h=y[a+1192>>2],u=y[a+1060>>2],l=y[s+560>>2];e=l+E(o=o+-1|0,28)|0,y[e>>2]=y[(c=o<<2)+u>>2],c=y[r+c>>2],y[e+24>>2]=1,y[e+16>>2]=0,y[e+20>>2]=1,y[e+8>>2]=0,y[e+12>>2]=0,y[e+4>>2]=h+(c<<2),0<(0|o););if(o=y[n+48>>2],1<=(0|(y[s+564>>2]=o))){for(;;){if(e=y[s+568>>2]+E(o=o+-1|0,36)|0,h=y[(n=o<<2)+y[a+1072>>2]>>2],1<=(0|(y[e+4>>2]=h)))for(r=0;y[y[e>>2]+(r<<2)>>2]=y[s+560>>2]+E(y[y[a+1064>>2]+(y[n+y[a+1068>>2]>>2]+r<<2)>>2],28),(0|h)!=(0|(r=r+1|0)););if(y[e+24>>2]=1,y[e+28>>2]=1,y[e+8>>2]=1<<h,!(0<(0|o)))break}a=y[s>>2],n=y[a+704>>2]}if(e=y[n>>2],(0|(y[s+4>>2]=e))<1)r=0;else{for(c=y[a+732>>2],d=y[a+736>>2],f=y[a+740>>2],h=y[a+720>>2],p=y[s+52>>2],u=y[s+568>>2],_=y[s+8>>2],o=e;l=_+E(o=o+-1|0,12)|0,y[l>>2]=u+E(y[(r=o<<2)+h>>2],36),y[l+4>>2]=y[r+f>>2],y[l+8>>2]=y[r+d>>2],A[r+p>>2]=y[r+c>>2]?w(1):w(0),0<(0|o););for(l=y[s+16>>2],r=0;o=y[8+(u+E(y[(c=(e=e+-1|0)<<2)+h>>2],36)|0)>>2],r=r+(y[l+c>>2]=o)|0,0<(0|e););e=y[s+4>>2]}if(y[s+12>>2]=e,y[s+20>>2]=r,e=y[n+4>>2],1<=(0|(y[s+304>>2]=e))){for(;r=y[s+308>>2]+((e=e+-1|0)<<5)|0,y[r>>2]=y[s+568>>2]+E(y[(o=e<<2)+y[a+752>>2]>>2],36),y[r+4>>2]=y[o+y[a+764>>2]>>2],y[r+8>>2]=y[o+y[a+768>>2]>>2],h=y[o+y[a+772>>2]>>2],y[r+12>>2]=h,n=y[o+y[a+776>>2]>>2],y[r+16>>2]=n,y[r+28>>2]=y[o+y[a+760>>2]>>2],h>>>0<=1?h-1?(y[20+(y[s+60>>2]+E(n,24)|0)>>2]=e,y[r+24>>2]=1,y[r+20>>2]=2):(y[8+(y[s+168>>2]+E(n,12)|0)>>2]=e,y[r+24>>2]=3,y[r+20>>2]=4):B(4,1179,0),0<(0|e););a=y[s>>2],n=y[a+704>>2]}o=y[n+8>>2];e:if(!((0|(y[s+56>>2]=o))<1)){if(r=o+-1|0,u=y[a+796>>2],l=y[a+804>>2],c=y[a+800>>2],d=y[a+780>>2],f=y[s+568>>2],p=y[s+60>>2],b[a+4|0]<2)for(;;)if(e=p+E(r,24)|0,y[e>>2]=f+E(y[(h=r<<2)+d>>2],36),y[e+4>>2]=y[h+c>>2],y[e+8>>2]=y[h+l>>2],h=y[h+u>>2],y[e+12>>2]=0,y[e+16>>2]=h,e=0<(0|r),r=r+-1|0,!e)break e;for(_=y[a+808>>2];e=p+E(r,24)|0,y[e>>2]=f+E(y[(h=r<<2)+d>>2],36),y[e+4>>2]=y[h+c>>2],y[e+8>>2]=y[h+l>>2],y[e+16>>2]=y[h+u>>2],y[e+12>>2]=y[h+_>>2],e=0<(0|r),r=r+-1|0,e;);}if(r=y[n+12>>2],1<=(0|(y[s+164>>2]=r)))for(h=y[a+828>>2],u=y[a+812>>2],l=y[s+568>>2],c=y[s+168>>2],e=r;d=c+E(e=e+-1|0,12)|0,y[d>>2]=l+E(y[(f=e<<2)+u>>2],36),y[d+4>>2]=y[h+f>>2],0<(0|e););if(((e=0)|o)<1)h=0;else{for(u=y[s+68>>2],l=y[s+60>>2],h=0;r=y[y[l+E(o=o+-1|0,24)>>2]+8>>2],h=(y[u+(o<<2)>>2]=r)+h|0,0<(0|o););r=y[s+164>>2],o=y[s+56>>2]}if(y[s+64>>2]=o,y[s+72>>2]=h,o=s,1<=(0|r)){for(u=y[s+176>>2],l=y[s+168>>2];h=y[y[l+E(r=r+-1|0,12)>>2]+8>>2],e=e+(y[u+(r<<2)>>2]=h)|0,0<(0|r););r=y[s+164>>2]}if(y[o+172>>2]=r,y[s+180>>2]=e,h=y[n+16>>2],1<=(0|(y[s+332>>2]=h))){for(c=y[a+872>>2],d=y[a+892>>2],f=y[a+880>>2],p=y[a+876>>2],u=y[a+852>>2],l=y[s+568>>2],_=y[s+336>>2],e=h;r=_+E(e=e+-1|0,20)|0,y[r>>2]=l+E(y[(o=e<<2)+u>>2],36),y[r+4>>2]=y[o+p>>2],y[r+8>>2]=y[o+f>>2],y[r+16>>2]=y[o+d>>2],y[r+12>>2]=y[o+c>>2],0<(0|e););for(o=y[s+344>>2],r=0;e=y[8+(l+E(y[(c=(h=h+-1|0)<<2)+u>>2],36)|0)>>2],r=(y[o+c>>2]=e)+r|0,0<(0|h););if(y[s+348>>2]=r,h=y[s+332>>2],!((0|(y[s+340>>2]=h))<1))for(r=h<<2,o=y[s+456>>2],u=y[s+452>>2];y[(l=(e=r+-4|0)<<2)+u>>2]=1065353216,y[(c=(r<<=2)-4|0)+u>>2]=1065353216,y[(d=(r=r+-12|0)+u|0)>>2]=1065353216,y[d+4>>2]=1065353216,y[o+l>>2]=0,y[o+c>>2]=1065353216,y[(r=r+o|0)>>2]=0,y[r+4>>2]=0,r=e,0<(0|(h=h+-1|0)););}else y[s+340>>2]=h,y[s+348>>2]=0;if(h=y[n+72>>2],1<=(0|(y[s+480>>2]=h)))for(c=y[a+1208>>2],d=y[a+1224>>2],f=y[a+1220>>2],p=y[a+1216>>2],_=y[a+1212>>2],g=y[s+484>>2],o=0;;){if(e=g+E(o,28)|0,u=y[(r=o<<2)+_>>2],y[e+4>>2]=u,y[e>>2]=y[r+p>>2],l=y[r+f>>2],y[e+16>>2]=l,T=y[r+d>>2],y[e+20>>2]=T,y[e+8>>2]=0,y[e+24>>2]=1+(l-T|0),1<=(0|u))for(T=y[r+c>>2],C=y[e+12>>2],S=y[a+1236>>2],M=y[a+1228>>2],P=y[a+1232>>2],r=0;y[4+(e=C+(r<<4)|0)>>2]=y[(l=r+T<<2)+P>>2],y[e>>2]=y[l+M>>2],l=y[l+S>>2],y[e+12>>2]=0,y[e+8>>2]=l,(0|u)!=(0|(r=r+1|0)););if((0|h)==(0|(o=o+1|0)))break}if(r=y[n+80>>2],(0|(y[s+500>>2]=r))<1)o=0;else{for(l=y[a+1280>>2],c=y[a+1268>>2],d=y[a+1276>>2],f=y[a+1272>>2],p=y[a+1264>>2],_=y[a+1260>>2],h=y[a+1248>>2],u=y[s+568>>2],g=y[s+504>>2];e=g+E(r=r+-1|0,24)|0,y[e>>2]=u+E(y[(o=r<<2)+h>>2],36),y[e+4>>2]=y[o+_>>2],y[e+8>>2]=y[o+p>>2],y[e+12>>2]=y[o+f>>2],o=y[o+c>>2],y[e+20>>2]=l+(o<<1),y[e+16>>2]=d+(o<<2),0<(0|r););if((0|(r=y[s+500>>2]))<1)o=0;else{for(l=y[s+512>>2],o=0;e=y[8+(u+E(y[(c=(r=r+-1|0)<<2)+h>>2],36)|0)>>2],o=(y[l+c>>2]=e)+o|0,0<(0|r););r=y[s+500>>2]}}y[s+508>>2]=r,y[s+516>>2]=o;e:if(4<=b[t+4|0]){if(!((h=b[a+4|0])>>>0<4)){if(r=y[n+120>>2],1<=(0|(y[s+572>>2]=r))){for(l=y[a+1172>>2],c=y[s+576>>2];h=(0|(n=y[(e=(r=r+-1|0)<<2)+l>>2]))<0?n=u=o=0:(o=(h=y[e+y[a+1176>>2]>>2]<<2)+y[a+1188>>2]|0,u=y[e+y[a+1180>>2]>>2],n=y[s+544>>2]+E(n,52)|0,h+y[a+1184>>2]|0),e=c+E(r,20)|0,y[e+12>>2]=u,y[e+8>>2]=o,y[e+4>>2]=h,y[e>>2]=n,0<(0|r););if(a=y[s>>2],(h=b[a+4|0])>>>0<4)break e}if(n=y[a+704>>2],o=y[n+100>>2],1<=(0|(y[s+580>>2]=o)))for(u=y[a+1084>>2],l=y[a+1076>>2],c=y[a+1192>>2],d=y[a+1080>>2],f=y[s+584>>2];e=f+E(o=o+-1|0,28)|0,y[e>>2]=y[(r=o<<2)+d>>2],y[e+4>>2]=c+(y[r+l>>2]<<2),r=y[r+u>>2],y[e+20>>2]=1,y[e+24>>2]=1,y[e+12>>2]=0,y[e+16>>2]=0,y[e+8>>2]=r,0<(0|o););if(o=y[n+104>>2],1<=(0|(y[s+588>>2]=o))){for(;;){if(e=y[s+592>>2]+E(o=o+-1|0,48)|0,y[e>>2]=y[s+584>>2]+E(y[(h=o<<2)+y[a+1088>>2]>>2],28),r=y[h+y[a+1092>>2]>>2],y[e+28>>2]=1,y[e+32>>2]=1,y[e+8>>2]=0,y[e+4>>2]=r,n=y[h+y[a+1104>>2]>>2],1<=(0|(y[e+36>>2]=n)))for(r=0;y[y[e+40>>2]+(r<<2)>>2]=y[s+576>>2]+E(y[y[a+1168>>2]+(y[h+y[a+1100>>2]>>2]+r<<2)>>2],20),(0|n)!=(0|(r=r+1|0)););if(!(1<=(0|o)))break}a=y[s>>2],h=b[a+4|0]}if(!(h>>>0<4)){if(h=y[t+704>>2],r=y[h+108>>2],1<=(0|(y[s+604>>2]=r)))for(n=y[t+1124>>2],u=y[t+1128>>2],l=y[t+1120>>2],c=y[s+592>>2],d=y[s+608>>2];e=d+E(r=r+-1|0,12)|0,y[e>>2]=y[(o=r<<2)+l>>2],y[e+4>>2]=y[o+u>>2],y[e+8>>2]=c+E(y[n+o>>2],48),0<(0|r););if(r=y[h+112>>2],1<=(0|(y[s+620>>2]=r)))for(h=y[t+1148>>2],n=y[t+1152>>2],u=y[t+1144>>2],l=y[s+592>>2],c=y[s+624>>2];e=c+E(r=r+-1|0,12)|0,y[e>>2]=y[(o=r<<2)+u>>2],y[e+4>>2]=y[n+o>>2],y[e+8>>2]=l+E(y[o+h>>2],48),0<(0|r););if(o=y[a+1192>>2],e=y[y[a+704>>2]+20>>2],y[s+640>>2]=y[a+972>>2],h=y[a+964>>2],y[s+636>>2]=h,!((0|e)<(r=1))&&(y[h>>2]=o+(y[y[a+968>>2]>>2]<<2),1!=(0|e)))for(;y[(h=r<<2)+y[s+636>>2]>>2]=o+(y[h+y[a+968>>2]>>2]<<2),(0|e)!=(0|(r=r+1|0)););}}}else if(!(y[n+20>>2]<1))for(n=0;;){if(o=y[(u=n<<2)+y[s+636>>2]>>2],1<=((e=0)|(r=y[u+y[a+952>>2]>>2])))for(d=r+(l=y[u+y[a+948>>2]>>2])|0,f=y[a+1060>>2],p=y[a+1056>>2];;){if(1<=(0|(c=y[(r=l<<2)+f>>2])))for(_=c+(h=y[r+p>>2])|0,g=y[a+1192>>2];;){c=o+(e<<2)|0,v=A[g+(h<<2)>>2],r=o;r:{if(0<(0|e))for(;;){if(A[r>>2]==v)break r;if(!((r=r+4|0)>>>0<c>>>0))break}A[c>>2]=v,e=e+1|0}if(!((0|(h=h+1|0))<(0|_)))break}if(!((0|(l=l+1|0))<(0|d)))break}if(function(t,e){var r,i,s=0,n=0,o=0;y[8+(L=r=L-208|0)>>2]=1,y[12+r>>2]=0;r:if(i=e<<2){for(y[16+r>>2]=4,o=e=y[20+r>>2]=4,s=2;e=(o+4|0)+(n=e)|0,y[(16+r|0)+(s<<2)>>2]=e,s=s+1|0,o=n,e>>>0<i>>>0;);if((n=(t+i|0)-4|0)>>>0<=t>>>0)e=s=1;else for(e=s=1;e=3&~s?(x[(16+r|0)+((o=e+-1|0)<<2)>>2]>=n-t>>>0?K(t,8+r|0,e,0,16+r|0):at(t,e,16+r|0),1==(0|e)?(J(8+r|0,1),0):(J(8+r|0,o),1)):(at(t,e,16+r|0),tt(8+r|0,2),e+2|0),s=1|y[8+r>>2],y[8+r>>2]=s,(t=t+4|0)>>>0<n>>>0;);for(K(t,8+r|0,e,0,16+r|0);;){i:{s:{n:{if(!(1!=(0|e)|1!=(0|s))){if(y[12+r>>2])break n;break r}if(1<(0|e))break s}tt(8+r|0,n=Ct(8+r|0)),s=y[8+r>>2],e=e+n|0;break i}J(8+r|0,2),y[8+r>>2]=7^y[8+r>>2],tt(8+r|0,1),K((o=t+-4|0)-y[(16+r|0)+((n=e+-2|0)<<2)>>2]|0,8+r|0,e+-1|0,1,16+r|0),J(8+r|0,1),s=1|y[8+r>>2],y[8+r>>2]=s,K(o,8+r|0,n,1,16+r|0),e=n}t=t+-4|0}}L=208+r|0}(o,e),y[u+y[s+640>>2]>>2]=e,!((0|(n=n+1|0))<y[y[a+704>>2]+20>>2]))break}if(!(b[t+4|0]<5|b[y[s>>2]+4|0]<4)){if(e=y[t+704>>2],r=y[e+128>>2],1<=(0|(y[s+596>>2]=r)))for(h=y[t+1112>>2],n=y[t+1116>>2],u=y[t+1108>>2],l=y[s+592>>2],c=y[s+600>>2];a=c+E(r=r+-1|0,12)|0,y[a>>2]=y[(o=r<<2)+u>>2],y[a+4>>2]=y[n+o>>2],y[a+8>>2]=l+E(y[o+h>>2],48),0<(0|r););if(r=y[e+132>>2],1<=(0|(y[s+612>>2]=r)))for(h=y[t+1136>>2],n=y[t+1140>>2],u=y[t+1132>>2],l=y[s+592>>2],c=y[s+616>>2];a=c+E(r=r+-1|0,12)|0,y[a>>2]=y[(o=r<<2)+u>>2],y[a+4>>2]=y[n+o>>2],y[a+8>>2]=l+E(y[o+h>>2],48),0<(0|r););if(r=y[e+136>>2],!((0|(y[s+628>>2]=r))<1))for(a=y[t+1160>>2],o=y[t+1164>>2],h=y[t+1156>>2],n=y[s+592>>2],u=y[s+632>>2];t=u+E(r=r+-1|0,12)|0,y[t>>2]=y[(e=r<<2)+h>>2],y[t+4>>2]=y[e+o>>2],y[t+8>>2]=n+E(y[e+a>>2],48),0<(0|r););}ht(s)}return L=576+i|0,s}(t,e,r))break t;y[36+i>>2]=2209,y[32+i>>2]=2361,B(4,1294,32+i|0)}else y[20+i>>2]=1444,y[16+i>>2]=2361,B(4,1294,16+i|0);else y[4+i>>2]=2132,y[i>>2]=2361,B(4,1294,i);e=0}return L=64+i|0,0|e}function ct(t){var e;return L=e=L-16|0,t=(t|=0)?function(t){var e;return z(16+(L=e=L-576|0)|0,0,560),bt(t,16+e|0,12+e|0),L=576+e|0,y[12+e>>2]}(t):(y[4+e>>2]=2132,y[e>>2]=2343,B(4,1294,e),0),L=16+e|0,0|t}function dt(t){var e=b[t+4|0];k(y[t+704>>2],4,64),X(y[t+708>>2],4),X(y[t+708>>2]+4|0,4),X(y[t+708>>2]+8|0,4),X(y[t+708>>2]+12|0,4),X(y[t+708>>2]+16|0,4),X(y[t+708>>2]+20|0,1),k(y[t+720>>2],4,y[y[t+704>>2]>>2]),k(y[t+724>>2],4,y[y[t+704>>2]>>2]),k(y[t+728>>2],4,y[y[t+704>>2]>>2]),k(y[t+732>>2],4,y[y[t+704>>2]>>2]),k(y[t+736>>2],4,y[y[t+704>>2]>>2]),k(y[t+740>>2],4,y[y[t+704>>2]>>2]),k(y[t+752>>2],4,y[y[t+704>>2]+4>>2]),k(y[t+756>>2],4,y[y[t+704>>2]+4>>2]),k(y[t+760>>2],4,y[y[t+704>>2]+4>>2]),k(y[t+764>>2],4,y[y[t+704>>2]+4>>2]),k(y[t+768>>2],4,y[y[t+704>>2]+4>>2]),k(y[t+772>>2],4,y[y[t+704>>2]+4>>2]),k(y[t+776>>2],4,y[y[t+704>>2]+4>>2]),k(y[t+780>>2],4,y[y[t+704>>2]+8>>2]),k(y[t+784>>2],4,y[y[t+704>>2]+8>>2]),k(y[t+788>>2],4,y[y[t+704>>2]+8>>2]),k(y[t+796>>2],4,y[y[t+704>>2]+8>>2]),k(y[t+800>>2],4,y[y[t+704>>2]+8>>2]),k(y[t+804>>2],4,y[y[t+704>>2]+8>>2]),k(y[t+812>>2],4,y[y[t+704>>2]+12>>2]),k(y[t+816>>2],4,y[y[t+704>>2]+12>>2]),k(y[t+820>>2],4,y[y[t+704>>2]+12>>2]),k(y[t+828>>2],4,y[y[t+704>>2]+12>>2]),k(y[t+852>>2],4,y[y[t+704>>2]+16>>2]),k(y[t+856>>2],4,y[y[t+704>>2]+16>>2]),k(y[t+860>>2],4,y[y[t+704>>2]+16>>2]),k(y[t+868>>2],4,y[y[t+704>>2]+16>>2]),k(y[t+872>>2],4,y[y[t+704>>2]+16>>2]),k(y[t+876>>2],4,y[y[t+704>>2]+16>>2]),k(y[t+880>>2],4,y[y[t+704>>2]+16>>2]),k(y[t+884>>2],4,y[y[t+704>>2]+16>>2]),k(y[t+888>>2],1,y[y[t+704>>2]+16>>2]),k(y[t+892>>2],4,y[y[t+704>>2]+16>>2]),k(y[t+896>>2],4,y[y[t+704>>2]+16>>2]),k(y[t+900>>2],4,y[y[t+704>>2]+16>>2]),k(y[t+904>>2],4,y[y[t+704>>2]+16>>2]),k(y[t+908>>2],4,y[y[t+704>>2]+16>>2]),k(y[t+912>>2],4,y[y[t+704>>2]+16>>2]),k(y[t+924>>2],4,y[y[t+704>>2]+20>>2]),k(y[t+928>>2],4,y[y[t+704>>2]+20>>2]),k(y[t+932>>2],4,y[y[t+704>>2]+20>>2]),k(y[t+936>>2],4,y[y[t+704>>2]+20>>2]),k(y[t+940>>2],4,y[y[t+704>>2]+20>>2]),k(y[t+948>>2],4,y[y[t+704>>2]+20>>2]),k(y[t+952>>2],4,y[y[t+704>>2]+20>>2]),k(y[t+976>>2],4,y[y[t+704>>2]+24>>2]),k(y[t+980>>2],4,y[y[t+704>>2]+28>>2]),k(y[t+984>>2],4,y[y[t+704>>2]+28>>2]),k(y[t+996>>2],4,y[y[t+704>>2]+32>>2]),k(y[t+1e3>>2],4,y[y[t+704>>2]+32>>2]),k(y[t+1004>>2],4,y[y[t+704>>2]+32>>2]),k(y[t+1008>>2],4,y[y[t+704>>2]+32>>2]),k(y[t+1012>>2],4,y[y[t+704>>2]+32>>2]),k(y[t+1016>>2],4,y[y[t+704>>2]+32>>2]),k(y[t+1020>>2],4,y[y[t+704>>2]+32>>2]),k(y[t+1032>>2],4,y[y[t+704>>2]+36>>2]),k(y[t+1036>>2],4,y[y[t+704>>2]+36>>2]),k(y[t+1040>>2],4,y[y[t+704>>2]+36>>2]),k(y[t+1052>>2],4,y[y[t+704>>2]+40>>2]),k(y[t+1064>>2],4,y[y[t+704>>2]+44>>2]),k(y[t+1068>>2],4,y[y[t+704>>2]+48>>2]),k(y[t+1072>>2],4,y[y[t+704>>2]+48>>2]),k(y[t+1056>>2],4,y[y[t+704>>2]+52>>2]),k(y[t+1060>>2],4,y[y[t+704>>2]+52>>2]),k(y[t+1192>>2],4,y[y[t+704>>2]+56>>2]),k(y[t+1196>>2],4,y[y[t+704>>2]+60>>2]),k(y[t+1200>>2],2,y[y[t+704>>2]+64>>2]),k(y[t+1204>>2],4,y[y[t+704>>2]+68>>2]),k(y[t+1208>>2],4,y[y[t+704>>2]+72>>2]),k(y[t+1212>>2],4,y[y[t+704>>2]+72>>2]),k(y[t+1216>>2],4,y[y[t+704>>2]+72>>2]),k(y[t+1220>>2],4,y[y[t+704>>2]+72>>2]),k(y[t+1224>>2],4,y[y[t+704>>2]+72>>2]),k(y[t+1228>>2],4,y[y[t+704>>2]+76>>2]),k(y[t+1232>>2],4,y[y[t+704>>2]+76>>2]),k(y[t+1236>>2],4,y[y[t+704>>2]+76>>2]),k(y[t+1248>>2],4,y[y[t+704>>2]+80>>2]),k(y[t+1252>>2],4,y[y[t+704>>2]+80>>2]),k(y[t+1256>>2],4,y[y[t+704>>2]+80>>2]),k(y[t+1260>>2],4,y[y[t+704>>2]+80>>2]),k(y[t+1264>>2],4,y[y[t+704>>2]+80>>2]),k(y[t+1268>>2],4,y[y[t+704>>2]+80>>2]),k(y[t+1272>>2],4,y[y[t+704>>2]+80>>2]),k(y[t+1276>>2],4,y[y[t+704>>2]+84>>2]),k(y[t+1280>>2],2,y[y[t+704>>2]+84>>2]),k(y[t+1284>>2],4,y[y[t+704>>2]+88>>2]),e>>>0<2||(k(y[t+808>>2],4,y[y[t+704>>2]+8>>2]),e>>>0<4)||(k(y[t+968>>2],4,y[y[t+704>>2]+20>>2]),k(y[t+972>>2],4,y[y[t+704>>2]+20>>2]),k(y[t+792>>2],4,y[y[t+704>>2]+8>>2]),k(y[t+824>>2],4,y[y[t+704>>2]+12>>2]),k(y[t+864>>2],4,y[y[t+704>>2]+16>>2]),k(y[t+1288>>2],4,y[y[t+704>>2]+92>>2]),k(y[t+1292>>2],4,y[y[t+704>>2]+92>>2]),k(y[t+1296>>2],4,y[y[t+704>>2]+92>>2]),k(y[t+1300>>2],4,y[y[t+704>>2]+96>>2]),k(y[t+1304>>2],4,y[y[t+704>>2]+96>>2]),k(y[t+1308>>2],4,y[y[t+704>>2]+96>>2]),k(y[t+944>>2],4,y[y[t+704>>2]+20>>2]),k(y[t+956>>2],4,y[y[t+704>>2]+20>>2]),k(y[t+960>>2],4,y[y[t+704>>2]+20>>2]),k(y[t+1076>>2],4,y[y[t+704>>2]+100>>2]),k(y[t+1080>>2],4,y[y[t+704>>2]+100>>2]),k(y[t+1084>>2],4,y[y[t+704>>2]+100>>2]),k(y[t+1088>>2],4,y[y[t+704>>2]+104>>2]),k(y[t+1092>>2],4,y[y[t+704>>2]+104>>2]),k(y[t+1096>>2],4,y[y[t+704>>2]+104>>2]),k(y[t+1100>>2],4,y[y[t+704>>2]+104>>2]),k(y[t+1104>>2],4,y[y[t+704>>2]+104>>2]),k(y[t+1120>>2],4,y[y[t+704>>2]+108>>2]),k(y[t+1124>>2],4,y[y[t+704>>2]+108>>2]),k(y[t+1128>>2],4,y[y[t+704>>2]+108>>2]),k(y[t+1144>>2],4,y[y[t+704>>2]+112>>2]),k(y[t+1148>>2],4,y[y[t+704>>2]+112>>2]),k(y[t+1152>>2],4,y[y[t+704>>2]+112>>2]),k(y[t+1168>>2],4,y[y[t+704>>2]+116>>2]),k(y[t+1172>>2],4,y[y[t+704>>2]+120>>2]),k(y[t+1176>>2],4,y[y[t+704>>2]+120>>2]),k(y[t+1180>>2],4,y[y[t+704>>2]+120>>2]),k(y[t+1184>>2],4,y[y[t+704>>2]+124>>2]),k(y[t+1188>>2],4,y[y[t+704>>2]+124>>2]),4!=(0|e)&&(k(y[t+988>>2],4,y[y[t+704>>2]+28>>2]),k(y[t+992>>2],4,y[y[t+704>>2]+28>>2]),k(y[t+1024>>2],4,y[y[t+704>>2]+32>>2]),k(y[t+1028>>2],4,y[y[t+704>>2]+32>>2]),k(y[t+1044>>2],4,y[y[t+704>>2]+36>>2]),k(y[t+1048>>2],4,y[y[t+704>>2]+36>>2]),k(y[t+1108>>2],4,y[y[t+704>>2]+128>>2]),k(y[t+1112>>2],4,y[y[t+704>>2]+128>>2]),k(y[t+1116>>2],4,y[y[t+704>>2]+128>>2]),k(y[t+1132>>2],4,y[y[t+704>>2]+132>>2]),k(y[t+1136>>2],4,y[y[t+704>>2]+132>>2]),k(y[t+1140>>2],4,y[y[t+704>>2]+132>>2]),k(y[t+1156>>2],4,y[y[t+704>>2]+136>>2]),k(y[t+1160>>2],4,y[y[t+704>>2]+136>>2]),k(y[t+1164>>2],4,y[y[t+704>>2]+136>>2])))}function ft(t,e){var r=0,i=0,s=0,n=0,o=0,a=0,h=t+e|0;t:{e:if(!(1&(r=y[t+4>>2]))){if(!(3&r))break t;if(e=(r=y[t>>2])+e|0,(0|(t=t-r|0))!=y[2092])if(r>>>0<=255)s=r>>>3,r=y[t+8>>2],(0|(i=y[t+12>>2]))==(0|r)?(a=y[2087]&It(s),y[2087]=a):(y[r+12>>2]=i,y[i+8>>2]=r);else{if(o=y[t+24>>2],(0|(r=y[t+12>>2]))!=(0|t))i=y[t+8>>2],y[i+12>>2]=r,y[r+8>>2]=i;else if(s=(s=y[(i=t+20|0)>>2])||y[(i=t+16|0)>>2]){for(;n=i,(s=y[(i=(r=s)+20|0)>>2])||(i=r+16|0,s=y[r+16>>2]););y[n>>2]=0}else r=0;if(o){i=y[t+28>>2];r:{if(y[(s=8652+(i<<2)|0)>>2]==(0|t)){if(y[s>>2]=r)break r;a=y[2088]&It(i),y[2088]=a;break e}if(!(y[o+(y[o+16>>2]==(0|t)?16:20)>>2]=r))break e}y[r+24>>2]=o,(i=y[t+16>>2])&&(y[r+16>>2]=i,y[i+24>>2]=r),(i=y[t+20>>2])&&(y[r+20>>2]=i,y[i+24>>2]=r)}}else if(!(3&~(r=y[4+h>>2])))return y[2089]=e,y[4+h>>2]=-2&r,y[t+4>>2]=1|e,y[h>>2]=e}e:{if(!(2&(r=y[4+h>>2]))){if(y[2093]==(0|h)){if(y[2093]=t,e=y[2090]+e|0,y[2090]=e,y[t+4>>2]=1|e,y[2092]!=(0|t))break t;return y[2089]=0,y[2092]=0}if(y[2092]==(0|h))return y[2092]=t,e=y[2089]+e|0,y[2089]=e,y[t+4>>2]=1|e,y[t+e>>2]=e;e=(-8&r)+e|0;r:if(r>>>0<=255)s=r>>>3,r=y[8+h>>2],(0|(i=y[12+h>>2]))==(0|r)?(a=y[2087]&It(s),y[2087]=a):(y[r+12>>2]=i,y[i+8>>2]=r);else{if(o=y[24+h>>2],(0|h)!=(0|(r=y[12+h>>2])))i=y[8+h>>2],y[i+12>>2]=r,y[r+8>>2]=i;else if(s=(s=y[(i=20+h|0)>>2])||y[(i=16+h|0)>>2]){for(;n=i,(s=y[(i=(r=s)+20|0)>>2])||(i=r+16|0,s=y[r+16>>2]););y[n>>2]=0}else r=0;if(o){i=y[28+h>>2];i:{if(y[(s=8652+(i<<2)|0)>>2]==(0|h)){if(y[s>>2]=r)break i;a=y[2088]&It(i),y[2088]=a;break r}if(!(y[o+(y[o+16>>2]==(0|h)?16:20)>>2]=r))break r}y[r+24>>2]=o,(i=y[16+h>>2])&&(y[r+16>>2]=i,y[i+24>>2]=r),(i=y[20+h>>2])&&(y[r+20>>2]=i,y[i+24>>2]=r)}}if(y[t+4>>2]=1|e,y[t+e>>2]=e,y[2092]!=(0|t))break e;return y[2089]=e}y[4+h>>2]=-2&r,y[t+4>>2]=1|e,y[t+e>>2]=e}if(e>>>0<=255)return e=8388+((r=e>>>3)<<3)|0,r=(i=y[2087])&(r=1<<r)?y[e+8>>2]:(y[2087]=r|i,e),y[e+8>>2]=t,y[r+12>>2]=t,y[t+12>>2]=e,y[t+8>>2]=r;y[t+16>>2]=0,r=y[t+20>>2]=0,(s=e>>>8)&&(r=31,16777215<e>>>0||(r=28+((r=((h=(s<<=n=s+1048320>>>16&8)<<(r=s+520192>>>16&4))<<(s=245760+h>>>16&2)>>>15)-(s|r|n)|0)<<1|e>>>r+21&1)|0)),s=8652+((y[(i=t)+28>>2]=r)<<2)|0;e:{if((i=y[2088])&(n=1<<r)){for(i=e<<(31==(0|r)?0:25-(r>>>1)),r=y[s>>2];;){if((-8&y[(s=r)+4>>2])==(0|e))break e;if(r=i>>>29,i<<=1,!(r=y[16+(n=s+(4&r)|0)>>2]))break}y[n+16>>2]=t}else y[2088]=i|n,y[s>>2]=t;return y[t+24>>2]=s,y[t+12>>2]=t,y[t+8>>2]=t}e=y[s+8>>2],y[e+12>>2]=t,y[s+8>>2]=t,y[t+24>>2]=0,y[t+12>>2]=s,y[t+8>>2]=e}}function pt(t){var e,r,i,n,o,h,l,d,f=w(0),p=(w(0),0),_=0,m=(w(0),w(0),w(0),w(0),0);w(0),w(0);t:{e:{if(u(t),_=2147483647&(p=s[0])){if(!(_>>>0<2139095041))return w(w(.10000000149011612)+t);if(1065353216==(0|_))return w(-1<(0|p)?.10000000149011612:10);if(2139095040==(0|_))return w(-1<(0|p)?0:-t);if(1073741824==(0|p))return w(.010000000707805157);if(1056964608==(0|p))return w(.3162277638912201);if(1291845633<=_>>>0)return w((0|p)<0?$:0);if(e=A[1701],d=w(w(1.600000023841858)-e),r=w(w(1)/w(e+w(1.600000023841858))),a(0,-4096&(u(l=w(d*r)),s[0])),f=c(),i=w(f*f),o=A[1705],e=w(r*w(w(d-w((n=f)*w(3.099609375)))-w(f*w(w(1.600000023841858)-w(w(3.099609375)-e))))),r=w(w(l+f)*e),f=w(l*l),d=w(r+w(w(f*f)*w(w(f*w(w(f*w(w(f*w(w(f*w(w(f*w(.20697501301765442))+w(.23066075146198273)))+w(.2727281153202057)))+w(.3333333432674408)))+w(.4285714328289032)))+w(.6000000238418579)))),a(0,-4096&(u(w(w(i+w(3))+d)),s[0])),f=c(),r=w(n*f),l=w(w(e*f)+w(l*w(d-w(w(f+w(-3))-i)))),a(0,-4096&(u(w(r+l)),s[0])),f=c(),e=w(f*w(.9619140625)),i=w(A[1703]+w(w(w(l-w(f-r))*w(.9617967009544373))+w(f*w(-.00011736857413779944)))),a(0,-4096&(u(w(w(o+w(e+i))+w(-4))),s[0])),l=c(),a(0,-4096&p),d=c(),f=w(l*d),t=w(w(w(i-w(w(w(l-w(-4))-o)-e))*t)+w(w(t-d)*l)),u(l=w(f+t)),1124073473<=(0|(p=s[0])))break e;r:{if((_=1124073472)==(0|p)){if(w(t+w(4.299566569443414e-8))>w(l-f))break e}else{if(_=2147483647&p,!(t<=w(l-f)^1|-1021968384!=(0|p))|1125515265<=_>>>0)break t;if(_>>>0<1056964609)break r}m=(8388607&(_=(8388608>>>(_>>>23)-126)+p|0)|8388608)>>>150-(h=_>>>23&255),m=(0|p)<0?0-m|0:m,f=w(f-(a(0,_&-8388608>>h-127),c())),u(w(t+f)),p=s[0]}a(0,-32768&p),l=c(),e=w(l*w(.693145751953125)),l=w(w(l*w(14286065379565116e-22))+w(w(t-w(l-f))*w(.6931471824645996))),t=w(e+l),f=w(t*t),f=w(t-w(f*w(w(f*w(w(f*w(w(f*w(w(f*w(4.138136944220605e-8))+w(-16533901998627698e-22)))+w(661375597701408e-19)))+w(-.0027777778450399637)))+w(.1666666716337204)))),n=w(w(t*f)/w(f+w(-2))),f=w(l-w(t-e)),t=(0|(p=0|(u(t=w(w(t-w(n-w(f+w(t*f))))+w(1))),s[0]+(m<<23))))<=8388607?function(t,e){var r=0;return 128<=(0|e)?(t=w(t*w(17014118346046923e22)),e=(0|(r=e+-127|0))<128?r:(t=w(t*w(17014118346046923e22)),((0|e)<381?e:381)+-254|0)):-127<(0|e)||(t=w(t*w(11754943508222875e-54)),e=-127<(0|(r=e+126|0))?r:(t=w(t*w(11754943508222875e-54)),(-378<(0|e)?e:-378)+252|0)),w(t*(a(0,1065353216+(e<<23)|0),c()))}(t,m):(a(0,p),c()),t=w(w(1)*t)}else t=w(1);return t}return w($)}return w(0)}function _t(t,e){var r,i,n,o=0,a=0,h=w(0);if(u(e),!((n=2147483647&(i=s[0]))>>>0<=2139095040&&(u(t),(o=2147483647&(a=s[0]))>>>0<2139095041)))return w(t+e);if(1065353216==(0|i))return mt(t);i=(r=i>>>30&2)|a>>>31;t:{e:{r:{i:{if(!o){switch(i-2|0){case 0:break i;case 1:break;default:break r}return w(-3.1415927410125732)}if(2139095040!=(0|n)){if(!n|!(o>>>0<=218103808+n>>>0&&2139095040!=(0|o)))break t;if(t=h=o+218103808>>>0<n>>>0&&(h=w(0),r)?h:mt(w(S(w(t/e)))),i>>>0<=2){switch(i-1|0){case 0:return w(-t);case 1:break;default:break r}return w(w(3.1415927410125732)-w(t+w(8.742277657347586e-8)))}return w(w(t+w(8.742277657347586e-8))+w(-3.1415927410125732))}if(2139095040==(0|o))break e;return A[6784+(i<<2)>>2]}t=w(3.1415927410125732)}return t}return A[6768+(i<<2)>>2]}return w((0|a)<0?-1.5707963705062866:1.5707963705062866)}function mt(t){w(0);var e,r,i,n,o,a=0;w(0),w(0),u(t);t:{if(1283457024<=(n=2147483647&(o=s[0]))>>>0){if(2139095040<n>>>0)break t;return w((0|o)<0?-1.570796251296997:1.570796251296997)}e:{if(n>>>0<=1054867455){if(a=-1,964689920<=n>>>0)break e;break t}t=w(S(t)),a=n>>>0<=1066926079?n>>>0<=1060110335?(t=w(w(w(t+t)+w(-1))/w(t+w(2))),0):(t=w(w(t+w(-1))/w(t+w(1))),1):n>>>0<=1075576831?(t=w(w(t+w(-1.5))/w(w(t*w(1.5))+w(1))),2):(t=w(w(-1)/t),3)}if(n=a,r=w(t*t),e=w(r*r),i=w(e*w(w(e*w(-.106480173766613))+w(-.19999158382415771))),e=w(r*w(w(e*w(w(e*w(.06168760731816292))+w(.14253635704517365)))+w(.333333283662796))),(0|n)<=-1)return w(t-w(t*w(i+e)));t=w(A[6736+(n<<=2)>>2]-w(w(w(t*w(i+e))-A[6752+n>>2])-t)),t=(0|o)<0?w(-t):t}return t}function gt(t,e){var r,i,n,o=0,h=0;return L=i=L-16|0,u(t),(o=2147483647&(n=s[0]))>>>0<=1305022426?(T[e>>3]=(r=+t)+-1.5707963109016418*(h=.6366197723675814*r+6755399441055744-6755399441055744)+-1.5893254773528196e-8*h,o=S(h)<2147483648?~~h:-2147483648):2139095040<=o>>>0?(T[e>>3]=w(t-t),o=0):(r=o,T[8+i>>3]=(a(0,r-((o=(o>>>23)-150|0)<<23)|0),c()),o=function(t,e,r){var i,s,n,o,a,h,l=0,u=0,c=0,d=0,f=0,p=0,_=0,m=0,g=0,b=0,v=0;if(L=i=L-560|0,_=(u=r)+E(n=0<(0|(r=(r+-3|0)/24|0))?r:0,-24)|0,0<=(0|(s=y[972])))for(u=s+1|0,r=n;T[(320+i|0)+(c<<3)>>3]=(0|r)<0?0:+y[3904+(r<<2)>>2],r=r+1|0,(0|u)!=(0|(c=c+1|0)););for(f=_+-24|0,u=0;;){for(l=r=0;l+=T[(r<<3)+t>>3]*T[(320+i|0)+(u-r<<3)>>3],1!=(0|(r=r+1|0)););if(T[(u<<3)+i>>3]=l,r=(0|u)<(0|s),u=u+1|0,!r)break}h=23-f|0,o=24-f|0,u=s;t:{for(;;){if(l=T[(u<<3)+i>>3],!(g=((r=0)|(c=u))<1))for(;p=(480+i|0)+(r<<2)|0,m=l,d=S(l*=5.960464477539063e-8)<2147483648?~~l:-2147483648,d=S(m+=-16777216*(l=0|d))<2147483648?~~m:-2147483648,y[p>>2]=d,l=T[((c=c+-1|0)<<3)+i>>3]+l,(0|u)!=(0|(r=r+1|0)););l=Q(l,f),l=(l+=-8*M(.125*l))-(0|(p=S(l)<2147483648?~~l:-2147483648));e:{r:{i:{if(v=(0|f)<1){if(f)break i;d=y[476+((u<<2)+i|0)>>2]>>23}else d=y[476+(c=(u<<2)+i|0)>>2],b=c,c=d-((r=d>>o)<<o)|0,p=r+p|0,d=(y[b+476>>2]=c)>>h;if((0|d)<1)break e;break r}if(d=2,!(.5<=l)){d=0;break e}}if(c=r=0,!g)for(;;){g=y[(a=(480+i|0)+(r<<2)|0)>>2],b=16777215;r:{i:{if(!c){if(!g)break i;b=16777216,c=1}y[a>>2]=b-g;break r}c=0}if((0|u)==(0|(r=r+1|0)))break}v||1<(r=f+-1|0)>>>0||(y[476+(r=(u<<2)+i|0)>>2]=r-1?8388607&y[r+476>>2]:4194303&y[r+476>>2]),p=p+1|0,2==(0|d)&&(l=1-l,d=2,c)&&(l-=Q(1,f))}if(0!=l)break;if(!(((c=0)|(r=u))<=(0|s))){for(;c=y[(480+i|0)+((r=r+-1|0)<<2)>>2]|c,(0|s)<(0|r););if(c){for(_=f;_=_+-24|0,!y[(480+i|0)+((u=u+-1|0)<<2)>>2];);break t}}for(r=1;r=(c=r)+1|0,!y[(480+i|0)+(s-c<<2)>>2];);for(c=u+c|0;;){for(u=p=u+1|0,T[(320+i|0)+(p<<3)>>3]=y[3904+(n+u<<2)>>2],l=r=0;l+=T[(r<<3)+t>>3]*T[(320+i|0)+(p-r<<3)>>3],1!=(0|(r=r+1|0)););if(T[(u<<3)+i>>3]=l,!((0|u)<(0|c)))break}u=c}16777216<=(l=Q(l,0-f|0))?(t=(480+i|0)+(u<<2)|0,m=l,r=S(l*=5.960464477539063e-8)<2147483648?~~l:-2147483648,c=S(l=m+-16777216*(0|r))<2147483648?~~l:-2147483648,y[t>>2]=c,u=u+1|0):(r=S(l)<2147483648?~~l:-2147483648,_=f),y[(480+i|0)+(u<<2)>>2]=r}if(l=Q(1,_),!((0|u)<=-1)){for(r=u;T[(r<<3)+i>>3]=l*+y[(480+i|0)+(r<<2)>>2],l*=5.960464477539063e-8,t=0<(0|r),r=r+-1|0,t;);if(!((0|u)<=-1))for(r=u;;){for(f=u-(t=r)|0,r=l=0;l+=T[6672+(r<<3)>>3]*T[(t+r<<3)+i>>3],!((0|s)<=(0|r))&&(_=r>>>0<f>>>0,r=r+1|0,_););if(T[(160+i|0)+(f<<3)>>3]=l,r=t+-1|0,!(0<(0|t)))break}}if(0<=(u|(l=0)))for(;l+=T[(160+i|0)+(u<<3)>>3],t=0<(0|u),u=u+-1|0,t;);return T[e>>3]=d?-l:l,L=560+i|0,7&p}(8+i|0,i,o),h=T[i>>3],(0|n)<=-1?(T[e>>3]=-h,o=0-o|0):T[e>>3]=h),L=16+i|0,o}function yt(t,e){return t?function(t,e){t:{if(t){if(e>>>0<=127)break t;if(y[y[1789]>>2]){if(e>>>0<=2047)return m[t+1|0]=63&e|128,m[0|t]=e>>>6|192,2;if(!(57344!=(-8192&e)&&55296<=e>>>0))return m[t+2|0]=63&e|128,m[0|t]=e>>>12|224,m[t+1|0]=e>>>6&63|128,3;if(e+-65536>>>0<=1048575)return m[t+3|0]=63&e|128,m[0|t]=e>>>18|240,m[t+2|0]=e>>>6&63|128,m[t+1|0]=e>>>12&63|128,4}else if(57216==(-128&e))break t;y[2086]=25,t=-1}else t=1;return t}return m[0|t]=e,1}(t,e):0}function bt(t,e,r){var i,s,n=0,o=0,a=0,h=0,l=0,u=0,c=0,d=0,f=0,p=b[t+4|0];if(y[e>>2]=652,o=y[t+704>>2],1<=(0|(h=y[o>>2]))){for(l=y[t+720>>2],c=y[t+1072>>2];a=(1<<y[c+(y[l+(n<<2)>>2]<<2)>>2])+a|0,(0|h)!=(0|(n=n+1|0)););n=a<<2}if(y[e+4>>2]=E(h,12),y[e+8>>2]=y[o>>2]<<2,y[e+12>>2]=y[o>>2]<<2,y[e+16>>2]=y[o>>2]<<2,y[e+20>>2]=y[o>>2]<<2,a=y[o>>2],y[e+28>>2]=n,y[e+24>>2]=a<<2,a=y[o>>2],y[e+40>>2]=n,y[e+36>>2]=n,y[e+32>>2]=a<<2,y[e+44>>2]=y[o+4>>2]<<5,y[e+48>>2]=y[o+4>>2]<<2,y[e+52>>2]=y[o+4>>2]<<2,y[e+56>>2]=y[o+4>>2]<<2,y[e+60>>2]=y[o+4>>2]<<4,y[e+64>>2]=y[o+4>>2]<<4,1<=((n=0)|(h=y[o+8>>2]))){for(l=y[t+780>>2],c=y[t+1072>>2],f=y[t+796>>2],a=0;u=(15+(y[(d=n<<2)+f>>2]<<3)&-16)+u|0,a=(1<<y[c+(y[l+d>>2]<<2)>>2])+a|0,(0|h)!=(0|(n=n+1|0)););n=a<<2}if(y[e+68>>2]=E(h,24),y[e+72>>2]=y[o+8>>2]<<2,y[e+76>>2]=y[o+8>>2]<<2,a=y[o+8>>2],y[e+84>>2]=u,y[e+80>>2]=a<<2,y[e+88>>2]=y[o+8>>2]<<4,y[e+92>>2]=y[o+8>>2]<<4,a=y[o+8>>2],y[e+100>>2]=n,y[e+96>>2]=a<<2,a=y[o+8>>2],y[e+140>>2]=n,y[e+136>>2]=n,y[e+132>>2]=n,y[e+128>>2]=n,y[e+124>>2]=n,y[e+120>>2]=n,y[e+116>>2]=n,y[e+112>>2]=n,y[e+108>>2]=n,y[e+104>>2]=a<<2,y[e+144>>2]=y[o+8>>2]<<2,y[e+148>>2]=y[o+8>>2]<<2,y[e+152>>2]=y[o+8>>2]<<2,y[e+156>>2]=y[o+8>>2]<<2,y[e+160>>2]=y[o+8>>2]<<2,y[e+164>>2]=y[o+8>>2]<<2,1<=((n=u=0)|(h=y[o+12>>2]))){for(l=y[t+812>>2],c=y[t+1072>>2],a=0;a=(1<<y[c+(y[l+(n<<2)>>2]<<2)>>2])+a|0,(0|h)!=(0|(n=n+1|0)););n=a<<2}if(y[e+168>>2]=E(h,12),y[e+172>>2]=y[o+12>>2]<<2,y[e+176>>2]=y[o+12>>2]<<2,y[e+180>>2]=y[o+12>>2]<<2,y[e+184>>2]=y[o+12>>2]<<2,y[e+188>>2]=y[o+12>>2]<<2,y[e+192>>2]=y[o+12>>2]<<2,y[e+196>>2]=y[o+12>>2]<<2,y[e+200>>2]=y[o+12>>2]<<2,y[e+204>>2]=y[o+12>>2]<<4,y[e+208>>2]=y[o+12>>2]<<4,a=y[o+12>>2],y[e+216>>2]=n,y[e+212>>2]=a<<2,a=y[o+12>>2],y[e+268>>2]=n,y[e+264>>2]=n,y[e+260>>2]=n,y[e+256>>2]=n,y[e+252>>2]=n,y[e+248>>2]=n,y[e+244>>2]=n,y[e+240>>2]=n,y[e+236>>2]=n,y[e+232>>2]=n,y[e+228>>2]=n,y[e+224>>2]=n,y[e+220>>2]=a<<2,y[e+272>>2]=y[o+12>>2]<<2,y[e+276>>2]=y[o+12>>2]<<2,y[e+280>>2]=y[o+12>>2]<<2,y[e+284>>2]=y[o+12>>2]<<2,y[e+288>>2]=y[o+12>>2]<<2,y[e+292>>2]=y[o+12>>2]<<2,1<=((n=0)|(a=y[o+16>>2]))){for(l=y[t+852>>2],c=y[t+1072>>2],f=y[t+892>>2],h=0;u=(15+(y[(d=n<<2)+f>>2]<<3)&-16)+u|0,h=(1<<y[c+(y[l+d>>2]<<2)>>2])+h|0,(0|a)!=(0|(n=n+1|0)););n=h<<2}if(y[e+296>>2]=E(a,20),y[e+300>>2]=y[o+16>>2]<<2,y[e+304>>2]=y[o+16>>2],y[e+308>>2]=y[o+16>>2]<<2,y[e+312>>2]=y[o+16>>2]<<2,a=y[o+16>>2],y[e+320>>2]=u,y[e+316>>2]=a<<2,y[e+324>>2]=y[o+16>>2]<<2,y[e+328>>2]=y[o+16>>2]<<4,y[e+332>>2]=y[o+16>>2]<<4,y[e+336>>2]=y[o+16>>2]<<2,y[e+340>>2]=y[o+16>>2]<<2,y[e+344>>2]=y[o+16>>2]<<2,y[e+348>>2]=y[o+16>>2]<<4,y[e+352>>2]=y[o+16>>2]<<4,a=y[o+16>>2],y[e+360>>2]=n,y[e+356>>2]=a<<2,a=y[o+16>>2],y[e+404>>2]=n,y[e+400>>2]=n,y[e+396>>2]=n,y[e+392>>2]=n,y[e+388>>2]=n,y[e+384>>2]=n,y[e+380>>2]=n,y[e+376>>2]=n,y[e+372>>2]=n,y[e+368>>2]=n,y[e+364>>2]=a<<2,y[e+408>>2]=y[o+16>>2]<<2,y[e+412>>2]=y[o+16>>2]<<2,y[e+416>>2]=y[o+16>>2]<<2,y[e+420>>2]=y[o+16>>2]<<2,y[e+424>>2]=y[o+16>>2]<<2,y[e+428>>2]=y[o+16>>2]<<2,l=y[t+704>>2],y[e+432>>2]=E(y[l+20>>2],52),y[e+436>>2]=p>>>(n=h=0)<=3?y[l+20>>2]<<2:0,y[e+440>>2]=y[l+20>>2]<<2,y[e+444>>2]=E(y[l+52>>2],28),1<=(0|(o=y[l+48>>2]))){for(a=y[t+1072>>2],u=0;u=(c=y[a+(n<<2)>>2])+u|0,h=(1<<c)+h|0,(0|o)!=(0|(n=n+1|0)););n=h<<2,h=u<<2}if(y[e+460>>2]=n,y[e+456>>2]=n,y[e+452>>2]=h,y[e+448>>2]=E(o,36),y[e+500>>2]=E(y[l+72>>2],28),1<=((u=n=a=0)|(c=y[l+72>>2]))){for(f=y[t+1224>>2],d=y[t+1220>>2],s=y[t+1212>>2],h=0;h=(0|(i=y[(o=u<<2)+d>>2]-y[o+f>>2]|0))<(0|h)?h:1+i|0,n=(0|n)<(0|(o=y[o+s>>2]))?o:n,(0|c)!=(0|(u=u+1|0)););u=n<<2,n=h<<2}if(o=y[l+76>>2],y[e+516>>2]=n,y[e+512>>2]=u,y[e+508>>2]=n,y[e+504>>2]=o<<4,1<=(0|(o=y[l+80>>2]))){for(a=y[t+1248>>2],u=y[t+1072>>2],h=n=0;h=(1<<y[u+(y[a+(n<<2)>>2]<<2)>>2])+h|0,(0|o)!=(0|(n=n+1|0)););a=h<<2}if(y[e+520>>2]=E(o,24),y[e+524>>2]=y[l+80>>2]<<2,o=y[l+80>>2],y[e+532>>2]=a,y[e+528>>2]=o<<2,o=y[l+80>>2],y[e+544>>2]=a,y[e+540>>2]=a,y[e+536>>2]=o<<2,o=e,4<=p>>>0){if(y[e+464>>2]=E(y[l+120>>2],20),y[e+468>>2]=E(y[l+100>>2],28),a=e,1<=((n=u=0)|(c=y[l+104>>2]))){for(t=y[t+1104>>2],h=0;h=y[t+(n<<2)>>2]+h|0,(0|c)!=(0|(n=n+1|0)););t=h<<2}else t=0;y[a+476>>2]=t,y[e+472>>2]=E(c,48),y[e+484>>2]=E(y[l+108>>2],12),t=y[l+112>>2],y[e+552>>2]=0,y[e+492>>2]=E(t,12),t=0}else{if((0|(u=y[l+20>>2]))<1)h=0;else for(c=y[t+1060>>2],f=y[t+952>>2],t=y[t+948>>2],a=h=0;;){if(1<=(0|(d=y[(n=a<<2)+f>>2])))for(d=(n=c+(y[t+n>>2]<<2)|0)+(d<<2)|0;h=y[n>>2]+h|0,(n=n+4|0)>>>0<d>>>0;);if((0|u)==(0|(a=a+1|0)))break}y[e+552>>2]=u<<2,u=y[l+20>>2]<<2,t=h<<2}for(y[o+556>>2]=t,y[e+548>>2]=u,4<p>>>0&&(y[e+480>>2]=E(y[l+128>>2],12),y[e+488>>2]=E(y[l+132>>2],12),y[e+496>>2]=E(y[l+136>>2],12)),n=h=0;n=((o=y[(t=(h<<2)+e|0)>>2])+15&-16)+(y[t>>2]=n)|0,140!=(0|(h=h+1|0)););y[r>>2]=n}function vt(t,e,r,i){t:{if(!(20<e>>>0||9<(e=e+-9|0)>>>0)){switch(e-1|0){default:return e=y[r>>2],y[r>>2]=e+4,y[t>>2]=y[e>>2];case 0:return e=y[r>>2],y[r>>2]=e+4,e=y[e>>2],y[t>>2]=e,y[t+4>>2]=e>>31;case 1:return e=y[r>>2],y[r>>2]=e+4,y[t>>2]=y[e>>2],y[t+4>>2]=0;case 3:return e=y[r>>2],y[r>>2]=e+4,e=g[e>>1],y[t>>2]=e,y[t+4>>2]=e>>31;case 4:return e=y[r>>2],y[r>>2]=e+4,y[t>>2]=v[e>>1],y[t+4>>2]=0;case 5:return e=y[r>>2],y[r>>2]=e+4,e=m[0|e],y[t>>2]=e,y[t+4>>2]=e>>31;case 6:return e=y[r>>2],y[r>>2]=e+4,y[t>>2]=b[0|e],y[t+4>>2]=0;case 2:case 7:break t;case 8:}_[i](t,r)}return}e=y[r>>2]+7&-8,y[r>>2]=e+8,r=y[e+4>>2],y[t>>2]=y[e>>2],y[t+4>>2]=r}function xt(t){var e,r,i=0;if(q(m[y[t>>2]]))for(;e=y[t>>2],r=m[0|e],y[t>>2]=e+1,i=(E(i,10)+r|0)-48|0,q(m[e+1|0]););return i}function At(t,e,r,i,s){var n,o;y[204+(L=o=L-208|0)>>2]=r,z(160+o|(r=0),0,40),y[200+o>>2]=y[204+o>>2],(0|nt(0,e,200+o|0,80+o|0,160+o|0,i,s))<0||(r=0<=y[t+76>>2]?1:r,r=y[t>>2],m[t+74|0]<=0&&(y[t>>2]=-33&r),n=32&r,y[t+48>>2]?nt(t,e,200+o|0,80+o|0,160+o|0,i,s):(y[t+48>>2]=80,y[t+16>>2]=80+o,y[t+28>>2]=o,y[t+20>>2]=o,r=y[t+44>>2],nt(t,e,200+(y[t+44>>2]=o)|0,80+o|0,160+o|0,i,s),r&&(_[y[t+36>>2]](t,0,0),y[t+48>>2]=0,y[t+44>>2]=r,y[t+28>>2]=0,y[t+16>>2]=0,y[t+20>>2]=0)),y[t>>2]=y[t>>2]|n),L=208+o|0}function Tt(t,e,r){var i,s;G(8+(L=s=L-160|0)|0,3192,144),y[52+s>>2]=t,y[28+s>>2]=t,y[56+s>>2]=i=(i=-2-t|0)>>>0<256?i:256,y[36+s>>2]=t=t+i|0,y[24+s>>2]=t,At(8+s|0,e,r,11,12),i&&(t=y[28+s>>2],m[t-((0|t)==y[24+s>>2])|0]=0),L=160+s|0}function Et(t,e){var r,i,s=0;s=!!(0|e);t:{e:{r:{i:if(!(!e|!(3&t)))for(;;){if(!b[0|t])break r;if(t=t+1|0,s=!!(0|(e=e+-1|0)),!e)break i;if(!(3&t))break}if(!s)break e}if(!b[0|t])break t;r:{if(4<=e>>>0){for(s=(s=e+-4|0)-(r=-4&s)|0,r=4+(t+r|0)|0;;){if(~(i=y[t>>2])&i+-16843009&-2139062144)break r;if(t=t+4|0,!(3<(e=e+-4|0)>>>0))break}e=s,t=r}if(!e)break e}for(;;){if(!b[0|t])break t;if(t=t+1|0,!(e=e+-1|0))break}}return 0}return t}function wt(t){var e,r=0;if(!t)return 32;if(!(1&t))for(;r=r+1|0,e=2&t,t>>>=1,!e;);return r}function St(t,e){var r,i,s,n,o=0,a=0;a=4;L=n=L-256|0;t:if(!((0|e)<2))for(o=y[(s=(e<<2)+t|0)>>2]=n;;){for(G(o,y[t>>2],r=a>>>0<256?a:256),o=0;G(y[(i=(o<<2)+t|0)>>2],y[((o=o+1|0)<<2)+t>>2],r),y[i>>2]=y[i>>2]+r,(0|e)!=(0|o););if(!(a=a-r|0))break t;o=y[s>>2]}L=256+n|0}function Ct(t){return wt(y[t>>2]+-1|0)||((t=wt(y[t+4>>2]))?t+32|0:0)}function Pt(t,e){e|=0,s[0]=t|=0,s[1]=e}function Mt(t,e,r){return function(t,e,r){var i,s,n,o,a=E(s=r>>>16,n=t>>>16);return t=(65535&(n=((i=E(o=65535&r,t&=65535))>>>16)+E(n,o)|0))+E(t,s)|0,F=((a+E(e,r)|0)+(n>>>16)|0)+(t>>>16)|0,65535&i|t<<16}(t,e,r)}function $t(t,e,r){return function(t,e,r){var i,s,n=0,o=0,a=0,h=0,l=0,u=0,c=0;t:{e:{r:{i:{s:{if(!(o=e))return Pt((e=t)-E(t=(t>>>0)/(r>>>0)|0,r)|0,0),F=0,t;if(n=r){if(!((h=n+-1|0)&n))break s;l=0-(h=(C(n)+33|0)-C(o)|0)|0;break r}if(!t)return Pt(0,o-E(t=(o>>>0)/0|0,0)|0),F=0,t;if((n=32-C(o)|0)>>>0<31)break i;break e}if(Pt(t&h,0),1==(0|n))break t;return r=31&(n=n?31-C(n+-1^n)|0:32),t=32<=(63&n)>>>0?(o=0,e>>>r):(o=e>>>r,((1<<r)-1&e)<<32-r|t>>>r),F=o,t}h=n+1|0,l=63-n|0}if(n=e,a=31&(o=63&h),a=32<=o>>>0?(o=0,n>>>a):(o=n>>>a,((1<<a)-1&n)<<32-a|t>>>a),n=31&(l&=63),32<=l>>>0?(e=t<<n,t=0):(e=(1<<n)-1&t>>>32-n|e<<n,t<<=n),h)for((l=r+(n=-1)|0)>>>0<4294967295&&(n=0);a=(s=u=a<<1|e>>>31)-(i=r&(u=n-((o=o<<1|a>>>31)+(l>>>0<u>>>0)|0)>>31))|0,o=o-(s>>>0<i>>>0)|0,e=e<<1|t>>>31,t=c|t<<1,c=u&=1,h=h+-1|0;);return Pt(a,o),F=e<<1|t>>>31,u|t<<1}Pt(t,e),e=t=0}return F=e,t}(t,e,r)}function It(t){var e;return(-1>>>(e=31&t)&-2)<<e|(-1<<(t=0-t&31)&-2)>>>t}function Rt(){return f.byteLength/65536|0}}(K,b,v)}}s=null,r.wasmBinary&&(y=r.wasmBinary);var g={},y=[];"object"!=typeof g&&_("no native wasm support detected");var b,v=new function(){var t=Array(16);return t.grow=function(){17<=t.length&&V("Unable to grow wasm table. Use a higher value for RESERVED_FUNCTION_POINTERS or set ALLOW_TABLE_GROWTH."),t.push(null)},t.set=function(e,r){t[e]=r},t.get=function(e){return t[e]},t},x=!1;function A(t,e){t||V("Assertion failed: "+e)}var T,E,w,S,C="undefined"!=typeof TextDecoder?new TextDecoder("utf8"):void 0;function P(t,e,r){var i=e+r;for(r=e;t[r]&&!(i<=r);)++r;if(16<r-e&&t.subarray&&C)return C.decode(t.subarray(e,r));for(i="";e<r;){var s,n,o=t[e++];128&o?(s=63&t[e++],192==(224&o)?i+=String.fromCharCode((31&o)<<6|s):(n=63&t[e++],(o=224==(240&o)?(15&o)<<12|s<<6|n:(7&o)<<18|s<<12|n<<6|63&t[e++])<65536?i+=String.fromCharCode(o):(o-=65536,i+=String.fromCharCode(55296|o>>10,56320|1023&o)))):i+=String.fromCharCode(o)}return i}function M(t,e){return t?P(w,t,e):""}function $(t){return 0<t%65536&&(t+=65536-t%65536),t}function I(t){T=t,r.HEAP8=E=new Int8Array(t),r.HEAP16=new Int16Array(t),r.HEAP32=S=new Int32Array(t),r.HEAPU8=w=new Uint8Array(t),r.HEAPU16=new Uint16Array(t),r.HEAPU32=new Uint32Array(t),r.HEAPF32=new Float32Array(t),r.HEAPF64=new Float64Array(t)}"undefined"!=typeof TextDecoder&&new TextDecoder("utf-16le");var R=r.TOTAL_MEMORY||16777216;function D(t){for(;0<t.length;){var e,i=t.shift();"function"==typeof i?i():"number"==typeof(e=i.ea)?void 0===i.da?r.dynCall_v(e):r.dynCall_vi(e,i.da):e(void 0===i.da?null:i.da)}}(b=r.wasmMemory||new function(){return{buffer:new ArrayBuffer(R/65536*65536),grow:function(t){return st(t)}}})&&(T=b.buffer),T.byteLength,I(T),S[2216]=5251936;var L,F=[],O=[],k=[],B=[],N=(Math.imul&&-5===Math.imul(4294967295,5)||(Math.imul=function(t,e){var r=65535&t,i=65535&e;return r*i+((t>>>16)*i+r*(e>>>16)<<16)|0}),Math.fround||(L=new Float32Array(1),Math.fround=function(t){return L[0]=t,L[0]}),Math.clz32||(Math.clz32=function(t){var e=32,r=t>>16;return r&&(e-=16,t=r),(r=t>>8)&&(e-=8,t=r),(r=t>>4)&&(e-=4,t=r),(r=t>>2)&&(e-=2,t=r),t>>1?e-2:e-t}),Math.trunc||(Math.trunc=function(t){return t<0?Math.ceil(t):Math.floor(t)}),0),U=null,G=null;function V(t){throw r.onAbort&&r.onAbort(t),p(t),_(t),x=!0,"abort("+t+"). Build with -s ASSERTIONS=1 for more info."}r.preloadedImages={},r.preloadedAudios={};var H="data:application/octet-stream;base64,";function z(t){return String.prototype.startsWith?t.startsWith(H):0===t.indexOf(H)}var X="_em_module.wasm";function W(){try{if(y)return new Uint8Array(y);var t=Q(X);if(t)return t;if(h)return h(X);throw"both async and sync fetching of the wasm failed"}catch(t){V(t)}}z(X)||(d=X,X=r.locateFile?r.locateFile(d,f):f+d),O.push({ea:function(){tt()}});var Y=[null,[],[]],j=!1;function q(t){for(var e=[],r=0;r<t.length;r++){var i=t[r];255<i&&(j&&A(!1,"Character code "+i+" ("+String.fromCharCode(i)+")  at offset "+r+" not in 0x00-0xFF."),i&=255),e.push(String.fromCharCode(i))}return e.join("")}var Z="function"==typeof atob?atob:function(t){var e="",r=0;t=t.replace(/[^A-Za-z0-9\+\/=]/g,"");do{var i="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".indexOf(t.charAt(r++)),s="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".indexOf(t.charAt(r++)),n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".indexOf(t.charAt(r++)),o="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".indexOf(t.charAt(r++)),a=(i=i<<2|s>>4,s=(15&s)<<4|n>>2,(3&n)<<6|o)}while(e+=String.fromCharCode(i),64!==n&&(e+=String.fromCharCode(s)),64!==o&&(e+=String.fromCharCode(a)),r<t.length);return e};function Q(t){if(z(t)){if(t=t.slice(H.length),"boolean"==typeof c&&c){try{var e=Buffer.from(t,"base64")}catch(r){e=new Buffer(t,"base64")}var r=new Uint8Array(e.buffer,e.byteOffset,e.byteLength)}else try{var i=Z(t),s=new Uint8Array(i.length);for(e=0;e<i.length;++e)s[e]=i.charCodeAt(e);r=s}catch(t){throw Error("Converting base64 string to bytes failed.")}return r}}var J,K={a:function(t,e,r){w.set(w.subarray(e,e+r),t)},b:function(t){if(2147418112<t)return!1;for(var e=Math.max(E.length,16777216);e<t;)e=e<=536870912?$(2*e):Math.min($((3*e+2147483648)/4),2147418112);t:{try{b.grow(e-T.byteLength+65535>>16),I(b.buffer);var r=1;break t}catch(t){}r=void 0}return!!r},c:function(t,e,r,i){try{for(var s=0,n=0;n<r;n++){for(var o=S[e+8*n>>2],a=S[e+(8*n+4)>>2],h=0;h<a;h++){var l=w[o+h],u=Y[t];0===l||10===l?((1===t?p:_)(P(u,0)),u.length=0):u.push(l)}s+=a}return S[i>>2]=s,0}catch(t){return"undefined"!=typeof FS&&t instanceof FS.fa||V(t),t.ga}},memory:b,table:v},tt=(f=function(){function t(t){r.asm=t.exports,N--,r.monitorRunDependencies&&r.monitorRunDependencies(N),0==N&&(null!==U&&(clearInterval(U),U=null),G)&&(t=G,G=null,t())}function e(e){t(e.instance)}function i(t){(y||!l&&!u||"function"!=typeof fetch?new Promise((function(t){t(W())})):fetch(X,{credentials:"same-origin"}).then((function(t){if(t.ok)return t.arrayBuffer();throw"failed to load wasm binary file at '"+X+"'"})).catch(W)).then((function(){return{then:function(t){t({instance:new m})}}})).then(t,(function(t){_("failed to asynchronously prepare wasm: "+t),V(t)}))}var s={env:K,wasi_unstable:K};if(N++,r.monitorRunDependencies&&r.monitorRunDependencies(N),r.instantiateWasm)try{return r.instantiateWasm(s,t)}catch(t){return _("Module.instantiateWasm callback failed with error: "+t),!1}return y||"function"!=typeof g.instantiateStreaming||z(X)||"function"!=typeof fetch?i(e):fetch(X,{credentials:"same-origin"}).then((function(t){return g.instantiateStreaming(t,s).then(e,(function(t){_("wasm streaming compile failed: "+t),_("falling back to ArrayBuffer instantiation"),i(e)}))})),{}}(),r.asm=f,r.___wasm_call_ctors=function(){return r.asm.d.apply(null,arguments)}),et=(r._csmGetVersion=function(){return r.asm.e.apply(null,arguments)},r._csmGetLatestMocVersion=function(){return r.asm.f.apply(null,arguments)},r._csmGetMocVersion=function(){return r.asm.g.apply(null,arguments)},r._csmHasMocConsistency=function(){return r.asm.h.apply(null,arguments)},r._csmSetLogFunction=function(){return r.asm.i.apply(null,arguments)},r._csmReviveMocInPlace=function(){return r.asm.j.apply(null,arguments)},r._csmReadCanvasInfo=function(){return r.asm.k.apply(null,arguments)},r._csmGetSizeofModel=function(){return r.asm.l.apply(null,arguments)},r._csmInitializeModelInPlace=function(){return r.asm.m.apply(null,arguments)},r._csmUpdateModel=function(){return r.asm.n.apply(null,arguments)},r._csmGetParameterCount=function(){return r.asm.o.apply(null,arguments)},r._csmGetParameterIds=function(){return r.asm.p.apply(null,arguments)},r._csmGetParameterTypes=function(){return r.asm.q.apply(null,arguments)},r._csmGetParameterMinimumValues=function(){return r.asm.r.apply(null,arguments)},r._csmGetParameterMaximumValues=function(){return r.asm.s.apply(null,arguments)},r._csmGetParameterDefaultValues=function(){return r.asm.t.apply(null,arguments)},r._csmGetParameterValues=function(){return r.asm.u.apply(null,arguments)},r._csmGetPartCount=function(){return r.asm.v.apply(null,arguments)},r._csmGetPartIds=function(){return r.asm.w.apply(null,arguments)},r._csmGetPartOpacities=function(){return r.asm.x.apply(null,arguments)},r._csmGetPartParentPartIndices=function(){return r.asm.y.apply(null,arguments)},r._csmGetDrawableCount=function(){return r.asm.z.apply(null,arguments)},r._csmGetDrawableIds=function(){return r.asm.A.apply(null,arguments)},r._csmGetDrawableConstantFlags=function(){return r.asm.B.apply(null,arguments)},r._csmGetDrawableDynamicFlags=function(){return r.asm.C.apply(null,arguments)},r._csmGetDrawableTextureIndices=function(){return r.asm.D.apply(null,arguments)},r._csmGetDrawableDrawOrders=function(){return r.asm.E.apply(null,arguments)},r._csmGetDrawableRenderOrders=function(){return r.asm.F.apply(null,arguments)},r._csmGetDrawableOpacities=function(){return r.asm.G.apply(null,arguments)},r._csmGetDrawableMaskCounts=function(){return r.asm.H.apply(null,arguments)},r._csmGetDrawableMasks=function(){return r.asm.I.apply(null,arguments)},r._csmGetDrawableVertexCounts=function(){return r.asm.J.apply(null,arguments)},r._csmGetDrawableVertexPositions=function(){return r.asm.K.apply(null,arguments)},r._csmGetDrawableVertexUvs=function(){return r.asm.L.apply(null,arguments)},r._csmGetDrawableIndexCounts=function(){return r.asm.M.apply(null,arguments)},r._csmGetDrawableIndices=function(){return r.asm.N.apply(null,arguments)},r._csmGetDrawableMultiplyColors=function(){return r.asm.O.apply(null,arguments)},r._csmGetDrawableScreenColors=function(){return r.asm.P.apply(null,arguments)},r._csmGetDrawableParentPartIndices=function(){return r.asm.Q.apply(null,arguments)},r._csmResetDrawableDynamicFlags=function(){return r.asm.R.apply(null,arguments)},r._csmGetParameterKeyCounts=function(){return r.asm.S.apply(null,arguments)},r._csmGetParameterKeyValues=function(){return r.asm.T.apply(null,arguments)},r._csmMallocMoc=function(){return r.asm.U.apply(null,arguments)},r._csmMallocModelAndInitialize=function(){return r.asm.V.apply(null,arguments)},r._csmMalloc=function(){return r.asm.W.apply(null,arguments)},r._csmFree=function(){return r.asm.X.apply(null,arguments)},r._csmInitializeAmountOfMemory=function(){return r.asm.Y.apply(null,arguments)},r.stackSave=function(){return r.asm.Z.apply(null,arguments)}),rt=r.stackAlloc=function(){return r.asm._.apply(null,arguments)},it=r.stackRestore=function(){return r.asm.$.apply(null,arguments)},st=r.__growWasmMemory=function(){return r.asm.aa.apply(null,arguments)};function nt(){function t(){if(!J&&(J=!0,!x)){if(D(O),D(k),r.onRuntimeInitialized&&r.onRuntimeInitialized(),r.postRun)for("function"==typeof r.postRun&&(r.postRun=[r.postRun]);r.postRun.length;){var t=r.postRun.shift();B.unshift(t)}D(B)}}if(!(0<N)){if(r.preRun)for("function"==typeof r.preRun&&(r.preRun=[r.preRun]);r.preRun.length;)!function(){var t=r.preRun.shift();F.unshift(t)}();D(F),0<N||(r.setStatus?(r.setStatus("Running..."),setTimeout((function(){setTimeout((function(){r.setStatus("")}),1),t()}),1)):t())}}if(r.dynCall_vi=function(){return r.asm.ba.apply(null,arguments)},r.asm=f,r.ccall=function(t,e,i,s){var n={string:function(t){var e=0;if(null!=t&&0!==t){var r=1+(t.length<<2),i=e=rt(r),s=w;if(0<r){r=i+r-1;for(var n=0;n<t.length;++n){var o=t.charCodeAt(n);if((o=55296<=o&&o<=57343?65536+((1023&o)<<10)|1023&t.charCodeAt(++n):o)<=127){if(r<=i)break;s[i++]=o}else{if(o<=2047){if(r<=i+1)break;s[i++]=192|o>>6}else{if(o<=65535){if(r<=i+2)break;s[i++]=224|o>>12}else{if(r<=i+3)break;s[i++]=240|o>>18,s[i++]=128|o>>12&63}s[i++]=128|o>>6&63}s[i++]=128|63&o}}s[i]=0}}return e},array:function(t){var e=rt(t.length);return E.set(t,e),e}},o=function(t){var e=r["_"+t];return A(e,"Cannot call unknown function "+t+", make sure it is exported"),e}(t),a=[];if(t=0,s)for(var h=0;h<s.length;h++){var l=n[i[h]];l?(0===t&&(t=et()),a[h]=l(s[h])):a[h]=s[h]}return i=function(t){return"string"===e?M(t):"boolean"===e?!!t:t}(i=o.apply(null,a)),0!==t&&it(t),i},r.UTF8ToString=M,r.addFunction=function(t,e){var r=v.length;try{v.grow(1)}catch(t){if(!t instanceof RangeError)throw t;throw"Unable to grow wasm table. Use a higher value for RESERVED_FUNCTION_POINTERS or set ALLOW_TABLE_GROWTH."}try{v.set(r,t)}catch(i){if(!i instanceof TypeError)throw i;A(void 0!==e,"Missing signature argument to addFunction"),v.set(r,t)}return r},r.then=function(t){var e;return J?t(r):(e=r.onRuntimeInitialized,r.onRuntimeInitialized=function(){e&&e(),t(r)}),r},G=function t(){J||nt(),J||(G=t)},r.run=nt,r.preInit)for("function"==typeof r.preInit&&(r.preInit=[r.preInit]);0<r.preInit.length;)r.preInit.pop()();return nt(),t}),l=("object"==typeof exports&&"object"==typeof module?module.exports=h:"function"==typeof define&&define.amd?define([],(function(){return h})):"object"==typeof exports&&(exports._em_module=h),h())}(Live2DCubismCore=Live2DCubismCore||{}),function(){var t=!0;function e(){t||(this._$MT=null,this._$5S=null,this._$NP=0,e._$42++,this._$5S=new G(this))}function r(e){if(!t){this.clipContextList=new Array,this.glcontext=e.gl,this.dp_webgl=e,this.curFrameNo=0,this.firstError_clipInNotUpdate=!0,this.colorBuffer=0,this.isInitGLFBFunc=!1,this.tmpBoundsOnModel=new A,ht.glContext.length>ht.frameBuffers.length&&(this.curFrameNo=this.getMaskRenderTexture()),this.tmpModelToViewMatrix=new D,this.tmpMatrix2=new D,this.tmpMatrixForMask=new D,this.tmpMatrixForDraw=new D,this.CHANNEL_COLORS=new Array;var r=new C;(r=new C).r=0,r.g=0,r.b=0,r.a=1,this.CHANNEL_COLORS.push(r),(r=new C).r=1,r.g=0,r.b=0,r.a=0,this.CHANNEL_COLORS.push(r),(r=new C).r=0,r.g=1,r.b=0,r.a=0,this.CHANNEL_COLORS.push(r),(r=new C).r=0,r.g=0,r.b=1,r.a=0,this.CHANNEL_COLORS.push(r);for(var i=0;i<this.CHANNEL_COLORS.length;i++)this.dp_webgl.setChannelFlagAsColor(i,this.CHANNEL_COLORS[i])}}function i(t,e,r){this.clipIDList=new Array,this.clipIDList=r,this.clippingMaskDrawIndexList=new Array;for(var i=0;i<r.length;i++)this.clippingMaskDrawIndexList.push(e.getDrawDataIndex(r[i]));this.clippedDrawContextList=new Array,this.isUsing=!0,this.layoutChannelNo=0,this.layoutBounds=new A,this.allClippedDrawRect=new A,this.matrixForMask=new Float32Array(16),this.matrixForDraw=new Float32Array(16),this.owner=t}function s(t,e){this._$gP=t,this.drawDataIndex=e}function n(){t||(this.color=null)}function o(){t||(this._$dP=null,this._$eo=null,this._$V0=null,this._$dP=1e3,this._$eo=1e3,this._$V0=1,this._$a0())}function a(){}function h(){this._$r=null,this._$0S=null}function l(){t||(this.x=null,this.y=null,this.width=null,this.height=null)}function u(e){t||it.prototype.constructor.call(this,e)}function c(e){t||it.prototype.constructor.call(this,e)}function d(){t||(this._$vo=null,this._$F2=null,this._$ao=400,this._$1S=400,d._$42++)}function f(){t||(this.p1=new p,this.p2=new p,this._$Fo=0,this._$Db=0,this._$L2=0,this._$M2=0,this._$ks=0,this._$9b=0,this._$iP=0,this._$iT=0,this._$lL=new Array,this._$qP=new Array,this.setup(.3,.5,.1))}function p(){this._$p=1,this.x=0,this.y=0,this.vx=0,this.vy=0,this.ax=0,this.ay=0,this.fx=0,this.fy=0,this._$s0=0,this._$70=0,this._$7L=0,this._$HL=0}function _(t,e,r){this._$wL=null,this.scale=null,this._$V0=null,this._$wL=t,this.scale=e,this._$V0=r}function g(t,e,r,i){_.prototype.constructor.call(this,e,r,i),this._$tL=null,this._$tL=t}function y(t,e,r){this._$wL=null,this.scale=null,this._$V0=null,this._$wL=t,this.scale=e,this._$V0=r}function b(t,e,r,i){y.prototype.constructor.call(this,e,r,i),this._$YP=null,this._$YP=t}function v(){t||(this._$fL=0,this._$gL=0,this._$B0=1,this._$z0=1,this._$qT=0,this.reflectX=!1,this.reflectY=!1)}e._$0s=1,e._$4s=2,e._$42=0,e._$62=function(t,r){try{if(r instanceof ArrayBuffer&&(r=new DataView(r)),!(r instanceof DataView))throw new ut("_$SS#loadModel(b) / b _$x be DataView or ArrayBuffer");var i,s=new At(r),n=s._$ST(),o=s._$ST(),h=s._$ST();if(109!=n||111!=o||99!=h)throw new ut("_$gi _$C _$li , _$Q0 _$P0.");if(i=s._$ST(),s._$gr(i),i>U._$T7)throw t._$NP|=e._$4s,new ut("_$gi _$C _$li , _$n0 _$_ version _$li ( SDK : "+U._$T7+" < _$f0 : "+i+" )@_$SS#loadModel()\n");var l=s._$nP();if(i>=U._$s7){var u=s._$9T(),c=s._$9T();if(-30584!=u||-30584!=c)throw t._$NP|=e._$0s,new ut("_$gi _$C _$li , _$0 _$6 _$Ui.")}t._$KS(l);var d=t.getModelContext();d.setDrawParam(t.getDrawParam()),d.init()}catch(t){a._$Rb(t)}},e.prototype._$KS=function(t){this._$MT=t},e.prototype.getModelImpl=function(){return null==this._$MT&&(this._$MT=new d,this._$MT._$zP()),this._$MT},e.prototype.getCanvasWidth=function(){return null==this._$MT?0:this._$MT.getCanvasWidth()},e.prototype.getCanvasHeight=function(){return null==this._$MT?0:this._$MT.getCanvasHeight()},e.prototype.getParamFloat=function(t){return"number"!=typeof t&&(t=this._$5S.getParamIndex(c.getID(t))),this._$5S.getParamFloat(t)},e.prototype.setParamFloat=function(t,e,r){"number"!=typeof t&&(t=this._$5S.getParamIndex(c.getID(t))),arguments.length<3&&(r=1),this._$5S.setParamFloat(t,this._$5S.getParamFloat(t)*(1-r)+e*r)},e.prototype.addToParamFloat=function(t,e,r){"number"!=typeof t&&(t=this._$5S.getParamIndex(c.getID(t))),arguments.length<3&&(r=1),this._$5S.setParamFloat(t,this._$5S.getParamFloat(t)+e*r)},e.prototype.multParamFloat=function(t,e,r){"number"!=typeof t&&(t=this._$5S.getParamIndex(c.getID(t))),arguments.length<3&&(r=1),this._$5S.setParamFloat(t,this._$5S.getParamFloat(t)*(1+(e-1)*r))},e.prototype.getParamIndex=function(t){return this._$5S.getParamIndex(c.getID(t))},e.prototype.loadParam=function(){this._$5S.loadParam()},e.prototype.saveParam=function(){this._$5S.saveParam()},e.prototype.init=function(){this._$5S.init()},e.prototype.update=function(){this._$5S.update()},e.prototype._$Rs=function(){return a._$li("_$60 _$PT _$Rs()"),-1},e.prototype._$Ds=function(t){a._$li("_$60 _$PT _$SS#_$Ds() \n")},e.prototype._$K2=function(){},e.prototype.draw=function(){},e.prototype.getModelContext=function(){return this._$5S},e.prototype._$s2=function(){return this._$NP},e.prototype._$P7=function(t,e,r,i){var s=-1,n=0,o=this,a=.5;if(0!=r)if(1==t.length){p=t[0];var h=0!=o.getParamFloat(p),l=(_=e[0],o.getPartsOpacity(_)),u=r/i;h?(l+=u)>1&&(l=1):(l-=u)<0&&(l=0),o.setPartsOpacity(_,l)}else{for(f=0;f<t.length;f++){p=t[f];if(m=0!=o.getParamFloat(p)){if(s>=0)break;s=f;_=e[f];n=o.getPartsOpacity(_),(n+=r/i)>1&&(n=1)}}s<0&&(console.log("No _$wi _$q0/ _$U default[%s]",t[0]),s=0,n=1,o.loadParam(),o.setParamFloat(t[s],n),o.saveParam());for(f=0;f<t.length;f++){_=e[f];if(s==f)o.setPartsOpacity(_,n);else{var c,d=o.getPartsOpacity(_);(1-(c=n<a?-.5*n/a+1:(1-n)*a/.5))*(1-n)>.15&&(c=1-.15/(1-n)),d>c&&(d=c),o.setPartsOpacity(_,d)}}}else for(var f=0;f<t.length;f++){var p=t[f],_=e[f],m=0!=o.getParamFloat(p);o.setPartsOpacity(_,m?1:0)}},e.prototype.setPartsOpacity=function(t,e){"number"!=typeof t&&(t=this._$5S.getPartsDataIndex(u.getID(t))),this._$5S.setPartsOpacity(t,e)},e.prototype.getPartsDataIndex=function(t){return t instanceof u||(t=u.getID(t)),this._$5S.getPartsDataIndex(t)},e.prototype.getPartsOpacity=function(t){return"number"!=typeof t&&(t=this._$5S.getPartsDataIndex(u.getID(t))),t<0?0:this._$5S.getPartsOpacity(t)},e.prototype.getDrawParam=function(){},e.prototype.getDrawDataIndex=function(t){return this._$5S.getDrawDataIndex(L.getID(t))},e.prototype.getDrawData=function(t){return this._$5S.getDrawData(t)},e.prototype.getTransformedPoints=function(t){var e=this._$5S._$C2(t);return e instanceof dt?e.getTransformedPoints():null},e.prototype.getIndexArray=function(t){if(t<0||t>=this._$5S._$aS.length)return null;var e=this._$5S._$aS[t];return null!=e&&e.getType()==j._$wb&&e instanceof ct?e.getIndexArray():null},r.CHANNEL_COUNT=4,r.RENDER_TEXTURE_USE_MIPMAP=!1,r.NOT_USED_FRAME=-100,r.prototype._$L7=function(){if(this.tmpModelToViewMatrix&&(this.tmpModelToViewMatrix=null),this.tmpMatrix2&&(this.tmpMatrix2=null),this.tmpMatrixForMask&&(this.tmpMatrixForMask=null),this.tmpMatrixForDraw&&(this.tmpMatrixForDraw=null),this.tmpBoundsOnModel&&(this.tmpBoundsOnModel=null),this.CHANNEL_COLORS){for(var t=this.CHANNEL_COLORS.length-1;t>=0;--t)this.CHANNEL_COLORS.splice(t,1);this.CHANNEL_COLORS=[]}this.releaseShader()},r.prototype.releaseShader=function(){for(var t=ht.frameBuffers.length,e=0;e<t;e++)this.gl.deleteFramebuffer(ht.frameBuffers[e].framebuffer);ht.frameBuffers=[],ht.glContext=[]},r.prototype.init=function(t,e,r){for(var s=0;s<e.length;s++){var n=e[s].getClipIDList();if(null!=n){var o=this.findSameClip(n);null==o&&(o=new i(this,t,n),this.clipContextList.push(o));var a=e[s].getDrawDataID(),h=t.getDrawDataIndex(a);o.addClippedDrawData(a,h),r[s].clipBufPre_clipContext=o}}},r.prototype.getMaskRenderTexture=function(){var t;return t=this.dp_webgl.createFramebuffer(),ht.frameBuffers[this.dp_webgl.glno]=t,this.dp_webgl.glno},r.prototype.setupClip=function(t,e){for(var r=0,i=0;i<this.clipContextList.length;i++){var s=this.clipContextList[i];this.calcClippedDrawTotalBounds(t,s),s.isUsing&&r++}if(r>0){var n=e.gl.getParameter(e.gl.FRAMEBUFFER_BINDING),o=new Array(4);o[0]=0,o[1]=0,o[2]=e.gl.canvas.width,o[3]=e.gl.canvas.height,e.gl.viewport(0,0,ht.clippingMaskBufferSize,ht.clippingMaskBufferSize),this.setupLayoutBounds(r),e.gl.bindFramebuffer(e.gl.FRAMEBUFFER,ht.frameBuffers[this.curFrameNo].framebuffer),e.gl.clearColor(0,0,0,0),e.gl.clear(e.gl.COLOR_BUFFER_BIT);for(i=0;i<this.clipContextList.length;i++){var a=(s=this.clipContextList[i]).allClippedDrawRect,h=(s.layoutChannelNo,s.layoutBounds);this.tmpBoundsOnModel._$jL(a),this.tmpBoundsOnModel.expand(.05*a.width,.05*a.height);var l=h.width/this.tmpBoundsOnModel.width,u=h.height/this.tmpBoundsOnModel.height;this.tmpMatrix2.identity(),this.tmpMatrix2.translate(-1,-1,0),this.tmpMatrix2.scale(2,2,1),this.tmpMatrix2.translate(h.x,h.y,0),this.tmpMatrix2.scale(l,u,1),this.tmpMatrix2.translate(-this.tmpBoundsOnModel.x,-this.tmpBoundsOnModel.y,0),this.tmpMatrixForMask.setMatrix(this.tmpMatrix2.m),this.tmpMatrix2.identity(),this.tmpMatrix2.translate(h.x,h.y,0),this.tmpMatrix2.scale(l,u,1),this.tmpMatrix2.translate(-this.tmpBoundsOnModel.x,-this.tmpBoundsOnModel.y,0),this.tmpMatrixForDraw.setMatrix(this.tmpMatrix2.m);for(var c=this.tmpMatrixForMask.getArray(),d=0;d<16;d++)s.matrixForMask[d]=c[d];var f=this.tmpMatrixForDraw.getArray();for(d=0;d<16;d++)s.matrixForDraw[d]=f[d];for(var p=s.clippingMaskDrawIndexList.length,_=0;_<p;_++){var m=s.clippingMaskDrawIndexList[_],g=t.getDrawData(m),y=t._$C2(m);e.setClipBufPre_clipContextForMask(s),g.draw(e,t,y)}}e.gl.bindFramebuffer(e.gl.FRAMEBUFFER,n),e.setClipBufPre_clipContextForMask(null),e.gl.viewport(o[0],o[1],o[2],o[3])}},r.prototype.getColorBuffer=function(){return this.colorBuffer},r.prototype.findSameClip=function(t){for(var e=0;e<this.clipContextList.length;e++){var r=this.clipContextList[e],i=r.clipIDList.length;if(i==t.length){for(var s=0,n=0;n<i;n++)for(var o=r.clipIDList[n],a=0;a<i;a++)if(t[a]==o){s++;break}if(s==i)return r}}return null},r.prototype.calcClippedDrawTotalBounds=function(t,e){for(var r=t._$Ri.getModelImpl().getCanvasWidth(),i=t._$Ri.getModelImpl().getCanvasHeight(),s=r>i?r:i,n=s,o=s,a=0,h=0,l=e.clippedDrawContextList.length,u=0;u<l;u++){var c=e.clippedDrawContextList[u].drawDataIndex,d=t._$C2(c);if(d._$yo()){for(var f=d.getTransformedPoints(),p=f.length,_=[],m=[],g=0,y=N._$i2;y<p;y+=N._$No)_[g]=f[y],m[g]=f[y+1],g++;var b=Math.min.apply(null,_),v=Math.min.apply(null,m),x=Math.max.apply(null,_),A=Math.max.apply(null,m);b<n&&(n=b),v<o&&(o=v),x>a&&(a=x),A>h&&(h=A)}}if(n==s)e.allClippedDrawRect.x=0,e.allClippedDrawRect.y=0,e.allClippedDrawRect.width=0,e.allClippedDrawRect.height=0,e.isUsing=!1;else{var T=a-n,E=h-o;e.allClippedDrawRect.x=n,e.allClippedDrawRect.y=o,e.allClippedDrawRect.width=T,e.allClippedDrawRect.height=E,e.isUsing=!0}},r.prototype.setupLayoutBounds=function(t){var e=t/r.CHANNEL_COUNT,i=t%r.CHANNEL_COUNT;e=~~e,i=~~i;for(var s=0,n=0;n<r.CHANNEL_COUNT;n++){var o=e+(n<i?1:0);if(0==o);else if(1==o)(c=this.clipContextList[s++]).layoutChannelNo=n,c.layoutBounds.x=0,c.layoutBounds.y=0,c.layoutBounds.width=1,c.layoutBounds.height=1;else if(2==o)for(var h=0;h<o;h++){var l=0;u=~~(u=h%2),(c=this.clipContextList[s++]).layoutChannelNo=n,c.layoutBounds.x=.5*u,c.layoutBounds.y=0,c.layoutBounds.width=.5,c.layoutBounds.height=1}else if(o<=4)for(h=0;h<o;h++){u=~~(u=h%2),l=~~(l=h/2),(c=this.clipContextList[s++]).layoutChannelNo=n,c.layoutBounds.x=.5*u,c.layoutBounds.y=.5*l,c.layoutBounds.width=.5,c.layoutBounds.height=.5}else if(o<=9)for(h=0;h<o;h++){var u,c;u=~~(u=h%3),l=~~(l=h/3),(c=this.clipContextList[s++]).layoutChannelNo=n,c.layoutBounds.x=u/3,c.layoutBounds.y=l/3,c.layoutBounds.width=1/3,c.layoutBounds.height=1/3}else a._$li("_$6 _$0P mask count : %d",o)}},i.prototype.addClippedDrawData=function(t,e){var r=new s(t,e);this.clippedDrawContextList.push(r)},o._$JT=function(t,e,r){var i=t/e,s=r/e,n=1/3,o=2/3,a=1-(1-s)*(1-s),h=1-(1-s)*(1-s),l=(1-s)*n*a+(s*o+(1-s)*n)*(1-a),u=(s+(1-s)*o)*h+(s*n+(1-s)*o)*(1-h);if(i<=0)return 0;if(i>=1)return 1;var c=i*i;return(1-3*u+3*l-0)*(i*c)+(3*u-6*l+0)*c+(3*l-0)*i+0},o.prototype._$a0=function(){},o.prototype.setFadeIn=function(t){this._$dP=t},o.prototype.setFadeOut=function(t){this._$eo=t},o.prototype._$pT=function(t){this._$V0=t},o.prototype.getFadeOut=function(){return this._$eo},o.prototype._$4T=function(){return this._$eo},o.prototype._$mT=function(){return this._$V0},o.prototype.getDurationMSec=function(){return-1},o.prototype.getLoopDurationMSec=function(){return-1},o.prototype.updateParam=function(t,e){if(e._$AT&&!e._$9L){var r=M.getUserTimeMSec();if(e._$z2<0){e._$z2=r,e._$bs=r;var i=this.getDurationMSec();e._$Do<0&&(e._$Do=i<=0?-1:e._$z2+i)}var s=this._$V0;0<=(s=s*(0==this._$dP?1:lt._$r2((r-e._$bs)/this._$dP))*(0==this._$eo||e._$Do<0?1:lt._$r2((e._$Do-r)/this._$eo)))&&s<=1||console.log("### assert!! ### "),this.updateParamExe(t,r,s,e),e._$Do>0&&e._$Do<r&&(e._$9L=!0)}},o.prototype.updateParamExe=function(t,e,r,i){},a._$8s=0,a._$fT=new Object,a.start=function(t){var e=a._$fT[t];null==e&&((e=new h)._$r=t,a._$fT[t]=e),e._$0S=M.getSystemTimeMSec()},a.dump=function(t){var e=a._$fT[t];if(null!=e){var r=M.getSystemTimeMSec()-e._$0S;return console.log(t+" : "+r+"ms"),r}return-1},a.end=function(t){var e=a._$fT[t];return null!=e?M.getSystemTimeMSec()-e._$0S:-1},a._$li=function(t,e){console.log("_$li : "+t+"\n",e)},a._$Ji=function(t,e){console.log(t,e)},a._$dL=function(t,e){console.log(t,e),console.log("\n")},a._$KL=function(t,e){for(var r=0;r<e;r++)r%16==0&&r>0?console.log("\n"):r%8==0&&r>0&&console.log("  "),console.log("%02X ",255&t[r]);console.log("\n")},a._$nr=function(t,e,r){console.log("%s\n",t);for(var i=e.length,s=0;s<i;++s)console.log("%5d",e[s]),console.log("%s\n",r),console.log(",");console.log("\n")},a._$Rb=function(t){console.log("dump exception : "+t),console.log("stack :: "+t.stack)},l.prototype._$8P=function(){return.5*(this.x+this.x+this.width)},l.prototype._$6P=function(){return.5*(this.y+this.y+this.height)},l.prototype._$EL=function(){return this.x+this.width},l.prototype._$5T=function(){return this.y+this.height},l.prototype._$jL=function(t,e,r,i){this.x=t,this.y=e,this.width=r,this.height=i},l.prototype._$jL=function(t){this.x=t.x,this.y=t.y,this.width=t.width,this.height=t.height},u.prototype=new it,u._$tP=new Object,u._$27=function(){u._$tP.clear()},u.getID=function(t){var e=u._$tP[t];return null==e&&(e=new u(t),u._$tP[t]=e),e},u.prototype._$3s=function(){return new u},c.prototype=new it,c._$tP=new Object,c._$27=function(){c._$tP.clear()},c.getID=function(t){var e=c._$tP[t];return null==e&&(e=new c(t),c._$tP[t]=e),e},c.prototype._$3s=function(){return new c},d._$42=0,d.prototype._$zP=function(){null==this._$vo&&(this._$vo=new st),null==this._$F2&&(this._$F2=new Array)},d.prototype.getCanvasWidth=function(){return this._$ao},d.prototype.getCanvasHeight=function(){return this._$1S},d.prototype._$F0=function(t){this._$vo=t._$nP(),this._$F2=t._$nP(),this._$ao=t._$6L(),this._$1S=t._$6L()},d.prototype._$6S=function(t){this._$F2.push(t)},d.prototype._$Xr=function(){return this._$F2},d.prototype._$E2=function(){return this._$vo},f.prototype.setup=function(t,e,r){this._$ks=this._$Yb(),this.p2._$xT(),3==arguments.length&&(this._$Fo=t,this._$L2=e,this.p1._$p=r,this.p2._$p=r,this.p2.y=t,this.setup())},f.prototype.getPhysicsPoint1=function(){return this.p1},f.prototype.getPhysicsPoint2=function(){return this.p2},f.prototype._$qr=function(){return this._$Db},f.prototype._$pr=function(t){this._$Db=t},f.prototype._$5r=function(){return this._$M2},f.prototype._$Cs=function(){return this._$9b},f.prototype._$Yb=function(){return-180*Math.atan2(this.p1.x-this.p2.x,-(this.p1.y-this.p2.y))/Math.PI},f.prototype.addSrcParam=function(t,e,r,i){var s=new g(t,e,r,i);this._$lL.push(s)},f.prototype.addTargetParam=function(t,e,r,i){var s=new b(t,e,r,i);this._$qP.push(s)},f.prototype.update=function(t,e){if(0==this._$iP)return this._$iP=this._$iT=e,void(this._$Fo=Math.sqrt((this.p1.x-this.p2.x)*(this.p1.x-this.p2.x)+(this.p1.y-this.p2.y)*(this.p1.y-this.p2.y)));var r=(e-this._$iT)/1e3;if(0!=r){for(var i=this._$lL.length-1;i>=0;--i){this._$lL[i]._$oP(t,this)}this._$oo(t,r),this._$M2=this._$Yb(),this._$9b=(this._$M2-this._$ks)/r,this._$ks=this._$M2}for(i=this._$qP.length-1;i>=0;--i){this._$qP[i]._$YS(t,this)}this._$iT=e},f.prototype._$oo=function(t,e){e<.033&&(e=.033);var r=1/e;this.p1.vx=(this.p1.x-this.p1._$s0)*r,this.p1.vy=(this.p1.y-this.p1._$70)*r,this.p1.ax=(this.p1.vx-this.p1._$7L)*r,this.p1.ay=(this.p1.vy-this.p1._$HL)*r,this.p1.fx=this.p1.ax*this.p1._$p,this.p1.fy=this.p1.ay*this.p1._$p,this.p1._$xT();var i,s,n=-Math.atan2(this.p1.y-this.p2.y,this.p1.x-this.p2.x),o=Math.cos(n),a=Math.sin(n),h=9.8*this.p2._$p,l=this._$Db*Et._$bS,u=h*Math.cos(n-l);i=u*a,s=u*o;var c=-this.p1.fx*a*a,d=-this.p1.fy*a*o,f=-this.p2.vx*this._$L2,p=-this.p2.vy*this._$L2;this.p2.fx=i+c+f,this.p2.fy=s+d+p,this.p2.ax=this.p2.fx/this.p2._$p,this.p2.ay=this.p2.fy/this.p2._$p,this.p2.vx+=this.p2.ax*e,this.p2.vy+=this.p2.ay*e,this.p2.x+=this.p2.vx*e,this.p2.y+=this.p2.vy*e;var _=Math.sqrt((this.p1.x-this.p2.x)*(this.p1.x-this.p2.x)+(this.p1.y-this.p2.y)*(this.p1.y-this.p2.y));this.p2.x=this.p1.x+this._$Fo*(this.p2.x-this.p1.x)/_,this.p2.y=this.p1.y+this._$Fo*(this.p2.y-this.p1.y)/_,this.p2.vx=(this.p2.x-this.p2._$s0)*r,this.p2.vy=(this.p2.y-this.p2._$70)*r,this.p2._$xT()},p.prototype._$xT=function(){this._$s0=this.x,this._$70=this.y,this._$7L=this.vx,this._$HL=this.vy},_.prototype._$oP=function(t,e){},g.prototype=new _,g.prototype._$oP=function(t,e){var r=this.scale*t.getParamFloat(this._$wL),i=e.getPhysicsPoint1();switch(this._$tL){default:case f.Src.SRC_TO_X:i.x=i.x+(r-i.x)*this._$V0;break;case f.Src.SRC_TO_Y:i.y=i.y+(r-i.y)*this._$V0;break;case f.Src.SRC_TO_G_ANGLE:var s=e._$qr();s+=(r-s)*this._$V0,e._$pr(s)}},y.prototype._$YS=function(t,e){},b.prototype=new y,b.prototype._$YS=function(t,e){switch(this._$YP){default:case f.Target.TARGET_FROM_ANGLE:t.setParamFloat(this._$wL,this.scale*e._$5r(),this._$V0);break;case f.Target.TARGET_FROM_ANGLE_V:t.setParamFloat(this._$wL,this.scale*e._$Cs(),this._$V0)}},f.Src=function(){},f.Src.SRC_TO_X="SRC_TO_X",f.Src.SRC_TO_Y="SRC_TO_Y",f.Src.SRC_TO_G_ANGLE="SRC_TO_G_ANGLE",f.Target=function(){},f.Target.TARGET_FROM_ANGLE="TARGET_FROM_ANGLE",f.Target.TARGET_FROM_ANGLE_V="TARGET_FROM_ANGLE_V",v.prototype.init=function(t){this._$fL=t._$fL,this._$gL=t._$gL,this._$B0=t._$B0,this._$z0=t._$z0,this._$qT=t._$qT,this.reflectX=t.reflectX,this.reflectY=t.reflectY},v.prototype._$F0=function(t){this._$fL=t._$_T(),this._$gL=t._$_T(),this._$B0=t._$_T(),this._$z0=t._$_T(),this._$qT=t._$_T(),t.getFormatVersion()>=U.LIVE2D_FORMAT_VERSION_V2_10_SDK2&&(this.reflectX=t._$po(),this.reflectY=t._$po())},v.prototype._$e=function(){};var x=function(){};function A(){t||(this.x=null,this.y=null,this.width=null,this.height=null)}function T(){}function E(){t||(this.x=null,this.y=null)}function w(){t||(this._$gP=null,this._$dr=null,this._$GS=null,this._$qb=null,this._$Lb=null,this._$mS=null,this.clipID=null,this.clipIDList=new Array)}function S(){t||(this._$Eb=S._$ps,this._$lT=1,this._$C0=1,this._$tT=1,this._$WL=1,this.culling=!1,this.matrix4x4=new Float32Array(16),this.premultipliedAlpha=!1,this.anisotropy=0,this.clippingProcess=S.CLIPPING_PROCESS_NONE,this.clipBufPre_clipContextMask=null,this.clipBufPre_clipContextDraw=null,this.CHANNEL_COLORS=new Array)}function C(){t||(this.a=1,this.r=1,this.g=1,this.b=1,this.scale=1,this._$ho=1,this.blendMode=ht.L2D_COLOR_BLEND_MODE_MULT)}function P(){t||(this._$kP=null,this._$dr=null,this._$Ai=!0,this._$mS=null)}function M(){}function $(){t||(this._$VP=0,this._$wL=null,this._$GP=null,this._$8o=$._$ds,this._$2r=-1,this._$O2=0,this._$ri=0)}function I(){}function R(){t||(this._$Ob=null)}function D(){this.m=new Float32Array(16),this.identity()}function L(e){t||it.prototype.constructor.call(this,e)}function F(){t||(this._$7=1,this._$f=0,this._$H=0,this._$g=1,this._$k=0,this._$w=0,this._$hi=STATE_IDENTITY,this._$Z=_$pS)}function O(){t||(o.prototype.constructor.call(this),this.motions=new Array,this._$7r=null,this._$7r=O._$Co++,this._$D0=30,this._$yT=0,this._$E=!0,this.loopFadeIn=!0,this._$AS=-1,_$a0())}function k(){this._$P=new Float32Array(100),this.size=0}function B(){this._$4P=null,this._$I0=null,this._$RP=null}function N(){}function U(){}function G(e){t||(this._$QT=!0,this._$co=-1,this._$qo=0,this._$pb=new Array(G._$is),this._$_2=new Float32Array(G._$is),this._$vr=new Float32Array(G._$is),this._$Rr=new Float32Array(G._$is),this._$Or=new Float32Array(G._$is),this._$fs=new Float32Array(G._$is),this._$Js=new Array(G._$is),this._$3S=new Array,this._$aS=new Array,this._$Bo=null,this._$F2=new Array,this._$db=new Array,this._$8b=new Array,this._$Hr=new Array,this._$Ws=null,this._$Vs=null,this._$Er=null,this._$Es=new Int16Array(N._$Qb),this._$ZP=new Float32Array(2*N._$1r),this._$Ri=e,this._$b0=G._$HP++,this.clipManager=null,this.dp_webgl=null)}function V(){}function H(){t||(this._$12=null,this._$bb=null,this._$_L=null,this._$jo=null,this._$iL=null,this._$0L=null,this._$Br=null,this._$Dr=null,this._$Cb=null,this._$mr=null,this._$_L=z.STATE_FIRST,this._$Br=4e3,this._$Dr=100,this._$Cb=50,this._$mr=150,this._$jo=!0,this._$iL="PARAM_EYE_L_OPEN",this._$0L="PARAM_EYE_R_OPEN")}x._$ni=function(t,e,r,i,s,n,o,a,h){var l=o*n-a*s;if(0==l)return null;var u,c=((t-r)*n-(e-i)*s)/l;return u=0!=s?(t-r-c*o)/s:(e-i-c*a)/n,isNaN(u)&&(u=(t-r-c*o)/s,isNaN(u)&&(u=(e-i-c*a)/n),isNaN(u)&&(console.log("a is NaN @UtVector#_$ni() "),console.log("v1x : "+s),console.log("v1x != 0 ? "+(0!=s)))),null==h?new Array(u,c):(h[0]=u,h[1]=c,h)},A.prototype._$8P=function(){return this.x+.5*this.width},A.prototype._$6P=function(){return this.y+.5*this.height},A.prototype._$EL=function(){return this.x+this.width},A.prototype._$5T=function(){return this.y+this.height},A.prototype._$jL=function(t,e,r,i){this.x=t,this.y=e,this.width=r,this.height=i},A.prototype._$jL=function(t){this.x=t.x,this.y=t.y,this.width=t.width,this.height=t.height},A.prototype.contains=function(t,e){return this.x<=this.x&&this.y<=this.y&&this.x<=this.x+this.width&&this.y<=this.y+this.height},A.prototype.expand=function(t,e){this.x-=t,this.y-=e,this.width+=2*t,this.height+=2*e},T._$Z2=function(t,e,r,i){var s=e._$Q2(t,r),n=t._$vs(),o=t._$Tr();if(e._$zr(n,o,s),s<=0)return i[n[0]];if(1==s)return(a=i[n[0]])+((h=i[n[1]])-a)*(b=o[0])|0;if(2==s){var a=i[n[0]],h=i[n[1]],l=i[n[2]],u=i[n[3]];return(A=a+(h-a)*(b=o[0])|0)+((l+(u-l)*b|0)-A)*(v=o[1])|0}if(3==s){var c=i[n[0]],d=i[n[1]],f=i[n[2]],p=i[n[3]],_=i[n[4]],m=i[n[5]],g=i[n[6]],y=i[n[7]];return(A=(a=c+(d-c)*(b=o[0])|0)+((h=f+(p-f)*b|0)-a)*(v=o[1])|0)+(((l=_+(m-_)*b|0)+((u=g+(y-g)*b|0)-l)*v|0)-A)*(x=o[2])|0}if(4==s){var b,v,x,A,T=i[n[0]],E=i[n[1]],w=i[n[2]],S=i[n[3]],C=i[n[4]],P=i[n[5]],M=i[n[6]],$=i[n[7]],I=i[n[8]],R=i[n[9]],D=i[n[10]],L=i[n[11]],F=i[n[12]],O=i[n[13]],k=i[n[14]],B=i[n[15]];return(A=(a=(c=T+(E-T)*(b=o[0])|0)+((d=w+(S-w)*b|0)-c)*(v=o[1])|0)+((h=(f=C+(P-C)*b|0)+((p=M+($-M)*b|0)-f)*v|0)-a)*(x=o[2])|0)+(((l=(_=I+(R-I)*b|0)+((m=D+(L-D)*b|0)-_)*v|0)+((u=(g=F+(O-F)*b|0)+((y=k+(B-k)*b|0)-g)*v|0)-l)*x|0)-A)*o[3]|0}for(var N=1<<s,U=new Float32Array(N),G=0;G<N;G++){for(var V=G,H=1,z=0;z<s;z++)H*=V%2==0?1-o[z]:o[z],V/=2;U[G]=H}for(var X=new Float32Array(N),W=0;W<N;W++)X[W]=i[n[W]];var Y=0;for(W=0;W<N;W++)Y+=U[W]*X[W];return Y+.5|0},T._$br=function(t,e,r,i){var s=e._$Q2(t,r),n=t._$vs(),o=t._$Tr();if(e._$zr(n,o,s),s<=0)return i[n[0]];if(1==s)return(a=i[n[0]])+((h=i[n[1]])-a)*(c=o[0]);if(2==s){var a=i[n[0]],h=i[n[1]],l=i[n[2]],u=i[n[3]],c=o[0];return(1-(v=o[1]))*(a+(h-a)*c)+v*(l+(u-l)*c)}if(3==s){var d=i[n[0]],f=i[n[1]],p=i[n[2]],_=i[n[3]],m=i[n[4]],g=i[n[5]],y=i[n[6]],b=i[n[7]],v=(c=o[0],o[1]);return(1-(k=o[2]))*((1-v)*(d+(f-d)*c)+v*(p+(_-p)*c))+k*((1-v)*(m+(g-m)*c)+v*(y+(b-y)*c))}if(4==s){var x=i[n[0]],A=i[n[1]],T=i[n[2]],E=i[n[3]],w=i[n[4]],S=i[n[5]],C=i[n[6]],P=i[n[7]],M=i[n[8]],$=i[n[9]],I=i[n[10]],R=i[n[11]],D=i[n[12]],L=i[n[13]],F=i[n[14]],O=i[n[15]],k=(c=o[0],v=o[1],o[2]),B=o[3];return(1-B)*((1-k)*((1-v)*(x+(A-x)*c)+v*(T+(E-T)*c))+k*((1-v)*(w+(S-w)*c)+v*(C+(P-C)*c)))+B*((1-k)*((1-v)*(M+($-M)*c)+v*(I+(R-I)*c))+k*((1-v)*(D+(L-D)*c)+v*(F+(O-F)*c)))}for(var N=1<<s,U=new Float32Array(N),G=0;G<N;G++){for(var V=G,H=1,z=0;z<s;z++)H*=V%2==0?1-o[z]:o[z],V/=2;U[G]=H}for(var X=new Float32Array(N),W=0;W<N;W++)X[W]=i[n[W]];var Y=0;for(W=0;W<N;W++)Y+=U[W]*X[W];return Y},T._$Vr=function(t,e,r,i,s,n,o,a){var h=e._$Q2(t,r),l=t._$vs(),u=t._$Tr();e._$zr(l,u,h);var c=2*i,d=o;if(h<=0){var f=s[l[0]];if(2==a&&0==o)M._$jT(f,0,n,0,c);else for(var p=0;p<c;)n[d]=f[p++],n[d+1]=f[p++],d+=a}else if(1==h){f=s[l[0]];var _=s[l[1]],m=1-(b=u[0]);for(p=0;p<c;)n[d]=f[p]*m+_[p]*b,++p,n[d+1]=f[p]*m+_[p]*b,++p,d+=a}else if(2==h){f=s[l[0]],_=s[l[1]];var g=s[l[2]],y=s[l[3]],b=u[0],v=(V=1-(D=u[1]))*(m=1-b),x=V*b,A=D*m,T=D*b;for(p=0;p<c;)n[d]=v*f[p]+x*_[p]+A*g[p]+T*y[p],++p,n[d+1]=v*f[p]+x*_[p]+A*g[p]+T*y[p],++p,d+=a}else if(3==h){var E=s[l[0]],w=s[l[1]],S=s[l[2]],C=s[l[3]],P=s[l[4]],$=s[l[5]],I=s[l[6]],R=s[l[7]],D=(b=u[0],u[1]),L=(H=1-(ot=u[2]))*(V=1-D)*(m=1-b),F=H*V*b,O=H*D*m,k=H*D*b,B=ot*V*m,N=ot*V*b,U=ot*D*m,G=ot*D*b;for(p=0;p<c;)n[d]=L*E[p]+F*w[p]+O*S[p]+k*C[p]+B*P[p]+N*$[p]+U*I[p]+G*R[p],++p,n[d+1]=L*E[p]+F*w[p]+O*S[p]+k*C[p]+B*P[p]+N*$[p]+U*I[p]+G*R[p],++p,d+=a}else if(4==h){var V,H,z=s[l[0]],X=s[l[1]],W=s[l[2]],Y=s[l[3]],j=s[l[4]],q=s[l[5]],Z=s[l[6]],Q=s[l[7]],J=s[l[8]],K=s[l[9]],tt=s[l[10]],et=s[l[11]],rt=s[l[12]],it=s[l[13]],st=s[l[14]],nt=s[l[15]],ot=(b=u[0],D=u[1],u[2]),at=u[3],ht=1-at,lt=ht*(H=1-ot)*(V=1-D)*(m=1-b),ut=ht*H*V*b,ct=ht*H*D*m,dt=ht*H*D*b,ft=ht*ot*V*m,pt=ht*ot*V*b,_t=ht*ot*D*m,mt=ht*ot*D*b,gt=at*H*V*m,yt=at*H*V*b,bt=at*H*D*m,vt=at*H*D*b,xt=at*ot*V*m,At=at*ot*V*b,Tt=at*ot*D*m,Et=at*ot*D*b;for(p=0;p<c;)n[d]=lt*z[p]+ut*X[p]+ct*W[p]+dt*Y[p]+ft*j[p]+pt*q[p]+_t*Z[p]+mt*Q[p]+gt*J[p]+yt*K[p]+bt*tt[p]+vt*et[p]+xt*rt[p]+At*it[p]+Tt*st[p]+Et*nt[p],++p,n[d+1]=lt*z[p]+ut*X[p]+ct*W[p]+dt*Y[p]+ft*j[p]+pt*q[p]+_t*Z[p]+mt*Q[p]+gt*J[p]+yt*K[p]+bt*tt[p]+vt*et[p]+xt*rt[p]+At*it[p]+Tt*st[p]+Et*nt[p],++p,d+=a}else{for(var wt=1<<h,St=new Float32Array(wt),Ct=0;Ct<wt;Ct++){for(var Pt=Ct,Mt=1,$t=0;$t<h;$t++)Mt*=Pt%2==0?1-u[$t]:u[$t],Pt/=2;St[Ct]=Mt}for(var It=new Float32Array(wt),Rt=0;Rt<wt;Rt++)It[Rt]=s[l[Rt]];for(p=0;p<c;){var Dt=0,Lt=0,Ft=p+1;for(Rt=0;Rt<wt;Rt++)Dt+=St[Rt]*It[Rt][p],Lt+=St[Rt]*It[Rt][Ft];p+=2,n[d]=Dt,n[d+1]=Lt,d+=a}}},E.prototype._$HT=function(t,e){this.x=t,this.y=e},E.prototype._$HT=function(t){this.x=t.x,this.y=t.y},w._$ur=-2,w._$ES=500,w._$wb=2,w._$8S=3,w._$52=w._$ES,w._$R2=w._$ES,w._$or=function(){return w._$52},w._$Pr=function(){return w._$R2},w.prototype.convertClipIDForV2_11=function(t){var e=[];return null==t||0==t.length?null:/,/.test(t)?e=t.id.split(","):(e.push(t.id),e)},w.prototype._$F0=function(t){this._$gP=t._$nP(),this._$dr=t._$nP(),this._$GS=t._$nP(),this._$qb=t._$6L(),this._$Lb=t._$cS(),this._$mS=t._$Tb(),t.getFormatVersion()>=U._$T7?(this.clipID=t._$nP(),this.clipIDList=this.convertClipIDForV2_11(this.clipID)):this.clipIDList=[],this._$MS(this._$Lb)},w.prototype.getClipIDList=function(){return this.clipIDList},w.prototype.init=function(t){},w.prototype._$Nr=function(t,e){if(e._$IS[0]=!1,e._$Us=T._$Z2(t,this._$GS,e._$IS,this._$Lb),ht._$Zs);else if(e._$IS[0])return;e._$7s=T._$br(t,this._$GS,e._$IS,this._$mS)},w.prototype._$2b=function(t,e){},w.prototype.getDrawDataID=function(){return this._$gP},w.prototype._$j2=function(t){this._$gP=t},w.prototype.getOpacity=function(t,e){return e._$7s},w.prototype._$zS=function(t,e){return e._$Us},w.prototype._$MS=function(t){for(var e=t.length-1;e>=0;--e){var r=t[e];r<w._$52?w._$52=r:r>w._$R2&&(w._$R2=r)}},w.prototype.getTargetBaseDataID=function(){return this._$dr},w.prototype._$gs=function(t){this._$dr=t},w.prototype._$32=function(){return null!=this._$dr&&this._$dr!=yt._$2o()},w.prototype.preDraw=function(t,e,r){},w.prototype.draw=function(t,e,r){},w.prototype.getType=function(){},w.prototype._$B2=function(t,e,r){},S._$ps=32,S.CLIPPING_PROCESS_NONE=0,S.CLIPPING_PROCESS_OVERWRITE_ALPHA=1,S.CLIPPING_PROCESS_MULTIPLY_ALPHA=2,S.CLIPPING_PROCESS_DRAW=3,S.CLIPPING_PROCESS_CLEAR_ALPHA=4,S.prototype.setChannelFlagAsColor=function(t,e){this.CHANNEL_COLORS[t]=e},S.prototype.getChannelFlagAsColor=function(t){return this.CHANNEL_COLORS[t]},S.prototype._$ZT=function(){},S.prototype._$Uo=function(t,e,r,i,s,n,o){},S.prototype._$Rs=function(){return-1},S.prototype._$Ds=function(t){},S.prototype.setBaseColor=function(t,e,r,i){t<0?t=0:t>1&&(t=1),e<0?e=0:e>1&&(e=1),r<0?r=0:r>1&&(r=1),i<0?i=0:i>1&&(i=1),this._$lT=t,this._$C0=e,this._$tT=r,this._$WL=i},S.prototype._$WP=function(t){this.culling=t},S.prototype.setMatrix=function(t){for(var e=0;e<16;e++)this.matrix4x4[e]=t[e]},S.prototype._$IT=function(){return this.matrix4x4},S.prototype.setPremultipliedAlpha=function(t){this.premultipliedAlpha=t},S.prototype.isPremultipliedAlpha=function(){return this.premultipliedAlpha},S.prototype.setAnisotropy=function(t){this.anisotropy=t},S.prototype.getAnisotropy=function(){return this.anisotropy},S.prototype.getClippingProcess=function(){return this.clippingProcess},S.prototype.setClippingProcess=function(t){this.clippingProcess=t},S.prototype.setClipBufPre_clipContextForMask=function(t){this.clipBufPre_clipContextMask=t},S.prototype.getClipBufPre_clipContextMask=function(){return this.clipBufPre_clipContextMask},S.prototype.setClipBufPre_clipContextForDraw=function(t){this.clipBufPre_clipContextDraw=t},S.prototype.getClipBufPre_clipContextDraw=function(){return this.clipBufPre_clipContextDraw},P._$ur=-2,P._$c2=1,P._$_b=2,P.prototype._$F0=function(t){this._$kP=t._$nP(),this._$dr=t._$nP()},P.prototype.readV2_opacity=function(t){t.getFormatVersion()>=U.LIVE2D_FORMAT_VERSION_V2_10_SDK2&&(this._$mS=t._$Tb())},P.prototype.init=function(t){},P.prototype._$Nr=function(t,e){},P.prototype.interpolateOpacity=function(t,e,r,i){null==this._$mS?r.setInterpolatedOpacity(1):r.setInterpolatedOpacity(T._$br(t,e,i,this._$mS))},P.prototype._$2b=function(t,e){},P.prototype._$nb=function(t,e,r,i,s,n,o){},P.prototype.getType=function(){},P.prototype._$gs=function(t){this._$dr=t},P.prototype._$a2=function(t){this._$kP=t},P.prototype.getTargetBaseDataID=function(){return this._$dr},P.prototype.getBaseDataID=function(){return this._$kP},P.prototype._$32=function(){return null!=this._$dr&&this._$dr!=yt._$2o()},M._$W2=0,M._$CS=M._$W2,M._$Mo=function(){return!0},M._$XP=function(t){try{for(var e=getTimeMSec();getTimeMSec()-e<t;);}catch(t){t._$Rb()}},M.getUserTimeMSec=function(){return M._$CS==M._$W2?M.getSystemTimeMSec():M._$CS},M.setUserTimeMSec=function(t){M._$CS=t},M.updateUserTimeMSec=function(){return M._$CS=M.getSystemTimeMSec()},M.getTimeMSec=function(){return(new Date).getTime()},M.getSystemTimeMSec=function(){return(new Date).getTime()},M._$Q=function(t){},M._$jT=function(t,e,r,i,s){for(var n=0;n<s;n++)r[i+n]=t[e+n]},$._$ds=-2,$.prototype._$F0=function(t){this._$wL=t._$nP(),this._$VP=t._$6L(),this._$GP=t._$nP()},$.prototype.getParamIndex=function(t){return this._$2r!=t&&(this._$8o=$._$ds),this._$8o},$.prototype._$Pb=function(t,e){this._$8o=t,this._$2r=e},$.prototype.getParamID=function(){return this._$wL},$.prototype._$yP=function(t){this._$wL=t},$.prototype._$N2=function(){return this._$VP},$.prototype._$d2=function(){return this._$GP},$.prototype._$t2=function(t,e){this._$VP=t,this._$GP=e},$.prototype._$Lr=function(){return this._$O2},$.prototype._$wr=function(t){this._$O2=t},$.prototype._$SL=function(){return this._$ri},$.prototype._$AL=function(t){this._$ri=t},I.startsWith=function(t,e,r){var i=e+r.length;if(i>=t.length)return!1;for(var s=e;s<i;s++)if(I.getChar(t,s)!=r.charAt(s-e))return!1;return!0},I.getChar=function(t,e){return String.fromCharCode(t.getUint8(e))},I.createString=function(t,e,r){for(var i=new ArrayBuffer(2*r),s=new Uint16Array(i),n=0;n<r;n++)s[n]=t.getUint8(e+n);return String.fromCharCode.apply(null,s)},I._$LS=function(t,e,r,i){t instanceof ArrayBuffer&&(t=new DataView(t));var s=r,n=!1,o=!1,a=0,h=I.getChar(t,s);"-"==h&&(n=!0,s++);for(var l=!1;s<e;s++){switch(h=I.getChar(t,s)){case"0":a*=10;break;case"1":a=10*a+1;break;case"2":a=10*a+2;break;case"3":a=10*a+3;break;case"4":a=10*a+4;break;case"5":a=10*a+5;break;case"6":a=10*a+6;break;case"7":a=10*a+7;break;case"8":a=10*a+8;break;case"9":a=10*a+9;break;case".":o=!0,s++,l=!0;break;default:l=!0}if(l)break}if(o)for(var u=.1,c=!1;s<e;s++){switch(h=I.getChar(t,s)){case"0":break;case"1":a+=1*u;break;case"2":a+=2*u;break;case"3":a+=3*u;break;case"4":a+=4*u;break;case"5":a+=5*u;break;case"6":a+=6*u;break;case"7":a+=7*u;break;case"8":a+=8*u;break;case"9":a+=9*u;break;default:c=!0}if(u*=.1,c)break}return n&&(a=-a),i[0]=s,a},R.prototype._$zP=function(){this._$Ob=new Array},R.prototype._$F0=function(t){this._$Ob=t._$nP()},R.prototype._$Ur=function(t){if(t._$WS())return!0;for(var e=t._$v2(),r=this._$Ob.length-1;r>=0;--r){var i=this._$Ob[r].getParamIndex(e);if(i==$._$ds&&(i=t.getParamIndex(this._$Ob[r].getParamID())),t._$Xb(i))return!0}return!1},R.prototype._$Q2=function(t,e){for(var r,i,s=this._$Ob.length,n=t._$v2(),o=0,a=0;a<s;a++){var h=this._$Ob[a];if((r=h.getParamIndex(n))==$._$ds&&(r=t.getParamIndex(h.getParamID()),h._$Pb(r,n)),r<0)throw new Exception("err 23242 : "+h.getParamID());var l=r<0?0:t.getParamFloat(r);i=h._$N2();var u,c,d=h._$d2(),f=-1,p=0;if(i<1);else if(1==i)(u=d[0])-N._$J<l&&l<u+N._$J?(f=0,p=0):(f=0,e[0]=!0);else if(l<(u=d[0])-N._$J)f=0,e[0]=!0;else if(l<u+N._$J)f=0;else{for(var _=!1,m=1;m<i;++m){if(l<(c=d[m])+N._$J){c-N._$J<l?f=m:(f=m-1,p=(l-u)/(c-u),o++),_=!0;break}u=c}_||(f=i-1,p=0,e[0]=!0)}h._$wr(f),h._$AL(p)}return o},R.prototype._$zr=function(t,e,r){var i=1<<r;i+1>N._$Qb&&console.log("err 23245\n");for(var s=this._$Ob.length,n=1,o=1,a=0,h=0;h<i;++h)t[h]=0;for(var l=0;l<s;++l){var u=this._$Ob[l];if(0==u._$SL()){if((c=u._$Lr()*n)<0&&ht._$3T)throw new Exception("err 23246");for(h=0;h<i;++h)t[h]+=c}else{var c=n*u._$Lr(),d=n*(u._$Lr()+1);for(h=0;h<i;++h)t[h]+=(h/o|0)%2==0?c:d;e[a++]=u._$SL(),o*=2}n*=u._$N2()}t[i]=65535,e[a]=-1},R.prototype._$h2=function(t,e,r){for(var i=new Float32Array(e),s=0;s<e;++s)i[s]=r[s];var n=new $;n._$yP(t),n._$t2(e,i),this._$Ob.push(n)},R.prototype._$J2=function(t){for(var e=t,r=this._$Ob.length,i=0;i<r;++i){var s=this._$Ob[i],n=s._$N2(),o=e%s._$N2(),a=s._$d2()[o];console.log("%s[%d]=%7.2f / ",s.getParamID(),o,a),e/=n}console.log("\n")},R.prototype.getParamCount=function(){return this._$Ob.length},R.prototype._$zs=function(){return this._$Ob},D.prototype.identity=function(){for(var t=0;t<16;t++)this.m[t]=t%5==0?1:0},D.prototype.getArray=function(){return this.m},D.prototype.getCopyMatrix=function(){return new Float32Array(this.m)},D.prototype.setMatrix=function(t){if(null!=t&&16==t.length)for(var e=0;e<16;e++)this.m[e]=t[e]},D.prototype.mult=function(t,e,r){return null==e?null:(this==e?this.mult_safe(this.m,t.m,e.m,r):this.mult_fast(this.m,t.m,e.m,r),e)},D.prototype.mult_safe=function(t,e,r,i){if(t==r){var s=new Array(16);this.mult_fast(t,e,s,i);for(var n=15;n>=0;--n)r[n]=s[n]}else this.mult_fast(t,e,r,i)},D.prototype.mult_fast=function(t,e,r,i){i?(r[0]=t[0]*e[0]+t[4]*e[1]+t[8]*e[2],r[4]=t[0]*e[4]+t[4]*e[5]+t[8]*e[6],r[8]=t[0]*e[8]+t[4]*e[9]+t[8]*e[10],r[12]=t[0]*e[12]+t[4]*e[13]+t[8]*e[14]+t[12],r[1]=t[1]*e[0]+t[5]*e[1]+t[9]*e[2],r[5]=t[1]*e[4]+t[5]*e[5]+t[9]*e[6],r[9]=t[1]*e[8]+t[5]*e[9]+t[9]*e[10],r[13]=t[1]*e[12]+t[5]*e[13]+t[9]*e[14]+t[13],r[2]=t[2]*e[0]+t[6]*e[1]+t[10]*e[2],r[6]=t[2]*e[4]+t[6]*e[5]+t[10]*e[6],r[10]=t[2]*e[8]+t[6]*e[9]+t[10]*e[10],r[14]=t[2]*e[12]+t[6]*e[13]+t[10]*e[14]+t[14],r[3]=r[7]=r[11]=0,r[15]=1):(r[0]=t[0]*e[0]+t[4]*e[1]+t[8]*e[2]+t[12]*e[3],r[4]=t[0]*e[4]+t[4]*e[5]+t[8]*e[6]+t[12]*e[7],r[8]=t[0]*e[8]+t[4]*e[9]+t[8]*e[10]+t[12]*e[11],r[12]=t[0]*e[12]+t[4]*e[13]+t[8]*e[14]+t[12]*e[15],r[1]=t[1]*e[0]+t[5]*e[1]+t[9]*e[2]+t[13]*e[3],r[5]=t[1]*e[4]+t[5]*e[5]+t[9]*e[6]+t[13]*e[7],r[9]=t[1]*e[8]+t[5]*e[9]+t[9]*e[10]+t[13]*e[11],r[13]=t[1]*e[12]+t[5]*e[13]+t[9]*e[14]+t[13]*e[15],r[2]=t[2]*e[0]+t[6]*e[1]+t[10]*e[2]+t[14]*e[3],r[6]=t[2]*e[4]+t[6]*e[5]+t[10]*e[6]+t[14]*e[7],r[10]=t[2]*e[8]+t[6]*e[9]+t[10]*e[10]+t[14]*e[11],r[14]=t[2]*e[12]+t[6]*e[13]+t[10]*e[14]+t[14]*e[15],r[3]=t[3]*e[0]+t[7]*e[1]+t[11]*e[2]+t[15]*e[3],r[7]=t[3]*e[4]+t[7]*e[5]+t[11]*e[6]+t[15]*e[7],r[11]=t[3]*e[8]+t[7]*e[9]+t[11]*e[10]+t[15]*e[11],r[15]=t[3]*e[12]+t[7]*e[13]+t[11]*e[14]+t[15]*e[15])},D.prototype.translate=function(t,e,r){this.m[12]=this.m[0]*t+this.m[4]*e+this.m[8]*r+this.m[12],this.m[13]=this.m[1]*t+this.m[5]*e+this.m[9]*r+this.m[13],this.m[14]=this.m[2]*t+this.m[6]*e+this.m[10]*r+this.m[14],this.m[15]=this.m[3]*t+this.m[7]*e+this.m[11]*r+this.m[15]},D.prototype.scale=function(t,e,r){this.m[0]*=t,this.m[4]*=e,this.m[8]*=r,this.m[1]*=t,this.m[5]*=e,this.m[9]*=r,this.m[2]*=t,this.m[6]*=e,this.m[10]*=r,this.m[3]*=t,this.m[7]*=e,this.m[11]*=r},D.prototype.rotateX=function(t){var e=Et.fcos(t),r=Et._$9(t),i=this.m[4];this.m[4]=i*e+this.m[8]*r,this.m[8]=i*-r+this.m[8]*e,i=this.m[5],this.m[5]=i*e+this.m[9]*r,this.m[9]=i*-r+this.m[9]*e,i=this.m[6],this.m[6]=i*e+this.m[10]*r,this.m[10]=i*-r+this.m[10]*e,i=this.m[7],this.m[7]=i*e+this.m[11]*r,this.m[11]=i*-r+this.m[11]*e},D.prototype.rotateY=function(t){var e=Et.fcos(t),r=Et._$9(t),i=this.m[0];this.m[0]=i*e+this.m[8]*-r,this.m[8]=i*r+this.m[8]*e,i=this.m[1],this.m[1]=i*e+this.m[9]*-r,this.m[9]=i*r+this.m[9]*e,i=m[2],this.m[2]=i*e+this.m[10]*-r,this.m[10]=i*r+this.m[10]*e,i=m[3],this.m[3]=i*e+this.m[11]*-r,this.m[11]=i*r+this.m[11]*e},D.prototype.rotateZ=function(t){var e=Et.fcos(t),r=Et._$9(t),i=this.m[0];this.m[0]=i*e+this.m[4]*r,this.m[4]=i*-r+this.m[4]*e,i=this.m[1],this.m[1]=i*e+this.m[5]*r,this.m[5]=i*-r+this.m[5]*e,i=this.m[2],this.m[2]=i*e+this.m[6]*r,this.m[6]=i*-r+this.m[6]*e,i=this.m[3],this.m[3]=i*e+this.m[7]*r,this.m[7]=i*-r+this.m[7]*e},L.prototype=new it,L._$tP=new Object,L._$27=function(){L._$tP.clear()},L.getID=function(t){var e=L._$tP[t];return null==e&&(e=new L(t),L._$tP[t]=e),e},L.prototype._$3s=function(){return new L},F._$kS=-1,F._$pS=0,F._$hb=1,F.STATE_IDENTITY=0,F._$gb=1,F._$fo=2,F._$go=4,F.prototype.transform=function(t,e,r){var i,s,n,o,a,h,l=0,u=0;switch(this._$hi){default:return;case F._$go|F._$fo|F._$gb:for(i=this._$7,s=this._$H,n=this._$k,o=this._$f,a=this._$g,h=this._$w;--r>=0;){var c=t[l++],d=t[l++];e[u++]=i*c+s*d+n,e[u++]=o*c+a*d+h}return;case F._$go|F._$fo:for(i=this._$7,s=this._$H,o=this._$f,a=this._$g;--r>=0;){c=t[l++],d=t[l++];e[u++]=i*c+s*d,e[u++]=o*c+a*d}return;case F._$go|F._$gb:for(s=this._$H,n=this._$k,o=this._$f,h=this._$w;--r>=0;){c=t[l++];e[u++]=s*t[l++]+n,e[u++]=o*c+h}return;case F._$go:for(s=this._$H,o=this._$f;--r>=0;){c=t[l++];e[u++]=s*t[l++],e[u++]=o*c}return;case F._$fo|F._$gb:for(i=this._$7,n=this._$k,a=this._$g,h=this._$w;--r>=0;)e[u++]=i*t[l++]+n,e[u++]=a*t[l++]+h;return;case F._$fo:for(i=this._$7,a=this._$g;--r>=0;)e[u++]=i*t[l++],e[u++]=a*t[l++];return;case F._$gb:for(n=this._$k,h=this._$w;--r>=0;)e[u++]=t[l++]+n,e[u++]=t[l++]+h;return;case F.STATE_IDENTITY:return void(t==e&&l==u||M._$jT(t,l,e,u,2*r))}},F.prototype.update=function(){0==this._$H&&0==this._$f?1==this._$7&&1==this._$g?0==this._$k&&0==this._$w?(this._$hi=F.STATE_IDENTITY,this._$Z=F._$pS):(this._$hi=F._$gb,this._$Z=F._$hb):0==this._$k&&0==this._$w?(this._$hi=F._$fo,this._$Z=F._$kS):(this._$hi=F._$fo|F._$gb,this._$Z=F._$kS):0==this._$7&&0==this._$g?0==this._$k&&0==this._$w?(this._$hi=F._$go,this._$Z=F._$kS):(this._$hi=F._$go|F._$gb,this._$Z=F._$kS):0==this._$k&&0==this._$w?(this._$hi=F._$go|F._$fo,this._$Z=F._$kS):(this._$hi=F._$go|F._$fo|F._$gb,this._$Z=F._$kS)},F.prototype._$RT=function(t){this._$IT(t);var e=t[0],r=t[2],i=t[1],s=t[3],n=Math.sqrt(e*e+i*i),o=e*s-r*i;0==n?ht._$so&&console.log("affine._$RT() / rt==0"):(t[0]=n,t[1]=o/n,t[2]=(i*s+e*r)/o,t[3]=Math.atan2(i,e))},F.prototype._$ho=function(t,e,r,i){var s=new Float32Array(6),n=new Float32Array(6);t._$RT(s),e._$RT(n);var o=new Float32Array(6);o[0]=s[0]+(n[0]-s[0])*r,o[1]=s[1]+(n[1]-s[1])*r,o[2]=s[2]+(n[2]-s[2])*r,o[3]=s[3]+(n[3]-s[3])*r,o[4]=s[4]+(n[4]-s[4])*r,o[5]=s[5]+(n[5]-s[5])*r,i._$CT(o)},F.prototype._$CT=function(t){var e=Math.cos(t[3]),r=Math.sin(t[3]);this._$7=t[0]*e,this._$f=t[0]*r,this._$H=t[1]*(t[2]*e-r),this._$g=t[1]*(t[2]*r+e),this._$k=t[4],this._$w=t[5],this.update()},F.prototype._$IT=function(t){t[0]=this._$7,t[1]=this._$f,t[2]=this._$H,t[3]=this._$g,t[4]=this._$k,t[5]=this._$w},O.prototype=new o,O._$cs="VISIBLE:",O._$ar="LAYOUT:",O._$Co=0,O._$D2=[],O._$1T=1,O.loadMotion=function(t){var e=new O,r=[0],i=t.length;e._$yT=0;for(var s=0;s<i;++s){var n=255&t[s];if("\n"!=n&&"\r"!=n)if("#"!=n)if("$"!=n){if("a"<=n&&n<="z"||"A"<=n&&n<="Z"||"_"==n){for(l=s,u=-1;s<i&&("\r"!=(n=255&t[s])&&"\n"!=n);++s)if("="==n){u=s;break}if(u>=0){var o=new B;I.startsWith(t,l,O._$cs)?(o._$RP=B._$hs,o._$4P=new String(t,l,u-l)):I.startsWith(t,l,O._$ar)?(o._$4P=new String(t,l+7,u-l-7),I.startsWith(t,l+7,"ANCHOR_X")?o._$RP=B._$xs:I.startsWith(t,l+7,"ANCHOR_Y")?o._$RP=B._$us:I.startsWith(t,l+7,"SCALE_X")?o._$RP=B._$qs:I.startsWith(t,l+7,"SCALE_Y")?o._$RP=B._$Ys:I.startsWith(t,l+7,"X")?o._$RP=B._$ws:I.startsWith(t,l+7,"Y")&&(o._$RP=B._$Ns)):(o._$RP=B._$Fr,o._$4P=new String(t,l,u-l)),e.motions.push(o);var a=0;for(O._$D2.clear(),s=u+1;s<i&&("\r"!=(n=255&t[s])&&"\n"!=n);++s)if(","!=n&&" "!=n&&"\t"!=n){d=I._$LS(t,i,s,r);if(r[0]>0){O._$D2.push(d),a++;var h=r[0];if(h<s){console.log("_$n0 _$hi . @Live2DMotion loadMotion()\n");break}s=h}}o._$I0=O._$D2._$BL(),a>e._$yT&&(e._$yT=a)}}}else{for(var l=s,u=-1;s<i&&("\r"!=(n=255&t[s])&&"\n"!=n);++s)if("="==n){u=s;break}var c=!1;if(u>=0)for(u==l+4&&"f"==t[l+1]&&"p"==t[l+2]&&"s"==t[l+3]&&(c=!0),s=u+1;s<i&&("\r"!=(n=255&t[s])&&"\n"!=n);++s)if(","!=n&&" "!=n&&"\t"!=n){var d=I._$LS(t,i,s,r);r[0]>0&&c&&5<d&&d<121&&(e._$D0=d),s=r[0]}for(;s<i&&("\n"!=t[s]&&"\r"!=t[s]);++s);}else for(;s<i&&("\n"!=t[s]&&"\r"!=t[s]);++s);}return e._$AS=1e3*e._$yT/e._$D0|0,e},O.prototype.getDurationMSec=function(){return this._$AS},O.prototype.dump=function(){for(var t=0;t<this.motions.length;t++){var e=this.motions[t];console.log("_$wL[%s] [%d]. ",e._$4P,e._$I0.length);for(var r=0;r<e._$I0.length&&r<10;r++)console.log("%5.2f ,",e._$I0[r]);console.log("\n")}},O.prototype.updateParamExe=function(t,e,r,i){for(var s=(e-i._$z2)*this._$D0/1e3,n=0|s,o=s-n,a=0;a<this.motions.length;a++){var h=this.motions[a],l=h._$I0.length,u=h._$4P;if(h._$RP==B._$hs){var c=h._$I0[n>=l?l-1:n];t.setParamFloat(u,c)}else if(B._$ws<=h._$RP&&h._$RP<=B._$Ys);else{var d=t.getParamFloat(u),f=h._$I0[n>=l?l-1:n],p=d+(f+(h._$I0[n+1>=l?l-1:n+1]-f)*o-d)*r;t.setParamFloat(u,p)}}n>=this._$yT&&(this._$E?(i._$z2=e,this.loopFadeIn&&(i._$bs=e)):i._$9L=!0)},O.prototype._$r0=function(){return this._$E},O.prototype._$aL=function(t){this._$E=t},O.prototype.isLoopFadeIn=function(){return this.loopFadeIn},O.prototype.setLoopFadeIn=function(t){this.loopFadeIn=t},k.prototype.clear=function(){this.size=0},k.prototype.add=function(t){if(this._$P.length<=this.size){var e=new Float32Array(2*this.size);M._$jT(this._$P,0,e,0,this.size),this._$P=e}this._$P[this.size++]=t},k.prototype._$BL=function(){var t=new Float32Array(this.size);return M._$jT(this._$P,0,t,0,this.size),t},B._$Fr=0,B._$hs=1,B._$ws=100,B._$Ns=101,B._$xs=102,B._$us=103,B._$qs=104,B._$Ys=105,N._$Ms=1,N._$Qs=2,N._$i2=0,N._$No=2,N._$do=N._$Ms,N._$Ls=!0,N._$1r=5,N._$Qb=65,N._$J=1e-4,N._$FT=.001,N._$Ss=3,U._$o7=6,U._$S7=7,U._$s7=8,U._$77=9,U.LIVE2D_FORMAT_VERSION_V2_10_SDK2=10,U.LIVE2D_FORMAT_VERSION_V2_11_SDK2_1=11,U._$T7=U.LIVE2D_FORMAT_VERSION_V2_11_SDK2_1,U._$Is=-2004318072,U._$h0=0,U._$4L=23,U._$7P=33,U._$uT=function(t){console.log("_$bo :: _$6 _$mo _$E0 : %d\n",t)},U._$9o=function(t){if(t<40)return U._$uT(t),null;if(t<50)return U._$uT(t),null;if(t<60)return U._$uT(t),null;if(t<100)switch(t){case 65:return new K;case 66:return new R;case 67:return new $;case 68:return new W;case 69:return new v;case 70:return new ct;default:return U._$uT(t),null}else if(t<150)switch(t){case 131:return new ot;case 133:return new et;case 136:return new d;case 137:return new st;case 142:return new q}return U._$uT(t),null},G._$HP=0,G._$_0=!0,G._$V2=-1,G._$W0=-1,G._$jr=!1,G._$ZS=!0,G._$tr=-1e6,G._$lr=1e6,G._$is=32,G._$e=!1,G.prototype.getDrawDataIndex=function(t){for(var e=this._$aS.length-1;e>=0;--e)if(null!=this._$aS[e]&&this._$aS[e].getDrawDataID()==t)return e;return-1},G.prototype.getDrawData=function(t){if(t instanceof L){if(null==this._$Bo){this._$Bo=new Object;for(var e=this._$aS.length,r=0;r<e;r++){var i=this._$aS[r],s=i.getDrawDataID();null!=s&&(this._$Bo[s]=i)}}return this._$Bo[id]}return t<this._$aS.length?this._$aS[t]:null},G.prototype.release=function(){this._$3S.clear(),this._$aS.clear(),this._$F2.clear(),null!=this._$Bo&&this._$Bo.clear(),this._$db.clear(),this._$8b.clear(),this._$Hr.clear()},G.prototype.init=function(){this._$co++,this._$F2.length>0&&this.release();for(var t=this._$Ri.getModelImpl(),e=t._$Xr(),i=e.length,s=new Array,n=new Array,o=0;o<i;++o){var a=e[o];this._$F2.push(a),this._$Hr.push(a.init(this));for(var h=a.getBaseData(),l=h.length,u=0;u<l;++u)s.push(h[u]);for(u=0;u<l;++u){var c=h[u].init(this);c._$l2(o),n.push(c)}var d=a.getDrawData(),f=d.length;for(u=0;u<f;++u){var p=d[u],_=p.init(this);_._$IP=o,this._$aS.push(p),this._$8b.push(_)}}for(var m=s.length,g=yt._$2o();;){var y=!1;for(o=0;o<m;++o){var b=s[o];if(null!=b){var v=b.getTargetBaseDataID();(null==v||v==g||this.getBaseDataIndex(v)>=0)&&(this._$3S.push(b),this._$db.push(n[o]),s[o]=null,y=!0)}}if(!y)break}var x=t._$E2();if(null!=x){var A=x._$1s();if(null!=A){var T=A.length;for(o=0;o<T;++o){var E=A[o];null!=E&&this._$02(E.getParamID(),E.getDefaultValue(),E.getMinValue(),E.getMaxValue())}}}this.clipManager=new r(this.dp_webgl),this.clipManager.init(this,this._$aS,this._$8b),this._$QT=!0},G.prototype.update=function(){G._$e&&a.start("_$zL");for(var t=this._$_2.length,e=0;e<t;e++)this._$_2[e]!=this._$vr[e]&&(this._$Js[e]=G._$ZS,this._$vr[e]=this._$_2[e]);var r=this._$3S.length,i=this._$aS.length,s=j._$or(),n=j._$Pr()-s+1;(null==this._$Ws||this._$Ws.length<n)&&(this._$Ws=new Int16Array(n),this._$Vs=new Int16Array(n));for(e=0;e<n;e++)this._$Ws[e]=G._$V2,this._$Vs[e]=G._$V2;(null==this._$Er||this._$Er.length<i)&&(this._$Er=new Int16Array(i));for(e=0;e<i;e++)this._$Er[e]=G._$W0;G._$e&&a.dump("_$zL"),G._$e&&a.start("_$UL");for(var o=null,h=0;h<r;++h){var l=this._$3S[h],u=this._$db[h];try{l._$Nr(this,u),l._$2b(this,u)}catch(t){null==o&&(o=t)}}null!=o&&G._$_0&&a._$Rb(o),G._$e&&a.dump("_$UL"),G._$e&&a.start("_$DL");for(var c=null,d=0;d<i;++d){var f=this._$aS[d],p=this._$8b[d];try{if(f._$Nr(this,p),p._$u2())continue;f._$2b(this,p);var _,m=Math.floor(f._$zS(this,p)-s);try{_=this._$Vs[m]}catch(t){console.log("_$li :: %s / %s \t\t\t\t@@_$fS\n",t.toString(),f.getDrawDataID().toString()),m=Math.floor(f._$zS(this,p)-s);continue}_==G._$V2?this._$Ws[m]=d:this._$Er[_]=d,this._$Vs[m]=d}catch(t){null==c&&(c=t,ht._$sT(ht._$H7))}}null!=c&&G._$_0&&a._$Rb(c),G._$e&&a.dump("_$DL"),G._$e&&a.start("_$eL");for(e=this._$Js.length-1;e>=0;e--)this._$Js[e]=G._$jr;return this._$QT=!1,G._$e&&a.dump("_$eL"),!1},G.prototype.preDraw=function(t){null!=this.clipManager&&(t._$ZT(),this.clipManager.setupClip(this,t))},G.prototype.draw=function(t){if(null!=this._$Ws){var e=this._$Ws.length;t._$ZT();for(var r=0;r<e;++r){var i=this._$Ws[r];if(i!=G._$V2)for(;;){var s=this._$aS[i],n=this._$8b[i];if(n._$yo()){var o=n._$IP,h=this._$Hr[o];n._$VS=h.getPartsOpacity(),s.draw(t,this,n)}var l=this._$Er[i];if(l<=i||l==G._$W0)break;i=l}}}else a._$li("call _$Ri.update() before _$Ri.draw() ")},G.prototype.getParamIndex=function(t){for(var e=this._$pb.length-1;e>=0;--e)if(this._$pb[e]==t)return e;return this._$02(t,0,G._$tr,G._$lr)},G.prototype._$BS=function(t){return this.getBaseDataIndex(t)},G.prototype.getBaseDataIndex=function(t){for(var e=this._$3S.length-1;e>=0;--e)if(null!=this._$3S[e]&&this._$3S[e].getBaseDataID()==t)return e;return-1},G.prototype._$UT=function(t,e){var r=new Float32Array(e);return M._$jT(t,0,r,0,t.length),r},G.prototype._$02=function(t,e,r,i){if(this._$qo>=this._$pb.length){var s=this._$pb.length,n=new Array(2*s);M._$jT(this._$pb,0,n,0,s),this._$pb=n,this._$_2=this._$UT(this._$_2,2*s),this._$vr=this._$UT(this._$vr,2*s),this._$Rr=this._$UT(this._$Rr,2*s),this._$Or=this._$UT(this._$Or,2*s);var o=new Array;M._$jT(this._$Js,0,o,0,s),this._$Js=o}return this._$pb[this._$qo]=t,this._$_2[this._$qo]=e,this._$vr[this._$qo]=e,this._$Rr[this._$qo]=r,this._$Or[this._$qo]=i,this._$Js[this._$qo]=G._$ZS,this._$qo++},G.prototype._$Zo=function(t,e){this._$3S[t]=e},G.prototype.setParamFloat=function(t,e){e<this._$Rr[t]&&(e=this._$Rr[t]),e>this._$Or[t]&&(e=this._$Or[t]),this._$_2[t]=e},G.prototype.loadParam=function(){var t=this._$_2.length;t>this._$fs.length&&(t=this._$fs.length),M._$jT(this._$fs,0,this._$_2,0,t)},G.prototype.saveParam=function(){var t=this._$_2.length;t>this._$fs.length&&(this._$fs=new Float32Array(t)),M._$jT(this._$_2,0,this._$fs,0,t)},G.prototype._$v2=function(){return this._$co},G.prototype._$WS=function(){return this._$QT},G.prototype._$Xb=function(t){return this._$Js[t]==G._$ZS},G.prototype._$vs=function(){return this._$Es},G.prototype._$Tr=function(){return this._$ZP},G.prototype.getBaseData=function(t){return this._$3S[t]},G.prototype.getParamFloat=function(t){return this._$_2[t]},G.prototype.getParamMax=function(t){return this._$Or[t]},G.prototype.getParamMin=function(t){return this._$Rr[t]},G.prototype.setPartsOpacity=function(t,e){this._$Hr[t].setPartsOpacity(e)},G.prototype.getPartsOpacity=function(t){return this._$Hr[t].getPartsOpacity()},G.prototype.getPartsDataIndex=function(t){for(var e=this._$F2.length-1;e>=0;--e)if(null!=this._$F2[e]&&this._$F2[e]._$p2()==t)return e;return-1},G.prototype._$q2=function(t){return this._$db[t]},G.prototype._$C2=function(t){return this._$8b[t]},G.prototype._$Bb=function(t){return this._$Hr[t]},G.prototype._$5s=function(t,e){for(var r=this._$Ws.length,i=t,s=0;s<r;++s){var n=this._$Ws[s];if(n!=G._$V2)for(;;){var o=this._$8b[n];o._$yo()&&(o._$GT()._$B2(this,o,i),i+=e);var a=this._$Er[n];if(a<=n||a==G._$W0)break;n=a}}},G.prototype.setDrawParam=function(t){this.dp_webgl=t},G.prototype.getDrawParam=function(){return this.dp_webgl},V._$0T=function(t){return V._$0T(new _$5(t))},V._$0T=function(t){if(!t.exists())throw new _$ls(t._$3b());for(var e,r=t.length(),i=new Int8Array(r),s=new _$Xs(new _$kb(t),8192),n=0;(e=s.read(i,n,r-n))>0;)n+=e;return i},V._$C=function(t){var e=null,r=null;try{e=t instanceof Array?t:new _$Xs(t,8192),r=new _$js;for(var i,s=new Int8Array(1e3);(i=e.read(s))>0;)r.write(s,0,i);return r._$TS()}finally{null!=t&&t.close(),null!=r&&(r.flush(),r.close())}},H.prototype._$T2=function(){return M.getUserTimeMSec()+Math._$10()*(2*this._$Br-1)},H.prototype._$uo=function(t){this._$Br=t},H.prototype._$QS=function(t,e,r){this._$Dr=t,this._$Cb=e,this._$mr=r},H.prototype._$7T=function(t){var e,r=M.getUserTimeMSec(),i=0;switch(this._$_L){case STATE_CLOSING:(i=(r-this._$bb)/this._$Dr)>=1&&(i=1,this._$_L=z.STATE_CLOSED,this._$bb=r),e=1-i;break;case STATE_CLOSED:(i=(r-this._$bb)/this._$Cb)>=1&&(this._$_L=z.STATE_OPENING,this._$bb=r),e=0;break;case STATE_OPENING:(i=(r-this._$bb)/this._$mr)>=1&&(i=1,this._$_L=z.STATE_INTERVAL,this._$12=this._$T2()),e=i;break;case STATE_INTERVAL:this._$12<r&&(this._$_L=z.STATE_CLOSING,this._$bb=r),e=1;break;case STATE_FIRST:default:this._$_L=z.STATE_INTERVAL,this._$12=this._$T2(),e=1}this._$jo||(e=-e),t.setParamFloat(this._$iL,e),t.setParamFloat(this._$0L,e)};var z=function(){};function X(){t||(S.prototype.constructor.call(this),this._$sb=new Int32Array(X._$As),this._$U2=new Array,this.transform=null,this.gl=null,null==X._$NT&&(X._$NT=X._$9r(256),X._$vS=X._$9r(256),X._$no=X._$vb(256)))}function W(){t||(P.prototype.constructor.call(this),this._$GS=null,this._$Y0=null)}function Y(t){at.prototype.constructor.call(this,t),this._$8r=P._$ur,this._$Yr=null,this._$Wr=null}function j(){t||(w.prototype.constructor.call(this),this._$gP=null,this._$dr=null,this._$GS=null,this._$qb=null,this._$Lb=null,this._$mS=null)}function q(){t||(this._$NL=null,this._$3S=null,this._$aS=null,q._$42++)}function Z(){t||(e.prototype.constructor.call(this),this._$zo=new X)}function Q(){t||(o.prototype.constructor.call(this),this.motions=new Array,this._$o2=null,this._$7r=Q._$Co++,this._$D0=30,this._$yT=0,this._$E=!1,this.loopFadeIn=!0,this._$rr=-1,this._$eP=0)}function J(t,e){return String.fromCharCode(t.getUint8(e))}function k(){this._$P=new Float32Array(100),this.size=0}function B(){this._$4P=null,this._$I0=null,this._$RP=null}function K(){t||(P.prototype.constructor.call(this),this._$o=0,this._$A=0,this._$GS=null,this._$Eo=null)}function tt(t){at.prototype.constructor.call(this,t),this._$8r=P._$ur,this._$Cr=null,this._$hr=null}function et(){t||(this.visible=!0,this._$g0=!1,this._$NL=null,this._$3S=null,this._$aS=null,et._$42++)}function rt(t){this._$VS=null,this._$e0=null,this._$e0=t}function it(e){t||(this.id=e)}function st(){t||(this._$4S=null)}function nt(t,e){this.canvas=t,this.context=e,this.viewport=new Array(0,0,t.width,t.height),this._$6r=1,this._$xP=0,this._$3r=1,this._$uP=0,this._$Qo=-1,this.cacheImages={}}function ot(){t||(this._$TT=null,this._$LT=null,this._$FS=null,this._$wL=null)}function at(e){t||(this._$e0=null,this._$IP=null,this._$JS=!1,this._$AT=!0,this._$e0=e,this.totalScale=1,this._$7s=1,this.totalOpacity=1)}function ht(){}function lt(){}function ut(e){t||(this._$ib=e)}function ct(){t||(j.prototype.constructor.call(this),this._$LP=-1,this._$d0=0,this._$Yo=0,this._$JP=null,this._$5P=null,this._$BP=null,this._$Eo=null,this._$Qi=null,this._$6s=ct._$ms,this.culling=!0,this.gl_cacheImage=null,this.instanceNo=ct._$42++)}function dt(t){wt.prototype.constructor.call(this,t),this._$8r=j._$ur,this._$Cr=null,this._$hr=null}function ft(){t||(this.x=null,this.y=null)}function pt(r){t||(e.prototype.constructor.call(this),this.drawParamWebGL=new bt(r),this.drawParamWebGL.setGL(ht.getGL(r)))}function _t(){t||(this.motions=null,this._$eb=!1,this.motions=new Array)}function mt(){this._$w0=null,this._$AT=!0,this._$9L=!1,this._$z2=-1,this._$bs=-1,this._$Do=-1,this._$sr=null,this._$sr=mt._$Gs++}function gt(){this.m=new Array(1,0,0,0,1,0,0,0,1)}function yt(e){t||it.prototype.constructor.call(this,e)}function bt(e){t||(S.prototype.constructor.call(this),this.textures=new Array,this.transform=null,this.gl=null,this.glno=e,this.firstDraw=!0,this.anisotropyExt=null,this.maxAnisotropy=0,this._$As=32,this._$Gr=!1,this._$NT=null,this._$vS=null,this._$no=null,this.vertShader=null,this.fragShader=null,this.vertShaderOff=null,this.fragShaderOff=null)}function vt(t,e,r){return null==e&&(e=t.createBuffer()),t.bindBuffer(t.ARRAY_BUFFER,e),t.bufferData(t.ARRAY_BUFFER,r,t.DYNAMIC_DRAW),e}function xt(t,e,r){return null==e&&(e=t.createBuffer()),t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,e),t.bufferData(t.ELEMENT_ARRAY_BUFFER,r,t.DYNAMIC_DRAW),e}function At(e){t||(this._$P=new Int8Array(8),this._$R0=new DataView(this._$P.buffer),this._$3i=new Int8Array(1e3),this._$hL=0,this._$v0=0,this._$S2=0,this._$Ko=new Array,this._$T=e,this._$F=0)}z.STATE_FIRST="STATE_FIRST",z.STATE_INTERVAL="STATE_INTERVAL",z.STATE_CLOSING="STATE_CLOSING",z.STATE_CLOSED="STATE_CLOSED",z.STATE_OPENING="STATE_OPENING",X.prototype=new S,X._$As=32,X._$Gr=!1,X._$NT=null,X._$vS=null,X._$no=null,X._$9r=function(t){return new Float32Array(t)},X._$vb=function(t){return new Int16Array(t)},X._$cr=function(t,e){return null==t||t._$yL()<e.length?((t=X._$9r(2*e.length)).put(e),t._$oT(0)):(t.clear(),t.put(e),t._$oT(0)),t},X._$mb=function(t,e){return null==t||t._$yL()<e.length?((t=X._$vb(2*e.length)).put(e),t._$oT(0)):(t.clear(),t.put(e),t._$oT(0)),t},X._$Hs=function(){return X._$Gr},X._$as=function(t){X._$Gr=t},X.prototype.setGL=function(t){this.gl=t},X.prototype.setTransform=function(t){this.transform=t},X.prototype._$ZT=function(){},X.prototype._$Uo=function(t,e,r,i,s,n,o,a){if(!(n<.01)){var h=this._$U2[t],l=n>.9?ht.EXPAND_W:0;this.gl.drawElements(h,r,i,s,n,l,this.transform,a)}},X.prototype._$Rs=function(){throw new Error("_$Rs")},X.prototype._$Ds=function(t){throw new Error("_$Ds")},X.prototype._$K2=function(){for(var t=0;t<this._$sb.length;t++){0!=this._$sb[t]&&(this.gl._$Sr(1,this._$sb,t),this._$sb[t]=0)}},X.prototype.setTexture=function(t,e){this._$sb.length<t+1&&this._$nS(t),this._$sb[t]=e},X.prototype.setTexture=function(t,e){this._$sb.length<t+1&&this._$nS(t),this._$U2[t]=e},X.prototype._$nS=function(t){var e=Math.max(2*this._$sb.length,t+1+10),r=new Int32Array(e);M._$jT(this._$sb,0,r,0,this._$sb.length),this._$sb=r;var i=new Array;M._$jT(this._$U2,0,i,0,this._$U2.length),this._$U2=i},W.prototype=new P,W._$Xo=new Float32Array(2),W._$io=new Float32Array(2),W._$0o=new Float32Array(2),W._$Lo=new Float32Array(2),W._$To=new Float32Array(2),W._$Po=new Float32Array(2),W._$gT=new Array,W.prototype._$zP=function(){this._$GS=new R,this._$GS._$zP(),this._$Y0=new Array},W.prototype.getType=function(){return P._$c2},W.prototype._$F0=function(t){P.prototype._$F0.call(this,t),this._$GS=t._$nP(),this._$Y0=t._$nP(),P.prototype.readV2_opacity.call(this,t)},W.prototype.init=function(t){var e=new Y(this);return e._$Yr=new v,this._$32()&&(e._$Wr=new v),e},W.prototype._$Nr=function(t,e){this!=e._$GT()&&console.log("### assert!! ### ");var r=e;if(this._$GS._$Ur(t)){var i=W._$gT;i[0]=!1;var s=this._$GS._$Q2(t,i);e._$Ib(i[0]),this.interpolateOpacity(t,this._$GS,e,i);var n=t._$vs(),o=t._$Tr();if(this._$GS._$zr(n,o,s),s<=0){var a=this._$Y0[n[0]];r._$Yr.init(a)}else if(1==s){a=this._$Y0[n[0]];var h=this._$Y0[n[1]],l=o[0];r._$Yr._$fL=a._$fL+(h._$fL-a._$fL)*l,r._$Yr._$gL=a._$gL+(h._$gL-a._$gL)*l,r._$Yr._$B0=a._$B0+(h._$B0-a._$B0)*l,r._$Yr._$z0=a._$z0+(h._$z0-a._$z0)*l,r._$Yr._$qT=a._$qT+(h._$qT-a._$qT)*l}else if(2==s){a=this._$Y0[n[0]],h=this._$Y0[n[1]];var u=this._$Y0[n[2]],c=this._$Y0[n[3]],d=(l=o[0],o[1]),f=a._$fL+(h._$fL-a._$fL)*l,p=u._$fL+(c._$fL-u._$fL)*l;r._$Yr._$fL=f+(p-f)*d,f=a._$gL+(h._$gL-a._$gL)*l,p=u._$gL+(c._$gL-u._$gL)*l,r._$Yr._$gL=f+(p-f)*d,f=a._$B0+(h._$B0-a._$B0)*l,p=u._$B0+(c._$B0-u._$B0)*l,r._$Yr._$B0=f+(p-f)*d,f=a._$z0+(h._$z0-a._$z0)*l,p=u._$z0+(c._$z0-u._$z0)*l,r._$Yr._$z0=f+(p-f)*d,f=a._$qT+(h._$qT-a._$qT)*l,p=u._$qT+(c._$qT-u._$qT)*l,r._$Yr._$qT=f+(p-f)*d}else if(3==s){var _=this._$Y0[n[0]],m=this._$Y0[n[1]],g=this._$Y0[n[2]],y=this._$Y0[n[3]],b=this._$Y0[n[4]],v=this._$Y0[n[5]],x=this._$Y0[n[6]],A=this._$Y0[n[7]],T=(l=o[0],d=o[1],o[2]),E=(f=_._$fL+(m._$fL-_._$fL)*l,p=g._$fL+(y._$fL-g._$fL)*l,b._$fL+(v._$fL-b._$fL)*l),w=x._$fL+(A._$fL-x._$fL)*l;r._$Yr._$fL=(1-T)*(f+(p-f)*d)+T*(E+(w-E)*d),f=_._$gL+(m._$gL-_._$gL)*l,p=g._$gL+(y._$gL-g._$gL)*l,E=b._$gL+(v._$gL-b._$gL)*l,w=x._$gL+(A._$gL-x._$gL)*l,r._$Yr._$gL=(1-T)*(f+(p-f)*d)+T*(E+(w-E)*d),f=_._$B0+(m._$B0-_._$B0)*l,p=g._$B0+(y._$B0-g._$B0)*l,E=b._$B0+(v._$B0-b._$B0)*l,w=x._$B0+(A._$B0-x._$B0)*l,r._$Yr._$B0=(1-T)*(f+(p-f)*d)+T*(E+(w-E)*d),f=_._$z0+(m._$z0-_._$z0)*l,p=g._$z0+(y._$z0-g._$z0)*l,E=b._$z0+(v._$z0-b._$z0)*l,w=x._$z0+(A._$z0-x._$z0)*l,r._$Yr._$z0=(1-T)*(f+(p-f)*d)+T*(E+(w-E)*d),f=_._$qT+(m._$qT-_._$qT)*l,p=g._$qT+(y._$qT-g._$qT)*l,E=b._$qT+(v._$qT-b._$qT)*l,w=x._$qT+(A._$qT-x._$qT)*l,r._$Yr._$qT=(1-T)*(f+(p-f)*d)+T*(E+(w-E)*d)}else if(4==s){var S=this._$Y0[n[0]],C=this._$Y0[n[1]],P=this._$Y0[n[2]],M=this._$Y0[n[3]],$=this._$Y0[n[4]],I=this._$Y0[n[5]],R=this._$Y0[n[6]],D=this._$Y0[n[7]],L=this._$Y0[n[8]],F=this._$Y0[n[9]],O=this._$Y0[n[10]],k=this._$Y0[n[11]],B=this._$Y0[n[12]],N=this._$Y0[n[13]],U=this._$Y0[n[14]],G=this._$Y0[n[15]],V=(l=o[0],d=o[1],T=o[2],o[3]),H=(f=S._$fL+(C._$fL-S._$fL)*l,p=P._$fL+(M._$fL-P._$fL)*l,E=$._$fL+(I._$fL-$._$fL)*l,w=R._$fL+(D._$fL-R._$fL)*l,L._$fL+(F._$fL-L._$fL)*l),z=O._$fL+(k._$fL-O._$fL)*l,X=B._$fL+(N._$fL-B._$fL)*l,Y=U._$fL+(G._$fL-U._$fL)*l;r._$Yr._$fL=(1-V)*((1-T)*(f+(p-f)*d)+T*(E+(w-E)*d))+V*((1-T)*(H+(z-H)*d)+T*(X+(Y-X)*d)),f=S._$gL+(C._$gL-S._$gL)*l,p=P._$gL+(M._$gL-P._$gL)*l,E=$._$gL+(I._$gL-$._$gL)*l,w=R._$gL+(D._$gL-R._$gL)*l,H=L._$gL+(F._$gL-L._$gL)*l,z=O._$gL+(k._$gL-O._$gL)*l,X=B._$gL+(N._$gL-B._$gL)*l,Y=U._$gL+(G._$gL-U._$gL)*l,r._$Yr._$gL=(1-V)*((1-T)*(f+(p-f)*d)+T*(E+(w-E)*d))+V*((1-T)*(H+(z-H)*d)+T*(X+(Y-X)*d)),f=S._$B0+(C._$B0-S._$B0)*l,p=P._$B0+(M._$B0-P._$B0)*l,E=$._$B0+(I._$B0-$._$B0)*l,w=R._$B0+(D._$B0-R._$B0)*l,H=L._$B0+(F._$B0-L._$B0)*l,z=O._$B0+(k._$B0-O._$B0)*l,X=B._$B0+(N._$B0-B._$B0)*l,Y=U._$B0+(G._$B0-U._$B0)*l,r._$Yr._$B0=(1-V)*((1-T)*(f+(p-f)*d)+T*(E+(w-E)*d))+V*((1-T)*(H+(z-H)*d)+T*(X+(Y-X)*d)),f=S._$z0+(C._$z0-S._$z0)*l,p=P._$z0+(M._$z0-P._$z0)*l,E=$._$z0+(I._$z0-$._$z0)*l,w=R._$z0+(D._$z0-R._$z0)*l,H=L._$z0+(F._$z0-L._$z0)*l,z=O._$z0+(k._$z0-O._$z0)*l,X=B._$z0+(N._$z0-B._$z0)*l,Y=U._$z0+(G._$z0-U._$z0)*l,r._$Yr._$z0=(1-V)*((1-T)*(f+(p-f)*d)+T*(E+(w-E)*d))+V*((1-T)*(H+(z-H)*d)+T*(X+(Y-X)*d)),f=S._$qT+(C._$qT-S._$qT)*l,p=P._$qT+(M._$qT-P._$qT)*l,E=$._$qT+(I._$qT-$._$qT)*l,w=R._$qT+(D._$qT-R._$qT)*l,H=L._$qT+(F._$qT-L._$qT)*l,z=O._$qT+(k._$qT-O._$qT)*l,X=B._$qT+(N._$qT-B._$qT)*l,Y=U._$qT+(G._$qT-U._$qT)*l,r._$Yr._$qT=(1-V)*((1-T)*(f+(p-f)*d)+T*(E+(w-E)*d))+V*((1-T)*(H+(z-H)*d)+T*(X+(Y-X)*d))}else{for(var j=0|Math.pow(2,s),q=new Float32Array(j),Z=0;Z<j;Z++){for(var Q=Z,J=1,K=0;K<s;K++)J*=Q%2==0?1-o[K]:o[K],Q/=2;q[Z]=J}for(var tt=new Array,et=0;et<j;et++)tt[et]=this._$Y0[n[et]];var rt=0,it=0,st=0,nt=0,ot=0;for(et=0;et<j;et++)rt+=q[et]*tt[et]._$fL,it+=q[et]*tt[et]._$gL,st+=q[et]*tt[et]._$B0,nt+=q[et]*tt[et]._$z0,ot+=q[et]*tt[et]._$qT;r._$Yr._$fL=rt,r._$Yr._$gL=it,r._$Yr._$B0=st,r._$Yr._$z0=nt,r._$Yr._$qT=ot}a=this._$Y0[n[0]];r._$Yr.reflectX=a.reflectX,r._$Yr.reflectY=a.reflectY}},W.prototype._$2b=function(t,e){this!=e._$GT()&&console.log("### assert!! ### ");var r=e;if(r._$hS(!0),this._$32()){var i=this.getTargetBaseDataID();if(r._$8r==P._$ur&&(r._$8r=t.getBaseDataIndex(i)),r._$8r<0)ht._$so&&a._$li("_$L _$0P _$G :: %s",i),r._$hS(!1);else{var s=t.getBaseData(r._$8r);if(null!=s){var n=t._$q2(r._$8r),o=W._$Xo;o[0]=r._$Yr._$fL,o[1]=r._$Yr._$gL;var h=W._$io;h[0]=0,h[1]=-.1,n._$GT().getType()==P._$c2?h[1]=-10:h[1]=-.1;var l=W._$0o;this._$Jr(t,s,n,o,h,l);var u=Et._$92(h,l);s._$nb(t,n,o,o,1,0,2),r._$Wr._$fL=o[0],r._$Wr._$gL=o[1],r._$Wr._$B0=r._$Yr._$B0,r._$Wr._$z0=r._$Yr._$z0,r._$Wr._$qT=r._$Yr._$qT-u*Et._$NS;var c=n.getTotalScale();r.setTotalScale_notForClient(c*r._$Wr._$B0);var d=n.getTotalOpacity();r.setTotalOpacity(d*r.getInterpolatedOpacity()),r._$Wr.reflectX=r._$Yr.reflectX,r._$Wr.reflectY=r._$Yr.reflectY,r._$hS(n._$yo())}else r._$hS(!1)}}else r.setTotalScale_notForClient(r._$Yr._$B0),r.setTotalOpacity(r.getInterpolatedOpacity())},W.prototype._$nb=function(t,e,r,i,s,n,o){this!=e._$GT()&&console.log("### assert!! ### ");for(var a,h,l=e,u=null!=l._$Wr?l._$Wr:l._$Yr,c=Math.sin(Et._$bS*u._$qT),d=Math.cos(Et._$bS*u._$qT),f=l.getTotalScale(),p=u.reflectX?-1:1,_=u.reflectY?-1:1,m=d*f*p,g=-c*f*_,y=c*f*p,b=d*f*_,v=u._$fL,x=u._$gL,A=s*o,T=n;T<A;T+=o)a=r[T],h=r[T+1],i[T]=m*a+g*h+v,i[T+1]=y*a+b*h+x},W.prototype._$Jr=function(t,e,r,i,s,n){e!=r._$GT()&&console.log("### assert!! ### ");var o=W._$Lo;W._$Lo[0]=i[0],W._$Lo[1]=i[1],e._$nb(t,r,o,o,1,0,2);for(var a=W._$To,h=W._$Po,l=1,u=0;u<10;u++){if(h[0]=i[0]+l*s[0],h[1]=i[1]+l*s[1],e._$nb(t,r,h,a,1,0,2),a[0]-=o[0],a[1]-=o[1],0!=a[0]||0!=a[1])return n[0]=a[0],void(n[1]=a[1]);if(h[0]=i[0]-l*s[0],h[1]=i[1]-l*s[1],e._$nb(t,r,h,a,1,0,2),a[0]-=o[0],a[1]-=o[1],0!=a[0]||0!=a[1])return a[0]=-a[0],a[0]=-a[0],n[0]=a[0],void(n[1]=a[1]);l*=.1}ht._$so&&console.log("_$L0 to transform _$SP\n")},Y.prototype=new at,j.prototype=new w,j._$ur=-2,j._$ES=500,j._$wb=2,j._$8S=3,j._$os=4,j._$52=j._$ES,j._$R2=j._$ES,j._$Sb=function(t){for(var e=t.length-1;e>=0;--e){var r=t[e];r<j._$52?j._$52=r:r>j._$R2&&(j._$R2=r)}},j._$or=function(){return j._$52},j._$Pr=function(){return j._$R2},j.prototype._$F0=function(t){this._$gP=t._$nP(),this._$dr=t._$nP(),this._$GS=t._$nP(),this._$qb=t._$6L(),this._$Lb=t._$cS(),this._$mS=t._$Tb(),t.getFormatVersion()>=U._$T7?(this.clipID=t._$nP(),this.clipIDList=this.convertClipIDForV2_11(this.clipID)):this.clipIDList=null,j._$Sb(this._$Lb)},j.prototype.getClipIDList=function(){return this.clipIDList},j.prototype._$Nr=function(t,e){if(e._$IS[0]=!1,e._$Us=T._$Z2(t,this._$GS,e._$IS,this._$Lb),ht._$Zs);else if(e._$IS[0])return;e._$7s=T._$br(t,this._$GS,e._$IS,this._$mS)},j.prototype._$2b=function(t){},j.prototype.getDrawDataID=function(){return this._$gP},j.prototype._$j2=function(t){this._$gP=t},j.prototype.getOpacity=function(t,e){return e._$7s},j.prototype._$zS=function(t,e){return e._$Us},j.prototype.getTargetBaseDataID=function(){return this._$dr},j.prototype._$gs=function(t){this._$dr=t},j.prototype._$32=function(){return null!=this._$dr&&this._$dr!=yt._$2o()},j.prototype.getType=function(){},q._$42=0,q.prototype._$1b=function(){return this._$3S},q.prototype.getDrawDataList=function(){return this._$aS},q.prototype._$F0=function(t){this._$NL=t._$nP(),this._$aS=t._$nP(),this._$3S=t._$nP()},q.prototype._$kr=function(t){t._$Zo(this._$3S),t._$xo(this._$aS),this._$3S=null,this._$aS=null},Z.prototype=new e,Z.loadModel=function(t){var r=new Z;return e._$62(r,t),r},Z.loadModel=function(t){var r=new Z;return e._$62(r,t),r},Z._$to=function(){return new Z},Z._$er=function(t){var e=new _$5("../_$_r/_$t0/_$Ri/_$_P._$d");if(0==e.exists())throw new _$ls("_$t0 _$_ _$6 _$Ui :: "+e._$PL());for(var r=["../_$_r/_$t0/_$Ri/_$_P.512/_$CP._$1","../_$_r/_$t0/_$Ri/_$_P.512/_$vP._$1","../_$_r/_$t0/_$Ri/_$_P.512/_$EP._$1","../_$_r/_$t0/_$Ri/_$_P.512/_$pP._$1"],i=Z.loadModel(e._$3b()),s=0;s<r.length;s++){var n=new _$5(r[s]);if(0==n.exists())throw new _$ls("_$t0 _$_ _$6 _$Ui :: "+n._$PL());i.setTexture(s,_$nL._$_o(t,n._$3b()))}return i},Z.prototype.setGL=function(t){this._$zo.setGL(t)},Z.prototype.setTransform=function(t){this._$zo.setTransform(t)},Z.prototype.draw=function(){this._$5S.draw(this._$zo)},Z.prototype._$K2=function(){this._$zo._$K2()},Z.prototype.setTexture=function(t,e){null==this._$zo&&a._$li("_$Yi for QT _$ki / _$XS() is _$6 _$ui!!"),this._$zo.setTexture(t,e)},Z.prototype.setTexture=function(t,e){null==this._$zo&&a._$li("_$Yi for QT _$ki / _$XS() is _$6 _$ui!!"),this._$zo.setTexture(t,e)},Z.prototype._$Rs=function(){return this._$zo._$Rs()},Z.prototype._$Ds=function(t){this._$zo._$Ds(t)},Z.prototype.getDrawParam=function(){return this._$zo},Q.prototype=new o,Q._$cs="VISIBLE:",Q._$ar="LAYOUT:",Q.MTN_PREFIX_FADEIN="FADEIN:",Q.MTN_PREFIX_FADEOUT="FADEOUT:",Q._$Co=0,Q._$1T=1,Q.loadMotion=function(t){var e=V._$C(t);return Q.loadMotion(e)},Q.loadMotion=function(t){t instanceof ArrayBuffer&&(t=new DataView(t));var e=new Q,r=[0],i=t.byteLength;e._$yT=0;for(var s=0;s<i;++s){var n=J(t,s),o=n.charCodeAt(0);if("\n"!=n&&"\r"!=n)if("#"!=n)if("$"!=n){if(97<=o&&o<=122||65<=o&&o<=90||"_"==n){for(c=s,d=-1;s<i&&("\r"!=(n=J(t,s))&&"\n"!=n);++s)if("="==n){d=s;break}if(d>=0){var a=new B;I.startsWith(t,c,Q._$cs)?(a._$RP=B._$hs,a._$4P=I.createString(t,c,d-c)):I.startsWith(t,c,Q._$ar)?(a._$4P=I.createString(t,c+7,d-c-7),I.startsWith(t,c+7,"ANCHOR_X")?a._$RP=B._$xs:I.startsWith(t,c+7,"ANCHOR_Y")?a._$RP=B._$us:I.startsWith(t,c+7,"SCALE_X")?a._$RP=B._$qs:I.startsWith(t,c+7,"SCALE_Y")?a._$RP=B._$Ys:I.startsWith(t,c+7,"X")?a._$RP=B._$ws:I.startsWith(t,c+7,"Y")&&(a._$RP=B._$Ns)):(a._$RP=B._$Fr,a._$4P=I.createString(t,c,d-c)),e.motions.push(a);var h=0,l=[];for(s=d+1;s<i&&("\r"!=(n=J(t,s))&&"\n"!=n);++s)if(","!=n&&" "!=n&&"\t"!=n){p=I._$LS(t,i,s,r);if(r[0]>0){l.push(p),h++;var u=r[0];if(u<s){console.log("_$n0 _$hi . @Live2DMotion loadMotion()\n");break}s=u-1}}a._$I0=new Float32Array(l),h>e._$yT&&(e._$yT=h)}}}else{for(var c=s,d=-1;s<i&&("\r"!=(n=J(t,s))&&"\n"!=n);++s)if("="==n){d=s;break}var f=!1;if(d>=0)for(d==c+4&&"f"==J(t,c+1)&&"p"==J(t,c+2)&&"s"==J(t,c+3)&&(f=!0),s=d+1;s<i&&("\r"!=(n=J(t,s))&&"\n"!=n);++s)if(","!=n&&" "!=n&&"\t"!=n){var p=I._$LS(t,i,s,r);r[0]>0&&f&&5<p&&p<121&&(e._$D0=p),s=r[0]}for(;s<i&&("\n"!=J(t,s)&&"\r"!=J(t,s));++s);}else for(;s<i&&("\n"!=J(t,s)&&"\r"!=J(t,s));++s);}return e._$rr=1e3*e._$yT/e._$D0|0,e},Q.prototype.getDurationMSec=function(){return this._$E?-1:this._$rr},Q.prototype.getLoopDurationMSec=function(){return this._$rr},Q.prototype.dump=function(){for(var t=0;t<this.motions.length;t++){var e=this.motions[t];console.log("_$wL[%s] [%d]. ",e._$4P,e._$I0.length);for(var r=0;r<e._$I0.length&&r<10;r++)console.log("%5.2f ,",e._$I0[r]);console.log("\n")}},Q.prototype.updateParamExe=function(t,e,r,i){for(var s=(e-i._$z2)*this._$D0/1e3,n=0|s,o=s-n,a=0;a<this.motions.length;a++){var h=this.motions[a],l=h._$I0.length,u=h._$4P;if(h._$RP==B._$hs){var c=h._$I0[n>=l?l-1:n];t.setParamFloat(u,c)}else if(B._$ws<=h._$RP&&h._$RP<=B._$Ys);else{var d=t.getParamIndex(u),f=t.getModelContext(),p=.4*(f.getParamMax(d)-f.getParamMin(d)),_=f.getParamFloat(d),m=h._$I0[n>=l?l-1:n],g=h._$I0[n+1>=l?l-1:n+1],y=_+((m<g&&g-m>p||m>g&&m-g>p?m:m+(g-m)*o)-_)*r;t.setParamFloat(u,y)}}n>=this._$yT&&(this._$E?(i._$z2=e,this.loopFadeIn&&(i._$bs=e)):i._$9L=!0),this._$eP=r},Q.prototype._$r0=function(){return this._$E},Q.prototype._$aL=function(t){this._$E=t},Q.prototype._$S0=function(){return this._$D0},Q.prototype._$U0=function(t){this._$D0=t},Q.prototype.isLoopFadeIn=function(){return this.loopFadeIn},Q.prototype.setLoopFadeIn=function(t){this.loopFadeIn=t},k.prototype.clear=function(){this.size=0},k.prototype.add=function(t){if(this._$P.length<=this.size){var e=new Float32Array(2*this.size);M._$jT(this._$P,0,e,0,this.size),this._$P=e}this._$P[this.size++]=t},k.prototype._$BL=function(){var t=new Float32Array(this.size);return M._$jT(this._$P,0,t,0,this.size),t},B._$Fr=0,B._$hs=1,B._$ws=100,B._$Ns=101,B._$xs=102,B._$us=103,B._$qs=104,B._$Ys=105,K.prototype=new P,K._$gT=new Array,K.prototype._$zP=function(){this._$GS=new R,this._$GS._$zP()},K.prototype._$F0=function(t){P.prototype._$F0.call(this,t),this._$A=t._$6L(),this._$o=t._$6L(),this._$GS=t._$nP(),this._$Eo=t._$nP(),P.prototype.readV2_opacity.call(this,t)},K.prototype.init=function(t){var e=new tt(this),r=(this._$o+1)*(this._$A+1);return null!=e._$Cr&&(e._$Cr=null),e._$Cr=new Float32Array(2*r),null!=e._$hr&&(e._$hr=null),this._$32()?e._$hr=new Float32Array(2*r):e._$hr=null,e},K.prototype._$Nr=function(t,e){var r=e;if(this._$GS._$Ur(t)){var i=this._$VT(),s=K._$gT;s[0]=!1,T._$Vr(t,this._$GS,s,i,this._$Eo,r._$Cr,0,2),e._$Ib(s[0]),this.interpolateOpacity(t,this._$GS,e,s)}},K.prototype._$2b=function(t,e){var r=e;if(r._$hS(!0),this._$32()){var i=this.getTargetBaseDataID();if(r._$8r==P._$ur&&(r._$8r=t.getBaseDataIndex(i)),r._$8r<0)ht._$so&&a._$li("_$L _$0P _$G :: %s",i),r._$hS(!1);else{var s=t.getBaseData(r._$8r),n=t._$q2(r._$8r);if(null!=s&&n._$yo()){var o=n.getTotalScale();r.setTotalScale_notForClient(o);var h=n.getTotalOpacity();r.setTotalOpacity(h*r.getInterpolatedOpacity()),s._$nb(t,n,r._$Cr,r._$hr,this._$VT(),0,2),r._$hS(!0)}else r._$hS(!1)}}else r.setTotalOpacity(r.getInterpolatedOpacity())},K.prototype._$nb=function(t,e,r,i,s,n,o){var a=e,h=null!=a._$hr?a._$hr:a._$Cr;K.transformPoints_sdk2(r,i,s,n,o,h,this._$o,this._$A)},K.transformPoints_sdk2=function(t,e,r,i,s,n,o,a){for(var h,l,u,c=r*s,d=0,f=0,p=0,_=0,m=0,g=0,y=!1,b=i;b<c;b+=s){var v,x,A,T;if(A=t[b],x=(T=t[b+1])*a,(v=A*o)<0||x<0||o<=v||a<=x){var E=o+1;if(!y){y=!0,d=.25*(n[2*(0+0*E)]+n[2*(o+0*E)]+n[2*(0+a*E)]+n[2*(o+a*E)]),f=.25*(n[2*(0+0*E)+1]+n[2*(o+0*E)+1]+n[2*(0+a*E)+1]+n[2*(o+a*E)+1]);var w=n[2*(o+a*E)]-n[2*(0+0*E)],S=n[2*(o+a*E)+1]-n[2*(0+0*E)+1],C=n[2*(o+0*E)]-n[2*(0+a*E)],P=n[2*(o+0*E)+1]-n[2*(0+a*E)+1];d-=.5*((p=.5*(w+C))+(m=.5*(w-C))),f-=.5*((_=.5*(S+P))+(g=.5*(S-P)))}if(-2<A&&A<3&&-2<T&&T<3)if(A<=0)if(T<=0){var M=n[2*(0+0*E)],$=n[2*(0+0*E)+1],I=d-2*p,R=f-2*_,D=d-2*m,L=f-2*g,F=d-2*p-2*m,O=f-2*_-2*g;(k=.5*(A- -2))+(B=.5*(T- -2))<=1?(e[b]=F+(D-F)*k+(I-F)*B,e[b+1]=O+(L-O)*k+(R-O)*B):(e[b]=M+(I-M)*(1-k)+(D-M)*(1-B),e[b+1]=$+(R-$)*(1-k)+(L-$)*(1-B))}else if(T>=1){D=n[2*(0+a*E)],L=n[2*(0+a*E)+1],F=d-2*p+1*m,O=f-2*_+1*g,M=d+3*m,$=f+3*g,I=d-2*p+3*m,R=f-2*_+3*g;(k=.5*(A- -2))+(B=.5*(T-1))<=1?(e[b]=F+(D-F)*k+(I-F)*B,e[b+1]=O+(L-O)*k+(R-O)*B):(e[b]=M+(I-M)*(1-k)+(D-M)*(1-B),e[b+1]=$+(R-$)*(1-k)+(L-$)*(1-B))}else{(G=0|x)==a&&(G=a-1);var k=.5*(A- -2),B=x-G,N=G/a,U=(G+1)/a;D=n[2*(0+G*E)],L=n[2*(0+G*E)+1],M=n[2*(0+(G+1)*E)],$=n[2*(0+(G+1)*E)+1],F=d-2*p+N*m,O=f-2*_+N*g,I=d-2*p+U*m,R=f-2*_+U*g;k+B<=1?(e[b]=F+(D-F)*k+(I-F)*B,e[b+1]=O+(L-O)*k+(R-O)*B):(e[b]=M+(I-M)*(1-k)+(D-M)*(1-B),e[b+1]=$+(R-$)*(1-k)+(L-$)*(1-B))}else if(1<=A)if(T<=0){I=n[2*(o+0*E)],R=n[2*(o+0*E)+1],M=d+3*p,$=f+3*_,F=d+1*p-2*m,O=f+1*_-2*g,D=d+3*p-2*m,L=f+3*_-2*g;(k=.5*(A-1))+(B=.5*(T- -2))<=1?(e[b]=F+(D-F)*k+(I-F)*B,e[b+1]=O+(L-O)*k+(R-O)*B):(e[b]=M+(I-M)*(1-k)+(D-M)*(1-B),e[b+1]=$+(R-$)*(1-k)+(L-$)*(1-B))}else if(T>=1){F=n[2*(o+a*E)],O=n[2*(o+a*E)+1],D=d+3*p+1*m,L=f+3*_+1*g,I=d+1*p+3*m,R=f+1*_+3*g,M=d+3*p+3*m,$=f+3*_+3*g;(k=.5*(A-1))+(B=.5*(T-1))<=1?(e[b]=F+(D-F)*k+(I-F)*B,e[b+1]=O+(L-O)*k+(R-O)*B):(e[b]=M+(I-M)*(1-k)+(D-M)*(1-B),e[b+1]=$+(R-$)*(1-k)+(L-$)*(1-B))}else{var G;(G=0|x)==a&&(G=a-1);k=.5*(A-1),B=x-G,N=G/a,U=(G+1)/a,F=n[2*(o+G*E)],O=n[2*(o+G*E)+1],I=n[2*(o+(G+1)*E)],R=n[2*(o+(G+1)*E)+1],D=d+3*p+N*m,L=f+3*_+N*g,M=d+3*p+U*m,$=f+3*_+U*g;k+B<=1?(e[b]=F+(D-F)*k+(I-F)*B,e[b+1]=O+(L-O)*k+(R-O)*B):(e[b]=M+(I-M)*(1-k)+(D-M)*(1-B),e[b+1]=$+(R-$)*(1-k)+(L-$)*(1-B))}else if(T<=0){(z=0|v)==o&&(z=o-1);k=v-z,B=.5*(T- -2);var V=z/o,H=(z+1)/o;I=n[2*(z+0*E)],R=n[2*(z+0*E)+1],M=n[2*(z+1+0*E)],$=n[2*(z+1+0*E)+1],F=d+V*p-2*m,O=f+V*_-2*g,D=d+H*p-2*m,L=f+H*_-2*g;k+B<=1?(e[b]=F+(D-F)*k+(I-F)*B,e[b+1]=O+(L-O)*k+(R-O)*B):(e[b]=M+(I-M)*(1-k)+(D-M)*(1-B),e[b+1]=$+(R-$)*(1-k)+(L-$)*(1-B))}else if(T>=1){var z;(z=0|v)==o&&(z=o-1);k=v-z,B=.5*(T-1),V=z/o,H=(z+1)/o,F=n[2*(z+a*E)],O=n[2*(z+a*E)+1],D=n[2*(z+1+a*E)],L=n[2*(z+1+a*E)+1],I=d+V*p+3*m,R=f+V*_+3*g,M=d+H*p+3*m,$=f+H*_+3*g;k+B<=1?(e[b]=F+(D-F)*k+(I-F)*B,e[b+1]=O+(L-O)*k+(R-O)*B):(e[b]=M+(I-M)*(1-k)+(D-M)*(1-B),e[b+1]=$+(R-$)*(1-k)+(L-$)*(1-B))}else System.err.printf("_$li calc : %.4f , %.4f\t\t\t\t\t@@BDBoxGrid\n",A,T);else e[b]=d+A*p+T*m,e[b+1]=f+A*_+T*g}else h=2*((0|v)+(0|x)*(o+1)),(l=v-(0|v))+(u=x-(0|x))<1?(e[b]=n[h]*(1-l-u)+n[h+2]*l+n[h+2*(o+1)]*u,e[b+1]=n[h+1]*(1-l-u)+n[h+3]*l+n[h+2*(o+1)+1]*u):(e[b]=n[h+2*(o+1)+2]*(l-1+u)+n[h+2*(o+1)]*(1-l)+n[h+2]*(1-u),e[b+1]=n[h+2*(o+1)+3]*(l-1+u)+n[h+2*(o+1)+1]*(1-l)+n[h+3]*(1-u))}},K.prototype.transformPoints_sdk1=function(t,e,r,i,s,n,o){for(var a,h,l,u,c,d,f,p=e,_=this._$o,m=this._$A,g=s*o,y=null!=p._$hr?p._$hr:p._$Cr,b=n;b<g;b+=o)ht._$ts?((a=r[b])<0?a=0:a>1&&(a=1),(h=r[b+1])<0?h=0:h>1&&(h=1),(l=0|(a*=_))>_-1&&(l=_-1),(u=0|(h*=m))>m-1&&(u=m-1),d=a-l,f=h-u,c=2*(l+u*(_+1))):(d=(a=r[b]*_)-(0|a),f=(h=r[b+1]*m)-(0|h),c=2*((0|a)+(0|h)*(_+1))),d+f<1?(i[b]=y[c]*(1-d-f)+y[c+2]*d+y[c+2*(_+1)]*f,i[b+1]=y[c+1]*(1-d-f)+y[c+3]*d+y[c+2*(_+1)+1]*f):(i[b]=y[c+2*(_+1)+2]*(d-1+f)+y[c+2*(_+1)]*(1-d)+y[c+2]*(1-f),i[b+1]=y[c+2*(_+1)+3]*(d-1+f)+y[c+2*(_+1)+1]*(1-d)+y[c+3]*(1-f))},K.prototype._$VT=function(){return(this._$o+1)*(this._$A+1)},K.prototype.getType=function(){return P._$_b},tt.prototype=new at,et._$42=0,et.prototype._$zP=function(){this._$3S=new Array,this._$aS=new Array},et.prototype._$F0=function(t){this._$g0=t._$8L(),this.visible=t._$8L(),this._$NL=t._$nP(),this._$3S=t._$nP(),this._$aS=t._$nP()},et.prototype.init=function(t){var e=new rt(this);return e.setPartsOpacity(this.isVisible()?1:0),e},et.prototype._$6o=function(t){if(null==this._$3S)throw new Error("_$3S _$6 _$Wo@_$6o");this._$3S.push(t)},et.prototype._$3o=function(t){if(null==this._$aS)throw new Error("_$aS _$6 _$Wo@_$3o");this._$aS.push(t)},et.prototype._$Zo=function(t){this._$3S=t},et.prototype._$xo=function(t){this._$aS=t},et.prototype.isVisible=function(){return this.visible},et.prototype._$uL=function(){return this._$g0},et.prototype._$KP=function(t){this.visible=t},et.prototype._$ET=function(t){this._$g0=t},et.prototype.getBaseData=function(){return this._$3S},et.prototype.getDrawData=function(){return this._$aS},et.prototype._$p2=function(){return this._$NL},et.prototype._$ob=function(t){this._$NL=t},et.prototype.getPartsID=function(){return this._$NL},et.prototype._$MP=function(t){this._$NL=t},rt.prototype=new function(){},rt.prototype.getPartsOpacity=function(){return this._$VS},rt.prototype.setPartsOpacity=function(t){this._$VS=t},it._$L7=function(){c._$27(),yt._$27(),L._$27(),u._$27()},it.prototype.toString=function(){return this.id},st.prototype._$1s=function(){return this._$4S},st.prototype._$zP=function(){this._$4S=new Array},st.prototype._$F0=function(t){this._$4S=t._$nP()},st.prototype._$Ks=function(t){this._$4S.push(t)},nt.tr=new gt,nt._$50=new gt,nt._$Ti=new Array(0,0),nt._$Pi=new Array(0,0),nt._$B=new Array(0,0),nt.prototype._$lP=function(t,e,r,i){this.viewport=new Array(t,e,r,i)},nt.prototype._$bL=function(){this.context.save();var t=this.viewport;null!=t&&(this.context.beginPath(),this.context._$Li(t[0],t[1],t[2],t[3]),this.context.clip())},nt.prototype._$ei=function(){this.context.restore()},nt.prototype.drawElements=function(t,e,r,i,s,n,o,h){try{s!=this._$Qo&&(this._$Qo=s,this.context.globalAlpha=s);for(var l=e.length,u=t.width,c=t.height,d=this.context,f=this._$xP,p=this._$uP,_=this._$6r,m=this._$3r,g=nt.tr,y=nt._$Ti,b=nt._$Pi,v=nt._$B,A=0;A<l;A+=3){d.save();var T=e[A],E=e[A+1],w=e[A+2],S=f+_*r[2*T],C=p+m*r[2*T+1],P=f+_*r[2*E],M=p+m*r[2*E+1],$=f+_*r[2*w],I=p+m*r[2*w+1];o&&(o._$PS(S,C,v),S=v[0],C=v[1],o._$PS(P,M,v),P=v[0],M=v[1],o._$PS($,I,v),$=v[0],I=v[1]);var R=u*i[2*T],D=c-c*i[2*T+1],L=u*i[2*E],F=c-c*i[2*E+1],O=u*i[2*w],k=c-c*i[2*w+1],B=Math.atan2(F-D,L-R),N=Math.atan2(M-C,P-S),U=P-S,G=M-C,V=Math.sqrt(U*U+G*G),H=L-R,z=F-D,X=V/Math.sqrt(H*H+z*z);x._$ni(O,k,R,D,L-R,F-D,-(F-D),L-R,y),x._$ni($,I,S,C,P-S,M-C,-(M-C),P-S,b);var W=(b[0]-y[0])/y[1],Y=Math.min(R,L,O),j=Math.max(R,L,O),q=Math.min(D,F,k),Z=Math.max(D,F,k),Q=Math.floor(Y),J=Math.floor(q),K=Math.ceil(j),tt=Math.ceil(Z);g.identity(),g.translate(S,C),g.rotate(N),g.scale(1,b[1]/y[1]),g.shear(W,0),g.scale(X,X),g.rotate(-B),g.translate(-R,-D),g.setContext(d);if(n||(n=1.2),ht.IGNORE_EXPAND&&(n=0),ht.USE_CACHED_POLYGON_IMAGE){var et=h._$e0;if(et.gl_cacheImage=et.gl_cacheImage||{},!et.gl_cacheImage[A]){var rt=nt.createCanvas(K-Q,tt-J);ht.DEBUG_DATA.LDGL_CANVAS_MB=ht.DEBUG_DATA.LDGL_CANVAS_MB||0,ht.DEBUG_DATA.LDGL_CANVAS_MB+=(K-Q)*(tt-J)*4;var it=rt.getContext("2d");it.translate(-Q,-J),nt.clip(it,g,n,V,R,D,L,F,O,k,S,C,P,M,$,I),it.drawImage(t,0,0),et.gl_cacheImage[A]={cacheCanvas:rt,cacheContext:it}}d.drawImage(et.gl_cacheImage[A].cacheCanvas,Q,J)}else ht.IGNORE_CLIP||nt.clip(d,g,n,V,R,D,L,F,O,k,S,C,P,M,$,I),ht.USE_ADJUST_TRANSLATION&&(Y=0,j=u,q=0,Z=c),d.drawImage(t,Y,q,j-Y,Z-q,Y,q,j-Y,Z-q);d.restore()}}catch(t){a._$Rb(t)}},nt.clip=function(t,e,r,i,s,n,o,a,h,l,u,c,d,f,p,_){r>.02?nt.expandClip(t,e,r,i,u,c,d,f,p,_):nt.clipWithTransform(t,null,s,n,o,a,h,l)},nt.expandClip=function(t,e,r,i,s,n,o,a,h,l){var u=o-s,c=a-n,d=h-s,f=l-n,p=u*f-c*d>0?r:-r,_=-c,m=u,g=h-o,y=l-a,b=-y,v=g,x=Math.sqrt(g*g+y*y),A=-f,T=d,E=Math.sqrt(d*d+f*f),w=s-p*_/i,S=n-p*m/i,C=o-p*_/i,P=a-p*m/i,M=o-p*b/x,$=a-p*v/x,I=h-p*b/x,R=l-p*v/x,D=s+p*A/E,L=n+p*T/E,F=h+p*A/E,O=l+p*T/E,k=nt._$50;return null!=e._$P2(k)&&(nt.clipWithTransform(t,k,w,S,C,P,M,$,I,R,F,O,D,L),!0)},nt.clipWithTransform=function(t,e,r,i,s,n,o,h){if(arguments.length<7)a._$li("err : @LDGL.clip()");else if(arguments[1]instanceof gt){var l=nt._$B,u=e,c=arguments;if(t.beginPath(),u){u._$PS(c[2],c[3],l),t.moveTo(l[0],l[1]);for(var d=4;d<c.length;d+=2)u._$PS(c[d],c[d+1],l),t.lineTo(l[0],l[1])}else{t.moveTo(c[2],c[3]);for(d=4;d<c.length;d+=2)t.lineTo(c[d],c[d+1])}t.clip()}else a._$li("err : a[0] is _$6 LDTransform @LDGL.clip()")},nt.createCanvas=function(t,e){var r=document.createElement("canvas");return r.setAttribute("width",t),r.setAttribute("height",e),r||a._$li("err : "+r),r},nt.dumpValues=function(){for(var t="",e=0;e<arguments.length;e++)t+="["+e+"]= "+arguments[e].toFixed(3)+" , ";console.log(t)},ot.prototype._$F0=function(t){this._$TT=t._$_T(),this._$LT=t._$_T(),this._$FS=t._$_T(),this._$wL=t._$nP()},ot.prototype.getMinValue=function(){return this._$TT},ot.prototype.getMaxValue=function(){return this._$LT},ot.prototype.getDefaultValue=function(){return this._$FS},ot.prototype.getParamID=function(){return this._$wL},at.prototype._$yo=function(){return this._$AT&&!this._$JS},at.prototype._$hS=function(t){this._$AT=t},at.prototype._$GT=function(){return this._$e0},at.prototype._$l2=function(t){this._$IP=t},at.prototype.getPartsIndex=function(){return this._$IP},at.prototype._$x2=function(){return this._$JS},at.prototype._$Ib=function(t){this._$JS=t},at.prototype.getTotalScale=function(){return this.totalScale},at.prototype.setTotalScale_notForClient=function(t){this.totalScale=t},at.prototype.getInterpolatedOpacity=function(){return this._$7s},at.prototype.setInterpolatedOpacity=function(t){this._$7s=t},at.prototype.getTotalOpacity=function(t){return this.totalOpacity},at.prototype.setTotalOpacity=function(t){this.totalOpacity=t},ht._$2s="2.1.00_1",ht._$Kr=201001e3,ht._$sP=!0,ht._$so=!0,ht._$cb=!1,ht._$3T=!0,ht._$Ts=!0,ht._$fb=!0,ht._$ts=!0,ht.L2D_DEFORMER_EXTEND=!0,ht._$Wb=!1,ht._$yr=!1,ht._$Zs=!1,ht.L2D_NO_ERROR=0,ht._$i7=1e3,ht._$9s=1001,ht._$es=1100,ht._$r7=2e3,ht._$07=2001,ht._$b7=2002,ht._$H7=4e3,ht.L2D_COLOR_BLEND_MODE_MULT=0,ht.L2D_COLOR_BLEND_MODE_ADD=1,ht.L2D_COLOR_BLEND_MODE_INTERPOLATE=2,ht._$6b=!0,ht._$cT=0,ht.clippingMaskBufferSize=256,ht.glContext=new Array,ht.frameBuffers=new Array,ht.fTexture=new Array,ht.IGNORE_CLIP=!1,ht.IGNORE_EXPAND=!1,ht.EXPAND_W=2,ht.USE_ADJUST_TRANSLATION=!0,ht.USE_CANVAS_TRANSFORM=!0,ht.USE_CACHED_POLYGON_IMAGE=!1,ht.DEBUG_DATA={},ht.PROFILE_IOS_SPEED={PROFILE_NAME:"iOS Speed",USE_ADJUST_TRANSLATION:!0,USE_CACHED_POLYGON_IMAGE:!0,EXPAND_W:4},ht.PROFILE_IOS_QUALITY={PROFILE_NAME:"iOS HiQ",USE_ADJUST_TRANSLATION:!0,USE_CACHED_POLYGON_IMAGE:!1,EXPAND_W:2},ht.PROFILE_IOS_DEFAULT=ht.PROFILE_IOS_QUALITY,ht.PROFILE_ANDROID={PROFILE_NAME:"Android",USE_ADJUST_TRANSLATION:!1,USE_CACHED_POLYGON_IMAGE:!1,EXPAND_W:2},ht.PROFILE_DESKTOP={PROFILE_NAME:"Desktop",USE_ADJUST_TRANSLATION:!1,USE_CACHED_POLYGON_IMAGE:!1,EXPAND_W:2},ht.initProfile=function(){St.isIOS()?ht.setupProfile(ht.PROFILE_IOS_DEFAULT):St.isAndroid()?ht.setupProfile(ht.PROFILE_ANDROID):ht.setupProfile(ht.PROFILE_DESKTOP)},ht.setupProfile=function(t,e){if("number"==typeof t)switch(t){case 9901:t=ht.PROFILE_IOS_SPEED;break;case 9902:t=ht.PROFILE_IOS_QUALITY;break;case 9903:t=ht.PROFILE_IOS_DEFAULT;break;case 9904:t=ht.PROFILE_ANDROID;break;case 9905:t=ht.PROFILE_DESKTOP;break;default:alert("profile _$6 _$Ui : "+t)}for(var r in arguments.length<2&&(e=!0),e&&console.log("profile : "+t.PROFILE_NAME),t)ht[r]=t[r],e&&console.log("  ["+r+"] = "+t[r])},ht.init=function(){if(ht._$6b){console.log("Live2D %s",ht._$2s),ht._$6b=!1;ht.initProfile()}},ht.getVersionStr=function(){return ht._$2s},ht.getVersionNo=function(){return ht._$Kr},ht._$sT=function(t){ht._$cT=t},ht.getError=function(){var t=ht._$cT;return ht._$cT=0,t},ht.dispose=function(){ht.glContext=[],ht.frameBuffers=[],ht.fTexture=[]},ht.setGL=function(t,e){var r=e||0;ht.glContext[r]=t},ht.getGL=function(t){return ht.glContext[t]},ht.setClippingMaskBufferSize=function(t){ht.clippingMaskBufferSize=t},ht.getClippingMaskBufferSize=function(){return ht.clippingMaskBufferSize},ht.deleteBuffer=function(t){ht.getGL(t).deleteFramebuffer(ht.frameBuffers[t].framebuffer),delete ht.frameBuffers[t],delete ht.glContext[t]},lt._$r2=function(t){return t<0?0:t>1?1:.5-.5*Math.cos(t*Et.PI_F)},ut._$fr=-1,ut.prototype.toString=function(){return this._$ib},ct.prototype=new j,ct._$42=0,ct._$Os=30,ct._$ms=0,ct._$ns=1,ct._$_s=2,ct._$gT=new Array,ct.prototype._$_S=function(t){this._$LP=t},ct.prototype.getTextureNo=function(){return this._$LP},ct.prototype._$ZL=function(){return this._$Qi},ct.prototype._$H2=function(){return this._$JP},ct.prototype.getNumPoints=function(){return this._$d0},ct.prototype.getType=function(){return j._$wb},ct.prototype._$B2=function(t,e,r){var i=e,s=null!=i._$hr?i._$hr:i._$Cr;switch(N._$do){default:case N._$Ms:throw new Error("_$L _$ro ");case N._$Qs:for(var n=this._$d0-1;n>=0;--n){s[n*N._$No+4]=r}}},ct.prototype._$zP=function(){this._$GS=new R,this._$GS._$zP()},ct.prototype._$F0=function(t){j.prototype._$F0.call(this,t),this._$LP=t._$6L(),this._$d0=t._$6L(),this._$Yo=t._$6L();var e=t._$nP();this._$BP=new Int16Array(3*this._$Yo);for(var r=3*this._$Yo-1;r>=0;--r)this._$BP[r]=e[r];if(this._$Eo=t._$nP(),this._$Qi=t._$nP(),t.getFormatVersion()>=U._$s7){if(this._$JP=t._$6L(),0!=this._$JP){if(1&this._$JP){var i=t._$6L();null==this._$5P&&(this._$5P=new Object),this._$5P._$Hb=parseInt(i)}this._$JP&ct._$Os?this._$6s=(this._$JP&ct._$Os)>>1:this._$6s=ct._$ms,32&this._$JP&&(this.culling=!1)}}else this._$JP=0},ct.prototype.init=function(t){var e=new dt(this),r=this._$d0*N._$No,i=this._$32();switch(null!=e._$Cr&&(e._$Cr=null),e._$Cr=new Float32Array(r),null!=e._$hr&&(e._$hr=null),e._$hr=i?new Float32Array(r):null,N._$do){default:case N._$Ms:if(N._$Ls)for(var s=this._$d0-1;s>=0;--s){var n=s<<1;this._$Qi[n+1]=1-this._$Qi[n+1]}break;case N._$Qs:for(s=this._$d0-1;s>=0;--s){n=s<<1;var o=s*N._$No,a=this._$Qi[n],h=this._$Qi[n+1];e._$Cr[o]=a,e._$Cr[o+1]=h,e._$Cr[o+4]=0,i&&(e._$hr[o]=a,e._$hr[o+1]=h,e._$hr[o+4]=0)}}return e},ct.prototype._$Nr=function(t,e){var r=e;if(this!=r._$GT()&&console.log("### assert!! ### "),this._$GS._$Ur(t)&&(j.prototype._$Nr.call(this,t,r),!r._$IS[0])){var i=ct._$gT;i[0]=!1,T._$Vr(t,this._$GS,i,this._$d0,this._$Eo,r._$Cr,N._$i2,N._$No)}},ct.prototype._$2b=function(t,e){try{this!=e._$GT()&&console.log("### assert!! ### ");var r=!1;e._$IS[0]&&(r=!0);var i=e;if(!r&&(j.prototype._$2b.call(this,t),this._$32())){var s=this.getTargetBaseDataID();if(i._$8r==j._$ur&&(i._$8r=t.getBaseDataIndex(s)),i._$8r<0)ht._$so&&a._$li("_$L _$0P _$G :: %s",s);else{var n=t.getBaseData(i._$8r),o=t._$q2(i._$8r);null==n||o._$x2()?i._$AT=!1:(n._$nb(t,o,i._$Cr,i._$hr,this._$d0,N._$i2,N._$No),i._$AT=!0),i.baseOpacity=o.getTotalOpacity()}}}catch(t){throw t}},ct.prototype.draw=function(t,e,r){if(this!=r._$GT()&&console.log("### assert!! ### "),!r._$IS[0]){var i=r,s=this._$LP;s<0&&(s=1);var n=this.getOpacity(e,i)*r._$VS*r.baseOpacity,o=null!=i._$hr?i._$hr:i._$Cr;t.setClipBufPre_clipContextForDraw(r.clipBufPre_clipContext),t._$WP(this.culling),t._$Uo(s,3*this._$Yo,this._$BP,o,this._$Qi,n,this._$6s,i)}},ct.prototype.dump=function(){console.log("  _$yi( %d ) , _$d0( %d ) , _$Yo( %d ) \n",this._$LP,this._$d0,this._$Yo),console.log("  _$Oi _$di = { ");for(var t=0;t<this._$BP.length;t++)console.log("%5d ,",this._$BP[t]);console.log("\n  _$5i _$30");for(t=0;t<this._$Eo.length;t++){console.log("\n    _$30[%d] = ",t);for(var e=this._$Eo[t],r=0;r<e.length;r++)console.log("%6.2f, ",e[r])}console.log("\n")},ct.prototype._$72=function(t){return null==this._$5P?null:this._$5P[t]},ct.prototype.getIndexArray=function(){return this._$BP},dt.prototype=new wt,dt.prototype.getTransformedPoints=function(){return null!=this._$hr?this._$hr:this._$Cr},ft.prototype._$HT=function(t){this.x=t.x,this.y=t.y},ft.prototype._$HT=function(t,e){this.x=t,this.y=e},pt.prototype=new e,pt.loadModel=function(t){var r=new pt;return e._$62(r,t),r},pt.loadModel=function(t,r){var i=new pt(r||0);return e._$62(i,t),i},pt._$to=function(){return new pt},pt._$er=function(t){var e=new _$5("../_$_r/_$t0/_$Ri/_$_P._$d");if(0==e.exists())throw new _$ls("_$t0 _$_ _$6 _$Ui :: "+e._$PL());for(var r=["../_$_r/_$t0/_$Ri/_$_P.512/_$CP._$1","../_$_r/_$t0/_$Ri/_$_P.512/_$vP._$1","../_$_r/_$t0/_$Ri/_$_P.512/_$EP._$1","../_$_r/_$t0/_$Ri/_$_P.512/_$pP._$1"],i=pt.loadModel(e._$3b()),s=0;s<r.length;s++){var n=new _$5(r[s]);if(0==n.exists())throw new _$ls("_$t0 _$_ _$6 _$Ui :: "+n._$PL());i.setTexture(s,_$nL._$_o(t,n._$3b()))}return i},pt.prototype.setGL=function(t){ht.setGL(t)},pt.prototype.setTransform=function(t){this.drawParamWebGL.setTransform(t)},pt.prototype.update=function(){this._$5S.update(),this._$5S.preDraw(this.drawParamWebGL)},pt.prototype.draw=function(){this._$5S.draw(this.drawParamWebGL)},pt.prototype._$K2=function(){this.drawParamWebGL._$K2()},pt.prototype.setTexture=function(t,e){null==this.drawParamWebGL&&a._$li("_$Yi for QT _$ki / _$XS() is _$6 _$ui!!"),this.drawParamWebGL.setTexture(t,e)},pt.prototype.setTexture=function(t,e){null==this.drawParamWebGL&&a._$li("_$Yi for QT _$ki / _$XS() is _$6 _$ui!!"),this.drawParamWebGL.setTexture(t,e)},pt.prototype._$Rs=function(){return this.drawParamWebGL._$Rs()},pt.prototype._$Ds=function(t){this.drawParamWebGL._$Ds(t)},pt.prototype.getDrawParam=function(){return this.drawParamWebGL},pt.prototype.setMatrix=function(t){this.drawParamWebGL.setMatrix(t)},pt.prototype.setPremultipliedAlpha=function(t){this.drawParamWebGL.setPremultipliedAlpha(t)},pt.prototype.isPremultipliedAlpha=function(){return this.drawParamWebGL.isPremultipliedAlpha()},pt.prototype.setAnisotropy=function(t){this.drawParamWebGL.setAnisotropy(t)},pt.prototype.getAnisotropy=function(){return this.drawParamWebGL.getAnisotropy()},_t.prototype._$tb=function(){return this.motions},_t.prototype.startMotion=function(t,e){for(var r=null,i=this.motions.length,s=0;s<i;++s)null!=(r=this.motions[s])&&(r._$qS(r._$w0.getFadeOut()),this._$eb&&a._$Ji("MotionQueueManager[size:%2d]->startMotion() / start _$K _$3 (m%d)\n",i,r._$sr));if(null==t)return-1;(r=new mt)._$w0=t,this.motions.push(r);var n=r._$sr;return this._$eb&&a._$Ji("MotionQueueManager[size:%2d]->startMotion() / new _$w0 (m%d)\n",i,n),n},_t.prototype.updateParam=function(t){try{for(var e=!1,r=0;r<this.motions.length;r++){var i=this.motions[r];if(null!=i){var s=i._$w0;null!=s?(s.updateParam(t,i),e=!0,i.isFinished()&&(this._$eb&&a._$Ji("MotionQueueManager[size:%2d]->updateParam() / _$T0 _$w0 (m%d)\n",this.motions.length-1,i._$sr),this.motions.splice(r,1),r--)):(this.motions=this.motions.splice(r,1),r--)}else this.motions.splice(r,1),r--}return e}catch(t){return a._$li(t),!0}},_t.prototype.isFinished=function(t){if(arguments.length>=1){for(var e=0;e<this.motions.length;e++){if(null!=(r=this.motions[e])&&(r._$sr==t&&!r.isFinished()))return!1}return!0}for(e=0;e<this.motions.length;e++){var r;if(null!=(r=this.motions[e]))if(null!=r._$w0){if(!r.isFinished())return!1}else this.motions.splice(e,1),e--;else this.motions.splice(e,1),e--}return!0},_t.prototype.stopAllMotions=function(){for(var t=0;t<this.motions.length;t++){var e=this.motions[t];if(null!=e){e._$w0;this.motions.splice(t,1),t--}else this.motions.splice(t,1),t--}},_t.prototype._$Zr=function(t){this._$eb=t},_t.prototype._$e=function(){console.log("-- _$R --\n");for(var t=0;t<this.motions.length;t++){var e=this.motions[t]._$w0;console.log("MotionQueueEnt[%d] :: %s\n",this.motions.length,e.toString())}},mt._$Gs=0,mt.prototype.isFinished=function(){return this._$9L},mt.prototype._$qS=function(t){var e=M.getUserTimeMSec()+t;(this._$Do<0||e<this._$Do)&&(this._$Do=e)},mt.prototype._$Bs=function(){return this._$sr},gt.prototype.setContext=function(t){var e=this.m;t.transform(e[0],e[1],e[3],e[4],e[6],e[7])},gt.prototype.toString=function(){for(var t="LDTransform { ",e=0;e<9;e++)t+=this.m[e].toFixed(2)+" ,";return t+=" }"},gt.prototype.identity=function(){var t=this.m;t[0]=t[4]=t[8]=1,t[1]=t[2]=t[3]=t[5]=t[6]=t[7]=0},gt.prototype._$PS=function(t,e,r){null==r&&(r=new Array(0,0));var i=this.m;return r[0]=i[0]*t+i[3]*e+i[6],r[1]=i[1]*t+i[4]*e+i[7],r},gt.prototype._$P2=function(t){t||(t=new gt);var e=this.m,r=e[0],i=e[1],s=e[2],n=e[3],o=e[4],a=e[5],h=e[6],l=e[7],u=e[8],c=r*o*u+i*a*h+s*n*l-r*a*l-s*o*h-i*n*u;if(0==c)return null;var d=1/c;return t.m[0]=d*(o*u-l*a),t.m[1]=d*(l*s-i*u),t.m[2]=d*(i*a-o*s),t.m[3]=d*(h*a-n*u),t.m[4]=d*(r*u-h*s),t.m[5]=d*(n*s-r*a),t.m[6]=d*(n*l-h*o),t.m[7]=d*(h*i-r*l),t.m[8]=d*(r*o-n*i),t},gt.prototype.transform=function(t,e,r){null==r&&(r=new Array(0,0));var i=this.m;return r[0]=i[0]*t+i[3]*e+i[6],r[1]=i[1]*t+i[4]*e+i[7],r},gt.prototype.translate=function(t,e){var r=this.m;r[6]=r[0]*t+r[3]*e+r[6],r[7]=r[1]*t+r[4]*e+r[7],r[8]=r[2]*t+r[5]*e+r[8]},gt.prototype.scale=function(t,e){var r=this.m;r[0]*=t,r[1]*=t,r[2]*=t,r[3]*=e,r[4]*=e,r[5]*=e},gt.prototype.shear=function(t,e){var r=this.m,i=r[0]+r[3]*e,s=r[1]+r[4]*e,n=r[2]+r[5]*e;r[3]=r[0]*t+r[3],r[4]=r[1]*t+r[4],r[5]=r[2]*t+r[5],r[0]=i,r[1]=s,r[2]=n},gt.prototype.rotate=function(t){var e=this.m,r=Math.cos(t),i=Math.sin(t),s=e[0]*r+e[3]*i,n=e[1]*r+e[4]*i,o=e[2]*r+e[5]*i;e[3]=-e[0]*i+e[3]*r,e[4]=-e[1]*i+e[4]*r,e[5]=-e[2]*i+e[5]*r,e[0]=s,e[1]=n,e[2]=o},gt.prototype.concatenate=function(t){var e=this.m,r=t.m,i=e[0]*r[0]+e[3]*r[1]+e[6]*r[2],s=e[1]*r[0]+e[4]*r[1]+e[7]*r[2],n=e[2]*r[0]+e[5]*r[1]+e[8]*r[2],o=e[0]*r[3]+e[3]*r[4]+e[6]*r[5],a=e[1]*r[3]+e[4]*r[4]+e[7]*r[5],h=e[2]*r[3]+e[5]*r[4]+e[8]*r[5],l=e[0]*r[6]+e[3]*r[7]+e[6]*r[8],u=e[1]*r[6]+e[4]*r[7]+e[7]*r[8],c=e[2]*r[6]+e[5]*r[7]+e[8]*r[8];m[0]=i,m[1]=s,m[2]=n,m[3]=o,m[4]=a,m[5]=h,m[6]=l,m[7]=u,m[8]=c},yt.prototype=new it,yt._$eT=null,yt._$tP=new Object,yt._$2o=function(){return null==yt._$eT&&(yt._$eT=yt.getID("DST_BASE")),yt._$eT},yt._$27=function(){yt._$tP.clear(),yt._$eT=null},yt.getID=function(t){var e=yt._$tP[t];return null==e&&(e=new yt(t),yt._$tP[t]=e),e},yt.prototype._$3s=function(){return new yt},bt.prototype=new S,bt._$9r=function(t){return new Float32Array(t)},bt._$vb=function(t){return new Int16Array(t)},bt._$cr=function(t,e){return null==t||t._$yL()<e.length?((t=bt._$9r(2*e.length)).put(e),t._$oT(0)):(t.clear(),t.put(e),t._$oT(0)),t},bt._$mb=function(t,e){return null==t||t._$yL()<e.length?((t=bt._$vb(2*e.length)).put(e),t._$oT(0)):(t.clear(),t.put(e),t._$oT(0)),t},bt._$Hs=function(){return this._$Gr},bt._$as=function(t){this._$Gr=t},bt.prototype.getGL=function(){return this.gl},bt.prototype.setGL=function(t){this.gl=t},bt.prototype.setTransform=function(t){this.transform=t},bt.prototype._$ZT=function(){var t=this.gl;this.firstDraw&&(this.initShader(),this.firstDraw=!1,this.anisotropyExt=t.getExtension("EXT_texture_filter_anisotropic")||t.getExtension("WEBKIT_EXT_texture_filter_anisotropic")||t.getExtension("MOZ_EXT_texture_filter_anisotropic"),this.anisotropyExt&&(this.maxAnisotropy=t.getParameter(this.anisotropyExt.MAX_TEXTURE_MAX_ANISOTROPY_EXT))),t.disable(t.SCISSOR_TEST),t.disable(t.STENCIL_TEST),t.disable(t.DEPTH_TEST),t.frontFace(t.CW),t.enable(t.BLEND),t.colorMask(1,1,1,1),t.bindBuffer(t.ARRAY_BUFFER,null),t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,null)},bt.prototype._$Uo=function(t,e,r,i,s,n,o,a){if(!(n<.01&&null==this.clipBufPre_clipContextMask)){n>.9&&ht.EXPAND_W;var h=this.gl;if(null==this.gl)throw new Error("gl is null");var l,u,c,d,f=1*this._$C0*n,p=1*this._$tT*n,_=1*this._$WL*n,m=this._$lT*n;if(null!=this.clipBufPre_clipContextMask){h.frontFace(h.CCW),h.useProgram(this.shaderProgram),this._$vS=vt(h,this._$vS,i),this._$no=xt(h,this._$no,r),h.enableVertexAttribArray(this.a_position_Loc),h.vertexAttribPointer(this.a_position_Loc,2,h.FLOAT,!1,0,0),this._$NT=vt(h,this._$NT,s),h.activeTexture(h.TEXTURE1),h.bindTexture(h.TEXTURE_2D,this.textures[t]),h.uniform1i(this.s_texture0_Loc,1),h.enableVertexAttribArray(this.a_texCoord_Loc),h.vertexAttribPointer(this.a_texCoord_Loc,2,h.FLOAT,!1,0,0),h.uniformMatrix4fv(this.u_matrix_Loc,!1,this.getClipBufPre_clipContextMask().matrixForMask);var g=this.getClipBufPre_clipContextMask().layoutChannelNo,y=this.getChannelFlagAsColor(g);h.uniform4f(this.u_channelFlag,y.r,y.g,y.b,y.a);var b=this.getClipBufPre_clipContextMask().layoutBounds;h.uniform4f(this.u_baseColor_Loc,2*b.x-1,2*b.y-1,2*b._$EL()-1,2*b._$5T()-1),h.uniform1i(this.u_maskFlag_Loc,!0)}else if(null!=this.getClipBufPre_clipContextDraw()){h.useProgram(this.shaderProgramOff),this._$vS=vt(h,this._$vS,i),this._$no=xt(h,this._$no,r),h.enableVertexAttribArray(this.a_position_Loc_Off),h.vertexAttribPointer(this.a_position_Loc_Off,2,h.FLOAT,!1,0,0),this._$NT=vt(h,this._$NT,s),h.activeTexture(h.TEXTURE1),h.bindTexture(h.TEXTURE_2D,this.textures[t]),h.uniform1i(this.s_texture0_Loc_Off,1),h.enableVertexAttribArray(this.a_texCoord_Loc_Off),h.vertexAttribPointer(this.a_texCoord_Loc_Off,2,h.FLOAT,!1,0,0),h.uniformMatrix4fv(this.u_clipMatrix_Loc_Off,!1,this.getClipBufPre_clipContextDraw().matrixForDraw),h.uniformMatrix4fv(this.u_matrix_Loc_Off,!1,this.matrix4x4),h.activeTexture(h.TEXTURE2),h.bindTexture(h.TEXTURE_2D,ht.fTexture[this.glno]),h.uniform1i(this.s_texture1_Loc_Off,2);g=this.getClipBufPre_clipContextDraw().layoutChannelNo,y=this.getChannelFlagAsColor(g);h.uniform4f(this.u_channelFlag_Loc_Off,y.r,y.g,y.b,y.a),h.uniform4f(this.u_baseColor_Loc_Off,f,p,_,m)}else h.useProgram(this.shaderProgram),this._$vS=vt(h,this._$vS,i),this._$no=xt(h,this._$no,r),h.enableVertexAttribArray(this.a_position_Loc),h.vertexAttribPointer(this.a_position_Loc,2,h.FLOAT,!1,0,0),this._$NT=vt(h,this._$NT,s),h.activeTexture(h.TEXTURE1),h.bindTexture(h.TEXTURE_2D,this.textures[t]),h.uniform1i(this.s_texture0_Loc,1),h.enableVertexAttribArray(this.a_texCoord_Loc),h.vertexAttribPointer(this.a_texCoord_Loc,2,h.FLOAT,!1,0,0),h.uniformMatrix4fv(this.u_matrix_Loc,!1,this.matrix4x4),h.uniform4f(this.u_baseColor_Loc,f,p,_,m),h.uniform1i(this.u_maskFlag_Loc,!1);if(this.culling?this.gl.enable(h.CULL_FACE):this.gl.disable(h.CULL_FACE),this.gl.enable(h.BLEND),null!=this.clipBufPre_clipContextMask)l=h.ONE,u=h.ONE_MINUS_SRC_ALPHA,c=h.ONE,d=h.ONE_MINUS_SRC_ALPHA;else switch(o){case ct._$ms:l=h.ONE,u=h.ONE_MINUS_SRC_ALPHA,c=h.ONE,d=h.ONE_MINUS_SRC_ALPHA;break;case ct._$ns:l=h.ONE,u=h.ONE,c=h.ZERO,d=h.ONE;break;case ct._$_s:l=h.DST_COLOR,u=h.ONE_MINUS_SRC_ALPHA,c=h.ZERO,d=h.ONE}h.blendEquationSeparate(h.FUNC_ADD,h.FUNC_ADD),h.blendFuncSeparate(l,u,c,d),this.anisotropyExt&&h.texParameteri(h.TEXTURE_2D,this.anisotropyExt.TEXTURE_MAX_ANISOTROPY_EXT,this.maxAnisotropy);var v=r.length;h.drawElements(h.TRIANGLES,v,h.UNSIGNED_SHORT,0),h.bindTexture(h.TEXTURE_2D,null)}},bt.prototype._$Rs=function(){throw new Error("_$Rs")},bt.prototype._$Ds=function(t){throw new Error("_$Ds")},bt.prototype._$K2=function(){for(var t=0;t<this.textures.length;t++){0!=this.textures[t]&&(this.gl._$K2(1,this.textures,t),this.textures[t]=null)}},bt.prototype.setTexture=function(t,e){this.textures[t]=e},bt.prototype.initShader=function(){var t=this.gl;this.loadShaders2(),this.a_position_Loc=t.getAttribLocation(this.shaderProgram,"a_position"),this.a_texCoord_Loc=t.getAttribLocation(this.shaderProgram,"a_texCoord"),this.u_matrix_Loc=t.getUniformLocation(this.shaderProgram,"u_mvpMatrix"),this.s_texture0_Loc=t.getUniformLocation(this.shaderProgram,"s_texture0"),this.u_channelFlag=t.getUniformLocation(this.shaderProgram,"u_channelFlag"),this.u_baseColor_Loc=t.getUniformLocation(this.shaderProgram,"u_baseColor"),this.u_maskFlag_Loc=t.getUniformLocation(this.shaderProgram,"u_maskFlag"),this.a_position_Loc_Off=t.getAttribLocation(this.shaderProgramOff,"a_position"),this.a_texCoord_Loc_Off=t.getAttribLocation(this.shaderProgramOff,"a_texCoord"),this.u_matrix_Loc_Off=t.getUniformLocation(this.shaderProgramOff,"u_mvpMatrix"),this.u_clipMatrix_Loc_Off=t.getUniformLocation(this.shaderProgramOff,"u_ClipMatrix"),this.s_texture0_Loc_Off=t.getUniformLocation(this.shaderProgramOff,"s_texture0"),this.s_texture1_Loc_Off=t.getUniformLocation(this.shaderProgramOff,"s_texture1"),this.u_channelFlag_Loc_Off=t.getUniformLocation(this.shaderProgramOff,"u_channelFlag"),this.u_baseColor_Loc_Off=t.getUniformLocation(this.shaderProgramOff,"u_baseColor")},bt.prototype.disposeShader=function(){var t=this.gl;this.shaderProgram&&(t.deleteProgram(this.shaderProgram),this.shaderProgram=null),this.shaderProgramOff&&(t.deleteProgram(this.shaderProgramOff),this.shaderProgramOff=null)},bt.prototype.compileShader=function(t,e){var r=this.gl,i=e,s=r.createShader(t);if(null==s)return a._$Ji("_$L0 to create shader"),null;if(r.shaderSource(s,i),r.compileShader(s),!r.getShaderParameter(s,r.COMPILE_STATUS)){var n=r.getShaderInfoLog(s);return a._$Ji("_$L0 to compile shader : "+n),r.deleteShader(s),null}return s},bt.prototype.loadShaders2=function(){var t=this.gl;if(this.shaderProgram=t.createProgram(),!this.shaderProgram)return!1;if(this.shaderProgramOff=t.createProgram(),!this.shaderProgramOff)return!1;if(this.vertShader=this.compileShader(t.VERTEX_SHADER,"attribute vec4     a_position;attribute vec2     a_texCoord;varying vec2       v_texCoord;varying vec4       v_ClipPos;uniform mat4       u_mvpMatrix;void main(){    gl_Position = u_mvpMatrix * a_position;    v_ClipPos = u_mvpMatrix * a_position;    v_texCoord = a_texCoord;}"),!this.vertShader)return a._$Ji("Vertex shader compile _$li!"),!1;if(this.vertShaderOff=this.compileShader(t.VERTEX_SHADER,"attribute vec4     a_position;attribute vec2     a_texCoord;varying vec2       v_texCoord;varying vec4       v_ClipPos;uniform mat4       u_mvpMatrix;uniform mat4       u_ClipMatrix;void main(){    gl_Position = u_mvpMatrix * a_position;    v_ClipPos = u_ClipMatrix * a_position;    v_texCoord = a_texCoord ;}"),!this.vertShaderOff)return a._$Ji("OffVertex shader compile _$li!"),!1;if(this.fragShader=this.compileShader(t.FRAGMENT_SHADER,"precision mediump float;varying vec2       v_texCoord;varying vec4       v_ClipPos;uniform sampler2D  s_texture0;uniform vec4       u_channelFlag;uniform vec4       u_baseColor;uniform bool       u_maskFlag;void main(){    vec4 smpColor;     if(u_maskFlag){        float isInside =             step(u_baseColor.x, v_ClipPos.x/v_ClipPos.w)          * step(u_baseColor.y, v_ClipPos.y/v_ClipPos.w)          * step(v_ClipPos.x/v_ClipPos.w, u_baseColor.z)          * step(v_ClipPos.y/v_ClipPos.w, u_baseColor.w);        smpColor = u_channelFlag * texture2D(s_texture0 , v_texCoord).a * isInside;    }else{        smpColor = texture2D(s_texture0 , v_texCoord) * u_baseColor;    }    gl_FragColor = smpColor;}"),!this.fragShader)return a._$Ji("Fragment shader compile _$li!"),!1;if(this.fragShaderOff=this.compileShader(t.FRAGMENT_SHADER,"precision mediump float ;varying vec2       v_texCoord;varying vec4       v_ClipPos;uniform sampler2D  s_texture0;uniform sampler2D  s_texture1;uniform vec4       u_channelFlag;uniform vec4       u_baseColor ;void main(){    vec4 col_formask = texture2D(s_texture0, v_texCoord) * u_baseColor;    vec4 clipMask = texture2D(s_texture1, v_ClipPos.xy / v_ClipPos.w) * u_channelFlag;    float maskVal = clipMask.r + clipMask.g + clipMask.b + clipMask.a;    col_formask = col_formask * maskVal;    gl_FragColor = col_formask;}"),!this.fragShaderOff)return a._$Ji("OffFragment shader compile _$li!"),!1;if(t.attachShader(this.shaderProgram,this.vertShader),t.attachShader(this.shaderProgram,this.fragShader),t.attachShader(this.shaderProgramOff,this.vertShaderOff),t.attachShader(this.shaderProgramOff,this.fragShaderOff),t.linkProgram(this.shaderProgram),t.linkProgram(this.shaderProgramOff),!t.getProgramParameter(this.shaderProgram,t.LINK_STATUS)){var e=t.getProgramInfoLog(this.shaderProgram);return a._$Ji("_$L0 to link program: "+e),this.vertShader&&(t.deleteShader(this.vertShader),this.vertShader=0),this.fragShader&&(t.deleteShader(this.fragShader),this.fragShader=0),this.shaderProgram&&(t.deleteProgram(this.shaderProgram),this.shaderProgram=0),this.vertShaderOff&&(t.deleteShader(this.vertShaderOff),this.vertShaderOff=0),this.fragShaderOff&&(t.deleteShader(this.fragShaderOff),this.fragShaderOff=0),this.shaderProgramOff&&(t.deleteProgram(this.shaderProgramOff),this.shaderProgramOff=0),!1}return!0},bt.prototype.createFramebuffer=function(){var t=this.gl,e=ht.clippingMaskBufferSize,r=t.createFramebuffer();t.bindFramebuffer(t.FRAMEBUFFER,r);var i=t.createRenderbuffer();t.bindRenderbuffer(t.RENDERBUFFER,i),t.renderbufferStorage(t.RENDERBUFFER,t.RGBA4,e,e),t.framebufferRenderbuffer(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.RENDERBUFFER,i);var s=t.createTexture();return t.bindTexture(t.TEXTURE_2D,s),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,e,e,0,t.RGBA,t.UNSIGNED_BYTE,null),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,s,0),t.bindTexture(t.TEXTURE_2D,null),t.bindRenderbuffer(t.RENDERBUFFER,null),t.bindFramebuffer(t.FRAMEBUFFER,null),ht.fTexture[this.glno]=s,{framebuffer:r,renderbuffer:i,texture:ht.fTexture[this.glno]}},At.prototype._$fP=function(){var t,e,r,i=this._$ST();if(128&i){if(128&(t=this._$ST())){if(128&(e=this._$ST())){if(128&(r=this._$ST()))throw new ut("_$L _$0P  _");return(127&i)<<21|(127&t)<<14|(127&e)<<7|255&r}return(127&i)<<14|(127&t)<<7|255&e}return(127&i)<<7|127&t}return 255&i},At.prototype.getFormatVersion=function(){return this._$S2},At.prototype._$gr=function(t){this._$S2=t},At.prototype._$3L=function(){return this._$fP()},At.prototype._$mP=function(){return this._$zT(),this._$F+=8,this._$T.getFloat64(this._$F-8)},At.prototype._$_T=function(){return this._$zT(),this._$F+=4,this._$T.getFloat32(this._$F-4)},At.prototype._$6L=function(){return this._$zT(),this._$F+=4,this._$T.getInt32(this._$F-4)},At.prototype._$ST=function(){return this._$zT(),this._$T.getInt8(this._$F++)},At.prototype._$9T=function(){return this._$zT(),this._$F+=2,this._$T.getInt16(this._$F-2)},At.prototype._$2T=function(){throw this._$zT(),this._$F+=8,new ut("_$L _$q read long")},At.prototype._$po=function(){return this._$zT(),0!=this._$T.getInt8(this._$F++)};var Tt=!0;function Et(){}function wt(e){t||(this._$e0=null,this._$IP=null,this._$Us=null,this._$7s=null,this._$IS=[!1],this._$VS=null,this._$AT=!0,this.baseOpacity=1,this.clipBufPre_clipContext=null,this._$e0=e)}function St(){}At.prototype._$bT=function(){this._$zT();var t=this._$3L(),e=null;if(Tt)try{var r=new ArrayBuffer(2*t);e=new Uint16Array(r);for(var i=0;i<t;++i)e[i]=this._$T.getUint8(this._$F++);return String.fromCharCode.apply(null,e)}catch(t){Tt=!1}try{var s=new Array;if(null==e)for(i=0;i<t;++i)s[i]=this._$T.getUint8(this._$F++);else for(i=0;i<t;++i)s[i]=e[i];return String.fromCharCode.apply(null,s)}catch(t){console.log("read utf8 / _$rT _$L0 !! : "+t)}},At.prototype._$cS=function(){this._$zT();for(var t=this._$3L(),e=new Int32Array(t),r=0;r<t;r++)e[r]=this._$T.getInt32(this._$F),this._$F+=4;return e},At.prototype._$Tb=function(){this._$zT();for(var t=this._$3L(),e=new Float32Array(t),r=0;r<t;r++)e[r]=this._$T.getFloat32(this._$F),this._$F+=4;return e},At.prototype._$5b=function(){this._$zT();for(var t=this._$3L(),e=new Float64Array(t),r=0;r<t;r++)e[r]=this._$T.getFloat64(this._$F),this._$F+=8;return e},At.prototype._$nP=function(){return this._$Jb(-1)},At.prototype._$Jb=function(t){if(this._$zT(),t<0&&(t=this._$3L()),t==U._$7P){var e=this._$6L();if(0<=e&&e<this._$Ko.length)return this._$Ko[e];throw new ut("_$sL _$4i @_$m0")}var r=this._$4b(t);return this._$Ko.push(r),r},At.prototype._$4b=function(t){if(0==t)return null;if(50==t){var e=this._$bT();return s=L.getID(e)}if(51==t){e=this._$bT();return s=yt.getID(e)}if(134==t){e=this._$bT();return s=u.getID(e)}if(60==t){e=this._$bT();return s=c.getID(e)}if(t>=48){var r=U._$9o(t);return null!=r?(r._$F0(this),r):null}switch(t){case 1:return this._$bT();case 10:return new n(this._$6L(),!0);case 11:return new A(this._$mP(),this._$mP(),this._$mP(),this._$mP());case 12:return new A(this._$_T(),this._$_T(),this._$_T(),this._$_T());case 13:return new E(this._$mP(),this._$mP());case 14:return new E(this._$_T(),this._$_T());case 15:for(var i=this._$3L(),s=new Array(i),o=0;o<i;o++)s[o]=this._$nP();return s;case 17:return s=new F(this._$mP(),this._$mP(),this._$mP(),this._$mP(),this._$mP(),this._$mP());case 21:return new l(this._$6L(),this._$6L(),this._$6L(),this._$6L());case 22:return new ft(this._$6L(),this._$6L());case 23:throw new Error("_$L _$ro ");case 16:case 25:return this._$cS();case 26:return this._$5b();case 27:return this._$Tb();case 2:case 3:case 4:case 5:case 6:case 7:case 8:case 9:case 18:case 19:case 20:case 24:case 28:throw new ut("_$6 _$q : _$nP() of 2-9 ,18,19,20,24,28 : "+t);default:throw new ut("_$6 _$q : _$nP() NO _$i : "+t)}},At.prototype._$8L=function(){return 0==this._$hL?this._$v0=this._$ST():8==this._$hL&&(this._$v0=this._$ST(),this._$hL=0),1==(this._$v0>>7-this._$hL++&1)},At.prototype._$zT=function(){0!=this._$hL&&(this._$hL=0)},Et._$2S=Math.PI/180,Et._$bS=Math.PI/180,Et._$wS=180/Math.PI,Et._$NS=180/Math.PI,Et.PI_F=Math.PI,Et._$kT=[0,.012368,.024734,.037097,.049454,.061803,.074143,.086471,.098786,.111087,.12337,.135634,.147877,.160098,.172295,.184465,.196606,.208718,.220798,.232844,.244854,.256827,.268761,.280654,.292503,.304308,.316066,.327776,.339436,.351044,.362598,.374097,.385538,.396921,.408243,.419502,.430697,.441826,.452888,.463881,.474802,.485651,.496425,.507124,.517745,.528287,.538748,.549126,.559421,.56963,.579752,.589785,.599728,.609579,.619337,.629,.638567,.648036,.657406,.666676,.675843,.684908,.693867,.70272,.711466,.720103,.72863,.737045,.745348,.753536,.76161,.769566,.777405,.785125,.792725,.800204,.807561,.814793,.821901,.828884,.835739,.842467,.849066,.855535,.861873,.868079,.874153,.880093,.885898,.891567,.897101,.902497,.907754,.912873,.917853,.922692,.92739,.931946,.936359,.940629,.944755,.948737,.952574,.956265,.959809,.963207,.966457,.96956,.972514,.97532,.977976,.980482,.982839,.985045,.987101,.989006,.990759,.992361,.993811,.995109,.996254,.997248,.998088,.998776,.999312,.999694,.999924,1],Et._$92=function(t,e){var r=Math.atan2(t[1],t[0]),i=Math.atan2(e[1],e[0]);return Et._$tS(r,i)},Et._$tS=function(t,e){for(var r=t-e;r<-Math.PI;)r+=2*Math.PI;for(;r>Math.PI;)r-=2*Math.PI;return r},Et._$9=function(t){return Math.sin(t)},Et.fcos=function(t){return Math.cos(t)},wt.prototype._$u2=function(){return this._$IS[0]},wt.prototype._$yo=function(){return this._$AT&&!this._$IS[0]},wt.prototype._$GT=function(){return this._$e0},St._$W2=0,St.SYSTEM_INFO=null,St.USER_AGENT=navigator.userAgent,St.isIPhone=function(){return St.SYSTEM_INFO||St.setup(),St.SYSTEM_INFO._isIPhone},St.isIOS=function(){return St.SYSTEM_INFO||St.setup(),St.SYSTEM_INFO._isIPhone||St.SYSTEM_INFO._isIPad},St.isAndroid=function(){return St.SYSTEM_INFO||St.setup(),St.SYSTEM_INFO._isAndroid},St.getOSVersion=function(){return St.SYSTEM_INFO||St.setup(),St.SYSTEM_INFO.version},St.getOS=function(){return St.SYSTEM_INFO||St.setup(),St.SYSTEM_INFO._isIPhone||St.SYSTEM_INFO._isIPad?"iOS":St.SYSTEM_INFO._isAndroid?"Android":"_$Q0 OS"},St.setup=function(){var t,e=St.USER_AGENT;function r(t,e){for(var r=t.substring(e).split(/[ _,;\.]/),i=0,s=0;s<=2&&!isNaN(r[s]);s++){var n=parseInt(r[s]);if(n<0||n>999){a._$li("err : "+n+" @UtHtml5.setup()"),i=0;break}i+=n*Math.pow(1e3,2-s)}return i}var i=St.SYSTEM_INFO={userAgent:e};if((t=e.indexOf("iPhone OS "))>=0)i.os="iPhone",i._isIPhone=!0,i.version=r(e,t+10);else if((t=e.indexOf("iPad"))>=0){if((t=e.indexOf("CPU OS"))<0)return void a._$li(" err : "+e+" @UtHtml5.setup()");i.os="iPad",i._isIPad=!0,i.version=r(e,t+7)}else(t=e.indexOf("Android"))>=0?(i.os="Android",i._isAndroid=!0,i.version=r(e,t+8)):(i.os="-",i.version=-1)},window.UtSystem=M,window.UtDebug=a,window.LDTransform=gt,window.LDGL=nt,window.Live2D=ht,window.Live2DModelWebGL=pt,window.Live2DModelJS=Z,window.Live2DMotion=Q,window.MotionQueueManager=_t,window.PhysicsHair=f,window.AMotion=o,window.PartsDataID=u,window.DrawDataID=L,window.BaseDataID=yt,window.ParamID=c,ht.init();t=!1}();
/*!
 * pixi.js - v7.4.2
 * Compiled Wed, 20 Mar 2024 19:55:28 UTC
 *
 * pixi.js is licensed under the MIT License.
 * http://www.opensource.org/licenses/mit-license
 */
var PIXI=function(t){"use strict";var e,r=((e=r||{})[e.WEBGL_LEGACY=0]="WEBGL_LEGACY",e[e.WEBGL=1]="WEBGL",e[e.WEBGL2=2]="WEBGL2",e),i=(t=>(t[t.UNKNOWN=0]="UNKNOWN",t[t.WEBGL=1]="WEBGL",t[t.CANVAS=2]="CANVAS",t))(i||{}),s=(t=>(t[t.COLOR=16384]="COLOR",t[t.DEPTH=256]="DEPTH",t[t.STENCIL=1024]="STENCIL",t))(s||{}),n=(t=>(t[t.NORMAL=0]="NORMAL",t[t.ADD=1]="ADD",t[t.MULTIPLY=2]="MULTIPLY",t[t.SCREEN=3]="SCREEN",t[t.OVERLAY=4]="OVERLAY",t[t.DARKEN=5]="DARKEN",t[t.LIGHTEN=6]="LIGHTEN",t[t.COLOR_DODGE=7]="COLOR_DODGE",t[t.COLOR_BURN=8]="COLOR_BURN",t[t.HARD_LIGHT=9]="HARD_LIGHT",t[t.SOFT_LIGHT=10]="SOFT_LIGHT",t[t.DIFFERENCE=11]="DIFFERENCE",t[t.EXCLUSION=12]="EXCLUSION",t[t.HUE=13]="HUE",t[t.SATURATION=14]="SATURATION",t[t.COLOR=15]="COLOR",t[t.LUMINOSITY=16]="LUMINOSITY",t[t.NORMAL_NPM=17]="NORMAL_NPM",t[t.ADD_NPM=18]="ADD_NPM",t[t.SCREEN_NPM=19]="SCREEN_NPM",t[t.NONE=20]="NONE",t[t.SRC_OVER=0]="SRC_OVER",t[t.SRC_IN=21]="SRC_IN",t[t.SRC_OUT=22]="SRC_OUT",t[t.SRC_ATOP=23]="SRC_ATOP",t[t.DST_OVER=24]="DST_OVER",t[t.DST_IN=25]="DST_IN",t[t.DST_OUT=26]="DST_OUT",t[t.DST_ATOP=27]="DST_ATOP",t[t.ERASE=26]="ERASE",t[t.SUBTRACT=28]="SUBTRACT",t[t.XOR=29]="XOR",t))(n||{}),o=(t=>(t[t.POINTS=0]="POINTS",t[t.LINES=1]="LINES",t[t.LINE_LOOP=2]="LINE_LOOP",t[t.LINE_STRIP=3]="LINE_STRIP",t[t.TRIANGLES=4]="TRIANGLES",t[t.TRIANGLE_STRIP=5]="TRIANGLE_STRIP",t[t.TRIANGLE_FAN=6]="TRIANGLE_FAN",t))(o||{}),a=(t=>(t[t.RGBA=6408]="RGBA",t[t.RGB=6407]="RGB",t[t.RG=33319]="RG",t[t.RED=6403]="RED",t[t.RGBA_INTEGER=36249]="RGBA_INTEGER",t[t.RGB_INTEGER=36248]="RGB_INTEGER",t[t.RG_INTEGER=33320]="RG_INTEGER",t[t.RED_INTEGER=36244]="RED_INTEGER",t[t.ALPHA=6406]="ALPHA",t[t.LUMINANCE=6409]="LUMINANCE",t[t.LUMINANCE_ALPHA=6410]="LUMINANCE_ALPHA",t[t.DEPTH_COMPONENT=6402]="DEPTH_COMPONENT",t[t.DEPTH_STENCIL=34041]="DEPTH_STENCIL",t))(a||{}),h=(t=>(t[t.TEXTURE_2D=3553]="TEXTURE_2D",t[t.TEXTURE_CUBE_MAP=34067]="TEXTURE_CUBE_MAP",t[t.TEXTURE_2D_ARRAY=35866]="TEXTURE_2D_ARRAY",t[t.TEXTURE_CUBE_MAP_POSITIVE_X=34069]="TEXTURE_CUBE_MAP_POSITIVE_X",t[t.TEXTURE_CUBE_MAP_NEGATIVE_X=34070]="TEXTURE_CUBE_MAP_NEGATIVE_X",t[t.TEXTURE_CUBE_MAP_POSITIVE_Y=34071]="TEXTURE_CUBE_MAP_POSITIVE_Y",t[t.TEXTURE_CUBE_MAP_NEGATIVE_Y=34072]="TEXTURE_CUBE_MAP_NEGATIVE_Y",t[t.TEXTURE_CUBE_MAP_POSITIVE_Z=34073]="TEXTURE_CUBE_MAP_POSITIVE_Z",t[t.TEXTURE_CUBE_MAP_NEGATIVE_Z=34074]="TEXTURE_CUBE_MAP_NEGATIVE_Z",t))(h||{}),l=(t=>(t[t.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",t[t.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",t[t.UNSIGNED_SHORT_5_6_5=33635]="UNSIGNED_SHORT_5_6_5",t[t.UNSIGNED_SHORT_4_4_4_4=32819]="UNSIGNED_SHORT_4_4_4_4",t[t.UNSIGNED_SHORT_5_5_5_1=32820]="UNSIGNED_SHORT_5_5_5_1",t[t.UNSIGNED_INT=5125]="UNSIGNED_INT",t[t.UNSIGNED_INT_10F_11F_11F_REV=35899]="UNSIGNED_INT_10F_11F_11F_REV",t[t.UNSIGNED_INT_2_10_10_10_REV=33640]="UNSIGNED_INT_2_10_10_10_REV",t[t.UNSIGNED_INT_24_8=34042]="UNSIGNED_INT_24_8",t[t.UNSIGNED_INT_5_9_9_9_REV=35902]="UNSIGNED_INT_5_9_9_9_REV",t[t.BYTE=5120]="BYTE",t[t.SHORT=5122]="SHORT",t[t.INT=5124]="INT",t[t.FLOAT=5126]="FLOAT",t[t.FLOAT_32_UNSIGNED_INT_24_8_REV=36269]="FLOAT_32_UNSIGNED_INT_24_8_REV",t[t.HALF_FLOAT=36193]="HALF_FLOAT",t))(l||{}),u=(t=>(t[t.FLOAT=0]="FLOAT",t[t.INT=1]="INT",t[t.UINT=2]="UINT",t))(u||{}),c=(t=>(t[t.NEAREST=0]="NEAREST",t[t.LINEAR=1]="LINEAR",t))(c||{}),d=(t=>(t[t.CLAMP=33071]="CLAMP",t[t.REPEAT=10497]="REPEAT",t[t.MIRRORED_REPEAT=33648]="MIRRORED_REPEAT",t))(d||{}),f=(t=>(t[t.OFF=0]="OFF",t[t.POW2=1]="POW2",t[t.ON=2]="ON",t[t.ON_MANUAL=3]="ON_MANUAL",t))(f||{}),p=(t=>(t[t.NPM=0]="NPM",t[t.UNPACK=1]="UNPACK",t[t.PMA=2]="PMA",t[t.NO_PREMULTIPLIED_ALPHA=0]="NO_PREMULTIPLIED_ALPHA",t[t.PREMULTIPLY_ON_UPLOAD=1]="PREMULTIPLY_ON_UPLOAD",t[t.PREMULTIPLIED_ALPHA=2]="PREMULTIPLIED_ALPHA",t))(p||{}),_=(t=>(t[t.NO=0]="NO",t[t.YES=1]="YES",t[t.AUTO=2]="AUTO",t[t.BLEND=0]="BLEND",t[t.CLEAR=1]="CLEAR",t[t.BLIT=2]="BLIT",t))(_||{}),m=(t=>(t[t.AUTO=0]="AUTO",t[t.MANUAL=1]="MANUAL",t))(m||{}),g=(t=>(t.LOW="lowp",t.MEDIUM="mediump",t.HIGH="highp",t))(g||{}),y=(t=>(t[t.NONE=0]="NONE",t[t.SCISSOR=1]="SCISSOR",t[t.STENCIL=2]="STENCIL",t[t.SPRITE=3]="SPRITE",t[t.COLOR=4]="COLOR",t))(y||{}),b=(t=>(t[t.RED=1]="RED",t[t.GREEN=2]="GREEN",t[t.BLUE=4]="BLUE",t[t.ALPHA=8]="ALPHA",t))(b||{}),v=(t=>(t[t.NONE=0]="NONE",t[t.LOW=2]="LOW",t[t.MEDIUM=4]="MEDIUM",t[t.HIGH=8]="HIGH",t))(v||{}),x=(t=>(t[t.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER",t[t.ARRAY_BUFFER=34962]="ARRAY_BUFFER",t[t.UNIFORM_BUFFER=35345]="UNIFORM_BUFFER",t))(x||{});const A={createCanvas:(t,e)=>{const r=document.createElement("canvas");return r.width=t,r.height=e,r},getCanvasRenderingContext2D:()=>CanvasRenderingContext2D,getWebGLRenderingContext:()=>WebGLRenderingContext,getNavigator:()=>navigator,getBaseUrl:()=>{var t;return null!=(t=document.baseURI)?t:window.location.href},getFontFaceSet:()=>document.fonts,fetch:(t,e)=>fetch(t,e),parseXML:t=>(new DOMParser).parseFromString(t,"text/xml")},T={ADAPTER:A,RESOLUTION:1,CREATE_IMAGE_BITMAP:!1,ROUND_PIXELS:!1};var E,w=/iPhone/i,S=/iPod/i,C=/iPad/i,P=/\biOS-universal(?:.+)Mac\b/i,M=/\bAndroid(?:.+)Mobile\b/i,$=/Android/i,I=/(?:SD4930UR|\bSilk(?:.+)Mobile\b)/i,R=/Silk/i,D=/Windows Phone/i,L=/\bWindows(?:.+)ARM\b/i,F=/BlackBerry/i,O=/BB10/i,k=/Opera Mini/i,B=/\b(CriOS|Chrome)(?:.+)Mobile/i,N=/Mobile(?:.+)Firefox\b/i,U=function(t){return void 0!==t&&"MacIntel"===t.platform&&"number"==typeof t.maxTouchPoints&&t.maxTouchPoints>1&&"undefined"==typeof MSStream};function G(t){var e={userAgent:"",platform:"",maxTouchPoints:0};t||"undefined"==typeof navigator?"string"==typeof t?e.userAgent=t:t&&t.userAgent&&(e={userAgent:t.userAgent,platform:t.platform,maxTouchPoints:t.maxTouchPoints||0}):e={userAgent:navigator.userAgent,platform:navigator.platform,maxTouchPoints:navigator.maxTouchPoints||0};var r=e.userAgent,i=r.split("[FBAN");void 0!==i[1]&&(r=i[0]),void 0!==(i=r.split("Twitter"))[1]&&(r=i[0]);var s=function(t){return function(e){return e.test(t)}}(r),n={apple:{phone:s(w)&&!s(D),ipod:s(S),tablet:!s(w)&&(s(C)||U(e))&&!s(D),universal:s(P),device:(s(w)||s(S)||s(C)||s(P)||U(e))&&!s(D)},amazon:{phone:s(I),tablet:!s(I)&&s(R),device:s(I)||s(R)},android:{phone:!s(D)&&s(I)||!s(D)&&s(M),tablet:!s(D)&&!s(I)&&!s(M)&&(s(R)||s($)),device:!s(D)&&(s(I)||s(R)||s(M)||s($))||s(/\bokhttp\b/i)},windows:{phone:s(D),tablet:s(L),device:s(D)||s(L)},other:{blackberry:s(F),blackberry10:s(O),opera:s(k),firefox:s(N),chrome:s(B),device:s(F)||s(O)||s(k)||s(N)||s(B)},any:!1,phone:!1,tablet:!1};return n.any=n.apple.device||n.android.device||n.windows.device||n.other.device,n.phone=n.apple.phone||n.android.phone||n.windows.phone,n.tablet=n.apple.tablet||n.android.tablet||n.windows.tablet,n}const V=(null!=(E=G.default)?E:G)(globalThis.navigator);T.RETINA_PREFIX=/@([0-9\.]+)x/,T.FAIL_IF_MAJOR_PERFORMANCE_CAVEAT=!1;var H="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function z(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var X={exports:{}};!function(t){var e=Object.prototype.hasOwnProperty,r="~";function i(){}function s(t,e,r){this.fn=t,this.context=e,this.once=r||!1}function n(t,e,i,n,o){if("function"!=typeof i)throw new TypeError("The listener must be a function");var a=new s(i,n||t,o),h=r?r+e:e;return t._events[h]?t._events[h].fn?t._events[h]=[t._events[h],a]:t._events[h].push(a):(t._events[h]=a,t._eventsCount++),t}function o(t,e){0==--t._eventsCount?t._events=new i:delete t._events[e]}function a(){this._events=new i,this._eventsCount=0}Object.create&&(i.prototype=Object.create(null),(new i).__proto__||(r=!1)),a.prototype.eventNames=function(){var t,i,s=[];if(0===this._eventsCount)return s;for(i in t=this._events)e.call(t,i)&&s.push(r?i.slice(1):i);return Object.getOwnPropertySymbols?s.concat(Object.getOwnPropertySymbols(t)):s},a.prototype.listeners=function(t){var e=r?r+t:t,i=this._events[e];if(!i)return[];if(i.fn)return[i.fn];for(var s=0,n=i.length,o=new Array(n);s<n;s++)o[s]=i[s].fn;return o},a.prototype.listenerCount=function(t){var e=r?r+t:t,i=this._events[e];return i?i.fn?1:i.length:0},a.prototype.emit=function(t,e,i,s,n,o){var a=r?r+t:t;if(!this._events[a])return!1;var h,l,u=this._events[a],c=arguments.length;if(u.fn){switch(u.once&&this.removeListener(t,u.fn,void 0,!0),c){case 1:return u.fn.call(u.context),!0;case 2:return u.fn.call(u.context,e),!0;case 3:return u.fn.call(u.context,e,i),!0;case 4:return u.fn.call(u.context,e,i,s),!0;case 5:return u.fn.call(u.context,e,i,s,n),!0;case 6:return u.fn.call(u.context,e,i,s,n,o),!0}for(l=1,h=new Array(c-1);l<c;l++)h[l-1]=arguments[l];u.fn.apply(u.context,h)}else{var d,f=u.length;for(l=0;l<f;l++)switch(u[l].once&&this.removeListener(t,u[l].fn,void 0,!0),c){case 1:u[l].fn.call(u[l].context);break;case 2:u[l].fn.call(u[l].context,e);break;case 3:u[l].fn.call(u[l].context,e,i);break;case 4:u[l].fn.call(u[l].context,e,i,s);break;default:if(!h)for(d=1,h=new Array(c-1);d<c;d++)h[d-1]=arguments[d];u[l].fn.apply(u[l].context,h)}}return!0},a.prototype.on=function(t,e,r){return n(this,t,e,r,!1)},a.prototype.once=function(t,e,r){return n(this,t,e,r,!0)},a.prototype.removeListener=function(t,e,i,s){var n=r?r+t:t;if(!this._events[n])return this;if(!e)return o(this,n),this;var a=this._events[n];if(a.fn)a.fn===e&&(!s||a.once)&&(!i||a.context===i)&&o(this,n);else{for(var h=0,l=[],u=a.length;h<u;h++)(a[h].fn!==e||s&&!a[h].once||i&&a[h].context!==i)&&l.push(a[h]);l.length?this._events[n]=1===l.length?l[0]:l:o(this,n)}return this},a.prototype.removeAllListeners=function(t){var e;return t?(e=r?r+t:t,this._events[e]&&o(this,e)):(this._events=new i,this._eventsCount=0),this},a.prototype.off=a.prototype.removeListener,a.prototype.addListener=a.prototype.on,a.prefixed=r,a.EventEmitter=a,t.exports=a}(X);var W=z(X.exports),Y={exports:{}};Y.exports;Y.exports=j;Y.exports.default=j;function j(t,e,r){r=r||2;var i,s,n,o,a,h,l,u=e&&e.length,c=u?e[0]*r:t.length,d=q(t,0,c,r,!0),f=[];if(!d||d.next===d.prev)return f;if(u&&(d=function(t,e,r,i){var s,n,o,a,h,l=[];for(s=0,n=e.length;s<n;s++)o=e[s]*i,a=s<n-1?e[s+1]*i:t.length,(h=q(t,o,a,i,!1))===h.next&&(h.steiner=!0),l.push(ot(h));for(l.sort(rt),s=0;s<l.length;s++)r=it(l[s],r);return r}(t,e,d,r)),t.length>80*r){i=n=t[0],s=o=t[1];for(var p=r;p<c;p+=r)(a=t[p])<i&&(i=a),(h=t[p+1])<s&&(s=h),a>n&&(n=a),h>o&&(o=h);l=0!==(l=Math.max(n-i,o-s))?32767/l:0}return Q(d,f,r,i,s,l,0),f}function q(t,e,r,i,s){var n,o;if(s===bt(t,e,r,i)>0)for(n=e;n<r;n+=i)o=mt(n,t[n],t[n+1],o);else for(n=r-i;n>=e;n-=i)o=mt(n,t[n],t[n+1],o);return o&&ut(o,o.next)&&(gt(o),o=o.next),o}function Z(t,e){if(!t)return t;e||(e=t);var r,i=t;do{if(r=!1,i.steiner||!ut(i,i.next)&&0!==lt(i.prev,i,i.next))i=i.next;else{if(gt(i),(i=e=i.prev)===i.next)break;r=!0}}while(r||i!==e);return e}function Q(t,e,r,i,s,n,o){if(t){!o&&n&&function(t,e,r,i){var s=t;do{0===s.z&&(s.z=nt(s.x,s.y,e,r,i)),s.prevZ=s.prev,s.nextZ=s.next,s=s.next}while(s!==t);s.prevZ.nextZ=null,s.prevZ=null,function(t){var e,r,i,s,n,o,a,h,l=1;do{for(r=t,t=null,n=null,o=0;r;){for(o++,i=r,a=0,e=0;e<l&&(a++,i=i.nextZ);e++);for(h=l;a>0||h>0&&i;)0!==a&&(0===h||!i||r.z<=i.z)?(s=r,r=r.nextZ,a--):(s=i,i=i.nextZ,h--),n?n.nextZ=s:t=s,s.prevZ=n,n=s;r=i}n.nextZ=null,l*=2}while(o>1)}(s)}(t,i,s,n);for(var a,h,l=t;t.prev!==t.next;)if(a=t.prev,h=t.next,n?K(t,i,s,n):J(t))e.push(a.i/r|0),e.push(t.i/r|0),e.push(h.i/r|0),gt(t),t=h.next,l=h.next;else if((t=h)===l){o?1===o?Q(t=tt(Z(t),e,r),e,r,i,s,n,2):2===o&&et(t,e,r,i,s,n):Q(Z(t),e,r,i,s,n,1);break}}}function J(t){var e=t.prev,r=t,i=t.next;if(lt(e,r,i)>=0)return!1;for(var s=e.x,n=r.x,o=i.x,a=e.y,h=r.y,l=i.y,u=s<n?s<o?s:o:n<o?n:o,c=a<h?a<l?a:l:h<l?h:l,d=s>n?s>o?s:o:n>o?n:o,f=a>h?a>l?a:l:h>l?h:l,p=i.next;p!==e;){if(p.x>=u&&p.x<=d&&p.y>=c&&p.y<=f&&at(s,a,n,h,o,l,p.x,p.y)&&lt(p.prev,p,p.next)>=0)return!1;p=p.next}return!0}function K(t,e,r,i){var s=t.prev,n=t,o=t.next;if(lt(s,n,o)>=0)return!1;for(var a=s.x,h=n.x,l=o.x,u=s.y,c=n.y,d=o.y,f=a<h?a<l?a:l:h<l?h:l,p=u<c?u<d?u:d:c<d?c:d,_=a>h?a>l?a:l:h>l?h:l,m=u>c?u>d?u:d:c>d?c:d,g=nt(f,p,e,r,i),y=nt(_,m,e,r,i),b=t.prevZ,v=t.nextZ;b&&b.z>=g&&v&&v.z<=y;){if(b.x>=f&&b.x<=_&&b.y>=p&&b.y<=m&&b!==s&&b!==o&&at(a,u,h,c,l,d,b.x,b.y)&&lt(b.prev,b,b.next)>=0||(b=b.prevZ,v.x>=f&&v.x<=_&&v.y>=p&&v.y<=m&&v!==s&&v!==o&&at(a,u,h,c,l,d,v.x,v.y)&&lt(v.prev,v,v.next)>=0))return!1;v=v.nextZ}for(;b&&b.z>=g;){if(b.x>=f&&b.x<=_&&b.y>=p&&b.y<=m&&b!==s&&b!==o&&at(a,u,h,c,l,d,b.x,b.y)&&lt(b.prev,b,b.next)>=0)return!1;b=b.prevZ}for(;v&&v.z<=y;){if(v.x>=f&&v.x<=_&&v.y>=p&&v.y<=m&&v!==s&&v!==o&&at(a,u,h,c,l,d,v.x,v.y)&&lt(v.prev,v,v.next)>=0)return!1;v=v.nextZ}return!0}function tt(t,e,r){var i=t;do{var s=i.prev,n=i.next.next;!ut(s,n)&&ct(s,i,i.next,n)&&pt(s,n)&&pt(n,s)&&(e.push(s.i/r|0),e.push(i.i/r|0),e.push(n.i/r|0),gt(i),gt(i.next),i=t=n),i=i.next}while(i!==t);return Z(i)}function et(t,e,r,i,s,n){var o=t;do{for(var a=o.next.next;a!==o.prev;){if(o.i!==a.i&&ht(o,a)){var h=_t(o,a);return o=Z(o,o.next),h=Z(h,h.next),Q(o,e,r,i,s,n,0),void Q(h,e,r,i,s,n,0)}a=a.next}o=o.next}while(o!==t)}function rt(t,e){return t.x-e.x}function it(t,e){var r=function(t,e){var r,i=e,s=t.x,n=t.y,o=-1/0;do{if(n<=i.y&&n>=i.next.y&&i.next.y!==i.y){var a=i.x+(n-i.y)*(i.next.x-i.x)/(i.next.y-i.y);if(a<=s&&a>o&&(o=a,r=i.x<i.next.x?i:i.next,a===s))return r}i=i.next}while(i!==e);if(!r)return null;var h,l=r,u=r.x,c=r.y,d=1/0;i=r;do{s>=i.x&&i.x>=u&&s!==i.x&&at(n<c?s:o,n,u,c,n<c?o:s,n,i.x,i.y)&&(h=Math.abs(n-i.y)/(s-i.x),pt(i,t)&&(h<d||h===d&&(i.x>r.x||i.x===r.x&&st(r,i)))&&(r=i,d=h)),i=i.next}while(i!==l);return r}(t,e);if(!r)return e;var i=_t(r,t);return Z(i,i.next),Z(r,r.next)}function st(t,e){return lt(t.prev,t,e.prev)<0&&lt(e.next,t,t.next)<0}function nt(t,e,r,i,s){return(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=(t-r)*s|0)|t<<8))|t<<4))|t<<2))|t<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=(e-i)*s|0)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function ot(t){var e=t,r=t;do{(e.x<r.x||e.x===r.x&&e.y<r.y)&&(r=e),e=e.next}while(e!==t);return r}function at(t,e,r,i,s,n,o,a){return(s-o)*(e-a)>=(t-o)*(n-a)&&(t-o)*(i-a)>=(r-o)*(e-a)&&(r-o)*(n-a)>=(s-o)*(i-a)}function ht(t,e){return t.next.i!==e.i&&t.prev.i!==e.i&&!function(t,e){var r=t;do{if(r.i!==t.i&&r.next.i!==t.i&&r.i!==e.i&&r.next.i!==e.i&&ct(r,r.next,t,e))return!0;r=r.next}while(r!==t);return!1}(t,e)&&(pt(t,e)&&pt(e,t)&&function(t,e){var r=t,i=!1,s=(t.x+e.x)/2,n=(t.y+e.y)/2;do{r.y>n!=r.next.y>n&&r.next.y!==r.y&&s<(r.next.x-r.x)*(n-r.y)/(r.next.y-r.y)+r.x&&(i=!i),r=r.next}while(r!==t);return i}(t,e)&&(lt(t.prev,t,e.prev)||lt(t,e.prev,e))||ut(t,e)&&lt(t.prev,t,t.next)>0&&lt(e.prev,e,e.next)>0)}function lt(t,e,r){return(e.y-t.y)*(r.x-e.x)-(e.x-t.x)*(r.y-e.y)}function ut(t,e){return t.x===e.x&&t.y===e.y}function ct(t,e,r,i){var s=ft(lt(t,e,r)),n=ft(lt(t,e,i)),o=ft(lt(r,i,t)),a=ft(lt(r,i,e));return!!(s!==n&&o!==a||0===s&&dt(t,r,e)||0===n&&dt(t,i,e)||0===o&&dt(r,t,i)||0===a&&dt(r,e,i))}function dt(t,e,r){return e.x<=Math.max(t.x,r.x)&&e.x>=Math.min(t.x,r.x)&&e.y<=Math.max(t.y,r.y)&&e.y>=Math.min(t.y,r.y)}function ft(t){return t>0?1:t<0?-1:0}function pt(t,e){return lt(t.prev,t,t.next)<0?lt(t,e,t.next)>=0&&lt(t,t.prev,e)>=0:lt(t,e,t.prev)<0||lt(t,t.next,e)<0}function _t(t,e){var r=new yt(t.i,t.x,t.y),i=new yt(e.i,e.x,e.y),s=t.next,n=e.prev;return t.next=e,e.prev=t,r.next=s,s.prev=r,i.next=r,r.prev=i,n.next=i,i.prev=n,i}function mt(t,e,r,i){var s=new yt(t,e,r);return i?(s.next=i.next,s.prev=i,i.next.prev=s,i.next=s):(s.prev=s,s.next=s),s}function gt(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)}function yt(t,e,r){this.i=t,this.x=e,this.y=r,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function bt(t,e,r,i){for(var s=0,n=e,o=r-i;n<r;n+=i)s+=(t[o]-t[n])*(t[n+1]+t[o+1]),o=n;return s}j.deviation=function(t,e,r,i){var s=e&&e.length,n=s?e[0]*r:t.length,o=Math.abs(bt(t,0,n,r));if(s)for(var a=0,h=e.length;a<h;a++){var l=e[a]*r,u=a<h-1?e[a+1]*r:t.length;o-=Math.abs(bt(t,l,u,r))}var c=0;for(a=0;a<i.length;a+=3){var d=i[a]*r,f=i[a+1]*r,p=i[a+2]*r;c+=Math.abs((t[d]-t[p])*(t[f+1]-t[d+1])-(t[d]-t[f])*(t[p+1]-t[d+1]))}return 0===o&&0===c?0:Math.abs((c-o)/o)},j.flatten=function(t){for(var e=t[0][0].length,r={vertices:[],holes:[],dimensions:e},i=0,s=0;s<t.length;s++){for(var n=0;n<t[s].length;n++)for(var o=0;o<e;o++)r.vertices.push(t[s][n][o]);s>0&&(i+=t[s-1].length,r.holes.push(i))}return r};var vt=z(Y.exports),xt={},At={exports:{}};/*! https://mths.be/punycode v1.3.2 by @mathias */!function(t,e){!function(r){var i=e&&!e.nodeType&&e,s=t&&!t.nodeType&&t,n="object"==typeof H&&H;(n.global===n||n.window===n||n.self===n)&&(r=n);var o,a,h=2147483647,l=36,u=/^xn--/,c=/[^\x20-\x7E]/,d=/[\x2E\u3002\uFF0E\uFF61]/g,f={overflow:"Overflow: input needs wider integers to process","not-basic":"Illegal input >= 0x80 (not a basic code point)","invalid-input":"Invalid input"},p=Math.floor,_=String.fromCharCode;function m(t){throw RangeError(f[t])}function g(t,e){for(var r=t.length,i=[];r--;)i[r]=e(t[r]);return i}function y(t,e){var r=t.split("@"),i="";return r.length>1&&(i=r[0]+"@",t=r[1]),i+g((t=t.replace(d,".")).split("."),e).join(".")}function b(t){for(var e,r,i=[],s=0,n=t.length;s<n;)(e=t.charCodeAt(s++))>=55296&&e<=56319&&s<n?56320==(64512&(r=t.charCodeAt(s++)))?i.push(((1023&e)<<10)+(1023&r)+65536):(i.push(e),s--):i.push(e);return i}function v(t){return g(t,(function(t){var e="";return t>65535&&(e+=_((t-=65536)>>>10&1023|55296),t=56320|1023&t),e+=_(t)})).join("")}function x(t){return t-48<10?t-22:t-65<26?t-65:t-97<26?t-97:l}function A(t,e){return t+22+75*(t<26)-((0!=e)<<5)}function T(t,e,r){var i=0;for(t=r?p(t/700):t>>1,t+=p(t/e);t>455;i+=l)t=p(t/35);return p(i+36*t/(t+38))}function E(t){var e,r,i,s,n,o,a,u,c,d,f=[],_=t.length,g=0,y=128,b=72;for((r=t.lastIndexOf("-"))<0&&(r=0),i=0;i<r;++i)t.charCodeAt(i)>=128&&m("not-basic"),f.push(t.charCodeAt(i));for(s=r>0?r+1:0;s<_;){for(n=g,o=1,a=l;s>=_&&m("invalid-input"),((u=x(t.charCodeAt(s++)))>=l||u>p((h-g)/o))&&m("overflow"),g+=u*o,!(u<(c=a<=b?1:a>=b+26?26:a-b));a+=l)o>p(h/(d=l-c))&&m("overflow"),o*=d;b=T(g-n,e=f.length+1,0==n),p(g/e)>h-y&&m("overflow"),y+=p(g/e),g%=e,f.splice(g++,0,y)}return v(f)}function w(t){var e,r,i,s,n,o,a,u,c,d,f,g,y,v,x,E=[];for(g=(t=b(t)).length,e=128,r=0,n=72,o=0;o<g;++o)(f=t[o])<128&&E.push(_(f));for(i=s=E.length,s&&E.push("-");i<g;){for(a=h,o=0;o<g;++o)(f=t[o])>=e&&f<a&&(a=f);for(a-e>p((h-r)/(y=i+1))&&m("overflow"),r+=(a-e)*y,e=a,o=0;o<g;++o)if((f=t[o])<e&&++r>h&&m("overflow"),f==e){for(u=r,c=l;!(u<(d=c<=n?1:c>=n+26?26:c-n));c+=l)x=u-d,v=l-d,E.push(_(A(d+x%v,0))),u=p(x/v);E.push(_(A(u,0))),n=T(r,y,i==s),r=0,++i}++r,++e}return E.join("")}if(o={version:"1.3.2",ucs2:{decode:b,encode:v},decode:E,encode:w,toASCII:function(t){return y(t,(function(t){return c.test(t)?"xn--"+w(t):t}))},toUnicode:function(t){return y(t,(function(t){return u.test(t)?E(t.slice(4).toLowerCase()):t}))}},i&&s)if(t.exports==i)s.exports=o;else for(a in o)o.hasOwnProperty(a)&&(i[a]=o[a]);else r.punycode=o}(H)}(At,At.exports);var Tt=At.exports,Et=(z(Tt),{isString:function(t){return"string"==typeof t},isObject:function(t){return"object"==typeof t&&null!==t},isNull:function(t){return null===t},isNullOrUndefined:function(t){return null==t}}),wt=(z(Et),{});function St(t,e){return Object.prototype.hasOwnProperty.call(t,e)}var Ct=function(t,e,r,i){e=e||"&",r=r||"=";var s={};if("string"!=typeof t||0===t.length)return s;var n=/\+/g;t=t.split(e);var o=1e3;i&&"number"==typeof i.maxKeys&&(o=i.maxKeys);var a=t.length;o>0&&a>o&&(a=o);for(var h=0;h<a;++h){var l,u,c,d,f=t[h].replace(n,"%20"),p=f.indexOf(r);p>=0?(l=f.substr(0,p),u=f.substr(p+1)):(l=f,u=""),c=decodeURIComponent(l),d=decodeURIComponent(u),St(s,c)?Array.isArray(s[c])?s[c].push(d):s[c]=[s[c],d]:s[c]=d}return s},Pt=(z(Ct),function(t){switch(typeof t){case"string":return t;case"boolean":return t?"true":"false";case"number":return isFinite(t)?t:"";default:return""}}),Mt=function(t,e,r,i){return e=e||"&",r=r||"=",null===t&&(t=void 0),"object"==typeof t?Object.keys(t).map((function(i){var s=encodeURIComponent(Pt(i))+r;return Array.isArray(t[i])?t[i].map((function(t){return s+encodeURIComponent(Pt(t))})).join(e):s+encodeURIComponent(Pt(t[i]))})).join(e):i?encodeURIComponent(Pt(i))+r+encodeURIComponent(Pt(t)):""},$t=(z(Mt),wt.decode=wt.parse=Ct,wt.encode=wt.stringify=Mt,Tt),It=Et,Rt=xt.parse=qt,Dt=xt.resolve=function(t,e){return qt(t,!1,!0).resolve(e)},Lt=(xt.resolveObject=function(t,e){return t?qt(t,!1,!0).resolveObject(e):e},xt.format=function(t){return It.isString(t)&&(t=qt(t)),t instanceof Ft?t.format():Ft.prototype.format.call(t)});xt.Url=Ft;function Ft(){this.protocol=null,this.slashes=null,this.auth=null,this.host=null,this.port=null,this.hostname=null,this.hash=null,this.search=null,this.query=null,this.pathname=null,this.path=null,this.href=null}var Ot=/^([a-z0-9.+-]+:)/i,kt=/:[0-9]*$/,Bt=/^(\/\/?(?!\/)[^\?\s]*)(\?[^\s]*)?$/,Nt=["{","}","|","\\","^","`"].concat(["<",">",'"',"`"," ","\r","\n","\t"]),Ut=["'"].concat(Nt),Gt=["%","/","?",";","#"].concat(Ut),Vt=["/","?","#"],Ht=/^[+a-z0-9A-Z_-]{0,63}$/,zt=/^([+a-z0-9A-Z_-]{0,63})(.*)$/,Xt={javascript:!0,"javascript:":!0},Wt={javascript:!0,"javascript:":!0},Yt={http:!0,https:!0,ftp:!0,gopher:!0,file:!0,"http:":!0,"https:":!0,"ftp:":!0,"gopher:":!0,"file:":!0},jt=wt;function qt(t,e,r){if(t&&It.isObject(t)&&t instanceof Ft)return t;var i=new Ft;return i.parse(t,e,r),i}Ft.prototype.parse=function(t,e,r){if(!It.isString(t))throw new TypeError("Parameter 'url' must be a string, not "+typeof t);var i=t.indexOf("?"),s=-1!==i&&i<t.indexOf("#")?"?":"#",n=t.split(s);n[0]=n[0].replace(/\\/g,"/");var o=t=n.join(s);if(o=o.trim(),!r&&1===t.split("#").length){var a=Bt.exec(o);if(a)return this.path=o,this.href=o,this.pathname=a[1],a[2]?(this.search=a[2],this.query=e?jt.parse(this.search.substr(1)):this.search.substr(1)):e&&(this.search="",this.query={}),this}var h=Ot.exec(o);if(h){var l=(h=h[0]).toLowerCase();this.protocol=l,o=o.substr(h.length)}if(r||h||o.match(/^\/\/[^@\/]+@[^@\/]+/)){var u="//"===o.substr(0,2);u&&(!h||!Wt[h])&&(o=o.substr(2),this.slashes=!0)}if(!Wt[h]&&(u||h&&!Yt[h])){for(var c=-1,d=0;d<Vt.length;d++){-1!==(_=o.indexOf(Vt[d]))&&(-1===c||_<c)&&(c=_)}var f,p;-1!==(p=-1===c?o.lastIndexOf("@"):o.lastIndexOf("@",c))&&(f=o.slice(0,p),o=o.slice(p+1),this.auth=decodeURIComponent(f)),c=-1;for(d=0;d<Gt.length;d++){var _;-1!==(_=o.indexOf(Gt[d]))&&(-1===c||_<c)&&(c=_)}-1===c&&(c=o.length),this.host=o.slice(0,c),o=o.slice(c),this.parseHost(),this.hostname=this.hostname||"";var m="["===this.hostname[0]&&"]"===this.hostname[this.hostname.length-1];if(!m)for(var g=this.hostname.split(/\./),y=(d=0,g.length);d<y;d++){var b=g[d];if(b&&!b.match(Ht)){for(var v="",x=0,A=b.length;x<A;x++)b.charCodeAt(x)>127?v+="x":v+=b[x];if(!v.match(Ht)){var T=g.slice(0,d),E=g.slice(d+1),w=b.match(zt);w&&(T.push(w[1]),E.unshift(w[2])),E.length&&(o="/"+E.join(".")+o),this.hostname=T.join(".");break}}}this.hostname.length>255?this.hostname="":this.hostname=this.hostname.toLowerCase(),m||(this.hostname=$t.toASCII(this.hostname));var S=this.port?":"+this.port:"",C=this.hostname||"";this.host=C+S,this.href+=this.host,m&&(this.hostname=this.hostname.substr(1,this.hostname.length-2),"/"!==o[0]&&(o="/"+o))}if(!Xt[l])for(d=0,y=Ut.length;d<y;d++){var P=Ut[d];if(-1!==o.indexOf(P)){var M=encodeURIComponent(P);M===P&&(M=escape(P)),o=o.split(P).join(M)}}var $=o.indexOf("#");-1!==$&&(this.hash=o.substr($),o=o.slice(0,$));var I=o.indexOf("?");if(-1!==I?(this.search=o.substr(I),this.query=o.substr(I+1),e&&(this.query=jt.parse(this.query)),o=o.slice(0,I)):e&&(this.search="",this.query={}),o&&(this.pathname=o),Yt[l]&&this.hostname&&!this.pathname&&(this.pathname="/"),this.pathname||this.search){S=this.pathname||"";var R=this.search||"";this.path=S+R}return this.href=this.format(),this},Ft.prototype.format=function(){var t=this.auth||"";t&&(t=(t=encodeURIComponent(t)).replace(/%3A/i,":"),t+="@");var e=this.protocol||"",r=this.pathname||"",i=this.hash||"",s=!1,n="";this.host?s=t+this.host:this.hostname&&(s=t+(-1===this.hostname.indexOf(":")?this.hostname:"["+this.hostname+"]"),this.port&&(s+=":"+this.port)),this.query&&It.isObject(this.query)&&Object.keys(this.query).length&&(n=jt.stringify(this.query));var o=this.search||n&&"?"+n||"";return e&&":"!==e.substr(-1)&&(e+=":"),this.slashes||(!e||Yt[e])&&!1!==s?(s="//"+(s||""),r&&"/"!==r.charAt(0)&&(r="/"+r)):s||(s=""),i&&"#"!==i.charAt(0)&&(i="#"+i),o&&"?"!==o.charAt(0)&&(o="?"+o),e+s+(r=r.replace(/[?#]/g,(function(t){return encodeURIComponent(t)})))+(o=o.replace("#","%23"))+i},Ft.prototype.resolve=function(t){return this.resolveObject(qt(t,!1,!0)).format()},Ft.prototype.resolveObject=function(t){if(It.isString(t)){var e=new Ft;e.parse(t,!1,!0),t=e}for(var r=new Ft,i=Object.keys(this),s=0;s<i.length;s++){var n=i[s];r[n]=this[n]}if(r.hash=t.hash,""===t.href)return r.href=r.format(),r;if(t.slashes&&!t.protocol){for(var o=Object.keys(t),a=0;a<o.length;a++){var h=o[a];"protocol"!==h&&(r[h]=t[h])}return Yt[r.protocol]&&r.hostname&&!r.pathname&&(r.path=r.pathname="/"),r.href=r.format(),r}if(t.protocol&&t.protocol!==r.protocol){if(!Yt[t.protocol]){for(var l=Object.keys(t),u=0;u<l.length;u++){var c=l[u];r[c]=t[c]}return r.href=r.format(),r}if(r.protocol=t.protocol,t.host||Wt[t.protocol])r.pathname=t.pathname;else{for(var d=(t.pathname||"").split("/");d.length&&!(t.host=d.shift()););t.host||(t.host=""),t.hostname||(t.hostname=""),""!==d[0]&&d.unshift(""),d.length<2&&d.unshift(""),r.pathname=d.join("/")}if(r.search=t.search,r.query=t.query,r.host=t.host||"",r.auth=t.auth,r.hostname=t.hostname||t.host,r.port=t.port,r.pathname||r.search){var f=r.pathname||"",p=r.search||"";r.path=f+p}return r.slashes=r.slashes||t.slashes,r.href=r.format(),r}var _=r.pathname&&"/"===r.pathname.charAt(0),m=t.host||t.pathname&&"/"===t.pathname.charAt(0),g=m||_||r.host&&t.pathname,y=g,b=r.pathname&&r.pathname.split("/")||[],v=(d=t.pathname&&t.pathname.split("/")||[],r.protocol&&!Yt[r.protocol]);if(v&&(r.hostname="",r.port=null,r.host&&(""===b[0]?b[0]=r.host:b.unshift(r.host)),r.host="",t.protocol&&(t.hostname=null,t.port=null,t.host&&(""===d[0]?d[0]=t.host:d.unshift(t.host)),t.host=null),g=g&&(""===d[0]||""===b[0])),m)r.host=t.host||""===t.host?t.host:r.host,r.hostname=t.hostname||""===t.hostname?t.hostname:r.hostname,r.search=t.search,r.query=t.query,b=d;else if(d.length)b||(b=[]),b.pop(),b=b.concat(d),r.search=t.search,r.query=t.query;else if(!It.isNullOrUndefined(t.search)){if(v)r.hostname=r.host=b.shift(),(w=!!(r.host&&r.host.indexOf("@")>0)&&r.host.split("@"))&&(r.auth=w.shift(),r.host=r.hostname=w.shift());return r.search=t.search,r.query=t.query,(!It.isNull(r.pathname)||!It.isNull(r.search))&&(r.path=(r.pathname?r.pathname:"")+(r.search?r.search:"")),r.href=r.format(),r}if(!b.length)return r.pathname=null,r.search?r.path="/"+r.search:r.path=null,r.href=r.format(),r;for(var x=b.slice(-1)[0],A=(r.host||t.host||b.length>1)&&("."===x||".."===x)||""===x,T=0,E=b.length;E>=0;E--)"."===(x=b[E])?b.splice(E,1):".."===x?(b.splice(E,1),T++):T&&(b.splice(E,1),T--);if(!g&&!y)for(;T--;T)b.unshift("..");g&&""!==b[0]&&(!b[0]||"/"!==b[0].charAt(0))&&b.unshift(""),A&&"/"!==b.join("/").substr(-1)&&b.push("");var w,S=""===b[0]||b[0]&&"/"===b[0].charAt(0);v&&(r.hostname=r.host=S?"":b.length?b.shift():"",(w=!!(r.host&&r.host.indexOf("@")>0)&&r.host.split("@"))&&(r.auth=w.shift(),r.host=r.hostname=w.shift()));return(g=g||r.host&&b.length)&&!S&&b.unshift(""),b.length?r.pathname=b.join("/"):(r.pathname=null,r.path=null),(!It.isNull(r.pathname)||!It.isNull(r.search))&&(r.path=(r.pathname?r.pathname:"")+(r.search?r.search:"")),r.auth=t.auth||r.auth,r.slashes=r.slashes||t.slashes,r.href=r.format(),r},Ft.prototype.parseHost=function(){var t=this.host,e=kt.exec(t);e&&(":"!==(e=e[0])&&(this.port=e.substr(1)),t=t.substr(0,t.length-e.length)),t&&(this.hostname=t)};const Zt={};function Qt(t,e,r=3){if(Zt[e])return;let i=(new Error).stack;void 0===i?console.warn("PixiJS Deprecation Warning: ",`${e}\nDeprecated since v${t}`):(i=i.split("\n").splice(r).join("\n"),console.groupCollapsed?(console.groupCollapsed("%cPixiJS Deprecation Warning: %c%s","color:#614108;background:#fffbe6","font-weight:normal;color:#614108;background:#fffbe6",`${e}\nDeprecated since v${t}`),console.warn(i),console.groupEnd()):(console.warn("PixiJS Deprecation Warning: ",`${e}\nDeprecated since v${t}`),console.warn(i))),Zt[e]=!0}const Jt={get parse(){return Rt},get format(){return Lt},get resolve(){return Dt}};function Kt(t){if("string"!=typeof t)throw new TypeError(`Path must be a string. Received ${JSON.stringify(t)}`)}function te(t){return t.split("?")[0].split("#")[0]}const ee={toPosix:t=>function(t,e,r){return t.replace(new RegExp(function(t){return t.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}(e),"g"),r)}(t,"\\","/"),isUrl(t){return/^https?:/.test(this.toPosix(t))},isDataUrl:t=>/^data:([a-z]+\/[a-z0-9-+.]+(;[a-z0-9-.!#$%*+.{}|~`]+=[a-z0-9-.!#$%*+.{}()_|~`]+)*)?(;base64)?,([a-z0-9!$&',()*+;=\-._~:@\/?%\s<>]*?)$/i.test(t),isBlobUrl:t=>t.startsWith("blob:"),hasProtocol(t){return/^[^/:]+:/.test(this.toPosix(t))},getProtocol(t){Kt(t),t=this.toPosix(t);const e=/^file:\/\/\//.exec(t);if(e)return e[0];const r=/^[^/:]+:\/{0,2}/.exec(t);return r?r[0]:""},toAbsolute(t,e,r){if(Kt(t),this.isDataUrl(t)||this.isBlobUrl(t))return t;const i=te(this.toPosix(null!=e?e:T.ADAPTER.getBaseUrl())),s=te(this.toPosix(null!=r?r:this.rootname(i)));return(t=this.toPosix(t)).startsWith("/")?ee.join(s,t.slice(1)):this.isAbsolute(t)?t:this.join(i,t)},normalize(t){if(Kt(t),0===t.length)return".";if(this.isDataUrl(t)||this.isBlobUrl(t))return t;let e="";const r=(t=this.toPosix(t)).startsWith("/");this.hasProtocol(t)&&(e=this.rootname(t),t=t.slice(e.length));const i=t.endsWith("/");return t=function(t,e){let r="",i=0,s=-1,n=0,o=-1;for(let a=0;a<=t.length;++a){if(a<t.length)o=t.charCodeAt(a);else{if(47===o)break;o=47}if(47===o){if(s!==a-1&&1!==n)if(s!==a-1&&2===n){if(r.length<2||2!==i||46!==r.charCodeAt(r.length-1)||46!==r.charCodeAt(r.length-2))if(r.length>2){const t=r.lastIndexOf("/");if(t!==r.length-1){-1===t?(r="",i=0):(r=r.slice(0,t),i=r.length-1-r.lastIndexOf("/")),s=a,n=0;continue}}else if(2===r.length||1===r.length){r="",i=0,s=a,n=0;continue}e&&(r.length>0?r+="/..":r="..",i=2)}else r.length>0?r+=`/${t.slice(s+1,a)}`:r=t.slice(s+1,a),i=a-s-1;s=a,n=0}else 46===o&&-1!==n?++n:n=-1}return r}(t,!1),t.length>0&&i&&(t+="/"),r?`/${t}`:e+t},isAbsolute(t){return Kt(t),t=this.toPosix(t),!!this.hasProtocol(t)||t.startsWith("/")},join(...t){var e;if(0===t.length)return".";let r;for(let i=0;i<t.length;++i){const s=t[i];if(Kt(s),s.length>0)if(void 0===r)r=s;else{const n=null!=(e=t[i-1])?e:"";this.joinExtensions.includes(this.extname(n).toLowerCase())?r+=`/../${s}`:r+=`/${s}`}}return void 0===r?".":this.normalize(r)},dirname(t){if(Kt(t),0===t.length)return".";let e=(t=this.toPosix(t)).charCodeAt(0);const r=47===e;let i=-1,s=!0;const n=this.getProtocol(t),o=t;for(let r=(t=t.slice(n.length)).length-1;r>=1;--r)if(e=t.charCodeAt(r),47===e){if(!s){i=r;break}}else s=!1;return-1===i?r?"/":this.isUrl(o)?n+t:n:r&&1===i?"//":n+t.slice(0,i)},rootname(t){Kt(t);let e="";if(e=(t=this.toPosix(t)).startsWith("/")?"/":this.getProtocol(t),this.isUrl(t)){const r=t.indexOf("/",e.length);e=-1!==r?t.slice(0,r):t,e.endsWith("/")||(e+="/")}return e},basename(t,e){Kt(t),e&&Kt(e),t=te(this.toPosix(t));let r,i=0,s=-1,n=!0;if(void 0!==e&&e.length>0&&e.length<=t.length){if(e.length===t.length&&e===t)return"";let o=e.length-1,a=-1;for(r=t.length-1;r>=0;--r){const h=t.charCodeAt(r);if(47===h){if(!n){i=r+1;break}}else-1===a&&(n=!1,a=r+1),o>=0&&(h===e.charCodeAt(o)?-1==--o&&(s=r):(o=-1,s=a))}return i===s?s=a:-1===s&&(s=t.length),t.slice(i,s)}for(r=t.length-1;r>=0;--r)if(47===t.charCodeAt(r)){if(!n){i=r+1;break}}else-1===s&&(n=!1,s=r+1);return-1===s?"":t.slice(i,s)},extname(t){Kt(t);let e=-1,r=0,i=-1,s=!0,n=0;for(let o=(t=te(this.toPosix(t))).length-1;o>=0;--o){const a=t.charCodeAt(o);if(47!==a)-1===i&&(s=!1,i=o+1),46===a?-1===e?e=o:1!==n&&(n=1):-1!==e&&(n=-1);else if(!s){r=o+1;break}}return-1===e||-1===i||0===n||1===n&&e===i-1&&e===r+1?"":t.slice(e,i)},parse(t){Kt(t);const e={root:"",dir:"",base:"",ext:"",name:""};if(0===t.length)return e;let r=(t=te(this.toPosix(t))).charCodeAt(0);const i=this.isAbsolute(t);let s;e.root=this.rootname(t),s=i||this.hasProtocol(t)?1:0;let n=-1,o=0,a=-1,h=!0,l=t.length-1,u=0;for(;l>=s;--l)if(r=t.charCodeAt(l),47!==r)-1===a&&(h=!1,a=l+1),46===r?-1===n?n=l:1!==u&&(u=1):-1!==n&&(u=-1);else if(!h){o=l+1;break}return-1===n||-1===a||0===u||1===u&&n===a-1&&n===o+1?-1!==a&&(e.base=e.name=0===o&&i?t.slice(1,a):t.slice(o,a)):(0===o&&i?(e.name=t.slice(1,n),e.base=t.slice(1,a)):(e.name=t.slice(o,n),e.base=t.slice(o,a)),e.ext=t.slice(n,a)),e.dir=this.dirname(t),e},sep:"/",delimiter:":",joinExtensions:[".html"]};let re,ie;async function se(){return null!=re||(re=(async()=>{var t;const e=document.createElement("canvas").getContext("webgl");if(!e)return p.UNPACK;const r=await new Promise((t=>{const e=document.createElement("video");e.onloadeddata=()=>t(e),e.onerror=()=>t(null),e.autoplay=!1,e.crossOrigin="anonymous",e.preload="auto",e.src="data:video/webm;base64,GkXfo59ChoEBQveBAULygQRC84EIQoKEd2VibUKHgQJChYECGFOAZwEAAAAAAAHTEU2bdLpNu4tTq4QVSalmU6yBoU27i1OrhBZUrmtTrIHGTbuMU6uEElTDZ1OsggEXTbuMU6uEHFO7a1OsggG97AEAAAAAAABZAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAVSalmoCrXsYMPQkBNgIRMYXZmV0GETGF2ZkSJiEBEAAAAAAAAFlSua8yuAQAAAAAAAEPXgQFzxYgAAAAAAAAAAZyBACK1nIN1bmSIgQCGhVZfVlA5g4EBI+ODhAJiWgDglLCBArqBApqBAlPAgQFVsIRVuYEBElTDZ9Vzc9JjwItjxYgAAAAAAAAAAWfInEWjh0VOQ09ERVJEh49MYXZjIGxpYnZweC12cDlnyKJFo4hEVVJBVElPTkSHlDAwOjAwOjAwLjA0MDAwMDAwMAAAH0O2dcfngQCgwqGggQAAAIJJg0IAABAAFgA4JBwYSgAAICAAEb///4r+AAB1oZ2mm+6BAaWWgkmDQgAAEAAWADgkHBhKAAAgIABIQBxTu2uRu4+zgQC3iveBAfGCAXHwgQM=",e.load()}));if(!r)return p.UNPACK;const i=e.createTexture();e.bindTexture(e.TEXTURE_2D,i);const s=e.createFramebuffer();e.bindFramebuffer(e.FRAMEBUFFER,s),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,i,0),e.pixelStorei(e.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!1),e.pixelStorei(e.UNPACK_COLORSPACE_CONVERSION_WEBGL,e.NONE),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,r);const n=new Uint8Array(4);return e.readPixels(0,0,1,1,e.RGBA,e.UNSIGNED_BYTE,n),e.deleteFramebuffer(s),e.deleteTexture(i),null==(t=e.getExtension("WEBGL_lose_context"))||t.loseContext(),n[0]<=n[3]?p.PMA:p.UNPACK})()),re}function ne(){return void 0===ie&&(ie=function(){var t;const e={stencil:!0,failIfMajorPerformanceCaveat:T.FAIL_IF_MAJOR_PERFORMANCE_CAVEAT};try{if(!T.ADAPTER.getWebGLRenderingContext())return!1;const r=T.ADAPTER.createCanvas();let i=r.getContext("webgl",e)||r.getContext("experimental-webgl",e);const s=!(null==(t=null==i?void 0:i.getContextAttributes())||!t.stencil);if(i){const t=i.getExtension("WEBGL_lose_context");t&&t.loseContext()}return i=null,s}catch(t){return!1}}()),ie}var oe={grad:.9,turn:360,rad:360/(2*Math.PI)},ae=function(t){return"string"==typeof t?t.length>0:"number"==typeof t},he=function(t,e,r){return void 0===e&&(e=0),void 0===r&&(r=Math.pow(10,e)),Math.round(r*t)/r+0},le=function(t,e,r){return void 0===e&&(e=0),void 0===r&&(r=1),t>r?r:t>e?t:e},ue=function(t){return(t=isFinite(t)?t%360:0)>0?t:t+360},ce=function(t){return{r:le(t.r,0,255),g:le(t.g,0,255),b:le(t.b,0,255),a:le(t.a)}},de=function(t){return{r:he(t.r),g:he(t.g),b:he(t.b),a:he(t.a,3)}},fe=/^#([0-9a-f]{3,8})$/i,pe=function(t){var e=t.toString(16);return e.length<2?"0"+e:e},_e=function(t){var e=t.r,r=t.g,i=t.b,s=t.a,n=Math.max(e,r,i),o=n-Math.min(e,r,i),a=o?n===e?(r-i)/o:n===r?2+(i-e)/o:4+(e-r)/o:0;return{h:60*(a<0?a+6:a),s:n?o/n*100:0,v:n/255*100,a:s}},me=function(t){var e=t.h,r=t.s,i=t.v,s=t.a;e=e/360*6,r/=100,i/=100;var n=Math.floor(e),o=i*(1-r),a=i*(1-(e-n)*r),h=i*(1-(1-e+n)*r),l=n%6;return{r:255*[i,a,o,o,h,i][l],g:255*[h,i,i,a,o,o][l],b:255*[o,o,h,i,i,a][l],a:s}},ge=function(t){return{h:ue(t.h),s:le(t.s,0,100),l:le(t.l,0,100),a:le(t.a)}},ye=function(t){return{h:he(t.h),s:he(t.s),l:he(t.l),a:he(t.a,3)}},be=function(t){return me((r=(e=t).s,{h:e.h,s:(r*=((i=e.l)<50?i:100-i)/100)>0?2*r/(i+r)*100:0,v:i+r,a:e.a}));var e,r,i},ve=function(t){return{h:(e=_e(t)).h,s:(s=(200-(r=e.s))*(i=e.v)/100)>0&&s<200?r*i/100/(s<=100?s:200-s)*100:0,l:s/2,a:e.a};var e,r,i,s},xe=/^hsla?\(\s*([+-]?\d*\.?\d+)(deg|rad|grad|turn)?\s*,\s*([+-]?\d*\.?\d+)%\s*,\s*([+-]?\d*\.?\d+)%\s*(?:,\s*([+-]?\d*\.?\d+)(%)?\s*)?\)$/i,Ae=/^hsla?\(\s*([+-]?\d*\.?\d+)(deg|rad|grad|turn)?\s+([+-]?\d*\.?\d+)%\s+([+-]?\d*\.?\d+)%\s*(?:\/\s*([+-]?\d*\.?\d+)(%)?\s*)?\)$/i,Te=/^rgba?\(\s*([+-]?\d*\.?\d+)(%)?\s*,\s*([+-]?\d*\.?\d+)(%)?\s*,\s*([+-]?\d*\.?\d+)(%)?\s*(?:,\s*([+-]?\d*\.?\d+)(%)?\s*)?\)$/i,Ee=/^rgba?\(\s*([+-]?\d*\.?\d+)(%)?\s+([+-]?\d*\.?\d+)(%)?\s+([+-]?\d*\.?\d+)(%)?\s*(?:\/\s*([+-]?\d*\.?\d+)(%)?\s*)?\)$/i,we={string:[[function(t){var e=fe.exec(t);return e?(t=e[1]).length<=4?{r:parseInt(t[0]+t[0],16),g:parseInt(t[1]+t[1],16),b:parseInt(t[2]+t[2],16),a:4===t.length?he(parseInt(t[3]+t[3],16)/255,2):1}:6===t.length||8===t.length?{r:parseInt(t.substr(0,2),16),g:parseInt(t.substr(2,2),16),b:parseInt(t.substr(4,2),16),a:8===t.length?he(parseInt(t.substr(6,2),16)/255,2):1}:null:null},"hex"],[function(t){var e=Te.exec(t)||Ee.exec(t);return e?e[2]!==e[4]||e[4]!==e[6]?null:ce({r:Number(e[1])/(e[2]?100/255:1),g:Number(e[3])/(e[4]?100/255:1),b:Number(e[5])/(e[6]?100/255:1),a:void 0===e[7]?1:Number(e[7])/(e[8]?100:1)}):null},"rgb"],[function(t){var e=xe.exec(t)||Ae.exec(t);if(!e)return null;var r,i,s=ge({h:(r=e[1],i=e[2],void 0===i&&(i="deg"),Number(r)*(oe[i]||1)),s:Number(e[3]),l:Number(e[4]),a:void 0===e[5]?1:Number(e[5])/(e[6]?100:1)});return be(s)},"hsl"]],object:[[function(t){var e=t.r,r=t.g,i=t.b,s=t.a,n=void 0===s?1:s;return ae(e)&&ae(r)&&ae(i)?ce({r:Number(e),g:Number(r),b:Number(i),a:Number(n)}):null},"rgb"],[function(t){var e=t.h,r=t.s,i=t.l,s=t.a,n=void 0===s?1:s;if(!ae(e)||!ae(r)||!ae(i))return null;var o=ge({h:Number(e),s:Number(r),l:Number(i),a:Number(n)});return be(o)},"hsl"],[function(t){var e=t.h,r=t.s,i=t.v,s=t.a,n=void 0===s?1:s;if(!ae(e)||!ae(r)||!ae(i))return null;var o,a=(o={h:Number(e),s:Number(r),v:Number(i),a:Number(n)},{h:ue(o.h),s:le(o.s,0,100),v:le(o.v,0,100),a:le(o.a)});return me(a)},"hsv"]]},Se=function(t,e){for(var r=0;r<e.length;r++){var i=e[r][0](t);if(i)return[i,e[r][1]]}return[null,void 0]},Ce=function(t){return"string"==typeof t?Se(t.trim(),we.string):"object"==typeof t&&null!==t?Se(t,we.object):[null,void 0]},Pe=function(t,e){var r=ve(t);return{h:r.h,s:le(r.s+100*e,0,100),l:r.l,a:r.a}},Me=function(t){return(299*t.r+587*t.g+114*t.b)/1e3/255},$e=function(t,e){var r=ve(t);return{h:r.h,s:r.s,l:le(r.l+100*e,0,100),a:r.a}},Ie=function(){function t(t){this.parsed=Ce(t)[0],this.rgba=this.parsed||{r:0,g:0,b:0,a:1}}return t.prototype.isValid=function(){return null!==this.parsed},t.prototype.brightness=function(){return he(Me(this.rgba),2)},t.prototype.isDark=function(){return Me(this.rgba)<.5},t.prototype.isLight=function(){return Me(this.rgba)>=.5},t.prototype.toHex=function(){return e=(t=de(this.rgba)).r,r=t.g,i=t.b,n=(s=t.a)<1?pe(he(255*s)):"","#"+pe(e)+pe(r)+pe(i)+n;var t,e,r,i,s,n},t.prototype.toRgb=function(){return de(this.rgba)},t.prototype.toRgbString=function(){return e=(t=de(this.rgba)).r,r=t.g,i=t.b,(s=t.a)<1?"rgba("+e+", "+r+", "+i+", "+s+")":"rgb("+e+", "+r+", "+i+")";var t,e,r,i,s},t.prototype.toHsl=function(){return ye(ve(this.rgba))},t.prototype.toHslString=function(){return e=(t=ye(ve(this.rgba))).h,r=t.s,i=t.l,(s=t.a)<1?"hsla("+e+", "+r+"%, "+i+"%, "+s+")":"hsl("+e+", "+r+"%, "+i+"%)";var t,e,r,i,s},t.prototype.toHsv=function(){return t=_e(this.rgba),{h:he(t.h),s:he(t.s),v:he(t.v),a:he(t.a,3)};var t},t.prototype.invert=function(){return Re({r:255-(t=this.rgba).r,g:255-t.g,b:255-t.b,a:t.a});var t},t.prototype.saturate=function(t){return void 0===t&&(t=.1),Re(Pe(this.rgba,t))},t.prototype.desaturate=function(t){return void 0===t&&(t=.1),Re(Pe(this.rgba,-t))},t.prototype.grayscale=function(){return Re(Pe(this.rgba,-1))},t.prototype.lighten=function(t){return void 0===t&&(t=.1),Re($e(this.rgba,t))},t.prototype.darken=function(t){return void 0===t&&(t=.1),Re($e(this.rgba,-t))},t.prototype.rotate=function(t){return void 0===t&&(t=15),this.hue(this.hue()+t)},t.prototype.alpha=function(t){return"number"==typeof t?Re({r:(e=this.rgba).r,g:e.g,b:e.b,a:t}):he(this.rgba.a,3);var e},t.prototype.hue=function(t){var e=ve(this.rgba);return"number"==typeof t?Re({h:t,s:e.s,l:e.l,a:e.a}):he(e.h)},t.prototype.isEqual=function(t){return this.toHex()===Re(t).toHex()},t}(),Re=function(t){return t instanceof Ie?t:new Ie(t)},De=[];var Le=Object.defineProperty,Fe=Object.getOwnPropertySymbols,Oe=Object.prototype.hasOwnProperty,ke=Object.prototype.propertyIsEnumerable,Be=(t,e,r)=>e in t?Le(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r;!function(t){t.forEach((function(t){De.indexOf(t)<0&&(t(Ie,we),De.push(t))}))}([function(t,e){var r={white:"#ffffff",bisque:"#ffe4c4",blue:"#0000ff",cadetblue:"#5f9ea0",chartreuse:"#7fff00",chocolate:"#d2691e",coral:"#ff7f50",antiquewhite:"#faebd7",aqua:"#00ffff",azure:"#f0ffff",whitesmoke:"#f5f5f5",papayawhip:"#ffefd5",plum:"#dda0dd",blanchedalmond:"#ffebcd",black:"#000000",gold:"#ffd700",goldenrod:"#daa520",gainsboro:"#dcdcdc",cornsilk:"#fff8dc",cornflowerblue:"#6495ed",burlywood:"#deb887",aquamarine:"#7fffd4",beige:"#f5f5dc",crimson:"#dc143c",cyan:"#00ffff",darkblue:"#00008b",darkcyan:"#008b8b",darkgoldenrod:"#b8860b",darkkhaki:"#bdb76b",darkgray:"#a9a9a9",darkgreen:"#006400",darkgrey:"#a9a9a9",peachpuff:"#ffdab9",darkmagenta:"#8b008b",darkred:"#8b0000",darkorchid:"#9932cc",darkorange:"#ff8c00",darkslateblue:"#483d8b",gray:"#808080",darkslategray:"#2f4f4f",darkslategrey:"#2f4f4f",deeppink:"#ff1493",deepskyblue:"#00bfff",wheat:"#f5deb3",firebrick:"#b22222",floralwhite:"#fffaf0",ghostwhite:"#f8f8ff",darkviolet:"#9400d3",magenta:"#ff00ff",green:"#008000",dodgerblue:"#1e90ff",grey:"#808080",honeydew:"#f0fff0",hotpink:"#ff69b4",blueviolet:"#8a2be2",forestgreen:"#228b22",lawngreen:"#7cfc00",indianred:"#cd5c5c",indigo:"#4b0082",fuchsia:"#ff00ff",brown:"#a52a2a",maroon:"#800000",mediumblue:"#0000cd",lightcoral:"#f08080",darkturquoise:"#00ced1",lightcyan:"#e0ffff",ivory:"#fffff0",lightyellow:"#ffffe0",lightsalmon:"#ffa07a",lightseagreen:"#20b2aa",linen:"#faf0e6",mediumaquamarine:"#66cdaa",lemonchiffon:"#fffacd",lime:"#00ff00",khaki:"#f0e68c",mediumseagreen:"#3cb371",limegreen:"#32cd32",mediumspringgreen:"#00fa9a",lightskyblue:"#87cefa",lightblue:"#add8e6",midnightblue:"#191970",lightpink:"#ffb6c1",mistyrose:"#ffe4e1",moccasin:"#ffe4b5",mintcream:"#f5fffa",lightslategray:"#778899",lightslategrey:"#778899",navajowhite:"#ffdead",navy:"#000080",mediumvioletred:"#c71585",powderblue:"#b0e0e6",palegoldenrod:"#eee8aa",oldlace:"#fdf5e6",paleturquoise:"#afeeee",mediumturquoise:"#48d1cc",mediumorchid:"#ba55d3",rebeccapurple:"#663399",lightsteelblue:"#b0c4de",mediumslateblue:"#7b68ee",thistle:"#d8bfd8",tan:"#d2b48c",orchid:"#da70d6",mediumpurple:"#9370db",purple:"#800080",pink:"#ffc0cb",skyblue:"#87ceeb",springgreen:"#00ff7f",palegreen:"#98fb98",red:"#ff0000",yellow:"#ffff00",slateblue:"#6a5acd",lavenderblush:"#fff0f5",peru:"#cd853f",palevioletred:"#db7093",violet:"#ee82ee",teal:"#008080",slategray:"#708090",slategrey:"#708090",aliceblue:"#f0f8ff",darkseagreen:"#8fbc8f",darkolivegreen:"#556b2f",greenyellow:"#adff2f",seagreen:"#2e8b57",seashell:"#fff5ee",tomato:"#ff6347",silver:"#c0c0c0",sienna:"#a0522d",lavender:"#e6e6fa",lightgreen:"#90ee90",orange:"#ffa500",orangered:"#ff4500",steelblue:"#4682b4",royalblue:"#4169e1",turquoise:"#40e0d0",yellowgreen:"#9acd32",salmon:"#fa8072",saddlebrown:"#8b4513",sandybrown:"#f4a460",rosybrown:"#bc8f8f",darksalmon:"#e9967a",lightgoldenrodyellow:"#fafad2",snow:"#fffafa",lightgrey:"#d3d3d3",lightgray:"#d3d3d3",dimgray:"#696969",dimgrey:"#696969",olivedrab:"#6b8e23",olive:"#808000"},i={};for(var s in r)i[r[s]]=s;var n={};t.prototype.toName=function(e){if(!(this.rgba.a||this.rgba.r||this.rgba.g||this.rgba.b))return"transparent";var s,o,a=i[this.toHex()];if(a)return a;if(null!=e&&e.closest){var h=this.toRgb(),l=1/0,u="black";if(!n.length)for(var c in r)n[c]=new t(r[c]).toRgb();for(var d in r){var f=(s=h,o=n[d],Math.pow(s.r-o.r,2)+Math.pow(s.g-o.g,2)+Math.pow(s.b-o.b,2));f<l&&(l=f,u=d)}return u}},e.string.push([function(e){var i=e.toLowerCase(),s="transparent"===i?"#0000":r[i];return s?new t(s).toRgb():null},"name"])}]);const Ne=class t{constructor(t=16777215){this._value=null,this._components=new Float32Array(4),this._components.fill(1),this._int=16777215,this.value=t}get red(){return this._components[0]}get green(){return this._components[1]}get blue(){return this._components[2]}get alpha(){return this._components[3]}setValue(t){return this.value=t,this}set value(e){if(e instanceof t)this._value=this.cloneSource(e._value),this._int=e._int,this._components.set(e._components);else{if(null===e)throw new Error("Cannot set PIXI.Color#value to null");(null===this._value||!this.isSourceEqual(this._value,e))&&(this.normalize(e),this._value=this.cloneSource(e))}}get value(){return this._value}cloneSource(t){return"string"==typeof t||"number"==typeof t||t instanceof Number||null===t?t:Array.isArray(t)||ArrayBuffer.isView(t)?t.slice(0):"object"==typeof t&&null!==t?((t,e)=>{for(var r in e||(e={}))Oe.call(e,r)&&Be(t,r,e[r]);if(Fe)for(var r of Fe(e))ke.call(e,r)&&Be(t,r,e[r]);return t})({},t):t}isSourceEqual(t,e){const r=typeof t;if(r!==typeof e)return!1;if("number"===r||"string"===r||t instanceof Number)return t===e;if(Array.isArray(t)&&Array.isArray(e)||ArrayBuffer.isView(t)&&ArrayBuffer.isView(e))return t.length===e.length&&t.every(((t,r)=>t===e[r]));if(null!==t&&null!==e){const r=Object.keys(t),i=Object.keys(e);return r.length===i.length&&r.every((r=>t[r]===e[r]))}return t===e}toRgba(){const[t,e,r,i]=this._components;return{r:t,g:e,b:r,a:i}}toRgb(){const[t,e,r]=this._components;return{r:t,g:e,b:r}}toRgbaString(){const[t,e,r]=this.toUint8RgbArray();return`rgba(${t},${e},${r},${this.alpha})`}toUint8RgbArray(t){const[e,r,i]=this._components;return(t=null!=t?t:[])[0]=Math.round(255*e),t[1]=Math.round(255*r),t[2]=Math.round(255*i),t}toRgbArray(t){t=null!=t?t:[];const[e,r,i]=this._components;return t[0]=e,t[1]=r,t[2]=i,t}toNumber(){return this._int}toLittleEndianNumber(){const t=this._int;return(t>>16)+(65280&t)+((255&t)<<16)}multiply(e){const[r,i,s,n]=t.temp.setValue(e)._components;return this._components[0]*=r,this._components[1]*=i,this._components[2]*=s,this._components[3]*=n,this.refreshInt(),this._value=null,this}premultiply(t,e=!0){return e&&(this._components[0]*=t,this._components[1]*=t,this._components[2]*=t),this._components[3]=t,this.refreshInt(),this._value=null,this}toPremultiplied(t,e=!0){if(1===t)return(255<<24)+this._int;if(0===t)return e?0:this._int;let r=this._int>>16&255,i=this._int>>8&255,s=255&this._int;return e&&(r=r*t+.5|0,i=i*t+.5|0,s=s*t+.5|0),(255*t<<24)+(r<<16)+(i<<8)+s}toHex(){const t=this._int.toString(16);return`#${"000000".substring(0,6-t.length)+t}`}toHexa(){const t=Math.round(255*this._components[3]).toString(16);return this.toHex()+"00".substring(0,2-t.length)+t}setAlpha(t){return this._components[3]=this._clamp(t),this}round(t){const[e,r,i]=this._components;return this._components[0]=Math.round(e*t)/t,this._components[1]=Math.round(r*t)/t,this._components[2]=Math.round(i*t)/t,this.refreshInt(),this._value=null,this}toArray(t){t=null!=t?t:[];const[e,r,i,s]=this._components;return t[0]=e,t[1]=r,t[2]=i,t[3]=s,t}normalize(e){let r,i,s,n;if(("number"==typeof e||e instanceof Number)&&e>=0&&e<=16777215){r=(e>>16&255)/255,i=(e>>8&255)/255,s=(255&e)/255,n=1}else if((Array.isArray(e)||e instanceof Float32Array)&&e.length>=3&&e.length<=4)e=this._clamp(e),[r,i,s,n=1]=e;else if((e instanceof Uint8Array||e instanceof Uint8ClampedArray)&&e.length>=3&&e.length<=4)e=this._clamp(e,0,255),[r,i,s,n=255]=e,r/=255,i/=255,s/=255,n/=255;else if("string"==typeof e||"object"==typeof e){if("string"==typeof e){const r=t.HEX_PATTERN.exec(e);r&&(e=`#${r[2]}`)}const o=Re(e);o.isValid()&&(({r:r,g:i,b:s,a:n}=o.rgba),r/=255,i/=255,s/=255)}if(void 0===r)throw new Error(`Unable to convert color ${e}`);this._components[0]=r,this._components[1]=i,this._components[2]=s,this._components[3]=n,this.refreshInt()}refreshInt(){this._clamp(this._components);const[t,e,r]=this._components;this._int=(255*t<<16)+(255*e<<8)+(255*r|0)}_clamp(t,e=0,r=1){return"number"==typeof t?Math.min(Math.max(t,e),r):(t.forEach(((i,s)=>{t[s]=Math.min(Math.max(i,e),r)})),t)}};Ne.shared=new Ne,Ne.temp=new Ne,Ne.HEX_PATTERN=/^(#|0x)?(([a-f0-9]{3}){1,2}([a-f0-9]{2})?)$/i;let Ue=Ne;function Ge(t){return Ue.shared.setValue(t).toHex()}function Ve(t){return Ue.shared.setValue(t).toNumber()}const He=function(){const t=[],e=[];for(let r=0;r<32;r++)t[r]=r,e[r]=r;t[n.NORMAL_NPM]=n.NORMAL,t[n.ADD_NPM]=n.ADD,t[n.SCREEN_NPM]=n.SCREEN,e[n.NORMAL]=n.NORMAL_NPM,e[n.ADD]=n.ADD_NPM,e[n.SCREEN]=n.SCREEN_NPM;const r=[];return r.push(e),r.push(t),r}();function ze(t,e){return He[e?1:0][t]}const Xe=/^\s*data:(?:([\w-]+)\/([\w+.-]+))?(?:;charset=([\w-]+))?(?:;(base64))?,(.*)/i;function We(t,e=null){const r=6*t;if((e=e||new Uint16Array(r)).length!==r)throw new Error(`Out buffer length is incorrect, got ${e.length} and expected ${r}`);for(let t=0,i=0;t<r;t+=6,i+=4)e[t+0]=i+0,e[t+1]=i+1,e[t+2]=i+2,e[t+3]=i+0,e[t+4]=i+2,e[t+5]=i+3;return e}function Ye(t){if(4===t.BYTES_PER_ELEMENT)return t instanceof Float32Array?"Float32Array":t instanceof Uint32Array?"Uint32Array":"Int32Array";if(2===t.BYTES_PER_ELEMENT){if(t instanceof Uint16Array)return"Uint16Array"}else if(1===t.BYTES_PER_ELEMENT&&t instanceof Uint8Array)return"Uint8Array";return null}const je={Float32Array:Float32Array,Uint32Array:Uint32Array,Int32Array:Int32Array,Uint8Array:Uint8Array};function qe(t){return t+=0===t?1:0,--t,t|=t>>>1,t|=t>>>2,t|=t>>>4,t|=t>>>8,(t|=t>>>16)+1}function Ze(t){return!(t&t-1||!t)}function Qe(t){let e=(t>65535?1:0)<<4,r=((t>>>=e)>255?1:0)<<3;return e|=r,r=((t>>>=r)>15?1:0)<<2,e|=r,r=((t>>>=r)>3?1:0)<<1,e|=r,e|(t>>>=r)>>1}function Je(t,e,r){const i=t.length;let s;if(e>=i||0===r)return;const n=i-(r=e+r>i?i-e:r);for(s=e;s<n;++s)t[s]=t[s+r];t.length=n}function Ke(t){return 0===t?0:t<0?-1:1}let tr=0;function er(){return++tr}const rr=class{constructor(t,e,r,i){this.left=t,this.top=e,this.right=r,this.bottom=i}get width(){return this.right-this.left}get height(){return this.bottom-this.top}isEmpty(){return this.left===this.right||this.top===this.bottom}};rr.EMPTY=new rr(0,0,0,0);let ir=rr;const sr={},nr=Object.create(null),or=Object.create(null);class ar{constructor(t,e,r){this._canvas=T.ADAPTER.createCanvas(),this._context=this._canvas.getContext("2d"),this.resolution=r||T.RESOLUTION,this.resize(t,e)}clear(){this._checkDestroyed(),this._context.setTransform(1,0,0,1,0,0),this._context.clearRect(0,0,this._canvas.width,this._canvas.height)}resize(t,e){this._checkDestroyed(),this._canvas.width=Math.round(t*this.resolution),this._canvas.height=Math.round(e*this.resolution)}destroy(){this._context=null,this._canvas=null}get width(){return this._checkDestroyed(),this._canvas.width}set width(t){this._checkDestroyed(),this._canvas.width=Math.round(t)}get height(){return this._checkDestroyed(),this._canvas.height}set height(t){this._checkDestroyed(),this._canvas.height=Math.round(t)}get canvas(){return this._checkDestroyed(),this._canvas}get context(){return this._checkDestroyed(),this._context}_checkDestroyed(){this._canvas}}function hr(t,e,r){for(let i=0,s=4*r*e;i<e;++i,s+=4)if(0!==t[s+3])return!1;return!0}function lr(t,e,r,i,s){const n=4*e;for(let e=i,o=i*n+4*r;e<=s;++e,o+=n)if(0!==t[o+3])return!1;return!0}function ur(t){const{width:e,height:r}=t,i=t.getContext("2d",{willReadFrequently:!0});if(null===i)throw new TypeError("Failed to get canvas 2D context");const s=i.getImageData(0,0,e,r).data;let n=0,o=0,a=e-1,h=r-1;for(;o<r&&hr(s,e,o);)++o;if(o===r)return ir.EMPTY;for(;hr(s,e,h);)--h;for(;lr(s,e,n,o,h);)++n;for(;lr(s,e,a,o,h);)--a;return++a,++h,new ir(n,o,a,h)}function cr(t){const e=ur(t),{width:r,height:i}=e;let s=null;if(!e.isEmpty()){const n=t.getContext("2d");if(null===n)throw new TypeError("Failed to get canvas 2D context");s=n.getImageData(e.left,e.top,r,i)}return{width:r,height:i,data:s}}function dr(t,e=globalThis.location){if(t.startsWith("data:"))return"";e=e||globalThis.location;const r=new URL(t,document.baseURI);return r.hostname!==e.hostname||r.port!==e.port||r.protocol!==e.protocol?"anonymous":""}function fr(t,e=1){var r;const i=null==(r=T.RETINA_PREFIX)?void 0:r.exec(t);return i?parseFloat(i[1]):e}var pr={__proto__:null,BaseTextureCache:or,BoundingBox:ir,CanvasRenderTarget:ar,DATA_URI:Xe,EventEmitter:W,ProgramCache:sr,TextureCache:nr,clearTextureCache:function(){let t;for(t in nr)delete nr[t];for(t in or)delete or[t]},correctBlendMode:ze,createIndicesForQuads:We,decomposeDataUri:function(t){const e=Xe.exec(t);if(e)return{mediaType:e[1]?e[1].toLowerCase():void 0,subType:e[2]?e[2].toLowerCase():void 0,charset:e[3]?e[3].toLowerCase():void 0,encoding:e[4]?e[4].toLowerCase():void 0,data:e[5]}},deprecation:Qt,destroyTextureCache:function(){let t;for(t in nr)nr[t].destroy();for(t in or)or[t].destroy()},detectVideoAlphaMode:se,determineCrossOrigin:dr,earcut:vt,getBufferType:Ye,getCanvasBoundingBox:ur,getResolutionOfUrl:fr,hex2rgb:function(t,e=[]){return Ue.shared.setValue(t).toRgbArray(e)},hex2string:Ge,interleaveTypedArrays:function(t,e){let r=0,i=0;const s={};for(let s=0;s<t.length;s++)i+=e[s],r+=t[s].length;const n=new ArrayBuffer(4*r);let o=null,a=0;for(let r=0;r<t.length;r++){const h=e[r],l=t[r],u=Ye(l);s[u]||(s[u]=new je[u](n)),o=s[u];for(let t=0;t<l.length;t++){o[(t/h|0)*i+a+t%h]=l[t]}a+=h}return new Float32Array(n)},isMobile:V,isPow2:Ze,isWebGLSupported:ne,log2:Qe,nextPow2:qe,path:ee,premultiplyBlendMode:He,premultiplyRgba:function(t,e,r,i=!0){return Ue.shared.setValue(t).premultiply(e,i).toArray(null!=r?r:new Float32Array(4))},premultiplyTint:function(t,e){return Ue.shared.setValue(t).toPremultiplied(e)},premultiplyTintToRgba:function(t,e,r,i=!0){return Ue.shared.setValue(t).premultiply(e,i).toArray(null!=r?r:new Float32Array(4))},removeItems:Je,rgb2hex:Ve,sayHello:function(){},sign:Ke,skipHello:function(){},string2hex:function(t){return Ue.shared.setValue(t).toNumber()},trimCanvas:cr,uid:er,url:Jt},_r=Object.defineProperty,mr=Object.defineProperties,gr=Object.getOwnPropertyDescriptors,yr=Object.getOwnPropertySymbols,br=Object.prototype.hasOwnProperty,vr=Object.prototype.propertyIsEnumerable,xr=(t,e,r)=>e in t?_r(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Ar=(t,e)=>{for(var r in e||(e={}))br.call(e,r)&&xr(t,r,e[r]);if(yr)for(var r of yr(e))vr.call(e,r)&&xr(t,r,e[r]);return t},Tr=(t=>(t.Renderer="renderer",t.Application="application",t.RendererSystem="renderer-webgl-system",t.RendererPlugin="renderer-webgl-plugin",t.CanvasRendererSystem="renderer-canvas-system",t.CanvasRendererPlugin="renderer-canvas-plugin",t.Asset="asset",t.LoadParser="load-parser",t.ResolveParser="resolve-parser",t.CacheParser="cache-parser",t.DetectionParser="detection-parser",t))(Tr||{});const Er=t=>{if("function"==typeof t||"object"==typeof t&&t.extension){const e="object"!=typeof t.extension?{type:t.extension}:t.extension;t=((t,e)=>mr(t,gr(e)))(Ar({},e),{ref:t})}if("object"!=typeof t)throw new Error("Invalid extension type");return"string"==typeof(t=Ar({},t)).type&&(t.type=[t.type]),t},wr=(t,e)=>{var r;return null!=(r=Er(t).priority)?r:e},Sr={_addHandlers:{},_removeHandlers:{},_queue:{},remove(...t){return t.map(Er).forEach((t=>{t.type.forEach((e=>{var r,i;return null==(i=(r=this._removeHandlers)[e])?void 0:i.call(r,t)}))})),this},add(...t){return t.map(Er).forEach((t=>{t.type.forEach((e=>{var r,i;const s=this._addHandlers,n=this._queue;s[e]?null==(i=s[e])||i.call(s,t):(n[e]=n[e]||[],null==(r=n[e])||r.push(t))}))})),this},handle(t,e,r){var i;const s=this._addHandlers,n=this._removeHandlers;s[t]=e,n[t]=r;const o=this._queue;return o[t]&&(null==(i=o[t])||i.forEach((t=>e(t))),delete o[t]),this},handleByMap(t,e){return this.handle(t,(t=>{t.name&&(e[t.name]=t.ref)}),(t=>{t.name&&delete e[t.name]}))},handleByList(t,e,r=-1){return this.handle(t,(t=>{e.includes(t.ref)||(e.push(t.ref),e.sort(((t,e)=>wr(e,r)-wr(t,r))))}),(t=>{const r=e.indexOf(t.ref);-1!==r&&e.splice(r,1)}))}};class Cr{constructor(t){"number"==typeof t?this.rawBinaryData=new ArrayBuffer(t):t instanceof Uint8Array?this.rawBinaryData=t.buffer:this.rawBinaryData=t,this.uint32View=new Uint32Array(this.rawBinaryData),this.float32View=new Float32Array(this.rawBinaryData)}get int8View(){return this._int8View||(this._int8View=new Int8Array(this.rawBinaryData)),this._int8View}get uint8View(){return this._uint8View||(this._uint8View=new Uint8Array(this.rawBinaryData)),this._uint8View}get int16View(){return this._int16View||(this._int16View=new Int16Array(this.rawBinaryData)),this._int16View}get uint16View(){return this._uint16View||(this._uint16View=new Uint16Array(this.rawBinaryData)),this._uint16View}get int32View(){return this._int32View||(this._int32View=new Int32Array(this.rawBinaryData)),this._int32View}view(t){return this[`${t}View`]}destroy(){this.rawBinaryData=null,this._int8View=null,this._uint8View=null,this._int16View=null,this._uint16View=null,this._int32View=null,this.uint32View=null,this.float32View=null}static sizeOf(t){switch(t){case"int8":case"uint8":return 1;case"int16":case"uint16":return 2;case"int32":case"uint32":case"float32":return 4;default:throw new Error(`${t} isn't a valid view type`)}}}const Pr=["precision mediump float;","void main(void){","float test = 0.1;","%forloop%","gl_FragColor = vec4(0.0);","}"].join("\n");function Mr(t){let e="";for(let r=0;r<t;++r)r>0&&(e+="\nelse "),r<t-1&&(e+=`if(test == ${r}.0){}`);return e}function $r(t,e){if(0===t)throw new Error("Invalid value of `0` passed to `checkMaxIfStatementsInShader`");const r=e.createShader(e.FRAGMENT_SHADER);for(;;){const i=Pr.replace(/%forloop%/gi,Mr(t));if(e.shaderSource(r,i),e.compileShader(r),e.getShaderParameter(r,e.COMPILE_STATUS))break;t=t/2|0}return t}class Ir{constructor(){this.data=0,this.blendMode=n.NORMAL,this.polygonOffset=0,this.blend=!0,this.depthMask=!0}get blend(){return!!(1&this.data)}set blend(t){!!(1&this.data)!==t&&(this.data^=1)}get offsets(){return!!(2&this.data)}set offsets(t){!!(2&this.data)!==t&&(this.data^=2)}get culling(){return!!(4&this.data)}set culling(t){!!(4&this.data)!==t&&(this.data^=4)}get depthTest(){return!!(8&this.data)}set depthTest(t){!!(8&this.data)!==t&&(this.data^=8)}get depthMask(){return!!(32&this.data)}set depthMask(t){!!(32&this.data)!==t&&(this.data^=32)}get clockwiseFrontFace(){return!!(16&this.data)}set clockwiseFrontFace(t){!!(16&this.data)!==t&&(this.data^=16)}get blendMode(){return this._blendMode}set blendMode(t){this.blend=t!==n.NONE,this._blendMode=t}get polygonOffset(){return this._polygonOffset}set polygonOffset(t){this.offsets=!!t,this._polygonOffset=t}static for2d(){const t=new Ir;return t.depthTest=!1,t.blend=!0,t}}const Rr=[];function Dr(t,e){if(!t)return null;let r="";if("string"==typeof t){const e=/\.(\w{3,4})(?:$|\?|#)/i.exec(t);e&&(r=e[1].toLowerCase())}for(let i=Rr.length-1;i>=0;--i){const s=Rr[i];if(s.test&&s.test(t,r))return new s(t,e)}throw new Error("Unrecognized source type to auto-detect Resource")}class Lr{constructor(t){this.items=[],this._name=t,this._aliasCount=0}emit(t,e,r,i,s,n,o,a){if(arguments.length>8)throw new Error("max arguments reached");const{name:h,items:l}=this;this._aliasCount++;for(let u=0,c=l.length;u<c;u++)l[u][h](t,e,r,i,s,n,o,a);return l===this.items&&this._aliasCount--,this}ensureNonAliasedItems(){this._aliasCount>0&&this.items.length>1&&(this._aliasCount=0,this.items=this.items.slice(0))}add(t){return t[this._name]&&(this.ensureNonAliasedItems(),this.remove(t),this.items.push(t)),this}remove(t){const e=this.items.indexOf(t);return-1!==e&&(this.ensureNonAliasedItems(),this.items.splice(e,1)),this}contains(t){return this.items.includes(t)}removeAll(){return this.ensureNonAliasedItems(),this.items.length=0,this}destroy(){this.removeAll(),this.items.length=0,this._name=""}get empty(){return 0===this.items.length}get name(){return this._name}}Object.defineProperties(Lr.prototype,{dispatch:{value:Lr.prototype.emit},run:{value:Lr.prototype.emit}});class Fr{constructor(t=0,e=0){this._width=t,this._height=e,this.destroyed=!1,this.internal=!1,this.onResize=new Lr("setRealSize"),this.onUpdate=new Lr("update"),this.onError=new Lr("onError")}bind(t){this.onResize.add(t),this.onUpdate.add(t),this.onError.add(t),(this._width||this._height)&&this.onResize.emit(this._width,this._height)}unbind(t){this.onResize.remove(t),this.onUpdate.remove(t),this.onError.remove(t)}resize(t,e){(t!==this._width||e!==this._height)&&(this._width=t,this._height=e,this.onResize.emit(t,e))}get valid(){return!!this._width&&!!this._height}update(){this.destroyed||this.onUpdate.emit()}load(){return Promise.resolve(this)}get width(){return this._width}get height(){return this._height}style(t,e,r){return!1}dispose(){}destroy(){this.destroyed||(this.destroyed=!0,this.dispose(),this.onError.removeAll(),this.onError=null,this.onResize.removeAll(),this.onResize=null,this.onUpdate.removeAll(),this.onUpdate=null)}static test(t,e){return!1}}class Or extends Fr{constructor(t,e){var r;const{width:i,height:s}=e||{};if(!i||!s)throw new Error("BufferResource width or height invalid");super(i,s),this.data=t,this.unpackAlignment=null!=(r=e.unpackAlignment)?r:4}upload(t,e,r){const i=t.gl;i.pixelStorei(i.UNPACK_ALIGNMENT,this.unpackAlignment),i.pixelStorei(i.UNPACK_PREMULTIPLY_ALPHA_WEBGL,e.alphaMode===p.UNPACK);const s=e.realWidth,n=e.realHeight;return r.width===s&&r.height===n?i.texSubImage2D(e.target,0,0,0,s,n,e.format,r.type,this.data):(r.width=s,r.height=n,i.texImage2D(e.target,0,r.internalFormat,s,n,0,e.format,r.type,this.data)),!0}dispose(){this.data=null}static test(t){return null===t||t instanceof Int8Array||t instanceof Uint8Array||t instanceof Uint8ClampedArray||t instanceof Int16Array||t instanceof Uint16Array||t instanceof Int32Array||t instanceof Uint32Array||t instanceof Float32Array}}var kr=Object.defineProperty,Br=Object.getOwnPropertySymbols,Nr=Object.prototype.hasOwnProperty,Ur=Object.prototype.propertyIsEnumerable,Gr=(t,e,r)=>e in t?kr(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r;const Vr={scaleMode:c.NEAREST,alphaMode:p.NPM},Hr=class t extends W{constructor(e=null,r=null){super(),r=Object.assign({},t.defaultOptions,r);const{alphaMode:i,mipmap:s,anisotropicLevel:n,scaleMode:o,width:a,height:h,wrapMode:l,format:u,type:c,target:d,resolution:f,resourceOptions:p}=r;e&&!(e instanceof Fr)&&((e=Dr(e,p)).internal=!0),this.resolution=f||T.RESOLUTION,this.width=Math.round((a||0)*this.resolution)/this.resolution,this.height=Math.round((h||0)*this.resolution)/this.resolution,this._mipmap=s,this.anisotropicLevel=n,this._wrapMode=l,this._scaleMode=o,this.format=u,this.type=c,this.target=d,this.alphaMode=i,this.uid=er(),this.touched=0,this.isPowerOfTwo=!1,this._refreshPOT(),this._glTextures={},this.dirtyId=0,this.dirtyStyleId=0,this.cacheId=null,this.valid=a>0&&h>0,this.textureCacheIds=[],this.destroyed=!1,this.resource=null,this._batchEnabled=0,this._batchLocation=0,this.parentTextureArray=null,this.setResource(e)}get realWidth(){return Math.round(this.width*this.resolution)}get realHeight(){return Math.round(this.height*this.resolution)}get mipmap(){return this._mipmap}set mipmap(t){this._mipmap!==t&&(this._mipmap=t,this.dirtyStyleId++)}get scaleMode(){return this._scaleMode}set scaleMode(t){this._scaleMode!==t&&(this._scaleMode=t,this.dirtyStyleId++)}get wrapMode(){return this._wrapMode}set wrapMode(t){this._wrapMode!==t&&(this._wrapMode=t,this.dirtyStyleId++)}setStyle(t,e){let r;return void 0!==t&&t!==this.scaleMode&&(this.scaleMode=t,r=!0),void 0!==e&&e!==this.mipmap&&(this.mipmap=e,r=!0),r&&this.dirtyStyleId++,this}setSize(t,e,r){return r=r||this.resolution,this.setRealSize(t*r,e*r,r)}setRealSize(t,e,r){return this.resolution=r||this.resolution,this.width=Math.round(t)/this.resolution,this.height=Math.round(e)/this.resolution,this._refreshPOT(),this.update(),this}_refreshPOT(){this.isPowerOfTwo=Ze(this.realWidth)&&Ze(this.realHeight)}setResolution(t){const e=this.resolution;return e===t||(this.resolution=t,this.valid&&(this.width=Math.round(this.width*e)/t,this.height=Math.round(this.height*e)/t,this.emit("update",this)),this._refreshPOT()),this}setResource(t){if(this.resource===t)return this;if(this.resource)throw new Error("Resource can be set only once");return t.bind(this),this.resource=t,this}update(){this.valid?(this.dirtyId++,this.dirtyStyleId++,this.emit("update",this)):this.width>0&&this.height>0&&(this.valid=!0,this.emit("loaded",this),this.emit("update",this))}onError(t){this.emit("error",this,t)}destroy(){this.resource&&(this.resource.unbind(this),this.resource.internal&&this.resource.destroy(),this.resource=null),this.cacheId&&(delete or[this.cacheId],delete nr[this.cacheId],this.cacheId=null),this.valid=!1,this.dispose(),t.removeFromCache(this),this.textureCacheIds=null,this.destroyed=!0,this.emit("destroyed",this),this.removeAllListeners()}dispose(){this.emit("dispose",this)}castToBaseTexture(){return this}static from(e,r,i=T.STRICT_TEXTURE_CACHE){const s="string"==typeof e;let n=null;if(s)n=e;else{if(!e._pixiId){const t=(null==r?void 0:r.pixiIdPrefix)||"pixiid";e._pixiId=`${t}_${er()}`}n=e._pixiId}let o=or[n];if(s&&i&&!o)throw new Error(`The cacheId "${n}" does not exist in BaseTextureCache.`);return o||(o=new t(e,r),o.cacheId=n,t.addToCache(o,n)),o}static fromBuffer(e,r,i,s){e=e||new Float32Array(r*i*4);const n=new Or(e,((t,e)=>{for(var r in e||(e={}))Nr.call(e,r)&&Gr(t,r,e[r]);if(Br)for(var r of Br(e))Ur.call(e,r)&&Gr(t,r,e[r]);return t})({width:r,height:i},null==s?void 0:s.resourceOptions));let o,h;return e instanceof Float32Array?(o=a.RGBA,h=l.FLOAT):e instanceof Int32Array?(o=a.RGBA_INTEGER,h=l.INT):e instanceof Uint32Array?(o=a.RGBA_INTEGER,h=l.UNSIGNED_INT):e instanceof Int16Array?(o=a.RGBA_INTEGER,h=l.SHORT):e instanceof Uint16Array?(o=a.RGBA_INTEGER,h=l.UNSIGNED_SHORT):e instanceof Int8Array?(o=a.RGBA,h=l.BYTE):(o=a.RGBA,h=l.UNSIGNED_BYTE),n.internal=!0,new t(n,Object.assign({},Vr,{type:h,format:o},s))}static addToCache(t,e){e&&(t.textureCacheIds.includes(e)||t.textureCacheIds.push(e),or[e]&&or[e]!==t&&console.warn(`BaseTexture added to the cache with an id [${e}] that already had an entry`),or[e]=t)}static removeFromCache(t){if("string"==typeof t){const e=or[t];if(e){const r=e.textureCacheIds.indexOf(t);return r>-1&&e.textureCacheIds.splice(r,1),delete or[t],e}}else if(null!=t&&t.textureCacheIds){for(let e=0;e<t.textureCacheIds.length;++e)delete or[t.textureCacheIds[e]];return t.textureCacheIds.length=0,t}return null}};Hr.defaultOptions={mipmap:f.POW2,anisotropicLevel:0,scaleMode:c.LINEAR,wrapMode:d.CLAMP,alphaMode:p.UNPACK,target:h.TEXTURE_2D,format:a.RGBA,type:l.UNSIGNED_BYTE},Hr._globalBatch=0;let zr=Hr;class Xr{constructor(){this.texArray=null,this.blend=0,this.type=o.TRIANGLES,this.start=0,this.size=0,this.data=null}}let Wr=0;class Yr{constructor(t,e=!0,r=!1){this.data=t||new Float32Array(1),this._glBuffers={},this._updateID=0,this.index=r,this.static=e,this.id=Wr++,this.disposeRunner=new Lr("disposeBuffer")}update(t){t instanceof Array&&(t=new Float32Array(t)),this.data=t||this.data,this._updateID++}dispose(){this.disposeRunner.emit(this,!1)}destroy(){this.dispose(),this.data=null}set index(t){this.type=t?x.ELEMENT_ARRAY_BUFFER:x.ARRAY_BUFFER}get index(){return this.type===x.ELEMENT_ARRAY_BUFFER}static from(t){return t instanceof Array&&(t=new Float32Array(t)),new Yr(t)}}class jr{constructor(t,e=0,r=!1,i=l.FLOAT,s,n,o,a=1){this.buffer=t,this.size=e,this.normalized=r,this.type=i,this.stride=s,this.start=n,this.instance=o,this.divisor=a}destroy(){this.buffer=null}static from(t,e,r,i,s){return new jr(t,e,r,i,s)}}const qr={Float32Array:Float32Array,Uint32Array:Uint32Array,Int32Array:Int32Array,Uint8Array:Uint8Array};const Zr={5126:4,5123:2,5121:1};let Qr=0;const Jr={Float32Array:Float32Array,Uint32Array:Uint32Array,Int32Array:Int32Array,Uint8Array:Uint8Array,Uint16Array:Uint16Array};class Kr{constructor(t=[],e={}){this.buffers=t,this.indexBuffer=null,this.attributes=e,this.glVertexArrayObjects={},this.id=Qr++,this.instanced=!1,this.instanceCount=1,this.disposeRunner=new Lr("disposeGeometry"),this.refCount=0}addAttribute(t,e,r=0,i=!1,s,n,o,a=!1){if(!e)throw new Error("You must pass a buffer when creating an attribute");e instanceof Yr||(e instanceof Array&&(e=new Float32Array(e)),e=new Yr(e));const h=t.split("|");if(h.length>1){for(let t=0;t<h.length;t++)this.addAttribute(h[t],e,r,i,s);return this}let l=this.buffers.indexOf(e);return-1===l&&(this.buffers.push(e),l=this.buffers.length-1),this.attributes[t]=new jr(l,r,i,s,n,o,a),this.instanced=this.instanced||a,this}getAttribute(t){return this.attributes[t]}getBuffer(t){return this.buffers[this.getAttribute(t).buffer]}addIndex(t){return t instanceof Yr||(t instanceof Array&&(t=new Uint16Array(t)),t=new Yr(t)),t.type=x.ELEMENT_ARRAY_BUFFER,this.indexBuffer=t,this.buffers.includes(t)||this.buffers.push(t),this}getIndex(){return this.indexBuffer}interleave(){if(1===this.buffers.length||2===this.buffers.length&&this.indexBuffer)return this;const t=[],e=[],r=new Yr;let i;for(i in this.attributes){const r=this.attributes[i],s=this.buffers[r.buffer];t.push(s.data),e.push(r.size*Zr[r.type]/4),r.buffer=0}for(r.data=function(t,e){let r=0,i=0;const s={};for(let s=0;s<t.length;s++)i+=e[s],r+=t[s].length;const n=new ArrayBuffer(4*r);let o=null,a=0;for(let r=0;r<t.length;r++){const h=e[r],l=t[r],u=Ye(l);s[u]||(s[u]=new qr[u](n)),o=s[u];for(let t=0;t<l.length;t++)o[(t/h|0)*i+a+t%h]=l[t];a+=h}return new Float32Array(n)}(t,e),i=0;i<this.buffers.length;i++)this.buffers[i]!==this.indexBuffer&&this.buffers[i].destroy();return this.buffers=[r],this.indexBuffer&&this.buffers.push(this.indexBuffer),this}getSize(){for(const t in this.attributes){const e=this.attributes[t];return this.buffers[e.buffer].data.length/(e.stride/4||e.size)}return 0}dispose(){this.disposeRunner.emit(this,!1)}destroy(){this.dispose(),this.buffers=null,this.indexBuffer=null,this.attributes=null}clone(){const t=new Kr;for(let e=0;e<this.buffers.length;e++)t.buffers[e]=new Yr(this.buffers[e].data.slice(0));for(const e in this.attributes){const r=this.attributes[e];t.attributes[e]=new jr(r.buffer,r.size,r.normalized,r.type,r.stride,r.start,r.instance)}return this.indexBuffer&&(t.indexBuffer=t.buffers[this.buffers.indexOf(this.indexBuffer)],t.indexBuffer.type=x.ELEMENT_ARRAY_BUFFER),t}static merge(t){const e=new Kr,r=[],i=[],s=[];let n;for(let e=0;e<t.length;e++){n=t[e];for(let t=0;t<n.buffers.length;t++)i[t]=i[t]||0,i[t]+=n.buffers[t].data.length,s[t]=0}for(let t=0;t<n.buffers.length;t++)r[t]=new(Jr[Ye(n.buffers[t].data)])(i[t]),e.buffers[t]=new Yr(r[t]);for(let e=0;e<t.length;e++){n=t[e];for(let t=0;t<n.buffers.length;t++)r[t].set(n.buffers[t].data,s[t]),s[t]+=n.buffers[t].data.length}if(e.attributes=n.attributes,n.indexBuffer){e.indexBuffer=e.buffers[n.buffers.indexOf(n.indexBuffer)],e.indexBuffer.type=x.ELEMENT_ARRAY_BUFFER;let r=0,i=0,s=0,o=0;for(let t=0;t<n.buffers.length;t++)if(n.buffers[t]!==n.indexBuffer){o=t;break}for(const t in n.attributes){const e=n.attributes[t];(0|e.buffer)===o&&(i+=e.size*Zr[e.type]/4)}for(let n=0;n<t.length;n++){const a=t[n].indexBuffer.data;for(let t=0;t<a.length;t++)e.indexBuffer.data[t+s]+=r;r+=t[n].buffers[o].data.length/i,s+=a.length}}return e}}class ti extends Kr{constructor(t=!1){super(),this._buffer=new Yr(null,t,!1),this._indexBuffer=new Yr(null,t,!0),this.addAttribute("aVertexPosition",this._buffer,2,!1,l.FLOAT).addAttribute("aTextureCoord",this._buffer,2,!1,l.FLOAT).addAttribute("aColor",this._buffer,4,!0,l.UNSIGNED_BYTE).addAttribute("aTextureId",this._buffer,1,!0,l.FLOAT).addIndex(this._indexBuffer)}}const ei=2*Math.PI,ri=180/Math.PI,ii=Math.PI/180;var si=(t=>(t[t.POLY=0]="POLY",t[t.RECT=1]="RECT",t[t.CIRC=2]="CIRC",t[t.ELIP=3]="ELIP",t[t.RREC=4]="RREC",t))(si||{});class ni{constructor(t=0,e=0){this.x=0,this.y=0,this.x=t,this.y=e}clone(){return new ni(this.x,this.y)}copyFrom(t){return this.set(t.x,t.y),this}copyTo(t){return t.set(this.x,this.y),t}equals(t){return t.x===this.x&&t.y===this.y}set(t=0,e=t){return this.x=t,this.y=e,this}}const oi=[new ni,new ni,new ni,new ni];class ai{constructor(t=0,e=0,r=0,i=0){this.x=Number(t),this.y=Number(e),this.width=Number(r),this.height=Number(i),this.type=si.RECT}get left(){return this.x}get right(){return this.x+this.width}get top(){return this.y}get bottom(){return this.y+this.height}static get EMPTY(){return new ai(0,0,0,0)}clone(){return new ai(this.x,this.y,this.width,this.height)}copyFrom(t){return this.x=t.x,this.y=t.y,this.width=t.width,this.height=t.height,this}copyTo(t){return t.x=this.x,t.y=this.y,t.width=this.width,t.height=this.height,t}contains(t,e){return!(this.width<=0||this.height<=0)&&(t>=this.x&&t<this.x+this.width&&e>=this.y&&e<this.y+this.height)}intersects(t,e){if(!e){const e=this.x<t.x?t.x:this.x;if((this.right>t.right?t.right:this.right)<=e)return!1;const r=this.y<t.y?t.y:this.y;return(this.bottom>t.bottom?t.bottom:this.bottom)>r}const r=this.left,i=this.right,s=this.top,n=this.bottom;if(i<=r||n<=s)return!1;const o=oi[0].set(t.left,t.top),a=oi[1].set(t.left,t.bottom),h=oi[2].set(t.right,t.top),l=oi[3].set(t.right,t.bottom);if(h.x<=o.x||a.y<=o.y)return!1;const u=Math.sign(e.a*e.d-e.b*e.c);if(0===u||(e.apply(o,o),e.apply(a,a),e.apply(h,h),e.apply(l,l),Math.max(o.x,a.x,h.x,l.x)<=r||Math.min(o.x,a.x,h.x,l.x)>=i||Math.max(o.y,a.y,h.y,l.y)<=s||Math.min(o.y,a.y,h.y,l.y)>=n))return!1;const c=u*(a.y-o.y),d=u*(o.x-a.x),f=c*r+d*s,p=c*i+d*s,_=c*r+d*n,m=c*i+d*n;if(Math.max(f,p,_,m)<=c*o.x+d*o.y||Math.min(f,p,_,m)>=c*l.x+d*l.y)return!1;const g=u*(o.y-h.y),y=u*(h.x-o.x),b=g*r+y*s,v=g*i+y*s,x=g*r+y*n,A=g*i+y*n;return!(Math.max(b,v,x,A)<=g*o.x+y*o.y||Math.min(b,v,x,A)>=g*l.x+y*l.y)}pad(t=0,e=t){return this.x-=t,this.y-=e,this.width+=2*t,this.height+=2*e,this}fit(t){const e=Math.max(this.x,t.x),r=Math.min(this.x+this.width,t.x+t.width),i=Math.max(this.y,t.y),s=Math.min(this.y+this.height,t.y+t.height);return this.x=e,this.width=Math.max(r-e,0),this.y=i,this.height=Math.max(s-i,0),this}ceil(t=1,e=.001){const r=Math.ceil((this.x+this.width-e)*t)/t,i=Math.ceil((this.y+this.height-e)*t)/t;return this.x=Math.floor((this.x+e)*t)/t,this.y=Math.floor((this.y+e)*t)/t,this.width=r-this.x,this.height=i-this.y,this}enlarge(t){const e=Math.min(this.x,t.x),r=Math.max(this.x+this.width,t.x+t.width),i=Math.min(this.y,t.y),s=Math.max(this.y+this.height,t.y+t.height);return this.x=e,this.width=r-e,this.y=i,this.height=s-i,this}}class hi{constructor(t=0,e=0,r=0){this.x=t,this.y=e,this.radius=r,this.type=si.CIRC}clone(){return new hi(this.x,this.y,this.radius)}contains(t,e){if(this.radius<=0)return!1;const r=this.radius*this.radius;let i=this.x-t,s=this.y-e;return i*=i,s*=s,i+s<=r}getBounds(){return new ai(this.x-this.radius,this.y-this.radius,2*this.radius,2*this.radius)}}class li{constructor(t=0,e=0,r=0,i=0){this.x=t,this.y=e,this.width=r,this.height=i,this.type=si.ELIP}clone(){return new li(this.x,this.y,this.width,this.height)}contains(t,e){if(this.width<=0||this.height<=0)return!1;let r=(t-this.x)/this.width,i=(e-this.y)/this.height;return r*=r,i*=i,r+i<=1}getBounds(){return new ai(this.x-this.width,this.y-this.height,this.width,this.height)}}class ui{constructor(...t){let e=Array.isArray(t[0])?t[0]:t;if("number"!=typeof e[0]){const t=[];for(let r=0,i=e.length;r<i;r++)t.push(e[r].x,e[r].y);e=t}this.points=e,this.type=si.POLY,this.closeStroke=!0}clone(){const t=this.points.slice(),e=new ui(t);return e.closeStroke=this.closeStroke,e}contains(t,e){let r=!1;const i=this.points.length/2;for(let s=0,n=i-1;s<i;n=s++){const i=this.points[2*s],o=this.points[2*s+1],a=this.points[2*n],h=this.points[2*n+1];o>e!=h>e&&t<(e-o)/(h-o)*(a-i)+i&&(r=!r)}return r}}class ci{constructor(t=0,e=0,r=0,i=0,s=20){this.x=t,this.y=e,this.width=r,this.height=i,this.radius=s,this.type=si.RREC}clone(){return new ci(this.x,this.y,this.width,this.height,this.radius)}contains(t,e){if(this.width<=0||this.height<=0)return!1;if(t>=this.x&&t<=this.x+this.width&&e>=this.y&&e<=this.y+this.height){const r=Math.max(0,Math.min(this.radius,Math.min(this.width,this.height)/2));if(e>=this.y+r&&e<=this.y+this.height-r||t>=this.x+r&&t<=this.x+this.width-r)return!0;let i=t-(this.x+r),s=e-(this.y+r);const n=r*r;if(i*i+s*s<=n||(i=t-(this.x+this.width-r),i*i+s*s<=n)||(s=e-(this.y+this.height-r),i*i+s*s<=n)||(i=t-(this.x+r),i*i+s*s<=n))return!0}return!1}}class di{constructor(t=1,e=0,r=0,i=1,s=0,n=0){this.array=null,this.a=t,this.b=e,this.c=r,this.d=i,this.tx=s,this.ty=n}fromArray(t){this.a=t[0],this.b=t[1],this.c=t[3],this.d=t[4],this.tx=t[2],this.ty=t[5]}set(t,e,r,i,s,n){return this.a=t,this.b=e,this.c=r,this.d=i,this.tx=s,this.ty=n,this}toArray(t,e){this.array||(this.array=new Float32Array(9));const r=e||this.array;return t?(r[0]=this.a,r[1]=this.b,r[2]=0,r[3]=this.c,r[4]=this.d,r[5]=0,r[6]=this.tx,r[7]=this.ty,r[8]=1):(r[0]=this.a,r[1]=this.c,r[2]=this.tx,r[3]=this.b,r[4]=this.d,r[5]=this.ty,r[6]=0,r[7]=0,r[8]=1),r}apply(t,e){e=e||new ni;const r=t.x,i=t.y;return e.x=this.a*r+this.c*i+this.tx,e.y=this.b*r+this.d*i+this.ty,e}applyInverse(t,e){e=e||new ni;const r=1/(this.a*this.d+this.c*-this.b),i=t.x,s=t.y;return e.x=this.d*r*i+-this.c*r*s+(this.ty*this.c-this.tx*this.d)*r,e.y=this.a*r*s+-this.b*r*i+(-this.ty*this.a+this.tx*this.b)*r,e}translate(t,e){return this.tx+=t,this.ty+=e,this}scale(t,e){return this.a*=t,this.d*=e,this.c*=t,this.b*=e,this.tx*=t,this.ty*=e,this}rotate(t){const e=Math.cos(t),r=Math.sin(t),i=this.a,s=this.c,n=this.tx;return this.a=i*e-this.b*r,this.b=i*r+this.b*e,this.c=s*e-this.d*r,this.d=s*r+this.d*e,this.tx=n*e-this.ty*r,this.ty=n*r+this.ty*e,this}append(t){const e=this.a,r=this.b,i=this.c,s=this.d;return this.a=t.a*e+t.b*i,this.b=t.a*r+t.b*s,this.c=t.c*e+t.d*i,this.d=t.c*r+t.d*s,this.tx=t.tx*e+t.ty*i+this.tx,this.ty=t.tx*r+t.ty*s+this.ty,this}setTransform(t,e,r,i,s,n,o,a,h){return this.a=Math.cos(o+h)*s,this.b=Math.sin(o+h)*s,this.c=-Math.sin(o-a)*n,this.d=Math.cos(o-a)*n,this.tx=t-(r*this.a+i*this.c),this.ty=e-(r*this.b+i*this.d),this}prepend(t){const e=this.tx;if(1!==t.a||0!==t.b||0!==t.c||1!==t.d){const e=this.a,r=this.c;this.a=e*t.a+this.b*t.c,this.b=e*t.b+this.b*t.d,this.c=r*t.a+this.d*t.c,this.d=r*t.b+this.d*t.d}return this.tx=e*t.a+this.ty*t.c+t.tx,this.ty=e*t.b+this.ty*t.d+t.ty,this}decompose(t){const e=this.a,r=this.b,i=this.c,s=this.d,n=t.pivot,o=-Math.atan2(-i,s),a=Math.atan2(r,e),h=Math.abs(o+a);return h<1e-5||Math.abs(ei-h)<1e-5?(t.rotation=a,t.skew.x=t.skew.y=0):(t.rotation=0,t.skew.x=o,t.skew.y=a),t.scale.x=Math.sqrt(e*e+r*r),t.scale.y=Math.sqrt(i*i+s*s),t.position.x=this.tx+(n.x*e+n.y*i),t.position.y=this.ty+(n.x*r+n.y*s),t}invert(){const t=this.a,e=this.b,r=this.c,i=this.d,s=this.tx,n=t*i-e*r;return this.a=i/n,this.b=-e/n,this.c=-r/n,this.d=t/n,this.tx=(r*this.ty-i*s)/n,this.ty=-(t*this.ty-e*s)/n,this}identity(){return this.a=1,this.b=0,this.c=0,this.d=1,this.tx=0,this.ty=0,this}clone(){const t=new di;return t.a=this.a,t.b=this.b,t.c=this.c,t.d=this.d,t.tx=this.tx,t.ty=this.ty,t}copyTo(t){return t.a=this.a,t.b=this.b,t.c=this.c,t.d=this.d,t.tx=this.tx,t.ty=this.ty,t}copyFrom(t){return this.a=t.a,this.b=t.b,this.c=t.c,this.d=t.d,this.tx=t.tx,this.ty=t.ty,this}static get IDENTITY(){return new di}static get TEMP_MATRIX(){return new di}}const fi=[1,1,0,-1,-1,-1,0,1,1,1,0,-1,-1,-1,0,1],pi=[0,1,1,1,0,-1,-1,-1,0,1,1,1,0,-1,-1,-1],_i=[0,-1,-1,-1,0,1,1,1,0,1,1,1,0,-1,-1,-1],mi=[1,1,0,-1,-1,-1,0,1,-1,-1,0,1,1,1,0,-1],gi=[],yi=[],bi=Math.sign;!function(){for(let t=0;t<16;t++){const e=[];gi.push(e);for(let r=0;r<16;r++){const i=bi(fi[t]*fi[r]+_i[t]*pi[r]),s=bi(pi[t]*fi[r]+mi[t]*pi[r]),n=bi(fi[t]*_i[r]+_i[t]*mi[r]),o=bi(pi[t]*_i[r]+mi[t]*mi[r]);for(let t=0;t<16;t++)if(fi[t]===i&&pi[t]===s&&_i[t]===n&&mi[t]===o){e.push(t);break}}}for(let t=0;t<16;t++){const e=new di;e.set(fi[t],pi[t],_i[t],mi[t],0,0),yi.push(e)}}();const vi={E:0,SE:1,S:2,SW:3,W:4,NW:5,N:6,NE:7,MIRROR_VERTICAL:8,MAIN_DIAGONAL:10,MIRROR_HORIZONTAL:12,REVERSE_DIAGONAL:14,uX:t=>fi[t],uY:t=>pi[t],vX:t=>_i[t],vY:t=>mi[t],inv:t=>8&t?15&t:7&-t,add:(t,e)=>gi[t][e],sub:(t,e)=>gi[t][vi.inv(e)],rotate180:t=>4^t,isVertical:t=>2==(3&t),byDirection:(t,e)=>2*Math.abs(t)<=Math.abs(e)?e>=0?vi.S:vi.N:2*Math.abs(e)<=Math.abs(t)?t>0?vi.E:vi.W:e>0?t>0?vi.SE:vi.SW:t>0?vi.NE:vi.NW,matrixAppendRotationInv:(t,e,r=0,i=0)=>{const s=yi[vi.inv(e)];s.tx=r,s.ty=i,t.append(s)}};class xi{constructor(t,e,r=0,i=0){this._x=r,this._y=i,this.cb=t,this.scope=e}clone(t=this.cb,e=this.scope){return new xi(t,e,this._x,this._y)}set(t=0,e=t){return(this._x!==t||this._y!==e)&&(this._x=t,this._y=e,this.cb.call(this.scope)),this}copyFrom(t){return(this._x!==t.x||this._y!==t.y)&&(this._x=t.x,this._y=t.y,this.cb.call(this.scope)),this}copyTo(t){return t.set(this._x,this._y),t}equals(t){return t.x===this._x&&t.y===this._y}get x(){return this._x}set x(t){this._x!==t&&(this._x=t,this.cb.call(this.scope))}get y(){return this._y}set y(t){this._y!==t&&(this._y=t,this.cb.call(this.scope))}}const Ai=class{constructor(){this.worldTransform=new di,this.localTransform=new di,this.position=new xi(this.onChange,this,0,0),this.scale=new xi(this.onChange,this,1,1),this.pivot=new xi(this.onChange,this,0,0),this.skew=new xi(this.updateSkew,this,0,0),this._rotation=0,this._cx=1,this._sx=0,this._cy=0,this._sy=1,this._localID=0,this._currentLocalID=0,this._worldID=0,this._parentID=0}onChange(){this._localID++}updateSkew(){this._cx=Math.cos(this._rotation+this.skew.y),this._sx=Math.sin(this._rotation+this.skew.y),this._cy=-Math.sin(this._rotation-this.skew.x),this._sy=Math.cos(this._rotation-this.skew.x),this._localID++}updateLocalTransform(){const t=this.localTransform;this._localID!==this._currentLocalID&&(t.a=this._cx*this.scale.x,t.b=this._sx*this.scale.x,t.c=this._cy*this.scale.y,t.d=this._sy*this.scale.y,t.tx=this.position.x-(this.pivot.x*t.a+this.pivot.y*t.c),t.ty=this.position.y-(this.pivot.x*t.b+this.pivot.y*t.d),this._currentLocalID=this._localID,this._parentID=-1)}updateTransform(t){const e=this.localTransform;if(this._localID!==this._currentLocalID&&(e.a=this._cx*this.scale.x,e.b=this._sx*this.scale.x,e.c=this._cy*this.scale.y,e.d=this._sy*this.scale.y,e.tx=this.position.x-(this.pivot.x*e.a+this.pivot.y*e.c),e.ty=this.position.y-(this.pivot.x*e.b+this.pivot.y*e.d),this._currentLocalID=this._localID,this._parentID=-1),this._parentID!==t._worldID){const r=t.worldTransform,i=this.worldTransform;i.a=e.a*r.a+e.b*r.c,i.b=e.a*r.b+e.b*r.d,i.c=e.c*r.a+e.d*r.c,i.d=e.c*r.b+e.d*r.d,i.tx=e.tx*r.a+e.ty*r.c+r.tx,i.ty=e.tx*r.b+e.ty*r.d+r.ty,this._parentID=t._worldID,this._worldID++}}setFromMatrix(t){t.decompose(this),this._localID++}get rotation(){return this._rotation}set rotation(t){this._rotation!==t&&(this._rotation=t,this.updateSkew())}};Ai.IDENTITY=new Ai;let Ti=Ai;function Ei(t,e,r){const i=t.createShader(e);return t.shaderSource(i,r),t.compileShader(i),i}function wi(t){const e=new Array(t);for(let t=0;t<e.length;t++)e[t]=!1;return e}function Si(t,e){switch(t){case"float":case"int":case"uint":case"sampler2D":case"sampler2DArray":return 0;case"vec2":return new Float32Array(2*e);case"vec3":return new Float32Array(3*e);case"vec4":return new Float32Array(4*e);case"ivec2":return new Int32Array(2*e);case"ivec3":return new Int32Array(3*e);case"ivec4":return new Int32Array(4*e);case"uvec2":return new Uint32Array(2*e);case"uvec3":return new Uint32Array(3*e);case"uvec4":return new Uint32Array(4*e);case"bool":return!1;case"bvec2":return wi(2*e);case"bvec3":return wi(3*e);case"bvec4":return wi(4*e);case"mat2":return new Float32Array([1,0,0,1]);case"mat3":return new Float32Array([1,0,0,0,1,0,0,0,1]);case"mat4":return new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1])}return null}const Ci=[{test:t=>"float"===t.type&&1===t.size&&!t.isArray,code:t=>`\n            if(uv["${t}"] !== ud["${t}"].value)\n            {\n                ud["${t}"].value = uv["${t}"]\n                gl.uniform1f(ud["${t}"].location, uv["${t}"])\n            }\n            `},{test:(t,e)=>!("sampler2D"!==t.type&&"samplerCube"!==t.type&&"sampler2DArray"!==t.type||1!==t.size||t.isArray||null!=e&&void 0===e.castToBaseTexture),code:t=>`t = syncData.textureCount++;\n\n            renderer.texture.bind(uv["${t}"], t);\n\n            if(ud["${t}"].value !== t)\n            {\n                ud["${t}"].value = t;\n                gl.uniform1i(ud["${t}"].location, t);\n; // eslint-disable-line max-len\n            }`},{test:(t,e)=>"mat3"===t.type&&1===t.size&&!t.isArray&&void 0!==e.a,code:t=>`\n            gl.uniformMatrix3fv(ud["${t}"].location, false, uv["${t}"].toArray(true));\n            `,codeUbo:t=>`\n                var ${t}_matrix = uv.${t}.toArray(true);\n\n                data[offset] = ${t}_matrix[0];\n                data[offset+1] = ${t}_matrix[1];\n                data[offset+2] = ${t}_matrix[2];\n        \n                data[offset + 4] = ${t}_matrix[3];\n                data[offset + 5] = ${t}_matrix[4];\n                data[offset + 6] = ${t}_matrix[5];\n        \n                data[offset + 8] = ${t}_matrix[6];\n                data[offset + 9] = ${t}_matrix[7];\n                data[offset + 10] = ${t}_matrix[8];\n            `},{test:(t,e)=>"vec2"===t.type&&1===t.size&&!t.isArray&&void 0!==e.x,code:t=>`\n                cv = ud["${t}"].value;\n                v = uv["${t}"];\n\n                if(cv[0] !== v.x || cv[1] !== v.y)\n                {\n                    cv[0] = v.x;\n                    cv[1] = v.y;\n                    gl.uniform2f(ud["${t}"].location, v.x, v.y);\n                }`,codeUbo:t=>`\n                v = uv.${t};\n\n                data[offset] = v.x;\n                data[offset+1] = v.y;\n            `},{test:t=>"vec2"===t.type&&1===t.size&&!t.isArray,code:t=>`\n                cv = ud["${t}"].value;\n                v = uv["${t}"];\n\n                if(cv[0] !== v[0] || cv[1] !== v[1])\n                {\n                    cv[0] = v[0];\n                    cv[1] = v[1];\n                    gl.uniform2f(ud["${t}"].location, v[0], v[1]);\n                }\n            `},{test:(t,e)=>"vec4"===t.type&&1===t.size&&!t.isArray&&void 0!==e.width,code:t=>`\n                cv = ud["${t}"].value;\n                v = uv["${t}"];\n\n                if(cv[0] !== v.x || cv[1] !== v.y || cv[2] !== v.width || cv[3] !== v.height)\n                {\n                    cv[0] = v.x;\n                    cv[1] = v.y;\n                    cv[2] = v.width;\n                    cv[3] = v.height;\n                    gl.uniform4f(ud["${t}"].location, v.x, v.y, v.width, v.height)\n                }`,codeUbo:t=>`\n                    v = uv.${t};\n\n                    data[offset] = v.x;\n                    data[offset+1] = v.y;\n                    data[offset+2] = v.width;\n                    data[offset+3] = v.height;\n                `},{test:(t,e)=>"vec4"===t.type&&1===t.size&&!t.isArray&&void 0!==e.red,code:t=>`\n                cv = ud["${t}"].value;\n                v = uv["${t}"];\n\n                if(cv[0] !== v.red || cv[1] !== v.green || cv[2] !== v.blue || cv[3] !== v.alpha)\n                {\n                    cv[0] = v.red;\n                    cv[1] = v.green;\n                    cv[2] = v.blue;\n                    cv[3] = v.alpha;\n                    gl.uniform4f(ud["${t}"].location, v.red, v.green, v.blue, v.alpha)\n                }`,codeUbo:t=>`\n                    v = uv.${t};\n\n                    data[offset] = v.red;\n                    data[offset+1] = v.green;\n                    data[offset+2] = v.blue;\n                    data[offset+3] = v.alpha;\n                `},{test:(t,e)=>"vec3"===t.type&&1===t.size&&!t.isArray&&void 0!==e.red,code:t=>`\n                cv = ud["${t}"].value;\n                v = uv["${t}"];\n\n                if(cv[0] !== v.red || cv[1] !== v.green || cv[2] !== v.blue || cv[3] !== v.a)\n                {\n                    cv[0] = v.red;\n                    cv[1] = v.green;\n                    cv[2] = v.blue;\n    \n                    gl.uniform3f(ud["${t}"].location, v.red, v.green, v.blue)\n                }`,codeUbo:t=>`\n                    v = uv.${t};\n\n                    data[offset] = v.red;\n                    data[offset+1] = v.green;\n                    data[offset+2] = v.blue;\n                `},{test:t=>"vec4"===t.type&&1===t.size&&!t.isArray,code:t=>`\n                cv = ud["${t}"].value;\n                v = uv["${t}"];\n\n                if(cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3])\n                {\n                    cv[0] = v[0];\n                    cv[1] = v[1];\n                    cv[2] = v[2];\n                    cv[3] = v[3];\n\n                    gl.uniform4f(ud["${t}"].location, v[0], v[1], v[2], v[3])\n                }`}],Pi={float:"\n    if (cv !== v)\n    {\n        cu.value = v;\n        gl.uniform1f(location, v);\n    }",vec2:"\n    if (cv[0] !== v[0] || cv[1] !== v[1])\n    {\n        cv[0] = v[0];\n        cv[1] = v[1];\n\n        gl.uniform2f(location, v[0], v[1])\n    }",vec3:"\n    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2])\n    {\n        cv[0] = v[0];\n        cv[1] = v[1];\n        cv[2] = v[2];\n\n        gl.uniform3f(location, v[0], v[1], v[2])\n    }",vec4:"\n    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3])\n    {\n        cv[0] = v[0];\n        cv[1] = v[1];\n        cv[2] = v[2];\n        cv[3] = v[3];\n\n        gl.uniform4f(location, v[0], v[1], v[2], v[3]);\n    }",int:"\n    if (cv !== v)\n    {\n        cu.value = v;\n\n        gl.uniform1i(location, v);\n    }",ivec2:"\n    if (cv[0] !== v[0] || cv[1] !== v[1])\n    {\n        cv[0] = v[0];\n        cv[1] = v[1];\n\n        gl.uniform2i(location, v[0], v[1]);\n    }",ivec3:"\n    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2])\n    {\n        cv[0] = v[0];\n        cv[1] = v[1];\n        cv[2] = v[2];\n\n        gl.uniform3i(location, v[0], v[1], v[2]);\n    }",ivec4:"\n    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3])\n    {\n        cv[0] = v[0];\n        cv[1] = v[1];\n        cv[2] = v[2];\n        cv[3] = v[3];\n\n        gl.uniform4i(location, v[0], v[1], v[2], v[3]);\n    }",uint:"\n    if (cv !== v)\n    {\n        cu.value = v;\n\n        gl.uniform1ui(location, v);\n    }",uvec2:"\n    if (cv[0] !== v[0] || cv[1] !== v[1])\n    {\n        cv[0] = v[0];\n        cv[1] = v[1];\n\n        gl.uniform2ui(location, v[0], v[1]);\n    }",uvec3:"\n    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2])\n    {\n        cv[0] = v[0];\n        cv[1] = v[1];\n        cv[2] = v[2];\n\n        gl.uniform3ui(location, v[0], v[1], v[2]);\n    }",uvec4:"\n    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3])\n    {\n        cv[0] = v[0];\n        cv[1] = v[1];\n        cv[2] = v[2];\n        cv[3] = v[3];\n\n        gl.uniform4ui(location, v[0], v[1], v[2], v[3]);\n    }",bool:"\n    if (cv !== v)\n    {\n        cu.value = v;\n        gl.uniform1i(location, v);\n    }",bvec2:"\n    if (cv[0] != v[0] || cv[1] != v[1])\n    {\n        cv[0] = v[0];\n        cv[1] = v[1];\n\n        gl.uniform2i(location, v[0], v[1]);\n    }",bvec3:"\n    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2])\n    {\n        cv[0] = v[0];\n        cv[1] = v[1];\n        cv[2] = v[2];\n\n        gl.uniform3i(location, v[0], v[1], v[2]);\n    }",bvec4:"\n    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3])\n    {\n        cv[0] = v[0];\n        cv[1] = v[1];\n        cv[2] = v[2];\n        cv[3] = v[3];\n\n        gl.uniform4i(location, v[0], v[1], v[2], v[3]);\n    }",mat2:"gl.uniformMatrix2fv(location, false, v)",mat3:"gl.uniformMatrix3fv(location, false, v)",mat4:"gl.uniformMatrix4fv(location, false, v)",sampler2D:"\n    if (cv !== v)\n    {\n        cu.value = v;\n\n        gl.uniform1i(location, v);\n    }",samplerCube:"\n    if (cv !== v)\n    {\n        cu.value = v;\n\n        gl.uniform1i(location, v);\n    }",sampler2DArray:"\n    if (cv !== v)\n    {\n        cu.value = v;\n\n        gl.uniform1i(location, v);\n    }"},Mi={float:"gl.uniform1fv(location, v)",vec2:"gl.uniform2fv(location, v)",vec3:"gl.uniform3fv(location, v)",vec4:"gl.uniform4fv(location, v)",mat4:"gl.uniformMatrix4fv(location, false, v)",mat3:"gl.uniformMatrix3fv(location, false, v)",mat2:"gl.uniformMatrix2fv(location, false, v)",int:"gl.uniform1iv(location, v)",ivec2:"gl.uniform2iv(location, v)",ivec3:"gl.uniform3iv(location, v)",ivec4:"gl.uniform4iv(location, v)",uint:"gl.uniform1uiv(location, v)",uvec2:"gl.uniform2uiv(location, v)",uvec3:"gl.uniform3uiv(location, v)",uvec4:"gl.uniform4uiv(location, v)",bool:"gl.uniform1iv(location, v)",bvec2:"gl.uniform2iv(location, v)",bvec3:"gl.uniform3iv(location, v)",bvec4:"gl.uniform4iv(location, v)",sampler2D:"gl.uniform1iv(location, v)",samplerCube:"gl.uniform1iv(location, v)",sampler2DArray:"gl.uniform1iv(location, v)"};const $i={};let Ii,Ri=$i;function Di(){if(Ri===$i||null!=Ri&&Ri.isContextLost()){const t=T.ADAPTER.createCanvas();let e;T.PREFER_ENV>=r.WEBGL2&&(e=t.getContext("webgl2",{})),e||(e=t.getContext("webgl",{})||t.getContext("experimental-webgl",{}),e?e.getExtension("WEBGL_draw_buffers"):e=null),Ri=e}return Ri}function Li(t,e){const r=t.getShaderSource(e).split("\n").map(((t,e)=>`${e}: ${t}`)),i=t.getShaderInfoLog(e),s=i.split("\n"),n={},o=s.map((t=>parseFloat(t.replace(/^ERROR\: 0\:([\d]+)\:.*$/,"$1")))).filter((t=>!(!t||n[t])&&(n[t]=!0,!0))),a=[""];o.forEach((t=>{r[t-1]=`%c${r[t-1]}%c`,a.push("background: #FF0000; color:#FFFFFF; font-size: 10px","font-size: 10px")}));const h=r.join("\n");a[0]=h,console.error(i),console.groupCollapsed("click to view full shader code"),console.warn(...a),console.groupEnd()}const Fi={float:1,vec2:2,vec3:3,vec4:4,int:1,ivec2:2,ivec3:3,ivec4:4,uint:1,uvec2:2,uvec3:3,uvec4:4,bool:1,bvec2:2,bvec3:3,bvec4:4,mat2:4,mat3:9,mat4:16,sampler2D:1};function Oi(t){return Fi[t]}let ki=null;const Bi={FLOAT:"float",FLOAT_VEC2:"vec2",FLOAT_VEC3:"vec3",FLOAT_VEC4:"vec4",INT:"int",INT_VEC2:"ivec2",INT_VEC3:"ivec3",INT_VEC4:"ivec4",UNSIGNED_INT:"uint",UNSIGNED_INT_VEC2:"uvec2",UNSIGNED_INT_VEC3:"uvec3",UNSIGNED_INT_VEC4:"uvec4",BOOL:"bool",BOOL_VEC2:"bvec2",BOOL_VEC3:"bvec3",BOOL_VEC4:"bvec4",FLOAT_MAT2:"mat2",FLOAT_MAT3:"mat3",FLOAT_MAT4:"mat4",SAMPLER_2D:"sampler2D",INT_SAMPLER_2D:"sampler2D",UNSIGNED_INT_SAMPLER_2D:"sampler2D",SAMPLER_CUBE:"samplerCube",INT_SAMPLER_CUBE:"samplerCube",UNSIGNED_INT_SAMPLER_CUBE:"samplerCube",SAMPLER_2D_ARRAY:"sampler2DArray",INT_SAMPLER_2D_ARRAY:"sampler2DArray",UNSIGNED_INT_SAMPLER_2D_ARRAY:"sampler2DArray"};function Ni(t,e){if(!ki){const e=Object.keys(Bi);ki={};for(let r=0;r<e.length;++r){const i=e[r];ki[t[i]]=Bi[i]}}return ki[e]}function Ui(t,e,r){if("precision"!==t.substring(0,9)){let i=e;return e===g.HIGH&&r!==g.HIGH&&(i=g.MEDIUM),`precision ${i} float;\n${t}`}return r!==g.HIGH&&"precision highp"===t.substring(0,15)?t.replace("precision highp","precision mediump"):t}let Gi;function Vi(){if("boolean"==typeof Gi)return Gi;try{Gi=!0===new Function("param1","param2","param3","return param1[param2] === param3;")({a:"b"},"a","b")}catch(t){Gi=!1}return Gi}let Hi=0;const zi={},Xi=class t{constructor(e,r,i="pixi-shader",s={}){this.extra={},this.id=Hi++,this.vertexSrc=e||t.defaultVertexSrc,this.fragmentSrc=r||t.defaultFragmentSrc,this.vertexSrc=this.vertexSrc.trim(),this.fragmentSrc=this.fragmentSrc.trim(),this.extra=s,"#version"!==this.vertexSrc.substring(0,8)&&(i=i.replace(/\s+/g,"-"),zi[i]?(zi[i]++,i+=`-${zi[i]}`):zi[i]=1,this.vertexSrc=`#define SHADER_NAME ${i}\n${this.vertexSrc}`,this.fragmentSrc=`#define SHADER_NAME ${i}\n${this.fragmentSrc}`,this.vertexSrc=Ui(this.vertexSrc,t.defaultVertexPrecision,g.HIGH),this.fragmentSrc=Ui(this.fragmentSrc,t.defaultFragmentPrecision,function(){if(!Ii){Ii=g.MEDIUM;const t=Di();if(t&&t.getShaderPrecisionFormat){const e=t.getShaderPrecisionFormat(t.FRAGMENT_SHADER,t.HIGH_FLOAT);e&&(Ii=e.precision?g.HIGH:g.MEDIUM)}}return Ii}())),this.glPrograms={},this.syncUniforms=null}static get defaultVertexSrc(){return"attribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\n\nuniform mat3 projectionMatrix;\n\nvarying vec2 vTextureCoord;\n\nvoid main(void){\n   gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n   vTextureCoord = aTextureCoord;\n}\n"}static get defaultFragmentSrc(){return"varying vec2 vTextureCoord;\n\nuniform sampler2D uSampler;\n\nvoid main(void){\n   gl_FragColor *= texture2D(uSampler, vTextureCoord);\n}"}static from(e,r,i){const s=e+r;let n=sr[s];return n||(sr[s]=n=new t(e,r,i)),n}};Xi.defaultVertexPrecision=g.HIGH,Xi.defaultFragmentPrecision=V.apple.device?g.HIGH:g.MEDIUM;let Wi=Xi,Yi=0;class ji{constructor(t,e,r){this.group=!0,this.syncUniforms={},this.dirtyId=0,this.id=Yi++,this.static=!!e,this.ubo=!!r,t instanceof Yr?(this.buffer=t,this.buffer.type=x.UNIFORM_BUFFER,this.autoManage=!1,this.ubo=!0):(this.uniforms=t,this.ubo&&(this.buffer=new Yr(new Float32Array(1)),this.buffer.type=x.UNIFORM_BUFFER,this.autoManage=!0))}update(){this.dirtyId++,!this.autoManage&&this.buffer&&this.buffer.update()}add(t,e,r){if(this.ubo)throw new Error("[UniformGroup] uniform groups in ubo mode cannot be modified, or have uniform groups nested in them");this.uniforms[t]=new ji(e,r)}static from(t,e,r){return new ji(t,e,r)}static uboFrom(t,e){return new ji(t,null==e||e,!0)}}class qi{constructor(t,e){this.uniformBindCount=0,this.program=t,this.uniformGroup=e?e instanceof ji?e:new ji(e):new ji({}),this.disposeRunner=new Lr("disposeShader")}checkUniformExists(t,e){if(e.uniforms[t])return!0;for(const r in e.uniforms){const i=e.uniforms[r];if(!0===i.group&&this.checkUniformExists(t,i))return!0}return!1}destroy(){this.uniformGroup=null,this.disposeRunner.emit(this),this.disposeRunner.destroy()}get uniforms(){return this.uniformGroup.uniforms}static from(t,e,r){const i=Wi.from(t,e);return new qi(i,r)}}class Zi{constructor(t,e){if(this.vertexSrc=t,this.fragTemplate=e,this.programCache={},this.defaultGroupCache={},!e.includes("%count%"))throw new Error('Fragment template must contain "%count%".');if(!e.includes("%forloop%"))throw new Error('Fragment template must contain "%forloop%".')}generateShader(t){if(!this.programCache[t]){const e=new Int32Array(t);for(let r=0;r<t;r++)e[r]=r;this.defaultGroupCache[t]=ji.from({uSamplers:e},!0);let r=this.fragTemplate;r=r.replace(/%count%/gi,`${t}`),r=r.replace(/%forloop%/gi,this.generateSampleSrc(t)),this.programCache[t]=new Wi(this.vertexSrc,r)}const e={tint:new Float32Array([1,1,1,1]),translationMatrix:new di,default:this.defaultGroupCache[t]};return new qi(this.programCache[t],e)}generateSampleSrc(t){let e="";e+="\n",e+="\n";for(let r=0;r<t;r++)r>0&&(e+="\nelse "),r<t-1&&(e+=`if(vTextureId < ${r}.5)`),e+="\n{",e+=`\n\tcolor = texture2D(uSamplers[${r}], vTextureCoord);`,e+="\n}";return e+="\n",e+="\n",e}}class Qi{constructor(){this.elements=[],this.ids=[],this.count=0}clear(){for(let t=0;t<this.count;t++)this.elements[t]=null;this.count=0}}class Ji{constructor(t){this.renderer=t}flush(){}destroy(){this.renderer=null}start(){}stop(){this.flush()}render(t){}}const Ki=class t extends Ji{constructor(e){super(e),this.setShaderGenerator(),this.geometryClass=ti,this.vertexSize=6,this.state=Ir.for2d(),this.size=4*t.defaultBatchSize,this._vertexCount=0,this._indexCount=0,this._bufferedElements=[],this._bufferedTextures=[],this._bufferSize=0,this._shader=null,this._packedGeometries=[],this._packedGeometryPoolSize=2,this._flushId=0,this._aBuffers={},this._iBuffers={},this.maxTextures=1,this.renderer.on("prerender",this.onPrerender,this),e.runners.contextChange.add(this),this._dcIndex=0,this._aIndex=0,this._iIndex=0,this._attributeBuffer=null,this._indexBuffer=null,this._tempBoundTextures=[]}static get defaultMaxTextures(){var t;return this._defaultMaxTextures=null!=(t=this._defaultMaxTextures)?t:function(t){let e=!0;const r=T.ADAPTER.getNavigator();if(V.tablet||V.phone){if(V.apple.device){const t=r.userAgent.match(/OS (\d+)_(\d+)?/);t&&parseInt(t[1],10)<11&&(e=!1)}if(V.android.device){const t=r.userAgent.match(/Android\s([0-9.]*)/);t&&parseInt(t[1],10)<7&&(e=!1)}}return e?t:4}(32),this._defaultMaxTextures}static set defaultMaxTextures(t){this._defaultMaxTextures=t}static get canUploadSameBuffer(){var t;return this._canUploadSameBuffer=null!=(t=this._canUploadSameBuffer)?t:!V.apple.device,this._canUploadSameBuffer}static set canUploadSameBuffer(t){this._canUploadSameBuffer=t}get MAX_TEXTURES(){return this.maxTextures}static get defaultVertexSrc(){return"precision highp float;\nattribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\nattribute vec4 aColor;\nattribute float aTextureId;\n\nuniform mat3 projectionMatrix;\nuniform mat3 translationMatrix;\nuniform vec4 tint;\n\nvarying vec2 vTextureCoord;\nvarying vec4 vColor;\nvarying float vTextureId;\n\nvoid main(void){\n    gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n\n    vTextureCoord = aTextureCoord;\n    vTextureId = aTextureId;\n    vColor = aColor * tint;\n}\n"}static get defaultFragmentTemplate(){return"varying vec2 vTextureCoord;\nvarying vec4 vColor;\nvarying float vTextureId;\nuniform sampler2D uSamplers[%count%];\n\nvoid main(void){\n    vec4 color;\n    %forloop%\n    gl_FragColor = color * vColor;\n}\n"}setShaderGenerator({vertex:e=t.defaultVertexSrc,fragment:r=t.defaultFragmentTemplate}={}){this.shaderGenerator=new Zi(e,r)}contextChange(){const e=this.renderer.gl;T.PREFER_ENV===r.WEBGL_LEGACY?this.maxTextures=1:(this.maxTextures=Math.min(e.getParameter(e.MAX_TEXTURE_IMAGE_UNITS),t.defaultMaxTextures),this.maxTextures=$r(this.maxTextures,e)),this._shader=this.shaderGenerator.generateShader(this.maxTextures);for(let t=0;t<this._packedGeometryPoolSize;t++)this._packedGeometries[t]=new this.geometryClass;this.initFlushBuffers()}initFlushBuffers(){const{_drawCallPool:e,_textureArrayPool:r}=t,i=this.size/4,s=Math.floor(i/this.maxTextures)+1;for(;e.length<i;)e.push(new Xr);for(;r.length<s;)r.push(new Qi);for(let t=0;t<this.maxTextures;t++)this._tempBoundTextures[t]=null}onPrerender(){this._flushId=0}render(t){t._texture.valid&&(this._vertexCount+t.vertexData.length/2>this.size&&this.flush(),this._vertexCount+=t.vertexData.length/2,this._indexCount+=t.indices.length,this._bufferedTextures[this._bufferSize]=t._texture.baseTexture,this._bufferedElements[this._bufferSize++]=t)}buildTexturesAndDrawCalls(){const{_bufferedTextures:e,maxTextures:r}=this,i=t._textureArrayPool,s=this.renderer.batch,n=this._tempBoundTextures,o=this.renderer.textureGC.count;let a=++zr._globalBatch,h=0,l=i[0],u=0;s.copyBoundTextures(n,r);for(let t=0;t<this._bufferSize;++t){const c=e[t];e[t]=null,c._batchEnabled!==a&&(l.count>=r&&(s.boundArray(l,n,a,r),this.buildDrawCalls(l,u,t),u=t,l=i[++h],++a),c._batchEnabled=a,c.touched=o,l.elements[l.count++]=c)}l.count>0&&(s.boundArray(l,n,a,r),this.buildDrawCalls(l,u,this._bufferSize),++h,++a);for(let t=0;t<n.length;t++)n[t]=null;zr._globalBatch=a}buildDrawCalls(e,r,i){const{_bufferedElements:s,_attributeBuffer:n,_indexBuffer:o,vertexSize:a}=this,h=t._drawCallPool;let l=this._dcIndex,u=this._aIndex,c=this._iIndex,d=h[l];d.start=this._iIndex,d.texArray=e;for(let t=r;t<i;++t){const i=s[t],f=i._texture.baseTexture,p=He[f.alphaMode?1:0][i.blendMode];s[t]=null,r<t&&d.blend!==p&&(d.size=c-d.start,r=t,d=h[++l],d.texArray=e,d.start=c),this.packInterleavedGeometry(i,n,o,u,c),u+=i.vertexData.length/2*a,c+=i.indices.length,d.blend=p}r<i&&(d.size=c-d.start,++l),this._dcIndex=l,this._aIndex=u,this._iIndex=c}bindAndClearTexArray(t){const e=this.renderer.texture;for(let r=0;r<t.count;r++)e.bind(t.elements[r],t.ids[r]),t.elements[r]=null;t.count=0}updateGeometry(){const{_packedGeometries:e,_attributeBuffer:r,_indexBuffer:i}=this;t.canUploadSameBuffer?(e[this._flushId]._buffer.update(r.rawBinaryData),e[this._flushId]._indexBuffer.update(i),this.renderer.geometry.updateBuffers()):(this._packedGeometryPoolSize<=this._flushId&&(this._packedGeometryPoolSize++,e[this._flushId]=new this.geometryClass),e[this._flushId]._buffer.update(r.rawBinaryData),e[this._flushId]._indexBuffer.update(i),this.renderer.geometry.bind(e[this._flushId]),this.renderer.geometry.updateBuffers(),this._flushId++)}drawBatches(){const e=this._dcIndex,{gl:r,state:i}=this.renderer,s=t._drawCallPool;let n=null;for(let t=0;t<e;t++){const{texArray:e,type:o,size:a,start:h,blend:l}=s[t];n!==e&&(n=e,this.bindAndClearTexArray(e)),this.state.blendMode=l,i.set(this.state),r.drawElements(o,a,r.UNSIGNED_SHORT,2*h)}}flush(){0!==this._vertexCount&&(this._attributeBuffer=this.getAttributeBuffer(this._vertexCount),this._indexBuffer=this.getIndexBuffer(this._indexCount),this._aIndex=0,this._iIndex=0,this._dcIndex=0,this.buildTexturesAndDrawCalls(),this.updateGeometry(),this.drawBatches(),this._bufferSize=0,this._vertexCount=0,this._indexCount=0)}start(){this.renderer.state.set(this.state),this.renderer.texture.ensureSamplerType(this.maxTextures),this.renderer.shader.bind(this._shader),t.canUploadSameBuffer&&this.renderer.geometry.bind(this._packedGeometries[this._flushId])}stop(){this.flush()}destroy(){for(let t=0;t<this._packedGeometryPoolSize;t++)this._packedGeometries[t]&&this._packedGeometries[t].destroy();this.renderer.off("prerender",this.onPrerender,this),this._aBuffers=null,this._iBuffers=null,this._packedGeometries=null,this._attributeBuffer=null,this._indexBuffer=null,this._shader&&(this._shader.destroy(),this._shader=null),super.destroy()}getAttributeBuffer(t){const e=qe(Math.ceil(t/8)),r=Qe(e),i=8*e;this._aBuffers.length<=r&&(this._iBuffers.length=r+1);let s=this._aBuffers[i];return s||(this._aBuffers[i]=s=new Cr(i*this.vertexSize*4)),s}getIndexBuffer(t){const e=qe(Math.ceil(t/12)),r=Qe(e),i=12*e;this._iBuffers.length<=r&&(this._iBuffers.length=r+1);let s=this._iBuffers[r];return s||(this._iBuffers[r]=s=new Uint16Array(i)),s}packInterleavedGeometry(t,e,r,i,s){const{uint32View:n,float32View:o}=e,a=i/this.vertexSize,h=t.uvs,l=t.indices,u=t.vertexData,c=t._texture.baseTexture._batchLocation,d=Math.min(t.worldAlpha,1),f=Ue.shared.setValue(t._tintRGB).toPremultiplied(d,t._texture.baseTexture.alphaMode>0);for(let t=0;t<u.length;t+=2)o[i++]=u[t],o[i++]=u[t+1],o[i++]=h[t],o[i++]=h[t+1],n[i++]=f,o[i++]=c;for(let t=0;t<l.length;t++)r[s++]=a+l[t]}};Ki.defaultBatchSize=4096,Ki.extension={name:"batch",type:Tr.RendererPlugin},Ki._drawCallPool=[],Ki._textureArrayPool=[];let ts=Ki;Sr.add(ts);const es=class t extends qi{constructor(e,r,i){super(Wi.from(e||t.defaultVertexSrc,r||t.defaultFragmentSrc),i),this.padding=0,this.resolution=t.defaultResolution,this.multisample=t.defaultMultisample,this.enabled=!0,this.autoFit=!0,this.state=new Ir}apply(t,e,r,i,s){t.applyFilter(this,e,r,i)}get blendMode(){return this.state.blendMode}set blendMode(t){this.state.blendMode=t}get resolution(){return this._resolution}set resolution(t){this._resolution=t}static get defaultVertexSrc(){return"attribute vec2 aVertexPosition;\n\nuniform mat3 projectionMatrix;\n\nvarying vec2 vTextureCoord;\n\nuniform vec4 inputSize;\nuniform vec4 outputFrame;\n\nvec4 filterVertexPosition( void )\n{\n    vec2 position = aVertexPosition * max(outputFrame.zw, vec2(0.)) + outputFrame.xy;\n\n    return vec4((projectionMatrix * vec3(position, 1.0)).xy, 0.0, 1.0);\n}\n\nvec2 filterTextureCoord( void )\n{\n    return aVertexPosition * (outputFrame.zw * inputSize.zw);\n}\n\nvoid main(void)\n{\n    gl_Position = filterVertexPosition();\n    vTextureCoord = filterTextureCoord();\n}\n"}static get defaultFragmentSrc(){return"varying vec2 vTextureCoord;\n\nuniform sampler2D uSampler;\n\nvoid main(void){\n   gl_FragColor = texture2D(uSampler, vTextureCoord);\n}\n"}};es.defaultResolution=1,es.defaultMultisample=v.NONE;let rs=es;class is{constructor(){this.clearBeforeRender=!0,this._backgroundColor=new Ue(0),this.alpha=1}init(t){this.clearBeforeRender=t.clearBeforeRender;const{backgroundColor:e,background:r,backgroundAlpha:i}=t,s=null!=r?r:e;void 0!==s&&(this.color=s),this.alpha=i}get color(){return this._backgroundColor.value}set color(t){this._backgroundColor.setValue(t)}get alpha(){return this._backgroundColor.alpha}set alpha(t){this._backgroundColor.setAlpha(t)}get backgroundColor(){return this._backgroundColor}destroy(){}}is.defaultOptions={backgroundAlpha:1,backgroundColor:0,clearBeforeRender:!0},is.extension={type:[Tr.RendererSystem,Tr.CanvasRendererSystem],name:"background"},Sr.add(is);class ss{constructor(t){this.renderer=t,this.emptyRenderer=new Ji(t),this.currentRenderer=this.emptyRenderer}setObjectRenderer(t){this.currentRenderer!==t&&(this.currentRenderer.stop(),this.currentRenderer=t,this.currentRenderer.start())}flush(){this.setObjectRenderer(this.emptyRenderer)}reset(){this.setObjectRenderer(this.emptyRenderer)}copyBoundTextures(t,e){const{boundTextures:r}=this.renderer.texture;for(let i=e-1;i>=0;--i)t[i]=r[i]||null,t[i]&&(t[i]._batchLocation=i)}boundArray(t,e,r,i){const{elements:s,ids:n,count:o}=t;let a=0;for(let t=0;t<o;t++){const o=s[t],h=o._batchLocation;if(h>=0&&h<i&&e[h]===o)n[t]=h;else for(;a<i;){const i=e[a];if(!i||i._batchEnabled!==r||i._batchLocation!==a){n[t]=a,o._batchLocation=a,e[a]=o;break}a++}}}destroy(){this.renderer=null}}ss.extension={type:Tr.RendererSystem,name:"batch"},Sr.add(ss);let ns=0;class os{constructor(t){this.renderer=t,this.webGLVersion=1,this.extensions={},this.supports={uint32Indices:!1},this.handleContextLost=this.handleContextLost.bind(this),this.handleContextRestored=this.handleContextRestored.bind(this)}get isLost(){return!this.gl||this.gl.isContextLost()}contextChange(t){this.gl=t,this.renderer.gl=t,this.renderer.CONTEXT_UID=ns++}init(t){if(t.context)this.initFromContext(t.context);else{const e=this.renderer.background.alpha<1,r=t.premultipliedAlpha;this.preserveDrawingBuffer=t.preserveDrawingBuffer,this.useContextAlpha=t.useContextAlpha,this.powerPreference=t.powerPreference,this.initFromOptions({alpha:e,premultipliedAlpha:r,antialias:t.antialias,stencil:!0,preserveDrawingBuffer:t.preserveDrawingBuffer,powerPreference:t.powerPreference})}}initFromContext(t){this.gl=t,this.validateContext(t),this.renderer.gl=t,this.renderer.CONTEXT_UID=ns++,this.renderer.runners.contextChange.emit(t);const e=this.renderer.view;void 0!==e.addEventListener&&(e.addEventListener("webglcontextlost",this.handleContextLost,!1),e.addEventListener("webglcontextrestored",this.handleContextRestored,!1))}initFromOptions(t){const e=this.createContext(this.renderer.view,t);this.initFromContext(e)}createContext(t,e){let i;if(T.PREFER_ENV>=r.WEBGL2&&(i=t.getContext("webgl2",e)),i)this.webGLVersion=2;else if(this.webGLVersion=1,i=t.getContext("webgl",e)||t.getContext("experimental-webgl",e),!i)throw new Error("This browser does not support WebGL. Try using the canvas renderer");return this.gl=i,this.getExtensions(),this.gl}getExtensions(){const{gl:t}=this,e={loseContext:t.getExtension("WEBGL_lose_context"),anisotropicFiltering:t.getExtension("EXT_texture_filter_anisotropic"),floatTextureLinear:t.getExtension("OES_texture_float_linear"),s3tc:t.getExtension("WEBGL_compressed_texture_s3tc"),s3tc_sRGB:t.getExtension("WEBGL_compressed_texture_s3tc_srgb"),etc:t.getExtension("WEBGL_compressed_texture_etc"),etc1:t.getExtension("WEBGL_compressed_texture_etc1"),pvrtc:t.getExtension("WEBGL_compressed_texture_pvrtc")||t.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc"),atc:t.getExtension("WEBGL_compressed_texture_atc"),astc:t.getExtension("WEBGL_compressed_texture_astc"),bptc:t.getExtension("EXT_texture_compression_bptc")};1===this.webGLVersion?Object.assign(this.extensions,e,{drawBuffers:t.getExtension("WEBGL_draw_buffers"),depthTexture:t.getExtension("WEBGL_depth_texture"),vertexArrayObject:t.getExtension("OES_vertex_array_object")||t.getExtension("MOZ_OES_vertex_array_object")||t.getExtension("WEBKIT_OES_vertex_array_object"),uint32ElementIndex:t.getExtension("OES_element_index_uint"),floatTexture:t.getExtension("OES_texture_float"),floatTextureLinear:t.getExtension("OES_texture_float_linear"),textureHalfFloat:t.getExtension("OES_texture_half_float"),textureHalfFloatLinear:t.getExtension("OES_texture_half_float_linear")}):2===this.webGLVersion&&Object.assign(this.extensions,e,{colorBufferFloat:t.getExtension("EXT_color_buffer_float")})}handleContextLost(t){t.preventDefault(),setTimeout((()=>{this.gl.isContextLost()&&this.extensions.loseContext&&this.extensions.loseContext.restoreContext()}),0)}handleContextRestored(){this.renderer.runners.contextChange.emit(this.gl)}destroy(){const t=this.renderer.view;this.renderer=null,void 0!==t.removeEventListener&&(t.removeEventListener("webglcontextlost",this.handleContextLost),t.removeEventListener("webglcontextrestored",this.handleContextRestored)),this.gl.useProgram(null),this.extensions.loseContext&&this.extensions.loseContext.loseContext()}postrender(){this.renderer.objectRenderer.renderingToScreen&&this.gl.flush()}validateContext(t){const e=t.getContextAttributes(),r="WebGL2RenderingContext"in globalThis&&t instanceof globalThis.WebGL2RenderingContext;r&&(this.webGLVersion=2),e&&!e.stencil&&console.warn("Provided WebGL context does not have a stencil buffer, masks may not render correctly");const i=r||!!t.getExtension("OES_element_index_uint");this.supports.uint32Indices=i,i||console.warn("Provided WebGL context does not support 32 index buffer, complex graphics may not render correctly")}}os.defaultOptions={context:null,antialias:!1,premultipliedAlpha:!0,preserveDrawingBuffer:!1,powerPreference:"default"},os.extension={type:Tr.RendererSystem,name:"context"},Sr.add(os);class as{constructor(t,e){if(this.width=Math.round(t),this.height=Math.round(e),!this.width||!this.height)throw new Error("Framebuffer width or height is zero");this.stencil=!1,this.depth=!1,this.dirtyId=0,this.dirtyFormat=0,this.dirtySize=0,this.depthTexture=null,this.colorTextures=[],this.glFramebuffers={},this.disposeRunner=new Lr("disposeFramebuffer"),this.multisample=v.NONE}get colorTexture(){return this.colorTextures[0]}addColorTexture(t=0,e){return this.colorTextures[t]=e||new zr(null,{scaleMode:c.NEAREST,resolution:1,mipmap:f.OFF,width:this.width,height:this.height}),this.dirtyId++,this.dirtyFormat++,this}addDepthTexture(t){return this.depthTexture=t||new zr(null,{scaleMode:c.NEAREST,resolution:1,width:this.width,height:this.height,mipmap:f.OFF,format:a.DEPTH_COMPONENT,type:l.UNSIGNED_SHORT}),this.dirtyId++,this.dirtyFormat++,this}enableDepth(){return this.depth=!0,this.dirtyId++,this.dirtyFormat++,this}enableStencil(){return this.stencil=!0,this.dirtyId++,this.dirtyFormat++,this}resize(t,e){if(t=Math.round(t),e=Math.round(e),!t||!e)throw new Error("Framebuffer width and height must not be zero");if(t!==this.width||e!==this.height){this.width=t,this.height=e,this.dirtyId++,this.dirtySize++;for(let r=0;r<this.colorTextures.length;r++){const i=this.colorTextures[r],s=i.resolution;i.setSize(t/s,e/s)}if(this.depthTexture){const r=this.depthTexture.resolution;this.depthTexture.setSize(t/r,e/r)}}}dispose(){this.disposeRunner.emit(this,!1)}destroyDepthTexture(){this.depthTexture&&(this.depthTexture.destroy(),this.depthTexture=null,++this.dirtyId,++this.dirtyFormat)}}class hs extends zr{constructor(t={}){var e,r;if("number"==typeof t){t={width:arguments[0],height:arguments[1],scaleMode:arguments[2],resolution:arguments[3]}}t.width=null!=(e=t.width)?e:100,t.height=null!=(r=t.height)?r:100,null!=t.multisample||(t.multisample=v.NONE),super(null,t),this.mipmap=f.OFF,this.valid=!0,this._clear=new Ue([0,0,0,0]),this.framebuffer=new as(this.realWidth,this.realHeight).addColorTexture(0,this),this.framebuffer.multisample=t.multisample,this.maskStack=[],this.filterStack=[{}]}set clearColor(t){this._clear.setValue(t)}get clearColor(){return this._clear.value}get clear(){return this._clear}get multisample(){return this.framebuffer.multisample}set multisample(t){this.framebuffer.multisample=t}resize(t,e){this.framebuffer.resize(t*this.resolution,e*this.resolution),this.setRealSize(this.framebuffer.width,this.framebuffer.height)}dispose(){this.framebuffer.dispose(),super.dispose()}destroy(){super.destroy(),this.framebuffer.destroyDepthTexture(),this.framebuffer=null}}class ls extends Fr{constructor(t){const e=t;super(e.naturalWidth||e.videoWidth||e.displayWidth||e.width,e.naturalHeight||e.videoHeight||e.displayHeight||e.height),this.source=t,this.noSubImage=!1}static crossOrigin(t,e,r){void 0!==r||e.startsWith("data:")?!1!==r&&(t.crossOrigin="string"==typeof r?r:"anonymous"):t.crossOrigin=dr(e)}upload(t,e,r,i){const s=t.gl,n=e.realWidth,o=e.realHeight;if(i=i||this.source,"undefined"!=typeof HTMLImageElement&&i instanceof HTMLImageElement){if(!i.complete||0===i.naturalWidth)return!1}else if("undefined"!=typeof HTMLVideoElement&&i instanceof HTMLVideoElement&&i.readyState<=1)return!1;return s.pixelStorei(s.UNPACK_PREMULTIPLY_ALPHA_WEBGL,e.alphaMode===p.UNPACK),this.noSubImage||e.target!==s.TEXTURE_2D||r.width!==n||r.height!==o?(r.width=n,r.height=o,s.texImage2D(e.target,0,r.internalFormat,e.format,r.type,i)):s.texSubImage2D(s.TEXTURE_2D,0,0,0,e.format,r.type,i),!0}update(){if(this.destroyed)return;const t=this.source,e=t.naturalWidth||t.videoWidth||t.width,r=t.naturalHeight||t.videoHeight||t.height;this.resize(e,r),super.update()}dispose(){this.source=null}}class us extends ls{constructor(t,e){var r;if(e=e||{},"string"==typeof t){const r=new Image;ls.crossOrigin(r,t,e.crossorigin),r.src=t,t=r}super(t),!t.complete&&this._width&&this._height&&(this._width=0,this._height=0),this.url=t.src,this._process=null,this.preserveBitmap=!1,this.createBitmap=(null!=(r=e.createBitmap)?r:T.CREATE_IMAGE_BITMAP)&&!!globalThis.createImageBitmap,this.alphaMode="number"==typeof e.alphaMode?e.alphaMode:null,this.bitmap=null,this._load=null,!1!==e.autoLoad&&this.load()}load(t){return this._load||(void 0!==t&&(this.createBitmap=t),this._load=new Promise(((t,e)=>{const r=this.source;this.url=r.src;const i=()=>{this.destroyed||(r.onload=null,r.onerror=null,this.update(),this._load=null,this.createBitmap?t(this.process()):t(this))};r.complete&&r.src?i():(r.onload=i,r.onerror=t=>{e(t),this.onError.emit(t)})}))),this._load}process(){const t=this.source;if(null!==this._process)return this._process;if(null!==this.bitmap||!globalThis.createImageBitmap)return Promise.resolve(this);const e=globalThis.createImageBitmap,r=!t.crossOrigin||"anonymous"===t.crossOrigin;return this._process=fetch(t.src,{mode:r?"cors":"no-cors"}).then((t=>t.blob())).then((r=>e(r,0,0,t.width,t.height,{premultiplyAlpha:null===this.alphaMode||this.alphaMode===p.UNPACK?"premultiply":"none"}))).then((t=>this.destroyed?Promise.reject():(this.bitmap=t,this.update(),this._process=null,Promise.resolve(this)))),this._process}upload(t,e,r){if("number"==typeof this.alphaMode&&(e.alphaMode=this.alphaMode),!this.createBitmap)return super.upload(t,e,r);if(!this.bitmap&&(this.process(),!this.bitmap))return!1;if(super.upload(t,e,r,this.bitmap),!this.preserveBitmap){let t=!0;const i=e._glTextures;for(const s in i){const n=i[s];if(n!==r&&n.dirtyId!==e.dirtyId){t=!1;break}}t&&(this.bitmap.close&&this.bitmap.close(),this.bitmap=null)}return!0}dispose(){this.source.onload=null,this.source.onerror=null,super.dispose(),this.bitmap&&(this.bitmap.close(),this.bitmap=null),this._process=null,this._load=null}static test(t){return"undefined"!=typeof HTMLImageElement&&("string"==typeof t||t instanceof HTMLImageElement)}}class cs{constructor(){this.x0=0,this.y0=0,this.x1=1,this.y1=0,this.x2=1,this.y2=1,this.x3=0,this.y3=1,this.uvsFloat32=new Float32Array(8)}set(t,e,r){const i=e.width,s=e.height;if(r){const e=t.width/2/i,n=t.height/2/s,o=t.x/i+e,a=t.y/s+n;r=vi.add(r,vi.NW),this.x0=o+e*vi.uX(r),this.y0=a+n*vi.uY(r),r=vi.add(r,2),this.x1=o+e*vi.uX(r),this.y1=a+n*vi.uY(r),r=vi.add(r,2),this.x2=o+e*vi.uX(r),this.y2=a+n*vi.uY(r),r=vi.add(r,2),this.x3=o+e*vi.uX(r),this.y3=a+n*vi.uY(r)}else this.x0=t.x/i,this.y0=t.y/s,this.x1=(t.x+t.width)/i,this.y1=t.y/s,this.x2=(t.x+t.width)/i,this.y2=(t.y+t.height)/s,this.x3=t.x/i,this.y3=(t.y+t.height)/s;this.uvsFloat32[0]=this.x0,this.uvsFloat32[1]=this.y0,this.uvsFloat32[2]=this.x1,this.uvsFloat32[3]=this.y1,this.uvsFloat32[4]=this.x2,this.uvsFloat32[5]=this.y2,this.uvsFloat32[6]=this.x3,this.uvsFloat32[7]=this.y3}}const ds=new cs;function fs(t){t.destroy=function(){},t.on=function(){},t.once=function(){},t.emit=function(){}}class ps extends W{constructor(t,e,r,i,s,n,o){if(super(),this.noFrame=!1,e||(this.noFrame=!0,e=new ai(0,0,1,1)),t instanceof ps&&(t=t.baseTexture),this.baseTexture=t,this._frame=e,this.trim=i,this.valid=!1,this.destroyed=!1,this._uvs=ds,this.uvMatrix=null,this.orig=r||e,this._rotate=Number(s||0),!0===s)this._rotate=2;else if(this._rotate%2!=0)throw new Error("attempt to use diamond-shaped UVs. If you are sure, set rotation manually");this.defaultAnchor=n?new ni(n.x,n.y):new ni(0,0),this.defaultBorders=o,this._updateID=0,this.textureCacheIds=[],t.valid?this.noFrame?t.valid&&this.onBaseTextureUpdated(t):this.frame=e:t.once("loaded",this.onBaseTextureUpdated,this),this.noFrame&&t.on("update",this.onBaseTextureUpdated,this)}update(){this.baseTexture.resource&&this.baseTexture.resource.update()}onBaseTextureUpdated(t){if(this.noFrame){if(!this.baseTexture.valid)return;this._frame.width=t.width,this._frame.height=t.height,this.valid=!0,this.updateUvs()}else this.frame=this._frame;this.emit("update",this)}destroy(t){if(this.baseTexture){if(t){const{resource:t}=this.baseTexture;null!=t&&t.url&&nr[t.url]&&ps.removeFromCache(t.url),this.baseTexture.destroy()}this.baseTexture.off("loaded",this.onBaseTextureUpdated,this),this.baseTexture.off("update",this.onBaseTextureUpdated,this),this.baseTexture=null}this._frame=null,this._uvs=null,this.trim=null,this.orig=null,this.valid=!1,ps.removeFromCache(this),this.textureCacheIds=null,this.destroyed=!0,this.emit("destroyed",this),this.removeAllListeners()}clone(){var t;const e=this._frame.clone(),r=this._frame===this.orig?e:this.orig.clone(),i=new ps(this.baseTexture,!this.noFrame&&e,r,null==(t=this.trim)?void 0:t.clone(),this.rotate,this.defaultAnchor,this.defaultBorders);return this.noFrame&&(i._frame=e),i}updateUvs(){this._uvs===ds&&(this._uvs=new cs),this._uvs.set(this._frame,this.baseTexture,this.rotate),this._updateID++}static from(t,e={},r=T.STRICT_TEXTURE_CACHE){const i="string"==typeof t;let s=null;if(i)s=t;else if(t instanceof zr){if(!t.cacheId){const r=(null==e?void 0:e.pixiIdPrefix)||"pixiid";t.cacheId=`${r}-${er()}`,zr.addToCache(t,t.cacheId)}s=t.cacheId}else{if(!t._pixiId){const r=(null==e?void 0:e.pixiIdPrefix)||"pixiid";t._pixiId=`${r}_${er()}`}s=t._pixiId}let n=nr[s];if(i&&r&&!n)throw new Error(`The cacheId "${s}" does not exist in TextureCache.`);return n||t instanceof zr?!n&&t instanceof zr&&(n=new ps(t),ps.addToCache(n,s)):(e.resolution||(e.resolution=fr(t)),n=new ps(new zr(t,e)),n.baseTexture.cacheId=s,zr.addToCache(n.baseTexture,s),ps.addToCache(n,s)),n}static fromURL(t,e){const r=Object.assign({autoLoad:!1},null==e?void 0:e.resourceOptions),i=ps.from(t,Object.assign({resourceOptions:r},e),!1),s=i.baseTexture.resource;return i.baseTexture.valid?Promise.resolve(i):s.load().then((()=>Promise.resolve(i)))}static fromBuffer(t,e,r,i){return new ps(zr.fromBuffer(t,e,r,i))}static fromLoader(t,e,r,i){const s=new zr(t,Object.assign({scaleMode:zr.defaultOptions.scaleMode,resolution:fr(e)},i)),{resource:n}=s;n instanceof us&&(n.url=e);const o=new ps(s);return r||(r=e),zr.addToCache(o.baseTexture,r),ps.addToCache(o,r),r!==e&&(zr.addToCache(o.baseTexture,e),ps.addToCache(o,e)),o.baseTexture.valid?Promise.resolve(o):new Promise((t=>{o.baseTexture.once("loaded",(()=>t(o)))}))}static addToCache(t,e){e&&(t.textureCacheIds.includes(e)||t.textureCacheIds.push(e),nr[e]&&nr[e]!==t&&console.warn(`Texture added to the cache with an id [${e}] that already had an entry`),nr[e]=t)}static removeFromCache(t){if("string"==typeof t){const e=nr[t];if(e){const r=e.textureCacheIds.indexOf(t);return r>-1&&e.textureCacheIds.splice(r,1),delete nr[t],e}}else if(null!=t&&t.textureCacheIds){for(let e=0;e<t.textureCacheIds.length;++e)nr[t.textureCacheIds[e]]===t&&delete nr[t.textureCacheIds[e]];return t.textureCacheIds.length=0,t}return null}get resolution(){return this.baseTexture.resolution}get frame(){return this._frame}set frame(t){this._frame=t,this.noFrame=!1;const{x:e,y:r,width:i,height:s}=t,n=e+i>this.baseTexture.width,o=r+s>this.baseTexture.height;if(n||o){const t=n&&o?"and":"or",a=`X: ${e} + ${i} = ${e+i} > ${this.baseTexture.width}`,h=`Y: ${r} + ${s} = ${r+s} > ${this.baseTexture.height}`;throw new Error(`Texture Error: frame does not fit inside the base Texture dimensions: ${a} ${t} ${h}`)}this.valid=i&&s&&this.baseTexture.valid,!this.trim&&!this.rotate&&(this.orig=t),this.valid&&this.updateUvs()}get rotate(){return this._rotate}set rotate(t){this._rotate=t,this.valid&&this.updateUvs()}get width(){return this.orig.width}get height(){return this.orig.height}castToBaseTexture(){return this.baseTexture}static get EMPTY(){return ps._EMPTY||(ps._EMPTY=new ps(new zr),fs(ps._EMPTY),fs(ps._EMPTY.baseTexture)),ps._EMPTY}static get WHITE(){if(!ps._WHITE){const t=T.ADAPTER.createCanvas(16,16),e=t.getContext("2d");t.width=16,t.height=16,e.fillStyle="white",e.fillRect(0,0,16,16),ps._WHITE=new ps(zr.from(t)),fs(ps._WHITE),fs(ps._WHITE.baseTexture)}return ps._WHITE}}class _s extends ps{constructor(t,e){super(t,e),this.valid=!0,this.filterFrame=null,this.filterPoolKey=null,this.updateUvs()}get framebuffer(){return this.baseTexture.framebuffer}get multisample(){return this.framebuffer.multisample}set multisample(t){this.framebuffer.multisample=t}resize(t,e,r=!0){const i=this.baseTexture.resolution,s=Math.round(t*i)/i,n=Math.round(e*i)/i;this.valid=s>0&&n>0,this._frame.width=this.orig.width=s,this._frame.height=this.orig.height=n,r&&this.baseTexture.resize(s,n),this.updateUvs()}setResolution(t){const{baseTexture:e}=this;e.resolution!==t&&(e.setResolution(t),this.resize(e.width,e.height,!1))}static create(t){return new _s(new hs(t))}}class ms{constructor(t){this.texturePool={},this.textureOptions=t||{},this.enableFullScreen=!1,this._pixelsWidth=0,this._pixelsHeight=0}createTexture(t,e,r=v.NONE){const i=new hs(Object.assign({width:t,height:e,resolution:1,multisample:r},this.textureOptions));return new _s(i)}getOptimalTexture(t,e,r=1,i=v.NONE){let s;t=Math.max(Math.ceil(t*r-1e-6),1),e=Math.max(Math.ceil(e*r-1e-6),1),this.enableFullScreen&&t===this._pixelsWidth&&e===this._pixelsHeight?s=i>1?-i:-1:(s=((65535&(t=qe(t)))<<16|65535&(e=qe(e)))>>>0,i>1&&(s+=4294967296*i)),this.texturePool[s]||(this.texturePool[s]=[]);let n=this.texturePool[s].pop();return n||(n=this.createTexture(t,e,i)),n.filterPoolKey=s,n.setResolution(r),n}getFilterTexture(t,e,r){const i=this.getOptimalTexture(t.width,t.height,e||t.resolution,r||v.NONE);return i.filterFrame=t.filterFrame,i}returnTexture(t){const e=t.filterPoolKey;t.filterFrame=null,this.texturePool[e].push(t)}returnFilterTexture(t){this.returnTexture(t)}clear(t){if(t=!1!==t)for(const t in this.texturePool){const e=this.texturePool[t];if(e)for(let t=0;t<e.length;t++)e[t].destroy(!0)}this.texturePool={}}setScreenSize(t){if(t.width!==this._pixelsWidth||t.height!==this._pixelsHeight){this.enableFullScreen=t.width>0&&t.height>0;for(const t in this.texturePool){if(!(Number(t)<0))continue;const e=this.texturePool[t];if(e)for(let t=0;t<e.length;t++)e[t].destroy(!0);this.texturePool[t]=[]}this._pixelsWidth=t.width,this._pixelsHeight=t.height}}}ms.SCREEN_KEY=-1;class gs extends Kr{constructor(){super(),this.addAttribute("aVertexPosition",new Float32Array([0,0,1,0,1,1,0,1])).addIndex([0,1,3,2])}}class ys extends Kr{constructor(){super(),this.vertices=new Float32Array([-1,-1,1,-1,1,1,-1,1]),this.uvs=new Float32Array([0,0,1,0,1,1,0,1]),this.vertexBuffer=new Yr(this.vertices),this.uvBuffer=new Yr(this.uvs),this.addAttribute("aVertexPosition",this.vertexBuffer).addAttribute("aTextureCoord",this.uvBuffer).addIndex([0,1,2,0,2,3])}map(t,e){let r=0,i=0;return this.uvs[0]=r,this.uvs[1]=i,this.uvs[2]=r+e.width/t.width,this.uvs[3]=i,this.uvs[4]=r+e.width/t.width,this.uvs[5]=i+e.height/t.height,this.uvs[6]=r,this.uvs[7]=i+e.height/t.height,r=e.x,i=e.y,this.vertices[0]=r,this.vertices[1]=i,this.vertices[2]=r+e.width,this.vertices[3]=i,this.vertices[4]=r+e.width,this.vertices[5]=i+e.height,this.vertices[6]=r,this.vertices[7]=i+e.height,this.invalidate(),this}invalidate(){return this.vertexBuffer._updateID++,this.uvBuffer._updateID++,this}}class bs{constructor(){this.renderTexture=null,this.target=null,this.legacy=!1,this.resolution=1,this.multisample=v.NONE,this.sourceFrame=new ai,this.destinationFrame=new ai,this.bindingSourceFrame=new ai,this.bindingDestinationFrame=new ai,this.filters=[],this.transform=null}clear(){this.target=null,this.filters=null,this.renderTexture=null}}const vs=[new ni,new ni,new ni,new ni],xs=new di;class As{constructor(t){this.renderer=t,this.defaultFilterStack=[{}],this.texturePool=new ms,this.statePool=[],this.quad=new gs,this.quadUv=new ys,this.tempRect=new ai,this.activeState={},this.globalUniforms=new ji({outputFrame:new ai,inputSize:new Float32Array(4),inputPixel:new Float32Array(4),inputClamp:new Float32Array(4),resolution:1,filterArea:new Float32Array(4),filterClamp:new Float32Array(4)},!0),this.forceClear=!1,this.useMaxPadding=!1}init(){this.texturePool.setScreenSize(this.renderer.view)}push(t,e){var r,i,s,n;const o=this.renderer,a=this.defaultFilterStack,h=this.statePool.pop()||new bs,l=o.renderTexture;let u,c;if(l.current){const t=l.current;u=t.resolution,c=t.multisample}else u=o.resolution,c=o.multisample;let d=e[0].resolution||u,f=null!=(r=e[0].multisample)?r:c,p=e[0].padding,_=e[0].autoFit,m=null==(i=e[0].legacy)||i;for(let t=1;t<e.length;t++){const r=e[t];d=Math.min(d,r.resolution||u),f=Math.min(f,null!=(s=r.multisample)?s:c),p=this.useMaxPadding?Math.max(p,r.padding):p+r.padding,_=_&&r.autoFit,m=m||null==(n=r.legacy)||n}1===a.length&&(this.defaultFilterStack[0].renderTexture=l.current),a.push(h),h.resolution=d,h.multisample=f,h.legacy=m,h.target=t,h.sourceFrame.copyFrom(t.filterArea||t.getBounds(!0)),h.sourceFrame.pad(p);const g=this.tempRect.copyFrom(l.sourceFrame);o.projection.transform&&this.transformAABB(xs.copyFrom(o.projection.transform).invert(),g),_?(h.sourceFrame.fit(g),(h.sourceFrame.width<=0||h.sourceFrame.height<=0)&&(h.sourceFrame.width=0,h.sourceFrame.height=0)):h.sourceFrame.intersects(g)||(h.sourceFrame.width=0,h.sourceFrame.height=0),this.roundFrame(h.sourceFrame,l.current?l.current.resolution:o.resolution,l.sourceFrame,l.destinationFrame,o.projection.transform),h.renderTexture=this.getOptimalFilterTexture(h.sourceFrame.width,h.sourceFrame.height,d,f),h.filters=e,h.destinationFrame.width=h.renderTexture.width,h.destinationFrame.height=h.renderTexture.height;const y=this.tempRect;y.x=0,y.y=0,y.width=h.sourceFrame.width,y.height=h.sourceFrame.height,h.renderTexture.filterFrame=h.sourceFrame,h.bindingSourceFrame.copyFrom(l.sourceFrame),h.bindingDestinationFrame.copyFrom(l.destinationFrame),h.transform=o.projection.transform,o.projection.transform=null,l.bind(h.renderTexture,h.sourceFrame,y),o.framebuffer.clear(0,0,0,0)}pop(){const t=this.defaultFilterStack,e=t.pop(),r=e.filters;this.activeState=e;const i=this.globalUniforms.uniforms;i.outputFrame=e.sourceFrame,i.resolution=e.resolution;const s=i.inputSize,n=i.inputPixel,o=i.inputClamp;if(s[0]=e.destinationFrame.width,s[1]=e.destinationFrame.height,s[2]=1/s[0],s[3]=1/s[1],n[0]=Math.round(s[0]*e.resolution),n[1]=Math.round(s[1]*e.resolution),n[2]=1/n[0],n[3]=1/n[1],o[0]=.5*n[2],o[1]=.5*n[3],o[2]=e.sourceFrame.width*s[2]-.5*n[2],o[3]=e.sourceFrame.height*s[3]-.5*n[3],e.legacy){const t=i.filterArea;t[0]=e.destinationFrame.width,t[1]=e.destinationFrame.height,t[2]=e.sourceFrame.x,t[3]=e.sourceFrame.y,i.filterClamp=i.inputClamp}this.globalUniforms.update();const a=t[t.length-1];if(this.renderer.framebuffer.blit(),1===r.length)r[0].apply(this,e.renderTexture,a.renderTexture,_.BLEND,e),this.returnFilterTexture(e.renderTexture);else{let t=e.renderTexture,i=this.getOptimalFilterTexture(t.width,t.height,e.resolution);i.filterFrame=t.filterFrame;let s=0;for(s=0;s<r.length-1;++s){1===s&&e.multisample>1&&(i=this.getOptimalFilterTexture(t.width,t.height,e.resolution),i.filterFrame=t.filterFrame),r[s].apply(this,t,i,_.CLEAR,e);const n=t;t=i,i=n}r[s].apply(this,t,a.renderTexture,_.BLEND,e),s>1&&e.multisample>1&&this.returnFilterTexture(e.renderTexture),this.returnFilterTexture(t),this.returnFilterTexture(i)}e.clear(),this.statePool.push(e)}bindAndClear(t,e=_.CLEAR){const{renderTexture:r,state:i}=this.renderer;if(t===this.defaultFilterStack[this.defaultFilterStack.length-1].renderTexture?this.renderer.projection.transform=this.activeState.transform:this.renderer.projection.transform=null,null!=t&&t.filterFrame){const e=this.tempRect;e.x=0,e.y=0,e.width=t.filterFrame.width,e.height=t.filterFrame.height,r.bind(t,t.filterFrame,e)}else t!==this.defaultFilterStack[this.defaultFilterStack.length-1].renderTexture?r.bind(t):this.renderer.renderTexture.bind(t,this.activeState.bindingSourceFrame,this.activeState.bindingDestinationFrame);const s=1&i.stateId||this.forceClear;(e===_.CLEAR||e===_.BLIT&&s)&&this.renderer.framebuffer.clear(0,0,0,0)}applyFilter(t,e,r,i){const s=this.renderer;s.state.set(t.state),this.bindAndClear(r,i),t.uniforms.uSampler=e,t.uniforms.filterGlobals=this.globalUniforms,s.shader.bind(t),t.legacy=!!t.program.attributeData.aTextureCoord,t.legacy?(this.quadUv.map(e._frame,e.filterFrame),s.geometry.bind(this.quadUv),s.geometry.draw(o.TRIANGLES)):(s.geometry.bind(this.quad),s.geometry.draw(o.TRIANGLE_STRIP))}calculateSpriteMatrix(t,e){const{sourceFrame:r,destinationFrame:i}=this.activeState,{orig:s}=e._texture,n=t.set(i.width,0,0,i.height,r.x,r.y),o=e.worldTransform.copyTo(di.TEMP_MATRIX);return o.invert(),n.prepend(o),n.scale(1/s.width,1/s.height),n.translate(e.anchor.x,e.anchor.y),n}destroy(){this.renderer=null,this.texturePool.clear(!1)}getOptimalFilterTexture(t,e,r=1,i=v.NONE){return this.texturePool.getOptimalTexture(t,e,r,i)}getFilterTexture(t,e,r){if("number"==typeof t){const r=t;t=e,e=r}t=t||this.activeState.renderTexture;const i=this.texturePool.getOptimalTexture(t.width,t.height,e||t.resolution,r||v.NONE);return i.filterFrame=t.filterFrame,i}returnFilterTexture(t){this.texturePool.returnTexture(t)}emptyPool(){this.texturePool.clear(!0)}resize(){this.texturePool.setScreenSize(this.renderer.view)}transformAABB(t,e){const r=vs[0],i=vs[1],s=vs[2],n=vs[3];r.set(e.left,e.top),i.set(e.left,e.bottom),s.set(e.right,e.top),n.set(e.right,e.bottom),t.apply(r,r),t.apply(i,i),t.apply(s,s),t.apply(n,n);const o=Math.min(r.x,i.x,s.x,n.x),a=Math.min(r.y,i.y,s.y,n.y),h=Math.max(r.x,i.x,s.x,n.x),l=Math.max(r.y,i.y,s.y,n.y);e.x=o,e.y=a,e.width=h-o,e.height=l-a}roundFrame(t,e,r,i,s){if(!(t.width<=0||t.height<=0||r.width<=0||r.height<=0)){if(s){const{a:t,b:e,c:r,d:i}=s;if((Math.abs(e)>1e-4||Math.abs(r)>1e-4)&&(Math.abs(t)>1e-4||Math.abs(i)>1e-4))return}(s=s?xs.copyFrom(s):xs.identity()).translate(-r.x,-r.y).scale(i.width/r.width,i.height/r.height).translate(i.x,i.y),this.transformAABB(s,t),t.ceil(e),this.transformAABB(s.invert(),t)}}}As.extension={type:Tr.RendererSystem,name:"filter"},Sr.add(As);class Ts{constructor(t){this.framebuffer=t,this.stencil=null,this.dirtyId=-1,this.dirtyFormat=-1,this.dirtySize=-1,this.multisample=v.NONE,this.msaaBuffer=null,this.blitFramebuffer=null,this.mipLevel=0}}const Es=new ai;class ws{constructor(t){this.renderer=t,this.managedFramebuffers=[],this.unknownFramebuffer=new as(10,10),this.msaaSamples=null}contextChange(){this.disposeAll(!0);const t=this.gl=this.renderer.gl;if(this.CONTEXT_UID=this.renderer.CONTEXT_UID,this.current=this.unknownFramebuffer,this.viewport=new ai,this.hasMRT=!0,this.writeDepthTexture=!0,1===this.renderer.context.webGLVersion){let e=this.renderer.context.extensions.drawBuffers,i=this.renderer.context.extensions.depthTexture;T.PREFER_ENV===r.WEBGL_LEGACY&&(e=null,i=null),e?t.drawBuffers=t=>e.drawBuffersWEBGL(t):(this.hasMRT=!1,t.drawBuffers=()=>{}),i||(this.writeDepthTexture=!1)}else this.msaaSamples=t.getInternalformatParameter(t.RENDERBUFFER,t.RGBA8,t.SAMPLES)}bind(t,e,r=0){const{gl:i}=this;if(t){const s=t.glFramebuffers[this.CONTEXT_UID]||this.initFramebuffer(t);this.current!==t&&(this.current=t,i.bindFramebuffer(i.FRAMEBUFFER,s.framebuffer)),s.mipLevel!==r&&(t.dirtyId++,t.dirtyFormat++,s.mipLevel=r),s.dirtyId!==t.dirtyId&&(s.dirtyId=t.dirtyId,s.dirtyFormat!==t.dirtyFormat?(s.dirtyFormat=t.dirtyFormat,s.dirtySize=t.dirtySize,this.updateFramebuffer(t,r)):s.dirtySize!==t.dirtySize&&(s.dirtySize=t.dirtySize,this.resizeFramebuffer(t)));for(let e=0;e<t.colorTextures.length;e++){const r=t.colorTextures[e];this.renderer.texture.unbind(r.parentTextureArray||r)}if(t.depthTexture&&this.renderer.texture.unbind(t.depthTexture),e){const t=e.width>>r,i=e.height>>r,s=t/e.width;this.setViewport(e.x*s,e.y*s,t,i)}else{const e=t.width>>r,i=t.height>>r;this.setViewport(0,0,e,i)}}else this.current&&(this.current=null,i.bindFramebuffer(i.FRAMEBUFFER,null)),e?this.setViewport(e.x,e.y,e.width,e.height):this.setViewport(0,0,this.renderer.width,this.renderer.height)}setViewport(t,e,r,i){const s=this.viewport;t=Math.round(t),e=Math.round(e),r=Math.round(r),i=Math.round(i),(s.width!==r||s.height!==i||s.x!==t||s.y!==e)&&(s.x=t,s.y=e,s.width=r,s.height=i,this.gl.viewport(t,e,r,i))}get size(){return this.current?{x:0,y:0,width:this.current.width,height:this.current.height}:{x:0,y:0,width:this.renderer.width,height:this.renderer.height}}clear(t,e,r,i,n=s.COLOR|s.DEPTH){const{gl:o}=this;o.clearColor(t,e,r,i),o.clear(n)}initFramebuffer(t){const{gl:e}=this,r=new Ts(e.createFramebuffer());return r.multisample=this.detectSamples(t.multisample),t.glFramebuffers[this.CONTEXT_UID]=r,this.managedFramebuffers.push(t),t.disposeRunner.add(this),r}resizeFramebuffer(t){const{gl:e}=this,r=t.glFramebuffers[this.CONTEXT_UID];if(r.stencil){let i;e.bindRenderbuffer(e.RENDERBUFFER,r.stencil),i=1===this.renderer.context.webGLVersion?e.DEPTH_STENCIL:t.depth&&t.stencil?e.DEPTH24_STENCIL8:t.depth?e.DEPTH_COMPONENT24:e.STENCIL_INDEX8,r.msaaBuffer?e.renderbufferStorageMultisample(e.RENDERBUFFER,r.multisample,i,t.width,t.height):e.renderbufferStorage(e.RENDERBUFFER,i,t.width,t.height)}const i=t.colorTextures;let s=i.length;e.drawBuffers||(s=Math.min(s,1));for(let n=0;n<s;n++){const s=i[n],o=s.parentTextureArray||s;this.renderer.texture.bind(o,0),0===n&&r.msaaBuffer&&(e.bindRenderbuffer(e.RENDERBUFFER,r.msaaBuffer),e.renderbufferStorageMultisample(e.RENDERBUFFER,r.multisample,o._glTextures[this.CONTEXT_UID].internalFormat,t.width,t.height))}t.depthTexture&&this.writeDepthTexture&&this.renderer.texture.bind(t.depthTexture,0)}updateFramebuffer(t,e){const{gl:r}=this,i=t.glFramebuffers[this.CONTEXT_UID],s=t.colorTextures;let n=s.length;r.drawBuffers||(n=Math.min(n,1)),i.multisample>1&&this.canMultisampleFramebuffer(t)?i.msaaBuffer=i.msaaBuffer||r.createRenderbuffer():i.msaaBuffer&&(r.deleteRenderbuffer(i.msaaBuffer),i.msaaBuffer=null,i.blitFramebuffer&&(i.blitFramebuffer.dispose(),i.blitFramebuffer=null));const o=[];for(let a=0;a<n;a++){const n=s[a],h=n.parentTextureArray||n;this.renderer.texture.bind(h,0),0===a&&i.msaaBuffer?(r.bindRenderbuffer(r.RENDERBUFFER,i.msaaBuffer),r.renderbufferStorageMultisample(r.RENDERBUFFER,i.multisample,h._glTextures[this.CONTEXT_UID].internalFormat,t.width,t.height),r.framebufferRenderbuffer(r.FRAMEBUFFER,r.COLOR_ATTACHMENT0,r.RENDERBUFFER,i.msaaBuffer)):(r.framebufferTexture2D(r.FRAMEBUFFER,r.COLOR_ATTACHMENT0+a,n.target,h._glTextures[this.CONTEXT_UID].texture,e),o.push(r.COLOR_ATTACHMENT0+a))}if(o.length>1&&r.drawBuffers(o),t.depthTexture&&this.writeDepthTexture){const i=t.depthTexture;this.renderer.texture.bind(i,0),r.framebufferTexture2D(r.FRAMEBUFFER,r.DEPTH_ATTACHMENT,r.TEXTURE_2D,i._glTextures[this.CONTEXT_UID].texture,e)}if(!t.stencil&&!t.depth||t.depthTexture&&this.writeDepthTexture)i.stencil&&(r.deleteRenderbuffer(i.stencil),i.stencil=null);else{let e,s;i.stencil=i.stencil||r.createRenderbuffer(),1===this.renderer.context.webGLVersion?(e=r.DEPTH_STENCIL_ATTACHMENT,s=r.DEPTH_STENCIL):t.depth&&t.stencil?(e=r.DEPTH_STENCIL_ATTACHMENT,s=r.DEPTH24_STENCIL8):t.depth?(e=r.DEPTH_ATTACHMENT,s=r.DEPTH_COMPONENT24):(e=r.STENCIL_ATTACHMENT,s=r.STENCIL_INDEX8),r.bindRenderbuffer(r.RENDERBUFFER,i.stencil),i.msaaBuffer?r.renderbufferStorageMultisample(r.RENDERBUFFER,i.multisample,s,t.width,t.height):r.renderbufferStorage(r.RENDERBUFFER,s,t.width,t.height),r.framebufferRenderbuffer(r.FRAMEBUFFER,e,r.RENDERBUFFER,i.stencil)}}canMultisampleFramebuffer(t){return 1!==this.renderer.context.webGLVersion&&t.colorTextures.length<=1&&!t.depthTexture}detectSamples(t){const{msaaSamples:e}=this;let r=v.NONE;if(t<=1||null===e)return r;for(let i=0;i<e.length;i++)if(e[i]<=t){r=e[i];break}return 1===r&&(r=v.NONE),r}blit(t,e,r){const{current:i,renderer:s,gl:n,CONTEXT_UID:o}=this;if(2!==s.context.webGLVersion||!i)return;const a=i.glFramebuffers[o];if(!a)return;if(!t){if(!a.msaaBuffer)return;const e=i.colorTextures[0];if(!e)return;a.blitFramebuffer||(a.blitFramebuffer=new as(i.width,i.height),a.blitFramebuffer.addColorTexture(0,e)),(t=a.blitFramebuffer).colorTextures[0]!==e&&(t.colorTextures[0]=e,t.dirtyId++,t.dirtyFormat++),(t.width!==i.width||t.height!==i.height)&&(t.width=i.width,t.height=i.height,t.dirtyId++,t.dirtySize++)}e||((e=Es).width=i.width,e.height=i.height),r||(r=e);const h=e.width===r.width&&e.height===r.height;this.bind(t),n.bindFramebuffer(n.READ_FRAMEBUFFER,a.framebuffer),n.blitFramebuffer(e.left,e.top,e.right,e.bottom,r.left,r.top,r.right,r.bottom,n.COLOR_BUFFER_BIT,h?n.NEAREST:n.LINEAR),n.bindFramebuffer(n.READ_FRAMEBUFFER,t.glFramebuffers[this.CONTEXT_UID].framebuffer)}disposeFramebuffer(t,e){const r=t.glFramebuffers[this.CONTEXT_UID],i=this.gl;if(!r)return;delete t.glFramebuffers[this.CONTEXT_UID];const s=this.managedFramebuffers.indexOf(t);s>=0&&this.managedFramebuffers.splice(s,1),t.disposeRunner.remove(this),e||(i.deleteFramebuffer(r.framebuffer),r.msaaBuffer&&i.deleteRenderbuffer(r.msaaBuffer),r.stencil&&i.deleteRenderbuffer(r.stencil)),r.blitFramebuffer&&this.disposeFramebuffer(r.blitFramebuffer,e)}disposeAll(t){const e=this.managedFramebuffers;this.managedFramebuffers=[];for(let r=0;r<e.length;r++)this.disposeFramebuffer(e[r],t)}forceStencil(){const t=this.current;if(!t)return;const e=t.glFramebuffers[this.CONTEXT_UID];if(!e||e.stencil&&t.stencil)return;t.stencil=!0;const r=t.width,i=t.height,s=this.gl,n=e.stencil=s.createRenderbuffer();let o,a;s.bindRenderbuffer(s.RENDERBUFFER,n),1===this.renderer.context.webGLVersion?(o=s.DEPTH_STENCIL_ATTACHMENT,a=s.DEPTH_STENCIL):t.depth?(o=s.DEPTH_STENCIL_ATTACHMENT,a=s.DEPTH24_STENCIL8):(o=s.STENCIL_ATTACHMENT,a=s.STENCIL_INDEX8),e.msaaBuffer?s.renderbufferStorageMultisample(s.RENDERBUFFER,e.multisample,a,r,i):s.renderbufferStorage(s.RENDERBUFFER,a,r,i),s.framebufferRenderbuffer(s.FRAMEBUFFER,o,s.RENDERBUFFER,n)}reset(){this.current=this.unknownFramebuffer,this.viewport=new ai}destroy(){this.renderer=null}}ws.extension={type:Tr.RendererSystem,name:"framebuffer"},Sr.add(ws);const Ss={5126:4,5123:2,5121:1};class Cs{constructor(t){this.renderer=t,this._activeGeometry=null,this._activeVao=null,this.hasVao=!0,this.hasInstance=!0,this.canUseUInt32ElementIndex=!1,this.managedGeometries={}}contextChange(){this.disposeAll(!0);const t=this.gl=this.renderer.gl,e=this.renderer.context;if(this.CONTEXT_UID=this.renderer.CONTEXT_UID,2!==e.webGLVersion){let e=this.renderer.context.extensions.vertexArrayObject;T.PREFER_ENV===r.WEBGL_LEGACY&&(e=null),e?(t.createVertexArray=()=>e.createVertexArrayOES(),t.bindVertexArray=t=>e.bindVertexArrayOES(t),t.deleteVertexArray=t=>e.deleteVertexArrayOES(t)):(this.hasVao=!1,t.createVertexArray=()=>null,t.bindVertexArray=()=>null,t.deleteVertexArray=()=>null)}if(2!==e.webGLVersion){const e=t.getExtension("ANGLE_instanced_arrays");e?(t.vertexAttribDivisor=(t,r)=>e.vertexAttribDivisorANGLE(t,r),t.drawElementsInstanced=(t,r,i,s,n)=>e.drawElementsInstancedANGLE(t,r,i,s,n),t.drawArraysInstanced=(t,r,i,s)=>e.drawArraysInstancedANGLE(t,r,i,s)):this.hasInstance=!1}this.canUseUInt32ElementIndex=2===e.webGLVersion||!!e.extensions.uint32ElementIndex}bind(t,e){e=e||this.renderer.shader.shader;const{gl:r}=this;let i=t.glVertexArrayObjects[this.CONTEXT_UID],s=!1;i||(this.managedGeometries[t.id]=t,t.disposeRunner.add(this),t.glVertexArrayObjects[this.CONTEXT_UID]=i={},s=!0);const n=i[e.program.id]||this.initGeometryVao(t,e,s);this._activeGeometry=t,this._activeVao!==n&&(this._activeVao=n,this.hasVao?r.bindVertexArray(n):this.activateVao(t,e.program)),this.updateBuffers()}reset(){this.unbind()}updateBuffers(){const t=this._activeGeometry,e=this.renderer.buffer;for(let r=0;r<t.buffers.length;r++){const i=t.buffers[r];e.update(i)}}checkCompatibility(t,e){const r=t.attributes,i=e.attributeData;for(const t in i)if(!r[t])throw new Error(`shader and geometry incompatible, geometry missing the "${t}" attribute`)}getSignature(t,e){const r=t.attributes,i=e.attributeData,s=["g",t.id];for(const t in r)i[t]&&s.push(t,i[t].location);return s.join("-")}initGeometryVao(t,e,r=!0){const i=this.gl,s=this.CONTEXT_UID,n=this.renderer.buffer,o=e.program;o.glPrograms[s]||this.renderer.shader.generateProgram(e),this.checkCompatibility(t,o);const a=this.getSignature(t,o),h=t.glVertexArrayObjects[this.CONTEXT_UID];let l=h[a];if(l)return h[o.id]=l,l;const u=t.buffers,c=t.attributes,d={},f={};for(const t in u)d[t]=0,f[t]=0;for(const t in c)!c[t].size&&o.attributeData[t]?c[t].size=o.attributeData[t].size:c[t].size||console.warn(`PIXI Geometry attribute '${t}' size cannot be determined (likely the bound shader does not have the attribute)`),d[c[t].buffer]+=c[t].size*Ss[c[t].type];for(const t in c){const e=c[t],r=e.size;void 0===e.stride&&(d[e.buffer]===r*Ss[e.type]?e.stride=0:e.stride=d[e.buffer]),void 0===e.start&&(e.start=f[e.buffer],f[e.buffer]+=r*Ss[e.type])}l=i.createVertexArray(),i.bindVertexArray(l);for(let t=0;t<u.length;t++){const e=u[t];n.bind(e),r&&e._glBuffers[s].refCount++}return this.activateVao(t,o),h[o.id]=l,h[a]=l,i.bindVertexArray(null),n.unbind(x.ARRAY_BUFFER),l}disposeGeometry(t,e){var r;if(!this.managedGeometries[t.id])return;delete this.managedGeometries[t.id];const i=t.glVertexArrayObjects[this.CONTEXT_UID],s=this.gl,n=t.buffers,o=null==(r=this.renderer)?void 0:r.buffer;if(t.disposeRunner.remove(this),i){if(o)for(let t=0;t<n.length;t++){const r=n[t]._glBuffers[this.CONTEXT_UID];r&&(r.refCount--,0===r.refCount&&!e&&o.dispose(n[t],e))}if(!e)for(const t in i)if("g"===t[0]){const e=i[t];this._activeVao===e&&this.unbind(),s.deleteVertexArray(e)}delete t.glVertexArrayObjects[this.CONTEXT_UID]}}disposeAll(t){const e=Object.keys(this.managedGeometries);for(let r=0;r<e.length;r++)this.disposeGeometry(this.managedGeometries[e[r]],t)}activateVao(t,e){const r=this.gl,i=this.CONTEXT_UID,s=this.renderer.buffer,n=t.buffers,o=t.attributes;t.indexBuffer&&s.bind(t.indexBuffer);let a=null;for(const t in o){const h=o[t],l=n[h.buffer],u=l._glBuffers[i];if(e.attributeData[t]){a!==u&&(s.bind(l),a=u);const i=e.attributeData[t].location;if(r.enableVertexAttribArray(i),r.vertexAttribPointer(i,h.size,h.type||r.FLOAT,h.normalized,h.stride,h.start),h.instance){if(!this.hasInstance)throw new Error("geometry error, GPU Instancing is not supported on this device");r.vertexAttribDivisor(i,h.divisor)}}}}draw(t,e,r,i){const{gl:s}=this,n=this._activeGeometry;if(n.indexBuffer){const o=n.indexBuffer.data.BYTES_PER_ELEMENT,a=2===o?s.UNSIGNED_SHORT:s.UNSIGNED_INT;2===o||4===o&&this.canUseUInt32ElementIndex?n.instanced?s.drawElementsInstanced(t,e||n.indexBuffer.data.length,a,(r||0)*o,i||1):s.drawElements(t,e||n.indexBuffer.data.length,a,(r||0)*o):console.warn("unsupported index buffer type: uint32")}else n.instanced?s.drawArraysInstanced(t,r,e||n.getSize(),i||1):s.drawArrays(t,r,e||n.getSize());return this}unbind(){this.gl.bindVertexArray(null),this._activeVao=null,this._activeGeometry=null}destroy(){this.renderer=null}}Cs.extension={type:Tr.RendererSystem,name:"geometry"},Sr.add(Cs);const Ps=new di;class Ms{constructor(t,e){this._texture=t,this.mapCoord=new di,this.uClampFrame=new Float32Array(4),this.uClampOffset=new Float32Array(2),this._textureID=-1,this._updateID=0,this.clampOffset=0,this.clampMargin=void 0===e?.5:e,this.isSimple=!1}get texture(){return this._texture}set texture(t){this._texture=t,this._textureID=-1}multiplyUvs(t,e){void 0===e&&(e=t);const r=this.mapCoord;for(let i=0;i<t.length;i+=2){const s=t[i],n=t[i+1];e[i]=s*r.a+n*r.c+r.tx,e[i+1]=s*r.b+n*r.d+r.ty}return e}update(t){const e=this._texture;if(!e||!e.valid||!t&&this._textureID===e._updateID)return!1;this._textureID=e._updateID,this._updateID++;const r=e._uvs;this.mapCoord.set(r.x1-r.x0,r.y1-r.y0,r.x3-r.x0,r.y3-r.y0,r.x0,r.y0);const i=e.orig,s=e.trim;s&&(Ps.set(i.width/s.width,0,0,i.height/s.height,-s.x/s.width,-s.y/s.height),this.mapCoord.append(Ps));const n=e.baseTexture,o=this.uClampFrame,a=this.clampMargin/n.resolution,h=this.clampOffset;return o[0]=(e._frame.x+a+h)/n.width,o[1]=(e._frame.y+a+h)/n.height,o[2]=(e._frame.x+e._frame.width-a+h)/n.width,o[3]=(e._frame.y+e._frame.height-a+h)/n.height,this.uClampOffset[0]=h/n.realWidth,this.uClampOffset[1]=h/n.realHeight,this.isSimple=e._frame.width===n.width&&e._frame.height===n.height&&0===e.rotate,!0}}class $s extends rs{constructor(t,e,r){let i=null;"string"!=typeof t&&void 0===e&&void 0===r&&(i=t,t=void 0,e=void 0,r=void 0),super(t||"attribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\n\nuniform mat3 projectionMatrix;\nuniform mat3 otherMatrix;\n\nvarying vec2 vMaskCoord;\nvarying vec2 vTextureCoord;\n\nvoid main(void)\n{\n    gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n\n    vTextureCoord = aTextureCoord;\n    vMaskCoord = ( otherMatrix * vec3( aTextureCoord, 1.0)  ).xy;\n}\n",e||"varying vec2 vMaskCoord;\nvarying vec2 vTextureCoord;\n\nuniform sampler2D uSampler;\nuniform sampler2D mask;\nuniform float alpha;\nuniform float npmAlpha;\nuniform vec4 maskClamp;\n\nvoid main(void)\n{\n    float clip = step(3.5,\n        step(maskClamp.x, vMaskCoord.x) +\n        step(maskClamp.y, vMaskCoord.y) +\n        step(vMaskCoord.x, maskClamp.z) +\n        step(vMaskCoord.y, maskClamp.w));\n\n    vec4 original = texture2D(uSampler, vTextureCoord);\n    vec4 masky = texture2D(mask, vMaskCoord);\n    float alphaMul = 1.0 - npmAlpha * (1.0 - masky.a);\n\n    original *= (alphaMul * masky.r * alpha * clip);\n\n    gl_FragColor = original;\n}\n",r),this.maskSprite=i,this.maskMatrix=new di}get maskSprite(){return this._maskSprite}set maskSprite(t){this._maskSprite=t,this._maskSprite&&(this._maskSprite.renderable=!1)}apply(t,e,r,i){const s=this._maskSprite,n=s._texture;n.valid&&(n.uvMatrix||(n.uvMatrix=new Ms(n,0)),n.uvMatrix.update(),this.uniforms.npmAlpha=n.baseTexture.alphaMode?0:1,this.uniforms.mask=n,this.uniforms.otherMatrix=t.calculateSpriteMatrix(this.maskMatrix,s).prepend(n.uvMatrix.mapCoord),this.uniforms.alpha=s.worldAlpha,this.uniforms.maskClamp=n.uvMatrix.uClampFrame,t.applyFilter(this,e,r,i))}}class Is{constructor(t=null){this.type=y.NONE,this.autoDetect=!0,this.maskObject=t||null,this.pooled=!1,this.isMaskData=!0,this.resolution=null,this.multisample=rs.defaultMultisample,this.enabled=!0,this.colorMask=15,this._filters=null,this._stencilCounter=0,this._scissorCounter=0,this._scissorRect=null,this._scissorRectLocal=null,this._colorMask=15,this._target=null}get filter(){return this._filters?this._filters[0]:null}set filter(t){t?this._filters?this._filters[0]=t:this._filters=[t]:this._filters=null}reset(){this.pooled&&(this.maskObject=null,this.type=y.NONE,this.autoDetect=!0),this._target=null,this._scissorRectLocal=null}copyCountersOrReset(t){t?(this._stencilCounter=t._stencilCounter,this._scissorCounter=t._scissorCounter,this._scissorRect=t._scissorRect):(this._stencilCounter=0,this._scissorCounter=0,this._scissorRect=null)}}class Rs{constructor(t){this.renderer=t,this.enableScissor=!0,this.alphaMaskPool=[],this.maskDataPool=[],this.maskStack=[],this.alphaMaskIndex=0}setMaskStack(t){this.maskStack=t,this.renderer.scissor.setMaskStack(t),this.renderer.stencil.setMaskStack(t)}push(t,e){let r=e;if(!r.isMaskData){const t=this.maskDataPool.pop()||new Is;t.pooled=!0,t.maskObject=e,r=t}const i=0!==this.maskStack.length?this.maskStack[this.maskStack.length-1]:null;if(r.copyCountersOrReset(i),r._colorMask=i?i._colorMask:15,r.autoDetect&&this.detect(r),r._target=t,r.type!==y.SPRITE&&this.maskStack.push(r),r.enabled)switch(r.type){case y.SCISSOR:this.renderer.scissor.push(r);break;case y.STENCIL:this.renderer.stencil.push(r);break;case y.SPRITE:r.copyCountersOrReset(null),this.pushSpriteMask(r);break;case y.COLOR:this.pushColorMask(r)}r.type===y.SPRITE&&this.maskStack.push(r)}pop(t){const e=this.maskStack.pop();if(e&&e._target===t){if(e.enabled)switch(e.type){case y.SCISSOR:this.renderer.scissor.pop(e);break;case y.STENCIL:this.renderer.stencil.pop(e.maskObject);break;case y.SPRITE:this.popSpriteMask(e);break;case y.COLOR:this.popColorMask(e)}if(e.reset(),e.pooled&&this.maskDataPool.push(e),0!==this.maskStack.length){const t=this.maskStack[this.maskStack.length-1];t.type===y.SPRITE&&t._filters&&(t._filters[0].maskSprite=t.maskObject)}}}detect(t){const e=t.maskObject;e?e.isSprite?t.type=y.SPRITE:this.enableScissor&&this.renderer.scissor.testScissor(t)?t.type=y.SCISSOR:t.type=y.STENCIL:t.type=y.COLOR}pushSpriteMask(t){const{maskObject:e}=t,r=t._target;let i=t._filters;i||(i=this.alphaMaskPool[this.alphaMaskIndex],i||(i=this.alphaMaskPool[this.alphaMaskIndex]=[new $s])),i[0].resolution=t.resolution,i[0].multisample=t.multisample,i[0].maskSprite=e;const s=r.filterArea;r.filterArea=e.getBounds(!0),this.renderer.filter.push(r,i),r.filterArea=s,t._filters||this.alphaMaskIndex++}popSpriteMask(t){this.renderer.filter.pop(),t._filters?t._filters[0].maskSprite=null:(this.alphaMaskIndex--,this.alphaMaskPool[this.alphaMaskIndex][0].maskSprite=null)}pushColorMask(t){const e=t._colorMask,r=t._colorMask=e&t.colorMask;r!==e&&this.renderer.gl.colorMask(!!(1&r),!!(2&r),!!(4&r),!!(8&r))}popColorMask(t){const e=t._colorMask,r=this.maskStack.length>0?this.maskStack[this.maskStack.length-1]._colorMask:15;r!==e&&this.renderer.gl.colorMask(!!(1&r),!!(2&r),!!(4&r),!!(8&r))}destroy(){this.renderer=null}}Rs.extension={type:Tr.RendererSystem,name:"mask"},Sr.add(Rs);class Ds{constructor(t){this.renderer=t,this.maskStack=[],this.glConst=0}getStackLength(){return this.maskStack.length}setMaskStack(t){const{gl:e}=this.renderer,r=this.getStackLength();this.maskStack=t;const i=this.getStackLength();i!==r&&(0===i?e.disable(this.glConst):(e.enable(this.glConst),this._useCurrent()))}_useCurrent(){}destroy(){this.renderer=null,this.maskStack=null}}const Ls=new di,Fs=[],Os=class t extends Ds{constructor(t){super(t),this.glConst=T.ADAPTER.getWebGLRenderingContext().SCISSOR_TEST}getStackLength(){const t=this.maskStack[this.maskStack.length-1];return t?t._scissorCounter:0}calcScissorRect(t){var e;if(t._scissorRectLocal)return;const r=t._scissorRect,{maskObject:i}=t,{renderer:s}=this,n=s.renderTexture,o=i.getBounds(!0,null!=(e=Fs.pop())?e:new ai);this.roundFrameToPixels(o,n.current?n.current.resolution:s.resolution,n.sourceFrame,n.destinationFrame,s.projection.transform),r&&o.fit(r),t._scissorRectLocal=o}static isMatrixRotated(t){if(!t)return!1;const{a:e,b:r,c:i,d:s}=t;return(Math.abs(r)>1e-4||Math.abs(i)>1e-4)&&(Math.abs(e)>1e-4||Math.abs(s)>1e-4)}testScissor(e){const{maskObject:r}=e;if(!r.isFastRect||!r.isFastRect()||t.isMatrixRotated(r.worldTransform)||t.isMatrixRotated(this.renderer.projection.transform))return!1;this.calcScissorRect(e);const i=e._scissorRectLocal;return i.width>0&&i.height>0}roundFrameToPixels(e,r,i,s,n){t.isMatrixRotated(n)||((n=n?Ls.copyFrom(n):Ls.identity()).translate(-i.x,-i.y).scale(s.width/i.width,s.height/i.height).translate(s.x,s.y),this.renderer.filter.transformAABB(n,e),e.fit(s),e.x=Math.round(e.x*r),e.y=Math.round(e.y*r),e.width=Math.round(e.width*r),e.height=Math.round(e.height*r))}push(t){t._scissorRectLocal||this.calcScissorRect(t);const{gl:e}=this.renderer;t._scissorRect||e.enable(e.SCISSOR_TEST),t._scissorCounter++,t._scissorRect=t._scissorRectLocal,this._useCurrent()}pop(t){const{gl:e}=this.renderer;t&&Fs.push(t._scissorRectLocal),this.getStackLength()>0?this._useCurrent():e.disable(e.SCISSOR_TEST)}_useCurrent(){const t=this.maskStack[this.maskStack.length-1]._scissorRect;let e;e=this.renderer.renderTexture.current?t.y:this.renderer.height-t.height-t.y,this.renderer.gl.scissor(t.x,e,t.width,t.height)}};Os.extension={type:Tr.RendererSystem,name:"scissor"};let ks=Os;Sr.add(ks);class Bs extends Ds{constructor(t){super(t),this.glConst=T.ADAPTER.getWebGLRenderingContext().STENCIL_TEST}getStackLength(){const t=this.maskStack[this.maskStack.length-1];return t?t._stencilCounter:0}push(t){const e=t.maskObject,{gl:r}=this.renderer,i=t._stencilCounter;0===i&&(this.renderer.framebuffer.forceStencil(),r.clearStencil(0),r.clear(r.STENCIL_BUFFER_BIT),r.enable(r.STENCIL_TEST)),t._stencilCounter++;const s=t._colorMask;0!==s&&(t._colorMask=0,r.colorMask(!1,!1,!1,!1)),r.stencilFunc(r.EQUAL,i,4294967295),r.stencilOp(r.KEEP,r.KEEP,r.INCR),e.renderable=!0,e.render(this.renderer),this.renderer.batch.flush(),e.renderable=!1,0!==s&&(t._colorMask=s,r.colorMask(!!(1&s),!!(2&s),!!(4&s),!!(8&s))),this._useCurrent()}pop(t){const e=this.renderer.gl;if(0===this.getStackLength())e.disable(e.STENCIL_TEST);else{const r=0!==this.maskStack.length?this.maskStack[this.maskStack.length-1]:null,i=r?r._colorMask:15;0!==i&&(r._colorMask=0,e.colorMask(!1,!1,!1,!1)),e.stencilOp(e.KEEP,e.KEEP,e.DECR),t.renderable=!0,t.render(this.renderer),this.renderer.batch.flush(),t.renderable=!1,0!==i&&(r._colorMask=i,e.colorMask(!!(1&i),!!(2&i),!!(4&i),!!(8&i))),this._useCurrent()}}_useCurrent(){const t=this.renderer.gl;t.stencilFunc(t.EQUAL,this.getStackLength(),4294967295),t.stencilOp(t.KEEP,t.KEEP,t.KEEP)}}Bs.extension={type:Tr.RendererSystem,name:"stencil"},Sr.add(Bs);class Ns{constructor(t){this.renderer=t,this.plugins={}}init(){const t=this.rendererPlugins;for(const e in t)this.plugins[e]=new t[e](this.renderer)}destroy(){for(const t in this.plugins)this.plugins[t].destroy(),this.plugins[t]=null}}Ns.extension={type:[Tr.RendererSystem,Tr.CanvasRendererSystem],name:"_plugin"},Sr.add(Ns);class Us{constructor(t){this.renderer=t,this.destinationFrame=null,this.sourceFrame=null,this.defaultFrame=null,this.projectionMatrix=new di,this.transform=null}update(t,e,r,i){this.destinationFrame=t||this.destinationFrame||this.defaultFrame,this.sourceFrame=e||this.sourceFrame||t,this.calculateProjection(this.destinationFrame,this.sourceFrame,r,i),this.transform&&this.projectionMatrix.append(this.transform);const s=this.renderer;s.globalUniforms.uniforms.projectionMatrix=this.projectionMatrix,s.globalUniforms.update(),s.shader.shader&&s.shader.syncUniformGroup(s.shader.shader.uniforms.globals)}calculateProjection(t,e,r,i){const s=this.projectionMatrix,n=i?-1:1;s.identity(),s.a=1/e.width*2,s.d=n*(1/e.height*2),s.tx=-1-e.x*s.a,s.ty=-n-e.y*s.d}setTransform(t){}destroy(){this.renderer=null}}Us.extension={type:Tr.RendererSystem,name:"projection"},Sr.add(Us);var Gs=Object.getOwnPropertySymbols,Vs=Object.prototype.hasOwnProperty,Hs=Object.prototype.propertyIsEnumerable;const zs=new Ti,Xs=new ai;class Ws{constructor(t){this.renderer=t,this._tempMatrix=new di}generateTexture(t,e){const r=e||{},{region:i}=r,s=((t,e)=>{var r={};for(var i in t)Vs.call(t,i)&&e.indexOf(i)<0&&(r[i]=t[i]);if(null!=t&&Gs)for(var i of Gs(t))e.indexOf(i)<0&&Hs.call(t,i)&&(r[i]=t[i]);return r})(r,["region"]),n=(null==i?void 0:i.copyTo(Xs))||t.getLocalBounds(Xs,!0),o=s.resolution||this.renderer.resolution;n.width=Math.max(n.width,1/o),n.height=Math.max(n.height,1/o),s.width=n.width,s.height=n.height,s.resolution=o,null!=s.multisample||(s.multisample=this.renderer.multisample);const a=_s.create(s);this._tempMatrix.tx=-n.x,this._tempMatrix.ty=-n.y;const h=t.transform;return t.transform=zs,this.renderer.render(t,{renderTexture:a,transform:this._tempMatrix,skipUpdateTransform:!!t.parent,blit:!0}),t.transform=h,a}destroy(){}}Ws.extension={type:[Tr.RendererSystem,Tr.CanvasRendererSystem],name:"textureGenerator"},Sr.add(Ws);const Ys=new ai,js=new ai;class qs{constructor(t){this.renderer=t,this.defaultMaskStack=[],this.current=null,this.sourceFrame=new ai,this.destinationFrame=new ai,this.viewportFrame=new ai}contextChange(){var t;const e=null==(t=this.renderer)?void 0:t.gl.getContextAttributes();this._rendererPremultipliedAlpha=!!(e&&e.alpha&&e.premultipliedAlpha)}bind(t=null,e,r){const i=this.renderer;let s,n,o;this.current=t,t?(s=t.baseTexture,o=s.resolution,e||(Ys.width=t.frame.width,Ys.height=t.frame.height,e=Ys),r||(js.x=t.frame.x,js.y=t.frame.y,js.width=e.width,js.height=e.height,r=js),n=s.framebuffer):(o=i.resolution,e||(Ys.width=i._view.screen.width,Ys.height=i._view.screen.height,e=Ys),r||((r=Ys).width=e.width,r.height=e.height));const a=this.viewportFrame;a.x=r.x*o,a.y=r.y*o,a.width=r.width*o,a.height=r.height*o,t||(a.y=i.view.height-(a.y+a.height)),a.ceil(),this.renderer.framebuffer.bind(n,a),this.renderer.projection.update(r,e,o,!n),t?this.renderer.mask.setMaskStack(s.maskStack):this.renderer.mask.setMaskStack(this.defaultMaskStack),this.sourceFrame.copyFrom(e),this.destinationFrame.copyFrom(r)}clear(t,e){const r=this.current?this.current.baseTexture.clear:this.renderer.background.backgroundColor,i=Ue.shared.setValue(t||r);(this.current&&this.current.baseTexture.alphaMode>0||!this.current&&this._rendererPremultipliedAlpha)&&i.premultiply(i.alpha);const s=this.destinationFrame,n=this.current?this.current.baseTexture:this.renderer._view.screen,o=s.width!==n.width||s.height!==n.height;if(o){let{x:t,y:e,width:r,height:i}=this.viewportFrame;t=Math.round(t),e=Math.round(e),r=Math.round(r),i=Math.round(i),this.renderer.gl.enable(this.renderer.gl.SCISSOR_TEST),this.renderer.gl.scissor(t,e,r,i)}this.renderer.framebuffer.clear(i.red,i.green,i.blue,i.alpha,e),o&&this.renderer.scissor.pop()}resize(){this.bind(null)}reset(){this.bind(null)}destroy(){this.renderer=null}}qs.extension={type:Tr.RendererSystem,name:"renderTexture"},Sr.add(qs);class Zs{constructor(t,e){this.program=t,this.uniformData=e,this.uniformGroups={},this.uniformDirtyGroups={},this.uniformBufferBindings={}}destroy(){this.uniformData=null,this.uniformGroups=null,this.uniformDirtyGroups=null,this.uniformBufferBindings=null,this.program=null}}function Qs(t,e){var r;const i=Ei(t,t.VERTEX_SHADER,e.vertexSrc),s=Ei(t,t.FRAGMENT_SHADER,e.fragmentSrc),n=t.createProgram();t.attachShader(n,i),t.attachShader(n,s);const o=null==(r=e.extra)?void 0:r.transformFeedbackVaryings;if(o&&("function"!=typeof t.transformFeedbackVaryings||t.transformFeedbackVaryings(n,o.names,"separate"===o.bufferMode?t.SEPARATE_ATTRIBS:t.INTERLEAVED_ATTRIBS)),t.linkProgram(n),t.getProgramParameter(n,t.LINK_STATUS)||function(t,e,r,i){t.getProgramParameter(e,t.LINK_STATUS)||(t.getShaderParameter(r,t.COMPILE_STATUS)||Li(t,r),t.getShaderParameter(i,t.COMPILE_STATUS)||Li(t,i),console.error("PixiJS Error: Could not initialize shader."),""!==t.getProgramInfoLog(e)&&console.warn("PixiJS Warning: gl.getProgramInfoLog()",t.getProgramInfoLog(e)))}(t,n,i,s),e.attributeData=function(t,e){const r={},i=e.getProgramParameter(t,e.ACTIVE_ATTRIBUTES);for(let s=0;s<i;s++){const i=e.getActiveAttrib(t,s);if(i.name.startsWith("gl_"))continue;const n=Ni(e,i.type),o={type:n,name:i.name,size:Oi(n),location:e.getAttribLocation(t,i.name)};r[i.name]=o}return r}(n,t),e.uniformData=function(t,e){const r={},i=e.getProgramParameter(t,e.ACTIVE_UNIFORMS);for(let s=0;s<i;s++){const i=e.getActiveUniform(t,s),n=i.name.replace(/\[.*?\]$/,""),o=!!i.name.match(/\[.*?\]$/),a=Ni(e,i.type);r[n]={name:n,index:s,type:a,size:i.size,isArray:o,value:Si(a,i.size)}}return r}(n,t),!/^[ \t]*#[ \t]*version[ \t]+300[ \t]+es[ \t]*$/m.test(e.vertexSrc)){const r=Object.keys(e.attributeData);r.sort(((t,e)=>t>e?1:-1));for(let i=0;i<r.length;i++)e.attributeData[r[i]].location=i,t.bindAttribLocation(n,i,r[i]);t.linkProgram(n)}t.deleteShader(i),t.deleteShader(s);const a={};for(const r in e.uniformData){const i=e.uniformData[r];a[r]={location:t.getUniformLocation(n,r),value:Si(i.type,i.size)}}return new Zs(n,a)}function Js(t,e,r,i,s){r.buffer.update(s)}const Ks={float:"\n        data[offset] = v;\n    ",vec2:"\n        data[offset] = v[0];\n        data[offset+1] = v[1];\n    ",vec3:"\n        data[offset] = v[0];\n        data[offset+1] = v[1];\n        data[offset+2] = v[2];\n\n    ",vec4:"\n        data[offset] = v[0];\n        data[offset+1] = v[1];\n        data[offset+2] = v[2];\n        data[offset+3] = v[3];\n    ",mat2:"\n        data[offset] = v[0];\n        data[offset+1] = v[1];\n\n        data[offset+4] = v[2];\n        data[offset+5] = v[3];\n    ",mat3:"\n        data[offset] = v[0];\n        data[offset+1] = v[1];\n        data[offset+2] = v[2];\n\n        data[offset + 4] = v[3];\n        data[offset + 5] = v[4];\n        data[offset + 6] = v[5];\n\n        data[offset + 8] = v[6];\n        data[offset + 9] = v[7];\n        data[offset + 10] = v[8];\n    ",mat4:"\n        for(var i = 0; i < 16; i++)\n        {\n            data[offset + i] = v[i];\n        }\n    "},tn={float:4,vec2:8,vec3:12,vec4:16,int:4,ivec2:8,ivec3:12,ivec4:16,uint:4,uvec2:8,uvec3:12,uvec4:16,bool:4,bvec2:8,bvec3:12,bvec4:16,mat2:32,mat3:48,mat4:64};function en(t){const e=t.map((t=>({data:t,offset:0,dataLen:0,dirty:0})));let r=0,i=0,s=0;for(let t=0;t<e.length;t++){const n=e[t];if(r=tn[n.data.type],n.data.size>1&&(r=Math.max(r,16)*n.data.size),n.dataLen=r,i%r!=0&&i<16){const t=i%r%16;i+=t,s+=t}i+r>16?(s=16*Math.ceil(s/16),n.offset=s,s+=r,i=r):(n.offset=s,i+=r,s+=r)}return s=16*Math.ceil(s/16),{uboElements:e,size:s}}function rn(t,e){const r=[];for(const i in t)e[i]&&r.push(e[i]);return r.sort(((t,e)=>t.index-e.index)),r}function sn(t,e){if(!t.autoManage)return{size:0,syncFunc:Js};const r=rn(t.uniforms,e),{uboElements:i,size:s}=en(r),n=["\n    var v = null;\n    var v2 = null;\n    var cv = null;\n    var t = 0;\n    var gl = renderer.gl\n    var index = 0;\n    var data = buffer.data;\n    "];for(let e=0;e<i.length;e++){const r=i[e],s=t.uniforms[r.data.name],o=r.data.name;let a=!1;for(let t=0;t<Ci.length;t++){const e=Ci[t];if(e.codeUbo&&e.test(r.data,s)){n.push(`offset = ${r.offset/4};`,Ci[t].codeUbo(r.data.name,s)),a=!0;break}}if(!a)if(r.data.size>1){const t=Oi(r.data.type),e=Math.max(tn[r.data.type]/16,1),i=t/e,s=(4-i%4)%4;n.push(`\n                cv = ud.${o}.value;\n                v = uv.${o};\n                offset = ${r.offset/4};\n\n                t = 0;\n\n                for(var i=0; i < ${r.data.size*e}; i++)\n                {\n                    for(var j = 0; j < ${i}; j++)\n                    {\n                        data[offset++] = v[t++];\n                    }\n                    offset += ${s};\n                }\n\n                `)}else{const t=Ks[r.data.type];n.push(`\n                cv = ud.${o}.value;\n                v = uv.${o};\n                offset = ${r.offset/4};\n                ${t};\n                `)}}return n.push("\n       renderer.buffer.update(buffer);\n    "),{size:s,syncFunc:new Function("ud","uv","renderer","syncData","buffer",n.join("\n"))}}let nn=0;const on={textureCount:0,uboCount:0};class an{constructor(t){this.destroyed=!1,this.renderer=t,this.systemCheck(),this.gl=null,this.shader=null,this.program=null,this.cache={},this._uboCache={},this.id=nn++}systemCheck(){if(!Vi())throw new Error("Current environment does not allow unsafe-eval, please use @pixi/unsafe-eval module to enable support.")}contextChange(t){this.gl=t,this.reset()}bind(t,e){t.disposeRunner.add(this),t.uniforms.globals=this.renderer.globalUniforms;const r=t.program,i=r.glPrograms[this.renderer.CONTEXT_UID]||this.generateProgram(t);return this.shader=t,this.program!==r&&(this.program=r,this.gl.useProgram(i.program)),e||(on.textureCount=0,on.uboCount=0,this.syncUniformGroup(t.uniformGroup,on)),i}setUniforms(t){const e=this.shader.program,r=e.glPrograms[this.renderer.CONTEXT_UID];e.syncUniforms(r.uniformData,t,this.renderer)}syncUniformGroup(t,e){const r=this.getGlProgram();(!t.static||t.dirtyId!==r.uniformDirtyGroups[t.id])&&(r.uniformDirtyGroups[t.id]=t.dirtyId,this.syncUniforms(t,r,e))}syncUniforms(t,e,r){(t.syncUniforms[this.shader.program.id]||this.createSyncGroups(t))(e.uniformData,t.uniforms,this.renderer,r)}createSyncGroups(t){const e=this.getSignature(t,this.shader.program.uniformData,"u");return this.cache[e]||(this.cache[e]=function(t,e){var r;const i=["\n        var v = null;\n        var cv = null;\n        var cu = null;\n        var t = 0;\n        var gl = renderer.gl;\n    "];for(const s in t.uniforms){const n=e[s];if(!n){!0===(null==(r=t.uniforms[s])?void 0:r.group)&&(t.uniforms[s].ubo?i.push(`\n                        renderer.shader.syncUniformBufferGroup(uv.${s}, '${s}');\n                    `):i.push(`\n                        renderer.shader.syncUniformGroup(uv.${s}, syncData);\n                    `));continue}const o=t.uniforms[s];let a=!1;for(let t=0;t<Ci.length;t++)if(Ci[t].test(n,o)){i.push(Ci[t].code(s,o)),a=!0;break}if(!a){const t=(1!==n.size||n.isArray?Mi:Pi)[n.type].replace("location",`ud["${s}"].location`);i.push(`\n            cu = ud["${s}"];\n            cv = cu.value;\n            v = uv["${s}"];\n            ${t};`)}}return new Function("ud","uv","renderer","syncData",i.join("\n"))}(t,this.shader.program.uniformData)),t.syncUniforms[this.shader.program.id]=this.cache[e],t.syncUniforms[this.shader.program.id]}syncUniformBufferGroup(t,e){const r=this.getGlProgram();if(!t.static||0!==t.dirtyId||!r.uniformGroups[t.id]){t.dirtyId=0;const i=r.uniformGroups[t.id]||this.createSyncBufferGroup(t,r,e);t.buffer.update(),i(r.uniformData,t.uniforms,this.renderer,on,t.buffer)}this.renderer.buffer.bindBufferBase(t.buffer,r.uniformBufferBindings[e])}createSyncBufferGroup(t,e,r){const{gl:i}=this.renderer;this.renderer.buffer.bind(t.buffer);const s=this.gl.getUniformBlockIndex(e.program,r);e.uniformBufferBindings[r]=this.shader.uniformBindCount,i.uniformBlockBinding(e.program,s,this.shader.uniformBindCount),this.shader.uniformBindCount++;const n=this.getSignature(t,this.shader.program.uniformData,"ubo");let o=this._uboCache[n];if(o||(o=this._uboCache[n]=sn(t,this.shader.program.uniformData)),t.autoManage){const e=new Float32Array(o.size/4);t.buffer.update(e)}return e.uniformGroups[t.id]=o.syncFunc,e.uniformGroups[t.id]}getSignature(t,e,r){const i=t.uniforms,s=[`${r}-`];for(const t in i)s.push(t),e[t]&&s.push(e[t].type);return s.join("-")}getGlProgram(){return this.shader?this.shader.program.glPrograms[this.renderer.CONTEXT_UID]:null}generateProgram(t){const e=this.gl,r=t.program,i=Qs(e,r);return r.glPrograms[this.renderer.CONTEXT_UID]=i,i}reset(){this.program=null,this.shader=null}disposeShader(t){this.shader===t&&(this.shader=null)}destroy(){this.renderer=null,this.destroyed=!0}}an.extension={type:Tr.RendererSystem,name:"shader"},Sr.add(an);class hn{constructor(t){this.renderer=t}run(t){const{renderer:e}=this;e.runners.init.emit(e.options),t.hello&&console.log(`PixiJS 7.4.2 - ${e.rendererLogId} - https://pixijs.com`),e.resize(e.screen.width,e.screen.height)}destroy(){}}hn.defaultOptions={hello:!1},hn.extension={type:[Tr.RendererSystem,Tr.CanvasRendererSystem],name:"startup"},Sr.add(hn);const ln=class t{constructor(){this.gl=null,this.stateId=0,this.polygonOffset=0,this.blendMode=n.NONE,this._blendEq=!1,this.map=[],this.map[0]=this.setBlend,this.map[1]=this.setOffset,this.map[2]=this.setCullFace,this.map[3]=this.setDepthTest,this.map[4]=this.setFrontFace,this.map[5]=this.setDepthMask,this.checks=[],this.defaultState=new Ir,this.defaultState.blend=!0}contextChange(t){this.gl=t,this.blendModes=function(t,e=[]){return e[n.NORMAL]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e[n.ADD]=[t.ONE,t.ONE],e[n.MULTIPLY]=[t.DST_COLOR,t.ONE_MINUS_SRC_ALPHA,t.ONE,t.ONE_MINUS_SRC_ALPHA],e[n.SCREEN]=[t.ONE,t.ONE_MINUS_SRC_COLOR,t.ONE,t.ONE_MINUS_SRC_ALPHA],e[n.OVERLAY]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e[n.DARKEN]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e[n.LIGHTEN]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e[n.COLOR_DODGE]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e[n.COLOR_BURN]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e[n.HARD_LIGHT]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e[n.SOFT_LIGHT]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e[n.DIFFERENCE]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e[n.EXCLUSION]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e[n.HUE]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e[n.SATURATION]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e[n.COLOR]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e[n.LUMINOSITY]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e[n.NONE]=[0,0],e[n.NORMAL_NPM]=[t.SRC_ALPHA,t.ONE_MINUS_SRC_ALPHA,t.ONE,t.ONE_MINUS_SRC_ALPHA],e[n.ADD_NPM]=[t.SRC_ALPHA,t.ONE,t.ONE,t.ONE],e[n.SCREEN_NPM]=[t.SRC_ALPHA,t.ONE_MINUS_SRC_COLOR,t.ONE,t.ONE_MINUS_SRC_ALPHA],e[n.SRC_IN]=[t.DST_ALPHA,t.ZERO],e[n.SRC_OUT]=[t.ONE_MINUS_DST_ALPHA,t.ZERO],e[n.SRC_ATOP]=[t.DST_ALPHA,t.ONE_MINUS_SRC_ALPHA],e[n.DST_OVER]=[t.ONE_MINUS_DST_ALPHA,t.ONE],e[n.DST_IN]=[t.ZERO,t.SRC_ALPHA],e[n.DST_OUT]=[t.ZERO,t.ONE_MINUS_SRC_ALPHA],e[n.DST_ATOP]=[t.ONE_MINUS_DST_ALPHA,t.SRC_ALPHA],e[n.XOR]=[t.ONE_MINUS_DST_ALPHA,t.ONE_MINUS_SRC_ALPHA],e[n.SUBTRACT]=[t.ONE,t.ONE,t.ONE,t.ONE,t.FUNC_REVERSE_SUBTRACT,t.FUNC_ADD],e}(t),this.set(this.defaultState),this.reset()}set(t){if(t=t||this.defaultState,this.stateId!==t.data){let e=this.stateId^t.data,r=0;for(;e;)1&e&&this.map[r].call(this,!!(t.data&1<<r)),e>>=1,r++;this.stateId=t.data}for(let e=0;e<this.checks.length;e++)this.checks[e](this,t)}forceState(t){t=t||this.defaultState;for(let e=0;e<this.map.length;e++)this.map[e].call(this,!!(t.data&1<<e));for(let e=0;e<this.checks.length;e++)this.checks[e](this,t);this.stateId=t.data}setBlend(e){this.updateCheck(t.checkBlendMode,e),this.gl[e?"enable":"disable"](this.gl.BLEND)}setOffset(e){this.updateCheck(t.checkPolygonOffset,e),this.gl[e?"enable":"disable"](this.gl.POLYGON_OFFSET_FILL)}setDepthTest(t){this.gl[t?"enable":"disable"](this.gl.DEPTH_TEST)}setDepthMask(t){this.gl.depthMask(t)}setCullFace(t){this.gl[t?"enable":"disable"](this.gl.CULL_FACE)}setFrontFace(t){this.gl.frontFace(this.gl[t?"CW":"CCW"])}setBlendMode(t){if(t===this.blendMode)return;this.blendMode=t;const e=this.blendModes[t],r=this.gl;2===e.length?r.blendFunc(e[0],e[1]):r.blendFuncSeparate(e[0],e[1],e[2],e[3]),6===e.length?(this._blendEq=!0,r.blendEquationSeparate(e[4],e[5])):this._blendEq&&(this._blendEq=!1,r.blendEquationSeparate(r.FUNC_ADD,r.FUNC_ADD))}setPolygonOffset(t,e){this.gl.polygonOffset(t,e)}reset(){this.gl.pixelStorei(this.gl.UNPACK_FLIP_Y_WEBGL,!1),this.forceState(this.defaultState),this._blendEq=!0,this.blendMode=-1,this.setBlendMode(0)}updateCheck(t,e){const r=this.checks.indexOf(t);e&&-1===r?this.checks.push(t):!e&&-1!==r&&this.checks.splice(r,1)}static checkBlendMode(t,e){t.setBlendMode(e.blendMode)}static checkPolygonOffset(t,e){t.setPolygonOffset(1,e.polygonOffset)}destroy(){this.gl=null}};ln.extension={type:Tr.RendererSystem,name:"state"};let un=ln;Sr.add(un);class cn extends W{constructor(){super(...arguments),this.runners={},this._systemsHash={}}setup(t){var e;this.addRunners(...t.runners);const r=(null!=(e=t.priority)?e:[]).filter((e=>t.systems[e])),i=[...r,...Object.keys(t.systems).filter((t=>!r.includes(t)))];for(const e of i)this.addSystem(t.systems[e],e)}addRunners(...t){t.forEach((t=>{this.runners[t]=new Lr(t)}))}addSystem(t,e){const r=new t(this);if(this[e])throw new Error(`Whoops! The name "${e}" is already in use`);this[e]=r,this._systemsHash[e]=r;for(const t in this.runners)this.runners[t].add(r);return this}emitWithCustomOptions(t,e){const r=Object.keys(this._systemsHash);t.items.forEach((i=>{const s=r.find((t=>this._systemsHash[t]===i));i[t.name](e[s])}))}destroy(){Object.values(this.runners).forEach((t=>{t.destroy()})),this._systemsHash={}}}const dn=class t{constructor(e){this.renderer=e,this.count=0,this.checkCount=0,this.maxIdle=t.defaultMaxIdle,this.checkCountMax=t.defaultCheckCountMax,this.mode=t.defaultMode}postrender(){this.renderer.objectRenderer.renderingToScreen&&(this.count++,this.mode!==m.MANUAL&&(this.checkCount++,this.checkCount>this.checkCountMax&&(this.checkCount=0,this.run())))}run(){const t=this.renderer.texture,e=t.managedTextures;let r=!1;for(let i=0;i<e.length;i++){const s=e[i];s.resource&&this.count-s.touched>this.maxIdle&&(t.destroyTexture(s,!0),e[i]=null,r=!0)}if(r){let t=0;for(let r=0;r<e.length;r++)null!==e[r]&&(e[t++]=e[r]);e.length=t}}unload(t){const e=this.renderer.texture,r=t._texture;r&&!r.framebuffer&&e.destroyTexture(r);for(let e=t.children.length-1;e>=0;e--)this.unload(t.children[e])}destroy(){this.renderer=null}};dn.defaultMode=m.AUTO,dn.defaultMaxIdle=3600,dn.defaultCheckCountMax=600,dn.extension={type:Tr.RendererSystem,name:"textureGC"};let fn=dn;Sr.add(fn);class pn{constructor(t){this.texture=t,this.width=-1,this.height=-1,this.dirtyId=-1,this.dirtyStyleId=-1,this.mipmap=!1,this.wrapMode=33071,this.type=l.UNSIGNED_BYTE,this.internalFormat=a.RGBA,this.samplerType=0}}class _n{constructor(t){this.renderer=t,this.boundTextures=[],this.currentLocation=-1,this.managedTextures=[],this._unknownBoundTextures=!1,this.unknownTexture=new zr,this.hasIntegerTextures=!1}contextChange(){const t=this.gl=this.renderer.gl;this.CONTEXT_UID=this.renderer.CONTEXT_UID,this.webGLVersion=this.renderer.context.webGLVersion,this.internalFormats=function(t){let e;return e="WebGL2RenderingContext"in globalThis&&t instanceof globalThis.WebGL2RenderingContext?{[l.UNSIGNED_BYTE]:{[a.RGBA]:t.RGBA8,[a.RGB]:t.RGB8,[a.RG]:t.RG8,[a.RED]:t.R8,[a.RGBA_INTEGER]:t.RGBA8UI,[a.RGB_INTEGER]:t.RGB8UI,[a.RG_INTEGER]:t.RG8UI,[a.RED_INTEGER]:t.R8UI,[a.ALPHA]:t.ALPHA,[a.LUMINANCE]:t.LUMINANCE,[a.LUMINANCE_ALPHA]:t.LUMINANCE_ALPHA},[l.BYTE]:{[a.RGBA]:t.RGBA8_SNORM,[a.RGB]:t.RGB8_SNORM,[a.RG]:t.RG8_SNORM,[a.RED]:t.R8_SNORM,[a.RGBA_INTEGER]:t.RGBA8I,[a.RGB_INTEGER]:t.RGB8I,[a.RG_INTEGER]:t.RG8I,[a.RED_INTEGER]:t.R8I},[l.UNSIGNED_SHORT]:{[a.RGBA_INTEGER]:t.RGBA16UI,[a.RGB_INTEGER]:t.RGB16UI,[a.RG_INTEGER]:t.RG16UI,[a.RED_INTEGER]:t.R16UI,[a.DEPTH_COMPONENT]:t.DEPTH_COMPONENT16},[l.SHORT]:{[a.RGBA_INTEGER]:t.RGBA16I,[a.RGB_INTEGER]:t.RGB16I,[a.RG_INTEGER]:t.RG16I,[a.RED_INTEGER]:t.R16I},[l.UNSIGNED_INT]:{[a.RGBA_INTEGER]:t.RGBA32UI,[a.RGB_INTEGER]:t.RGB32UI,[a.RG_INTEGER]:t.RG32UI,[a.RED_INTEGER]:t.R32UI,[a.DEPTH_COMPONENT]:t.DEPTH_COMPONENT24},[l.INT]:{[a.RGBA_INTEGER]:t.RGBA32I,[a.RGB_INTEGER]:t.RGB32I,[a.RG_INTEGER]:t.RG32I,[a.RED_INTEGER]:t.R32I},[l.FLOAT]:{[a.RGBA]:t.RGBA32F,[a.RGB]:t.RGB32F,[a.RG]:t.RG32F,[a.RED]:t.R32F,[a.DEPTH_COMPONENT]:t.DEPTH_COMPONENT32F},[l.HALF_FLOAT]:{[a.RGBA]:t.RGBA16F,[a.RGB]:t.RGB16F,[a.RG]:t.RG16F,[a.RED]:t.R16F},[l.UNSIGNED_SHORT_5_6_5]:{[a.RGB]:t.RGB565},[l.UNSIGNED_SHORT_4_4_4_4]:{[a.RGBA]:t.RGBA4},[l.UNSIGNED_SHORT_5_5_5_1]:{[a.RGBA]:t.RGB5_A1},[l.UNSIGNED_INT_2_10_10_10_REV]:{[a.RGBA]:t.RGB10_A2,[a.RGBA_INTEGER]:t.RGB10_A2UI},[l.UNSIGNED_INT_10F_11F_11F_REV]:{[a.RGB]:t.R11F_G11F_B10F},[l.UNSIGNED_INT_5_9_9_9_REV]:{[a.RGB]:t.RGB9_E5},[l.UNSIGNED_INT_24_8]:{[a.DEPTH_STENCIL]:t.DEPTH24_STENCIL8},[l.FLOAT_32_UNSIGNED_INT_24_8_REV]:{[a.DEPTH_STENCIL]:t.DEPTH32F_STENCIL8}}:{[l.UNSIGNED_BYTE]:{[a.RGBA]:t.RGBA,[a.RGB]:t.RGB,[a.ALPHA]:t.ALPHA,[a.LUMINANCE]:t.LUMINANCE,[a.LUMINANCE_ALPHA]:t.LUMINANCE_ALPHA},[l.UNSIGNED_SHORT_5_6_5]:{[a.RGB]:t.RGB},[l.UNSIGNED_SHORT_4_4_4_4]:{[a.RGBA]:t.RGBA},[l.UNSIGNED_SHORT_5_5_5_1]:{[a.RGBA]:t.RGBA}},e}(t),this.samplerTypes=function(t){let e;return e="WebGL2RenderingContext"in globalThis&&t instanceof globalThis.WebGL2RenderingContext?{[t.RGB]:u.FLOAT,[t.RGBA]:u.FLOAT,[t.ALPHA]:u.FLOAT,[t.LUMINANCE]:u.FLOAT,[t.LUMINANCE_ALPHA]:u.FLOAT,[t.R8]:u.FLOAT,[t.R8_SNORM]:u.FLOAT,[t.RG8]:u.FLOAT,[t.RG8_SNORM]:u.FLOAT,[t.RGB8]:u.FLOAT,[t.RGB8_SNORM]:u.FLOAT,[t.RGB565]:u.FLOAT,[t.RGBA4]:u.FLOAT,[t.RGB5_A1]:u.FLOAT,[t.RGBA8]:u.FLOAT,[t.RGBA8_SNORM]:u.FLOAT,[t.RGB10_A2]:u.FLOAT,[t.RGB10_A2UI]:u.FLOAT,[t.SRGB8]:u.FLOAT,[t.SRGB8_ALPHA8]:u.FLOAT,[t.R16F]:u.FLOAT,[t.RG16F]:u.FLOAT,[t.RGB16F]:u.FLOAT,[t.RGBA16F]:u.FLOAT,[t.R32F]:u.FLOAT,[t.RG32F]:u.FLOAT,[t.RGB32F]:u.FLOAT,[t.RGBA32F]:u.FLOAT,[t.R11F_G11F_B10F]:u.FLOAT,[t.RGB9_E5]:u.FLOAT,[t.R8I]:u.INT,[t.R8UI]:u.UINT,[t.R16I]:u.INT,[t.R16UI]:u.UINT,[t.R32I]:u.INT,[t.R32UI]:u.UINT,[t.RG8I]:u.INT,[t.RG8UI]:u.UINT,[t.RG16I]:u.INT,[t.RG16UI]:u.UINT,[t.RG32I]:u.INT,[t.RG32UI]:u.UINT,[t.RGB8I]:u.INT,[t.RGB8UI]:u.UINT,[t.RGB16I]:u.INT,[t.RGB16UI]:u.UINT,[t.RGB32I]:u.INT,[t.RGB32UI]:u.UINT,[t.RGBA8I]:u.INT,[t.RGBA8UI]:u.UINT,[t.RGBA16I]:u.INT,[t.RGBA16UI]:u.UINT,[t.RGBA32I]:u.INT,[t.RGBA32UI]:u.UINT,[t.DEPTH_COMPONENT16]:u.FLOAT,[t.DEPTH_COMPONENT24]:u.FLOAT,[t.DEPTH_COMPONENT32F]:u.FLOAT,[t.DEPTH_STENCIL]:u.FLOAT,[t.DEPTH24_STENCIL8]:u.FLOAT,[t.DEPTH32F_STENCIL8]:u.FLOAT}:{[t.RGB]:u.FLOAT,[t.RGBA]:u.FLOAT,[t.ALPHA]:u.FLOAT,[t.LUMINANCE]:u.FLOAT,[t.LUMINANCE_ALPHA]:u.FLOAT,[t.DEPTH_STENCIL]:u.FLOAT},e}(t);const e=t.getParameter(t.MAX_TEXTURE_IMAGE_UNITS);this.boundTextures.length=e;for(let t=0;t<e;t++)this.boundTextures[t]=null;this.emptyTextures={};const r=new pn(t.createTexture());t.bindTexture(t.TEXTURE_2D,r.texture),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,1,1,0,t.RGBA,t.UNSIGNED_BYTE,new Uint8Array(4)),this.emptyTextures[t.TEXTURE_2D]=r,this.emptyTextures[t.TEXTURE_CUBE_MAP]=new pn(t.createTexture()),t.bindTexture(t.TEXTURE_CUBE_MAP,this.emptyTextures[t.TEXTURE_CUBE_MAP].texture);for(let e=0;e<6;e++)t.texImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+e,0,t.RGBA,1,1,0,t.RGBA,t.UNSIGNED_BYTE,null);t.texParameteri(t.TEXTURE_CUBE_MAP,t.TEXTURE_MAG_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_CUBE_MAP,t.TEXTURE_MIN_FILTER,t.LINEAR);for(let t=0;t<this.boundTextures.length;t++)this.bind(null,t)}bind(t,e=0){const{gl:r}=this;if(null!=(t=null==t?void 0:t.castToBaseTexture())&&t.valid&&!t.parentTextureArray){t.touched=this.renderer.textureGC.count;const i=t._glTextures[this.CONTEXT_UID]||this.initTexture(t);this.boundTextures[e]!==t&&(this.currentLocation!==e&&(this.currentLocation=e,r.activeTexture(r.TEXTURE0+e)),r.bindTexture(t.target,i.texture)),i.dirtyId!==t.dirtyId?(this.currentLocation!==e&&(this.currentLocation=e,r.activeTexture(r.TEXTURE0+e)),this.updateTexture(t)):i.dirtyStyleId!==t.dirtyStyleId&&this.updateTextureStyle(t),this.boundTextures[e]=t}else this.currentLocation!==e&&(this.currentLocation=e,r.activeTexture(r.TEXTURE0+e)),r.bindTexture(r.TEXTURE_2D,this.emptyTextures[r.TEXTURE_2D].texture),this.boundTextures[e]=null}reset(){this._unknownBoundTextures=!0,this.hasIntegerTextures=!1,this.currentLocation=-1;for(let t=0;t<this.boundTextures.length;t++)this.boundTextures[t]=this.unknownTexture}unbind(t){const{gl:e,boundTextures:r}=this;if(this._unknownBoundTextures){this._unknownBoundTextures=!1;for(let t=0;t<r.length;t++)r[t]===this.unknownTexture&&this.bind(null,t)}for(let i=0;i<r.length;i++)r[i]===t&&(this.currentLocation!==i&&(e.activeTexture(e.TEXTURE0+i),this.currentLocation=i),e.bindTexture(t.target,this.emptyTextures[t.target].texture),r[i]=null)}ensureSamplerType(t){const{boundTextures:e,hasIntegerTextures:r,CONTEXT_UID:i}=this;if(r)for(let r=t-1;r>=0;--r){const t=e[r];t&&t._glTextures[i].samplerType!==u.FLOAT&&this.renderer.texture.unbind(t)}}initTexture(t){const e=new pn(this.gl.createTexture());return e.dirtyId=-1,t._glTextures[this.CONTEXT_UID]=e,this.managedTextures.push(t),t.on("dispose",this.destroyTexture,this),e}initTextureType(t,e){var r,i,s;e.internalFormat=null!=(i=null==(r=this.internalFormats[t.type])?void 0:r[t.format])?i:t.format,e.samplerType=null!=(s=this.samplerTypes[e.internalFormat])?s:u.FLOAT,2===this.webGLVersion&&t.type===l.HALF_FLOAT?e.type=this.gl.HALF_FLOAT:e.type=t.type}updateTexture(t){var e;const r=t._glTextures[this.CONTEXT_UID];if(!r)return;const i=this.renderer;if(this.initTextureType(t,r),null!=(e=t.resource)&&e.upload(i,t,r))r.samplerType!==u.FLOAT&&(this.hasIntegerTextures=!0);else{const e=t.realWidth,s=t.realHeight,n=i.gl;(r.width!==e||r.height!==s||r.dirtyId<0)&&(r.width=e,r.height=s,n.texImage2D(t.target,0,r.internalFormat,e,s,0,t.format,r.type,null))}t.dirtyStyleId!==r.dirtyStyleId&&this.updateTextureStyle(t),r.dirtyId=t.dirtyId}destroyTexture(t,e){const{gl:r}=this;if((t=t.castToBaseTexture())._glTextures[this.CONTEXT_UID]&&(this.unbind(t),r.deleteTexture(t._glTextures[this.CONTEXT_UID].texture),t.off("dispose",this.destroyTexture,this),delete t._glTextures[this.CONTEXT_UID],!e)){const e=this.managedTextures.indexOf(t);-1!==e&&Je(this.managedTextures,e,1)}}updateTextureStyle(t){var e;const r=t._glTextures[this.CONTEXT_UID];r&&(t.mipmap!==f.POW2&&2===this.webGLVersion||t.isPowerOfTwo?r.mipmap=t.mipmap>=1:r.mipmap=!1,2===this.webGLVersion||t.isPowerOfTwo?r.wrapMode=t.wrapMode:r.wrapMode=d.CLAMP,null!=(e=t.resource)&&e.style(this.renderer,t,r)||this.setStyle(t,r),r.dirtyStyleId=t.dirtyStyleId)}setStyle(t,e){const r=this.gl;if(e.mipmap&&t.mipmap!==f.ON_MANUAL&&r.generateMipmap(t.target),r.texParameteri(t.target,r.TEXTURE_WRAP_S,e.wrapMode),r.texParameteri(t.target,r.TEXTURE_WRAP_T,e.wrapMode),e.mipmap){r.texParameteri(t.target,r.TEXTURE_MIN_FILTER,t.scaleMode===c.LINEAR?r.LINEAR_MIPMAP_LINEAR:r.NEAREST_MIPMAP_NEAREST);const e=this.renderer.context.extensions.anisotropicFiltering;if(e&&t.anisotropicLevel>0&&t.scaleMode===c.LINEAR){const i=Math.min(t.anisotropicLevel,r.getParameter(e.MAX_TEXTURE_MAX_ANISOTROPY_EXT));r.texParameterf(t.target,e.TEXTURE_MAX_ANISOTROPY_EXT,i)}}else r.texParameteri(t.target,r.TEXTURE_MIN_FILTER,t.scaleMode===c.LINEAR?r.LINEAR:r.NEAREST);r.texParameteri(t.target,r.TEXTURE_MAG_FILTER,t.scaleMode===c.LINEAR?r.LINEAR:r.NEAREST)}destroy(){this.renderer=null}}_n.extension={type:Tr.RendererSystem,name:"texture"},Sr.add(_n);class mn{constructor(t){this.renderer=t}contextChange(){this.gl=this.renderer.gl,this.CONTEXT_UID=this.renderer.CONTEXT_UID}bind(t){const{gl:e,CONTEXT_UID:r}=this,i=t._glTransformFeedbacks[r]||this.createGLTransformFeedback(t);e.bindTransformFeedback(e.TRANSFORM_FEEDBACK,i)}unbind(){const{gl:t}=this;t.bindTransformFeedback(t.TRANSFORM_FEEDBACK,null)}beginTransformFeedback(t,e){const{gl:r,renderer:i}=this;e&&i.shader.bind(e),r.beginTransformFeedback(t)}endTransformFeedback(){const{gl:t}=this;t.endTransformFeedback()}createGLTransformFeedback(t){const{gl:e,renderer:r,CONTEXT_UID:i}=this,s=e.createTransformFeedback();t._glTransformFeedbacks[i]=s,e.bindTransformFeedback(e.TRANSFORM_FEEDBACK,s);for(let s=0;s<t.buffers.length;s++){const n=t.buffers[s];n&&(r.buffer.update(n),n._glBuffers[i].refCount++,e.bindBufferBase(e.TRANSFORM_FEEDBACK_BUFFER,s,n._glBuffers[i].buffer||null))}return e.bindTransformFeedback(e.TRANSFORM_FEEDBACK,null),t.disposeRunner.add(this),s}disposeTransformFeedback(t,e){const r=t._glTransformFeedbacks[this.CONTEXT_UID],i=this.gl;t.disposeRunner.remove(this);const s=this.renderer.buffer;if(s)for(let r=0;r<t.buffers.length;r++){const i=t.buffers[r];if(!i)continue;const n=i._glBuffers[this.CONTEXT_UID];n&&(n.refCount--,0===n.refCount&&!e&&s.dispose(i,e))}r&&(e||i.deleteTransformFeedback(r),delete t._glTransformFeedbacks[this.CONTEXT_UID])}destroy(){this.renderer=null}}mn.extension={type:Tr.RendererSystem,name:"transformFeedback"},Sr.add(mn);class gn{constructor(t){this.renderer=t}init(t){this.screen=new ai(0,0,t.width,t.height),this.element=t.view||T.ADAPTER.createCanvas(),this.resolution=t.resolution||T.RESOLUTION,this.autoDensity=!!t.autoDensity}resizeView(t,e){this.element.width=Math.round(t*this.resolution),this.element.height=Math.round(e*this.resolution);const r=this.element.width/this.resolution,i=this.element.height/this.resolution;this.screen.width=r,this.screen.height=i,this.autoDensity&&(this.element.style.width=`${r}px`,this.element.style.height=`${i}px`),this.renderer.emit("resize",r,i),this.renderer.runners.resize.emit(this.screen.width,this.screen.height)}destroy(t){var e;t&&(null==(e=this.element.parentNode)||e.removeChild(this.element)),this.renderer=null,this.element=null,this.screen=null}}gn.defaultOptions={width:800,height:600,resolution:void 0,autoDensity:!1},gn.extension={type:[Tr.RendererSystem,Tr.CanvasRendererSystem],name:"_view"},Sr.add(gn);var yn=Object.defineProperty,bn=Object.getOwnPropertySymbols,vn=Object.prototype.hasOwnProperty,xn=Object.prototype.propertyIsEnumerable,An=(t,e,r)=>e in t?yn(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Tn=(t,e)=>{for(var r in e||(e={}))vn.call(e,r)&&An(t,r,e[r]);if(bn)for(var r of bn(e))xn.call(e,r)&&An(t,r,e[r]);return t};T.PREFER_ENV=r.WEBGL2,T.STRICT_TEXTURE_CACHE=!1,T.RENDER_OPTIONS=Tn(Tn(Tn(Tn({},os.defaultOptions),is.defaultOptions),gn.defaultOptions),hn.defaultOptions),Object.defineProperties(T,{WRAP_MODE:{get:()=>zr.defaultOptions.wrapMode,set(t){zr.defaultOptions.wrapMode=t}},SCALE_MODE:{get:()=>zr.defaultOptions.scaleMode,set(t){zr.defaultOptions.scaleMode=t}},MIPMAP_TEXTURES:{get:()=>zr.defaultOptions.mipmap,set(t){zr.defaultOptions.mipmap=t}},ANISOTROPIC_LEVEL:{get:()=>zr.defaultOptions.anisotropicLevel,set(t){zr.defaultOptions.anisotropicLevel=t}},FILTER_RESOLUTION:{get:()=>rs.defaultResolution,set(t){rs.defaultResolution=t}},FILTER_MULTISAMPLE:{get:()=>rs.defaultMultisample,set(t){rs.defaultMultisample=t}},SPRITE_MAX_TEXTURES:{get:()=>ts.defaultMaxTextures,set(t){ts.defaultMaxTextures=t}},SPRITE_BATCH_SIZE:{get:()=>ts.defaultBatchSize,set(t){ts.defaultBatchSize=t}},CAN_UPLOAD_SAME_BUFFER:{get:()=>ts.canUploadSameBuffer,set(t){ts.canUploadSameBuffer=t}},GC_MODE:{get:()=>fn.defaultMode,set(t){fn.defaultMode=t}},GC_MAX_IDLE:{get:()=>fn.defaultMaxIdle,set(t){fn.defaultMaxIdle=t}},GC_MAX_CHECK_COUNT:{get:()=>fn.defaultCheckCountMax,set(t){fn.defaultCheckCountMax=t}},PRECISION_VERTEX:{get:()=>Wi.defaultVertexPrecision,set(t){Wi.defaultVertexPrecision=t}},PRECISION_FRAGMENT:{get:()=>Wi.defaultFragmentPrecision,set(t){Wi.defaultFragmentPrecision=t}}});var En=(t=>(t[t.INTERACTION=50]="INTERACTION",t[t.HIGH=25]="HIGH",t[t.NORMAL=0]="NORMAL",t[t.LOW=-25]="LOW",t[t.UTILITY=-50]="UTILITY",t))(En||{});class wn{constructor(t,e=null,r=0,i=!1){this.next=null,this.previous=null,this._destroyed=!1,this.fn=t,this.context=e,this.priority=r,this.once=i}match(t,e=null){return this.fn===t&&this.context===e}emit(t){this.fn&&(this.context?this.fn.call(this.context,t):this.fn(t));const e=this.next;return this.once&&this.destroy(!0),this._destroyed&&(this.next=null),e}connect(t){this.previous=t,t.next&&(t.next.previous=this),this.next=t.next,t.next=this}destroy(t=!1){this._destroyed=!0,this.fn=null,this.context=null,this.previous&&(this.previous.next=this.next),this.next&&(this.next.previous=this.previous);const e=this.next;return this.next=t?null:e,this.previous=null,e}}const Sn=class t{constructor(){this.autoStart=!1,this.deltaTime=1,this.lastTime=-1,this.speed=1,this.started=!1,this._requestId=null,this._maxElapsedMS=100,this._minElapsedMS=0,this._protected=!1,this._lastFrame=-1,this._head=new wn(null,null,1/0),this.deltaMS=1/t.targetFPMS,this.elapsedMS=1/t.targetFPMS,this._tick=t=>{this._requestId=null,this.started&&(this.update(t),this.started&&null===this._requestId&&this._head.next&&(this._requestId=requestAnimationFrame(this._tick)))}}_requestIfNeeded(){null===this._requestId&&this._head.next&&(this.lastTime=performance.now(),this._lastFrame=this.lastTime,this._requestId=requestAnimationFrame(this._tick))}_cancelIfNeeded(){null!==this._requestId&&(cancelAnimationFrame(this._requestId),this._requestId=null)}_startIfPossible(){this.started?this._requestIfNeeded():this.autoStart&&this.start()}add(t,e,r=En.NORMAL){return this._addListener(new wn(t,e,r))}addOnce(t,e,r=En.NORMAL){return this._addListener(new wn(t,e,r,!0))}_addListener(t){let e=this._head.next,r=this._head;if(e){for(;e;){if(t.priority>e.priority){t.connect(r);break}r=e,e=e.next}t.previous||t.connect(r)}else t.connect(r);return this._startIfPossible(),this}remove(t,e){let r=this._head.next;for(;r;)r=r.match(t,e)?r.destroy():r.next;return this._head.next||this._cancelIfNeeded(),this}get count(){if(!this._head)return 0;let t=0,e=this._head;for(;e=e.next;)t++;return t}start(){this.started||(this.started=!0,this._requestIfNeeded())}stop(){this.started&&(this.started=!1,this._cancelIfNeeded())}destroy(){if(!this._protected){this.stop();let t=this._head.next;for(;t;)t=t.destroy(!0);this._head.destroy(),this._head=null}}update(e=performance.now()){let r;if(e>this.lastTime){if(r=this.elapsedMS=e-this.lastTime,r>this._maxElapsedMS&&(r=this._maxElapsedMS),r*=this.speed,this._minElapsedMS){const t=e-this._lastFrame|0;if(t<this._minElapsedMS)return;this._lastFrame=e-t%this._minElapsedMS}this.deltaMS=r,this.deltaTime=this.deltaMS*t.targetFPMS;const i=this._head;let s=i.next;for(;s;)s=s.emit(this.deltaTime);i.next||this._cancelIfNeeded()}else this.deltaTime=this.deltaMS=this.elapsedMS=0;this.lastTime=e}get FPS(){return 1e3/this.elapsedMS}get minFPS(){return 1e3/this._maxElapsedMS}set minFPS(e){const r=Math.min(this.maxFPS,e),i=Math.min(Math.max(0,r)/1e3,t.targetFPMS);this._maxElapsedMS=1/i}get maxFPS(){return this._minElapsedMS?Math.round(1e3/this._minElapsedMS):0}set maxFPS(t){if(0===t)this._minElapsedMS=0;else{const e=Math.max(this.minFPS,t);this._minElapsedMS=1/(e/1e3)}}static get shared(){if(!t._shared){const e=t._shared=new t;e.autoStart=!0,e._protected=!0}return t._shared}static get system(){if(!t._system){const e=t._system=new t;e.autoStart=!0,e._protected=!0}return t._system}};Sn.targetFPMS=.06;let Cn=Sn;Object.defineProperties(T,{TARGET_FPMS:{get:()=>Cn.targetFPMS,set(t){Cn.targetFPMS=t}}});class Pn{static init(t){t=Object.assign({autoStart:!0,sharedTicker:!1},t),Object.defineProperty(this,"ticker",{set(t){this._ticker&&this._ticker.remove(this.render,this),this._ticker=t,t&&t.add(this.render,this,En.LOW)},get(){return this._ticker}}),this.stop=()=>{this._ticker.stop()},this.start=()=>{this._ticker.start()},this._ticker=null,this.ticker=t.sharedTicker?Cn.shared:new Cn,t.autoStart&&this.start()}static destroy(){if(this._ticker){const t=this._ticker;this.ticker=null,t.destroy()}}}Pn.extension=Tr.Application,Sr.add(Pn);const Mn=[];function $n(t){for(const e of Mn)if(e.test(t))return new e(t);throw new Error("Unable to auto-detect a suitable renderer.")}Sr.handleByList(Tr.Renderer,Mn);const In="attribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\n\nuniform mat3 projectionMatrix;\n\nvarying vec2 vTextureCoord;\n\nvoid main(void)\n{\n    gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n    vTextureCoord = aTextureCoord;\n}",Rn="attribute vec2 aVertexPosition;\n\nuniform mat3 projectionMatrix;\n\nvarying vec2 vTextureCoord;\n\nuniform vec4 inputSize;\nuniform vec4 outputFrame;\n\nvec4 filterVertexPosition( void )\n{\n    vec2 position = aVertexPosition * max(outputFrame.zw, vec2(0.)) + outputFrame.xy;\n\n    return vec4((projectionMatrix * vec3(position, 1.0)).xy, 0.0, 1.0);\n}\n\nvec2 filterTextureCoord( void )\n{\n    return aVertexPosition * (outputFrame.zw * inputSize.zw);\n}\n\nvoid main(void)\n{\n    gl_Position = filterVertexPosition();\n    vTextureCoord = filterTextureCoord();\n}\n";class Dn{constructor(t){this.renderer=t}contextChange(t){let e;if(1===this.renderer.context.webGLVersion){const r=t.getParameter(t.FRAMEBUFFER_BINDING);t.bindFramebuffer(t.FRAMEBUFFER,null),e=t.getParameter(t.SAMPLES),t.bindFramebuffer(t.FRAMEBUFFER,r)}else{const r=t.getParameter(t.DRAW_FRAMEBUFFER_BINDING);t.bindFramebuffer(t.DRAW_FRAMEBUFFER,null),e=t.getParameter(t.SAMPLES),t.bindFramebuffer(t.DRAW_FRAMEBUFFER,r)}e>=v.HIGH?this.multisample=v.HIGH:e>=v.MEDIUM?this.multisample=v.MEDIUM:e>=v.LOW?this.multisample=v.LOW:this.multisample=v.NONE}destroy(){}}Dn.extension={type:Tr.RendererSystem,name:"_multisample"},Sr.add(Dn);class Ln{constructor(t){this.buffer=t||null,this.updateID=-1,this.byteLength=-1,this.refCount=0}}class Fn{constructor(t){this.renderer=t,this.managedBuffers={},this.boundBufferBases={}}destroy(){this.renderer=null}contextChange(){this.disposeAll(!0),this.gl=this.renderer.gl,this.CONTEXT_UID=this.renderer.CONTEXT_UID}bind(t){const{gl:e,CONTEXT_UID:r}=this,i=t._glBuffers[r]||this.createGLBuffer(t);e.bindBuffer(t.type,i.buffer)}unbind(t){const{gl:e}=this;e.bindBuffer(t,null)}bindBufferBase(t,e){const{gl:r,CONTEXT_UID:i}=this;if(this.boundBufferBases[e]!==t){const s=t._glBuffers[i]||this.createGLBuffer(t);this.boundBufferBases[e]=t,r.bindBufferBase(r.UNIFORM_BUFFER,e,s.buffer)}}bindBufferRange(t,e,r){const{gl:i,CONTEXT_UID:s}=this;r=r||0;const n=t._glBuffers[s]||this.createGLBuffer(t);i.bindBufferRange(i.UNIFORM_BUFFER,e||0,n.buffer,256*r,256)}update(t){const{gl:e,CONTEXT_UID:r}=this,i=t._glBuffers[r]||this.createGLBuffer(t);if(t._updateID!==i.updateID)if(i.updateID=t._updateID,e.bindBuffer(t.type,i.buffer),i.byteLength>=t.data.byteLength)e.bufferSubData(t.type,0,t.data);else{const r=t.static?e.STATIC_DRAW:e.DYNAMIC_DRAW;i.byteLength=t.data.byteLength,e.bufferData(t.type,t.data,r)}}dispose(t,e){if(!this.managedBuffers[t.id])return;delete this.managedBuffers[t.id];const r=t._glBuffers[this.CONTEXT_UID],i=this.gl;t.disposeRunner.remove(this),r&&(e||i.deleteBuffer(r.buffer),delete t._glBuffers[this.CONTEXT_UID])}disposeAll(t){const e=Object.keys(this.managedBuffers);for(let r=0;r<e.length;r++)this.dispose(this.managedBuffers[e[r]],t)}createGLBuffer(t){const{CONTEXT_UID:e,gl:r}=this;return t._glBuffers[e]=new Ln(r.createBuffer()),this.managedBuffers[t.id]=t,t.disposeRunner.add(this),t._glBuffers[e]}}Fn.extension={type:Tr.RendererSystem,name:"buffer"},Sr.add(Fn);class On{constructor(t){this.renderer=t}render(t,e){const r=this.renderer;let i,s,n,o;if(e&&(i=e.renderTexture,s=e.clear,n=e.transform,o=e.skipUpdateTransform),this.renderingToScreen=!i,r.runners.prerender.emit(),r.emit("prerender"),r.projection.transform=n,!r.context.isLost){if(i||(this.lastObjectRendered=t),!o){const e=t.enableTempParent();t.updateTransform(),t.disableTempParent(e)}r.renderTexture.bind(i),r.batch.currentRenderer.start(),(null!=s?s:r.background.clearBeforeRender)&&r.renderTexture.clear(),t.render(r),r.batch.currentRenderer.flush(),i&&(e.blit&&r.framebuffer.blit(),i.baseTexture.update()),r.runners.postrender.emit(),r.projection.transform=null,r.emit("postrender")}}destroy(){this.renderer=null,this.lastObjectRendered=null}}On.extension={type:Tr.RendererSystem,name:"objectRenderer"},Sr.add(On);const kn=class t extends cn{constructor(e){super(),this.type=i.WEBGL,e=Object.assign({},T.RENDER_OPTIONS,e),this.gl=null,this.CONTEXT_UID=0,this.globalUniforms=new ji({projectionMatrix:new di},!0);const r={runners:["init","destroy","contextChange","resolutionChange","reset","update","postrender","prerender","resize"],systems:t.__systems,priority:["_view","textureGenerator","background","_plugin","startup","context","state","texture","buffer","geometry","framebuffer","transformFeedback","mask","scissor","stencil","projection","textureGC","filter","renderTexture","batch","objectRenderer","_multisample"]};this.setup(r),"useContextAlpha"in e&&(e.premultipliedAlpha=e.useContextAlpha&&"notMultiplied"!==e.useContextAlpha,e.backgroundAlpha=!1===e.useContextAlpha?1:e.backgroundAlpha),this._plugin.rendererPlugins=t.__plugins,this.options=e,this.startup.run(this.options)}static test(t){return(null==t||!t.forceCanvas)&&ne()}render(t,e){this.objectRenderer.render(t,e)}resize(t,e){this._view.resizeView(t,e)}reset(){return this.runners.reset.emit(),this}clear(){this.renderTexture.bind(),this.renderTexture.clear()}destroy(t=!1){this.runners.destroy.items.reverse(),this.emitWithCustomOptions(this.runners.destroy,{_view:t}),super.destroy()}get plugins(){return this._plugin.plugins}get multisample(){return this._multisample.multisample}get width(){return this._view.element.width}get height(){return this._view.element.height}get resolution(){return this._view.resolution}set resolution(t){this._view.resolution=t,this.runners.resolutionChange.emit(t)}get autoDensity(){return this._view.autoDensity}get view(){return this._view.element}get screen(){return this._view.screen}get lastObjectRendered(){return this.objectRenderer.lastObjectRendered}get renderingToScreen(){return this.objectRenderer.renderingToScreen}get rendererLogId(){return`WebGL ${this.context.webGLVersion}`}get clearBeforeRender(){return this.background.clearBeforeRender}get useContextAlpha(){return this.context.useContextAlpha}get preserveDrawingBuffer(){return this.context.preserveDrawingBuffer}get backgroundColor(){return this.background.color}set backgroundColor(t){this.background.color=t}get backgroundAlpha(){return this.background.alpha}set backgroundAlpha(t){this.background.alpha=t}get powerPreference(){return this.context.powerPreference}generateTexture(t,e){return this.textureGenerator.generateTexture(t,e)}};kn.extension={type:Tr.Renderer,priority:1},kn.__plugins={},kn.__systems={};let Bn=kn;Sr.handleByMap(Tr.RendererPlugin,Bn.__plugins),Sr.handleByMap(Tr.RendererSystem,Bn.__systems),Sr.add(Bn);class Nn extends Fr{constructor(t,e){const{width:r,height:i}=e||{};super(r,i),this.items=[],this.itemDirtyIds=[];for(let e=0;e<t;e++){const t=new zr;this.items.push(t),this.itemDirtyIds.push(-2)}this.length=t,this._load=null,this.baseTexture=null}initFromArray(t,e){for(let r=0;r<this.length;r++)t[r]&&(t[r].castToBaseTexture?this.addBaseTextureAt(t[r].castToBaseTexture(),r):t[r]instanceof Fr?this.addResourceAt(t[r],r):this.addResourceAt(Dr(t[r],e),r))}dispose(){for(let t=0,e=this.length;t<e;t++)this.items[t].destroy();this.items=null,this.itemDirtyIds=null,this._load=null}addResourceAt(t,e){if(!this.items[e])throw new Error(`Index ${e} is out of bounds`);return t.valid&&!this.valid&&this.resize(t.width,t.height),this.items[e].setResource(t),this}bind(t){if(null!==this.baseTexture)throw new Error("Only one base texture per TextureArray is allowed");super.bind(t);for(let e=0;e<this.length;e++)this.items[e].parentTextureArray=t,this.items[e].on("update",t.update,t)}unbind(t){super.unbind(t);for(let e=0;e<this.length;e++)this.items[e].parentTextureArray=null,this.items[e].off("update",t.update,t)}load(){if(this._load)return this._load;const t=this.items.map((t=>t.resource)).filter((t=>t)).map((t=>t.load()));return this._load=Promise.all(t).then((()=>{const{realWidth:t,realHeight:e}=this.items[0];return this.resize(t,e),this.update(),Promise.resolve(this)})),this._load}}class Un extends Nn{constructor(t,e){const{width:r,height:i}=e||{};let s,n;Array.isArray(t)?(s=t,n=t.length):n=t,super(n,{width:r,height:i}),s&&this.initFromArray(s,e)}addBaseTextureAt(t,e){if(!t.resource)throw new Error("ArrayResource does not support RenderTexture");return this.addResourceAt(t.resource,e),this}bind(t){super.bind(t),t.target=h.TEXTURE_2D_ARRAY}upload(t,e,r){const{length:i,itemDirtyIds:s,items:n}=this,{gl:o}=t;r.dirtyId<0&&o.texImage3D(o.TEXTURE_2D_ARRAY,0,r.internalFormat,this._width,this._height,i,0,e.format,r.type,null);for(let t=0;t<i;t++){const i=n[t];s[t]<i.dirtyId&&(s[t]=i.dirtyId,i.valid&&o.texSubImage3D(o.TEXTURE_2D_ARRAY,0,0,0,t,i.resource.width,i.resource.height,1,e.format,r.type,i.resource.source))}return!0}}class Gn extends ls{constructor(t){super(t)}static test(t){const{OffscreenCanvas:e}=globalThis;return!!(e&&t instanceof e)||globalThis.HTMLCanvasElement&&t instanceof HTMLCanvasElement}}const Vn=class t extends Nn{constructor(e,r){const{width:i,height:s,autoLoad:n,linkBaseTexture:o}=r||{};if(e&&e.length!==t.SIDES)throw new Error(`Invalid length. Got ${e.length}, expected 6`);super(6,{width:i,height:s});for(let e=0;e<t.SIDES;e++)this.items[e].target=h.TEXTURE_CUBE_MAP_POSITIVE_X+e;this.linkBaseTexture=!1!==o,e&&this.initFromArray(e,r),!1!==n&&this.load()}bind(t){super.bind(t),t.target=h.TEXTURE_CUBE_MAP}addBaseTextureAt(t,e,r){if(void 0===r&&(r=this.linkBaseTexture),!this.items[e])throw new Error(`Index ${e} is out of bounds`);if(!this.linkBaseTexture||t.parentTextureArray||Object.keys(t._glTextures).length>0){if(!t.resource)throw new Error("CubeResource does not support copying of renderTexture.");this.addResourceAt(t.resource,e)}else t.target=h.TEXTURE_CUBE_MAP_POSITIVE_X+e,t.parentTextureArray=this.baseTexture,this.items[e]=t;return t.valid&&!this.valid&&this.resize(t.realWidth,t.realHeight),this.items[e]=t,this}upload(e,r,i){const s=this.itemDirtyIds;for(let n=0;n<t.SIDES;n++){const t=this.items[n];(s[n]<t.dirtyId||i.dirtyId<r.dirtyId)&&(t.valid&&t.resource?(t.resource.upload(e,t,i),s[n]=t.dirtyId):s[n]<-1&&(e.gl.texImage2D(t.target,0,i.internalFormat,r.realWidth,r.realHeight,0,r.format,i.type,null),s[n]=-1))}return!0}static test(e){return Array.isArray(e)&&e.length===t.SIDES}};Vn.SIDES=6;let Hn=Vn;class zn extends ls{constructor(t,e){var r,i;let s,n,o;e=e||{},"string"==typeof t?(s=zn.EMPTY,n=t,o=!0):(s=t,n=null,o=!1),super(s),this.url=n,this.crossOrigin=null==(r=e.crossOrigin)||r,this.alphaMode="number"==typeof e.alphaMode?e.alphaMode:null,this.ownsImageBitmap=null!=(i=e.ownsImageBitmap)?i:o,this._load=null,!1!==e.autoLoad&&this.load()}load(){return this._load||(this._load=new Promise((async(t,e)=>{if(null!==this.url)try{const e=await T.ADAPTER.fetch(this.url,{mode:this.crossOrigin?"cors":"no-cors"});if(this.destroyed)return;const r=await e.blob();if(this.destroyed)return;const i=await createImageBitmap(r,{premultiplyAlpha:null===this.alphaMode||this.alphaMode===p.UNPACK?"premultiply":"none"});if(this.destroyed)return void i.close();this.source=i,this.update(),t(this)}catch(t){if(this.destroyed)return;e(t),this.onError.emit(t)}else t(this)}))),this._load}upload(t,e,r){return this.source instanceof ImageBitmap?("number"==typeof this.alphaMode&&(e.alphaMode=this.alphaMode),super.upload(t,e,r)):(this.load(),!1)}dispose(){this.ownsImageBitmap&&this.source instanceof ImageBitmap&&this.source.close(),super.dispose(),this._load=null}static test(t){return!!globalThis.createImageBitmap&&"undefined"!=typeof ImageBitmap&&("string"==typeof t||t instanceof ImageBitmap)}static get EMPTY(){var t;return zn._EMPTY=null!=(t=zn._EMPTY)?t:T.ADAPTER.createCanvas(0,0),zn._EMPTY}}const Xn=class t extends ls{constructor(t,e){e=e||{},super(T.ADAPTER.createCanvas()),this._width=0,this._height=0,this.svg=t,this.scale=e.scale||1,this._overrideWidth=e.width,this._overrideHeight=e.height,this._resolve=null,this._crossorigin=e.crossorigin,this._load=null,!1!==e.autoLoad&&this.load()}load(){return this._load||(this._load=new Promise((e=>{if(this._resolve=()=>{this.update(),e(this)},t.SVG_XML.test(this.svg.trim())){if(!btoa)throw new Error("Your browser doesn't support base64 conversions.");this.svg=`data:image/svg+xml;base64,${btoa(unescape(encodeURIComponent(this.svg)))}`}this._loadSvg()}))),this._load}_loadSvg(){const t=new Image;ls.crossOrigin(t,this.svg,this._crossorigin),t.src=this.svg,t.onerror=e=>{this._resolve&&(t.onerror=null,this.onError.emit(e))},t.onload=()=>{if(!this._resolve)return;const e=t.width,r=t.height;if(!e||!r)throw new Error("The SVG image must have width and height defined (in pixels), canvas API needs them.");let i=e*this.scale,s=r*this.scale;(this._overrideWidth||this._overrideHeight)&&(i=this._overrideWidth||this._overrideHeight/r*e,s=this._overrideHeight||this._overrideWidth/e*r),i=Math.round(i),s=Math.round(s);const n=this.source;n.width=i,n.height=s,n._pixiId=`canvas_${er()}`,n.getContext("2d").drawImage(t,0,0,e,r,0,0,i,s),this._resolve(),this._resolve=null}}static getSize(e){const r=t.SVG_SIZE.exec(e),i={};return r&&(i[r[1]]=Math.round(parseFloat(r[3])),i[r[5]]=Math.round(parseFloat(r[7]))),i}dispose(){super.dispose(),this._resolve=null,this._crossorigin=null}static test(e,r){return"svg"===r||"string"==typeof e&&e.startsWith("data:image/svg+xml")||"string"==typeof e&&t.SVG_XML.test(e)}};Xn.SVG_XML=/^(<\?xml[^?]+\?>)?\s*(<!--[^(-->)]*-->)?\s*\<svg/m,Xn.SVG_SIZE=/<svg[^>]*(?:\s(width|height)=('|")(\d*(?:\.\d+)?)(?:px)?('|"))[^>]*(?:\s(width|height)=('|")(\d*(?:\.\d+)?)(?:px)?('|"))[^>]*>/i;let Wn=Xn;const Yn=class t extends ls{constructor(e,r){if(r=r||{},!(e instanceof HTMLVideoElement)){const i=document.createElement("video");!1!==r.autoLoad&&i.setAttribute("preload","auto"),!1!==r.playsinline&&(i.setAttribute("webkit-playsinline",""),i.setAttribute("playsinline","")),!0===r.muted&&(i.setAttribute("muted",""),i.muted=!0),!0===r.loop&&i.setAttribute("loop",""),!1!==r.autoPlay&&i.setAttribute("autoplay",""),"string"==typeof e&&(e=[e]);const s=e[0].src||e[0];ls.crossOrigin(i,s,r.crossorigin);for(let r=0;r<e.length;++r){const s=document.createElement("source");let{src:n,mime:o}=e[r];if(n=n||e[r],n.startsWith("data:"))o=n.slice(5,n.indexOf(";"));else if(!n.startsWith("blob:")){const e=n.split("?").shift().toLowerCase(),r=e.slice(e.lastIndexOf(".")+1);o=o||t.MIME_TYPES[r]||`video/${r}`}s.src=n,o&&(s.type=o),i.appendChild(s)}e=i}super(e),this.noSubImage=!0,this._autoUpdate=!0,this._isConnectedToTicker=!1,this._updateFPS=r.updateFPS||0,this._msToNextUpdate=0,this.autoPlay=!1!==r.autoPlay,this._videoFrameRequestCallback=this._videoFrameRequestCallback.bind(this),this._videoFrameRequestCallbackHandle=null,this._load=null,this._resolve=null,this._reject=null,this._onCanPlay=this._onCanPlay.bind(this),this._onError=this._onError.bind(this),this._onPlayStart=this._onPlayStart.bind(this),this._onPlayStop=this._onPlayStop.bind(this),this._onSeeked=this._onSeeked.bind(this),!1!==r.autoLoad&&this.load()}update(t=0){if(!this.destroyed){if(this._updateFPS){const t=Cn.shared.elapsedMS*this.source.playbackRate;this._msToNextUpdate=Math.floor(this._msToNextUpdate-t)}(!this._updateFPS||this._msToNextUpdate<=0)&&(super.update(),this._msToNextUpdate=this._updateFPS?Math.floor(1e3/this._updateFPS):0)}}_videoFrameRequestCallback(){this.update(),this.destroyed?this._videoFrameRequestCallbackHandle=null:this._videoFrameRequestCallbackHandle=this.source.requestVideoFrameCallback(this._videoFrameRequestCallback)}load(){if(this._load)return this._load;const t=this.source;return(t.readyState===t.HAVE_ENOUGH_DATA||t.readyState===t.HAVE_FUTURE_DATA)&&t.width&&t.height&&(t.complete=!0),t.addEventListener("play",this._onPlayStart),t.addEventListener("pause",this._onPlayStop),t.addEventListener("seeked",this._onSeeked),this._isSourceReady()?this._onCanPlay():(t.addEventListener("canplay",this._onCanPlay),t.addEventListener("canplaythrough",this._onCanPlay),t.addEventListener("error",this._onError,!0)),this._load=new Promise(((e,r)=>{this.valid?e(this):(this._resolve=e,this._reject=r,t.load())})),this._load}_onError(t){this.source.removeEventListener("error",this._onError,!0),this.onError.emit(t),this._reject&&(this._reject(t),this._reject=null,this._resolve=null)}_isSourcePlaying(){const t=this.source;return!t.paused&&!t.ended}_isSourceReady(){return this.source.readyState>2}_onPlayStart(){this.valid||this._onCanPlay(),this._configureAutoUpdate()}_onPlayStop(){this._configureAutoUpdate()}_onSeeked(){this._autoUpdate&&!this._isSourcePlaying()&&(this._msToNextUpdate=0,this.update(),this._msToNextUpdate=0)}_onCanPlay(){const t=this.source;t.removeEventListener("canplay",this._onCanPlay),t.removeEventListener("canplaythrough",this._onCanPlay);const e=this.valid;this._msToNextUpdate=0,this.update(),this._msToNextUpdate=0,!e&&this._resolve&&(this._resolve(this),this._resolve=null,this._reject=null),this._isSourcePlaying()?this._onPlayStart():this.autoPlay&&t.play()}dispose(){this._configureAutoUpdate();const t=this.source;t&&(t.removeEventListener("play",this._onPlayStart),t.removeEventListener("pause",this._onPlayStop),t.removeEventListener("seeked",this._onSeeked),t.removeEventListener("canplay",this._onCanPlay),t.removeEventListener("canplaythrough",this._onCanPlay),t.removeEventListener("error",this._onError,!0),t.pause(),t.src="",t.load()),super.dispose()}get autoUpdate(){return this._autoUpdate}set autoUpdate(t){t!==this._autoUpdate&&(this._autoUpdate=t,this._configureAutoUpdate())}get updateFPS(){return this._updateFPS}set updateFPS(t){t!==this._updateFPS&&(this._updateFPS=t,this._configureAutoUpdate())}_configureAutoUpdate(){this._autoUpdate&&this._isSourcePlaying()?!this._updateFPS&&this.source.requestVideoFrameCallback?(this._isConnectedToTicker&&(Cn.shared.remove(this.update,this),this._isConnectedToTicker=!1,this._msToNextUpdate=0),null===this._videoFrameRequestCallbackHandle&&(this._videoFrameRequestCallbackHandle=this.source.requestVideoFrameCallback(this._videoFrameRequestCallback))):(null!==this._videoFrameRequestCallbackHandle&&(this.source.cancelVideoFrameCallback(this._videoFrameRequestCallbackHandle),this._videoFrameRequestCallbackHandle=null),this._isConnectedToTicker||(Cn.shared.add(this.update,this),this._isConnectedToTicker=!0,this._msToNextUpdate=0)):(null!==this._videoFrameRequestCallbackHandle&&(this.source.cancelVideoFrameCallback(this._videoFrameRequestCallbackHandle),this._videoFrameRequestCallbackHandle=null),this._isConnectedToTicker&&(Cn.shared.remove(this.update,this),this._isConnectedToTicker=!1,this._msToNextUpdate=0))}static test(e,r){return globalThis.HTMLVideoElement&&e instanceof HTMLVideoElement||t.TYPES.includes(r)}};Yn.TYPES=["mp4","m4v","webm","ogg","ogv","h264","avi","mov"],Yn.MIME_TYPES={ogv:"video/ogg",mov:"video/quicktime",m4v:"video/mp4"};let jn=Yn;Rr.push(zn,us,Gn,jn,class extends ls{constructor(t){super(t)}static test(t){return!!globalThis.VideoFrame&&t instanceof globalThis.VideoFrame}},Wn,Or,Hn,Un);class qn{constructor(){this.minX=1/0,this.minY=1/0,this.maxX=-1/0,this.maxY=-1/0,this.rect=null,this.updateID=-1}isEmpty(){return this.minX>this.maxX||this.minY>this.maxY}clear(){this.minX=1/0,this.minY=1/0,this.maxX=-1/0,this.maxY=-1/0}getRectangle(t){return this.minX>this.maxX||this.minY>this.maxY?ai.EMPTY:((t=t||new ai(0,0,1,1)).x=this.minX,t.y=this.minY,t.width=this.maxX-this.minX,t.height=this.maxY-this.minY,t)}addPoint(t){this.minX=Math.min(this.minX,t.x),this.maxX=Math.max(this.maxX,t.x),this.minY=Math.min(this.minY,t.y),this.maxY=Math.max(this.maxY,t.y)}addPointMatrix(t,e){const{a:r,b:i,c:s,d:n,tx:o,ty:a}=t,h=r*e.x+s*e.y+o,l=i*e.x+n*e.y+a;this.minX=Math.min(this.minX,h),this.maxX=Math.max(this.maxX,h),this.minY=Math.min(this.minY,l),this.maxY=Math.max(this.maxY,l)}addQuad(t){let e=this.minX,r=this.minY,i=this.maxX,s=this.maxY,n=t[0],o=t[1];e=n<e?n:e,r=o<r?o:r,i=n>i?n:i,s=o>s?o:s,n=t[2],o=t[3],e=n<e?n:e,r=o<r?o:r,i=n>i?n:i,s=o>s?o:s,n=t[4],o=t[5],e=n<e?n:e,r=o<r?o:r,i=n>i?n:i,s=o>s?o:s,n=t[6],o=t[7],e=n<e?n:e,r=o<r?o:r,i=n>i?n:i,s=o>s?o:s,this.minX=e,this.minY=r,this.maxX=i,this.maxY=s}addFrame(t,e,r,i,s){this.addFrameMatrix(t.worldTransform,e,r,i,s)}addFrameMatrix(t,e,r,i,s){const n=t.a,o=t.b,a=t.c,h=t.d,l=t.tx,u=t.ty;let c=this.minX,d=this.minY,f=this.maxX,p=this.maxY,_=n*e+a*r+l,m=o*e+h*r+u;c=_<c?_:c,d=m<d?m:d,f=_>f?_:f,p=m>p?m:p,_=n*i+a*r+l,m=o*i+h*r+u,c=_<c?_:c,d=m<d?m:d,f=_>f?_:f,p=m>p?m:p,_=n*e+a*s+l,m=o*e+h*s+u,c=_<c?_:c,d=m<d?m:d,f=_>f?_:f,p=m>p?m:p,_=n*i+a*s+l,m=o*i+h*s+u,c=_<c?_:c,d=m<d?m:d,f=_>f?_:f,p=m>p?m:p,this.minX=c,this.minY=d,this.maxX=f,this.maxY=p}addVertexData(t,e,r){let i=this.minX,s=this.minY,n=this.maxX,o=this.maxY;for(let a=e;a<r;a+=2){const e=t[a],r=t[a+1];i=e<i?e:i,s=r<s?r:s,n=e>n?e:n,o=r>o?r:o}this.minX=i,this.minY=s,this.maxX=n,this.maxY=o}addVertices(t,e,r,i){this.addVerticesMatrix(t.worldTransform,e,r,i)}addVerticesMatrix(t,e,r,i,s=0,n=s){const o=t.a,a=t.b,h=t.c,l=t.d,u=t.tx,c=t.ty;let d=this.minX,f=this.minY,p=this.maxX,_=this.maxY;for(let t=r;t<i;t+=2){const r=e[t],i=e[t+1],m=o*r+h*i+u,g=l*i+a*r+c;d=Math.min(d,m-s),p=Math.max(p,m+s),f=Math.min(f,g-n),_=Math.max(_,g+n)}this.minX=d,this.minY=f,this.maxX=p,this.maxY=_}addBounds(t){const e=this.minX,r=this.minY,i=this.maxX,s=this.maxY;this.minX=t.minX<e?t.minX:e,this.minY=t.minY<r?t.minY:r,this.maxX=t.maxX>i?t.maxX:i,this.maxY=t.maxY>s?t.maxY:s}addBoundsMask(t,e){const r=t.minX>e.minX?t.minX:e.minX,i=t.minY>e.minY?t.minY:e.minY,s=t.maxX<e.maxX?t.maxX:e.maxX,n=t.maxY<e.maxY?t.maxY:e.maxY;if(r<=s&&i<=n){const t=this.minX,e=this.minY,o=this.maxX,a=this.maxY;this.minX=r<t?r:t,this.minY=i<e?i:e,this.maxX=s>o?s:o,this.maxY=n>a?n:a}}addBoundsMatrix(t,e){this.addFrameMatrix(e,t.minX,t.minY,t.maxX,t.maxY)}addBoundsArea(t,e){const r=t.minX>e.x?t.minX:e.x,i=t.minY>e.y?t.minY:e.y,s=t.maxX<e.x+e.width?t.maxX:e.x+e.width,n=t.maxY<e.y+e.height?t.maxY:e.y+e.height;if(r<=s&&i<=n){const t=this.minX,e=this.minY,o=this.maxX,a=this.maxY;this.minX=r<t?r:t,this.minY=i<e?i:e,this.maxX=s>o?s:o,this.maxY=n>a?n:a}}pad(t=0,e=t){this.isEmpty()||(this.minX-=t,this.maxX+=t,this.minY-=e,this.maxY+=e)}addFramePad(t,e,r,i,s,n){t-=s,e-=n,r+=s,i+=n,this.minX=this.minX<t?this.minX:t,this.maxX=this.maxX>r?this.maxX:r,this.minY=this.minY<e?this.minY:e,this.maxY=this.maxY>i?this.maxY:i}}class Zn extends W{constructor(){super(),this.tempDisplayObjectParent=null,this.transform=new Ti,this.alpha=1,this.visible=!0,this.renderable=!0,this.cullable=!1,this.cullArea=null,this.parent=null,this.worldAlpha=1,this._lastSortedIndex=0,this._zIndex=0,this.filterArea=null,this.filters=null,this._enabledFilters=null,this._bounds=new qn,this._localBounds=null,this._boundsID=0,this._boundsRect=null,this._localBoundsRect=null,this._mask=null,this._maskRefCount=0,this._destroyed=!1,this.isSprite=!1,this.isMask=!1}static mixin(t){const e=Object.keys(t);for(let r=0;r<e.length;++r){const i=e[r];Object.defineProperty(Zn.prototype,i,Object.getOwnPropertyDescriptor(t,i))}}get destroyed(){return this._destroyed}_recursivePostUpdateTransform(){this.parent?(this.parent._recursivePostUpdateTransform(),this.transform.updateTransform(this.parent.transform)):this.transform.updateTransform(this._tempDisplayObjectParent.transform)}updateTransform(){this._boundsID++,this.transform.updateTransform(this.parent.transform),this.worldAlpha=this.alpha*this.parent.worldAlpha}getBounds(t,e){return t||(this.parent?(this._recursivePostUpdateTransform(),this.updateTransform()):(this.parent=this._tempDisplayObjectParent,this.updateTransform(),this.parent=null)),this._bounds.updateID!==this._boundsID&&(this.calculateBounds(),this._bounds.updateID=this._boundsID),e||(this._boundsRect||(this._boundsRect=new ai),e=this._boundsRect),this._bounds.getRectangle(e)}getLocalBounds(t){var e;t||(this._localBoundsRect||(this._localBoundsRect=new ai),t=this._localBoundsRect),this._localBounds||(this._localBounds=new qn);const r=this.transform,i=this.parent;this.parent=null,this._tempDisplayObjectParent.worldAlpha=null!=(e=null==i?void 0:i.worldAlpha)?e:1,this.transform=this._tempDisplayObjectParent.transform;const s=this._bounds,n=this._boundsID;this._bounds=this._localBounds;const o=this.getBounds(!1,t);return this.parent=i,this.transform=r,this._bounds=s,this._bounds.updateID+=this._boundsID-n,o}toGlobal(t,e,r=!1){return r||(this._recursivePostUpdateTransform(),this.parent?this.displayObjectUpdateTransform():(this.parent=this._tempDisplayObjectParent,this.displayObjectUpdateTransform(),this.parent=null)),this.worldTransform.apply(t,e)}toLocal(t,e,r,i){return e&&(t=e.toGlobal(t,r,i)),i||(this._recursivePostUpdateTransform(),this.parent?this.displayObjectUpdateTransform():(this.parent=this._tempDisplayObjectParent,this.displayObjectUpdateTransform(),this.parent=null)),this.worldTransform.applyInverse(t,r)}setParent(t){if(!t||!t.addChild)throw new Error("setParent: Argument must be a Container");return t.addChild(this),t}removeFromParent(){var t;null==(t=this.parent)||t.removeChild(this)}setTransform(t=0,e=0,r=1,i=1,s=0,n=0,o=0,a=0,h=0){return this.position.x=t,this.position.y=e,this.scale.x=r||1,this.scale.y=i||1,this.rotation=s,this.skew.x=n,this.skew.y=o,this.pivot.x=a,this.pivot.y=h,this}destroy(t){this.removeFromParent(),this._destroyed=!0,this.transform=null,this.parent=null,this._bounds=null,this.mask=null,this.cullArea=null,this.filters=null,this.filterArea=null,this.hitArea=null,this.eventMode="auto",this.interactiveChildren=!1,this.emit("destroyed"),this.removeAllListeners()}get _tempDisplayObjectParent(){return null===this.tempDisplayObjectParent&&(this.tempDisplayObjectParent=new Qn),this.tempDisplayObjectParent}enableTempParent(){const t=this.parent;return this.parent=this._tempDisplayObjectParent,t}disableTempParent(t){this.parent=t}get x(){return this.position.x}set x(t){this.transform.position.x=t}get y(){return this.position.y}set y(t){this.transform.position.y=t}get worldTransform(){return this.transform.worldTransform}get localTransform(){return this.transform.localTransform}get position(){return this.transform.position}set position(t){this.transform.position.copyFrom(t)}get scale(){return this.transform.scale}set scale(t){this.transform.scale.copyFrom(t)}get pivot(){return this.transform.pivot}set pivot(t){this.transform.pivot.copyFrom(t)}get skew(){return this.transform.skew}set skew(t){this.transform.skew.copyFrom(t)}get rotation(){return this.transform.rotation}set rotation(t){this.transform.rotation=t}get angle(){return this.transform.rotation*ri}set angle(t){this.transform.rotation=t*ii}get zIndex(){return this._zIndex}set zIndex(t){this._zIndex!==t&&(this._zIndex=t,this.parent&&(this.parent.sortDirty=!0))}get worldVisible(){let t=this;do{if(!t.visible)return!1;t=t.parent}while(t);return!0}get mask(){return this._mask}set mask(t){if(this._mask!==t){if(this._mask){const t=this._mask.isMaskData?this._mask.maskObject:this._mask;t&&(t._maskRefCount--,0===t._maskRefCount&&(t.renderable=!0,t.isMask=!1))}if(this._mask=t,this._mask){const t=this._mask.isMaskData?this._mask.maskObject:this._mask;t&&(0===t._maskRefCount&&(t.renderable=!1,t.isMask=!0),t._maskRefCount++)}}}}class Qn extends Zn{constructor(){super(...arguments),this.sortDirty=null}}Zn.prototype.displayObjectUpdateTransform=Zn.prototype.updateTransform;const Jn=new di;function Kn(t,e){return t.zIndex===e.zIndex?t._lastSortedIndex-e._lastSortedIndex:t.zIndex-e.zIndex}const to=class t extends Zn{constructor(){super(),this.children=[],this.sortableChildren=t.defaultSortableChildren,this.sortDirty=!1}onChildrenChange(t){}addChild(...t){if(t.length>1)for(let e=0;e<t.length;e++)this.addChild(t[e]);else{const e=t[0];e.parent&&e.parent.removeChild(e),e.parent=this,this.sortDirty=!0,e.transform._parentID=-1,this.children.push(e),this._boundsID++,this.onChildrenChange(this.children.length-1),this.emit("childAdded",e,this,this.children.length-1),e.emit("added",this)}return t[0]}addChildAt(t,e){if(e<0||e>this.children.length)throw new Error(`${t}addChildAt: The index ${e} supplied is out of bounds ${this.children.length}`);return t.parent&&t.parent.removeChild(t),t.parent=this,this.sortDirty=!0,t.transform._parentID=-1,this.children.splice(e,0,t),this._boundsID++,this.onChildrenChange(e),t.emit("added",this),this.emit("childAdded",t,this,e),t}swapChildren(t,e){if(t===e)return;const r=this.getChildIndex(t),i=this.getChildIndex(e);this.children[r]=e,this.children[i]=t,this.onChildrenChange(r<i?r:i)}getChildIndex(t){const e=this.children.indexOf(t);if(-1===e)throw new Error("The supplied DisplayObject must be a child of the caller");return e}setChildIndex(t,e){if(e<0||e>=this.children.length)throw new Error(`The index ${e} supplied is out of bounds ${this.children.length}`);const r=this.getChildIndex(t);Je(this.children,r,1),this.children.splice(e,0,t),this.onChildrenChange(e)}getChildAt(t){if(t<0||t>=this.children.length)throw new Error(`getChildAt: Index (${t}) does not exist.`);return this.children[t]}removeChild(...t){if(t.length>1)for(let e=0;e<t.length;e++)this.removeChild(t[e]);else{const e=t[0],r=this.children.indexOf(e);if(-1===r)return null;e.parent=null,e.transform._parentID=-1,Je(this.children,r,1),this._boundsID++,this.onChildrenChange(r),e.emit("removed",this),this.emit("childRemoved",e,this,r)}return t[0]}removeChildAt(t){const e=this.getChildAt(t);return e.parent=null,e.transform._parentID=-1,Je(this.children,t,1),this._boundsID++,this.onChildrenChange(t),e.emit("removed",this),this.emit("childRemoved",e,this,t),e}removeChildren(t=0,e=this.children.length){const r=t,i=e-r;let s;if(i>0&&i<=e){s=this.children.splice(r,i);for(let t=0;t<s.length;++t)s[t].parent=null,s[t].transform&&(s[t].transform._parentID=-1);this._boundsID++,this.onChildrenChange(t);for(let t=0;t<s.length;++t)s[t].emit("removed",this),this.emit("childRemoved",s[t],this,t);return s}if(0===i&&0===this.children.length)return[];throw new RangeError("removeChildren: numeric values are outside the acceptable range.")}sortChildren(){let t=!1;for(let e=0,r=this.children.length;e<r;++e){const r=this.children[e];r._lastSortedIndex=e,!t&&0!==r.zIndex&&(t=!0)}t&&this.children.length>1&&this.children.sort(Kn),this.sortDirty=!1}updateTransform(){this.sortableChildren&&this.sortDirty&&this.sortChildren(),this._boundsID++,this.transform.updateTransform(this.parent.transform),this.worldAlpha=this.alpha*this.parent.worldAlpha;for(let t=0,e=this.children.length;t<e;++t){const e=this.children[t];e.visible&&e.updateTransform()}}calculateBounds(){this._bounds.clear(),this._calculateBounds();for(let t=0;t<this.children.length;t++){const e=this.children[t];if(e.visible&&e.renderable)if(e.calculateBounds(),e._mask){const t=e._mask.isMaskData?e._mask.maskObject:e._mask;t?(t.calculateBounds(),this._bounds.addBoundsMask(e._bounds,t._bounds)):this._bounds.addBounds(e._bounds)}else e.filterArea?this._bounds.addBoundsArea(e._bounds,e.filterArea):this._bounds.addBounds(e._bounds)}this._bounds.updateID=this._boundsID}getLocalBounds(t,e=!1){const r=super.getLocalBounds(t);if(!e)for(let t=0,e=this.children.length;t<e;++t){const e=this.children[t];e.visible&&e.updateTransform()}return r}_calculateBounds(){}_renderWithCulling(e){const r=e.renderTexture.sourceFrame;if(!(r.width>0&&r.height>0))return;let i,s;this.cullArea?(i=this.cullArea,s=this.worldTransform):this._render!==t.prototype._render&&(i=this.getBounds(!0));const n=e.projection.transform;if(n&&(s?(s=Jn.copyFrom(s),s.prepend(n)):s=n),i&&r.intersects(i,s))this._render(e);else if(this.cullArea)return;for(let t=0,r=this.children.length;t<r;++t){const r=this.children[t],i=r.cullable;r.cullable=i||!this.cullArea,r.render(e),r.cullable=i}}render(t){var e;if(this.visible&&!(this.worldAlpha<=0)&&this.renderable)if(this._mask||null!=(e=this.filters)&&e.length)this.renderAdvanced(t);else if(this.cullable)this._renderWithCulling(t);else{this._render(t);for(let e=0,r=this.children.length;e<r;++e)this.children[e].render(t)}}renderAdvanced(t){var e,r,i;const s=this.filters,n=this._mask;if(s){this._enabledFilters||(this._enabledFilters=[]),this._enabledFilters.length=0;for(let t=0;t<s.length;t++)s[t].enabled&&this._enabledFilters.push(s[t])}const o=s&&(null==(e=this._enabledFilters)?void 0:e.length)||n&&(!n.isMaskData||n.enabled&&(n.autoDetect||n.type!==y.NONE));if(o&&t.batch.flush(),s&&null!=(r=this._enabledFilters)&&r.length&&t.filter.push(this,this._enabledFilters),n&&t.mask.push(this,this._mask),this.cullable)this._renderWithCulling(t);else{this._render(t);for(let e=0,r=this.children.length;e<r;++e)this.children[e].render(t)}o&&t.batch.flush(),n&&t.mask.pop(this),s&&null!=(i=this._enabledFilters)&&i.length&&t.filter.pop()}_render(t){}destroy(t){super.destroy(),this.sortDirty=!1;const e="boolean"==typeof t?t:null==t?void 0:t.children,r=this.removeChildren(0,this.children.length);if(e)for(let e=0;e<r.length;++e)r[e].destroy(t)}get width(){return this.scale.x*this.getLocalBounds().width}set width(t){const e=this.getLocalBounds().width;this.scale.x=0!==e?t/e:1,this._width=t}get height(){return this.scale.y*this.getLocalBounds().height}set height(t){const e=this.getLocalBounds().height;this.scale.y=0!==e?t/e:1,this._height=t}};to.defaultSortableChildren=!1;let eo=to;eo.prototype.containerUpdateTransform=eo.prototype.updateTransform,Object.defineProperties(T,{SORTABLE_CHILDREN:{get:()=>eo.defaultSortableChildren,set(t){eo.defaultSortableChildren=t}}});const ro=new ni,io=new Uint16Array([0,1,2,0,2,3]);class so extends eo{constructor(t){super(),this._anchor=new xi(this._onAnchorUpdate,this,t?t.defaultAnchor.x:0,t?t.defaultAnchor.y:0),this._texture=null,this._width=0,this._height=0,this._tintColor=new Ue(16777215),this._tintRGB=null,this.tint=16777215,this.blendMode=n.NORMAL,this._cachedTint=16777215,this.uvs=null,this.texture=t||ps.EMPTY,this.vertexData=new Float32Array(8),this.vertexTrimmedData=null,this._transformID=-1,this._textureID=-1,this._transformTrimmedID=-1,this._textureTrimmedID=-1,this.indices=io,this.pluginName="batch",this.isSprite=!0,this._roundPixels=T.ROUND_PIXELS}_onTextureUpdate(){this._textureID=-1,this._textureTrimmedID=-1,this._cachedTint=16777215,this._width&&(this.scale.x=Ke(this.scale.x)*this._width/this._texture.orig.width),this._height&&(this.scale.y=Ke(this.scale.y)*this._height/this._texture.orig.height)}_onAnchorUpdate(){this._transformID=-1,this._transformTrimmedID=-1}calculateVertices(){const t=this._texture;if(this._transformID===this.transform._worldID&&this._textureID===t._updateID)return;this._textureID!==t._updateID&&(this.uvs=this._texture._uvs.uvsFloat32),this._transformID=this.transform._worldID,this._textureID=t._updateID;const e=this.transform.worldTransform,r=e.a,i=e.b,s=e.c,n=e.d,o=e.tx,a=e.ty,h=this.vertexData,l=t.trim,u=t.orig,c=this._anchor;let d=0,f=0,p=0,_=0;if(l?(f=l.x-c._x*u.width,d=f+l.width,_=l.y-c._y*u.height,p=_+l.height):(f=-c._x*u.width,d=f+u.width,_=-c._y*u.height,p=_+u.height),h[0]=r*f+s*_+o,h[1]=n*_+i*f+a,h[2]=r*d+s*_+o,h[3]=n*_+i*d+a,h[4]=r*d+s*p+o,h[5]=n*p+i*d+a,h[6]=r*f+s*p+o,h[7]=n*p+i*f+a,this._roundPixels){const t=T.RESOLUTION;for(let e=0;e<h.length;++e)h[e]=Math.round(h[e]*t)/t}}calculateTrimmedVertices(){if(this.vertexTrimmedData){if(this._transformTrimmedID===this.transform._worldID&&this._textureTrimmedID===this._texture._updateID)return}else this.vertexTrimmedData=new Float32Array(8);this._transformTrimmedID=this.transform._worldID,this._textureTrimmedID=this._texture._updateID;const t=this._texture,e=this.vertexTrimmedData,r=t.orig,i=this._anchor,s=this.transform.worldTransform,n=s.a,o=s.b,a=s.c,h=s.d,l=s.tx,u=s.ty,c=-i._x*r.width,d=c+r.width,f=-i._y*r.height,p=f+r.height;if(e[0]=n*c+a*f+l,e[1]=h*f+o*c+u,e[2]=n*d+a*f+l,e[3]=h*f+o*d+u,e[4]=n*d+a*p+l,e[5]=h*p+o*d+u,e[6]=n*c+a*p+l,e[7]=h*p+o*c+u,this._roundPixels){const t=T.RESOLUTION;for(let r=0;r<e.length;++r)e[r]=Math.round(e[r]*t)/t}}_render(t){this.calculateVertices(),t.batch.setObjectRenderer(t.plugins[this.pluginName]),t.plugins[this.pluginName].render(this)}_calculateBounds(){const t=this._texture.trim,e=this._texture.orig;!t||t.width===e.width&&t.height===e.height?(this.calculateVertices(),this._bounds.addQuad(this.vertexData)):(this.calculateTrimmedVertices(),this._bounds.addQuad(this.vertexTrimmedData))}getLocalBounds(t){return 0===this.children.length?(this._localBounds||(this._localBounds=new qn),this._localBounds.minX=this._texture.orig.width*-this._anchor._x,this._localBounds.minY=this._texture.orig.height*-this._anchor._y,this._localBounds.maxX=this._texture.orig.width*(1-this._anchor._x),this._localBounds.maxY=this._texture.orig.height*(1-this._anchor._y),t||(this._localBoundsRect||(this._localBoundsRect=new ai),t=this._localBoundsRect),this._localBounds.getRectangle(t)):super.getLocalBounds.call(this,t)}containsPoint(t){this.worldTransform.applyInverse(t,ro);const e=this._texture.orig.width,r=this._texture.orig.height,i=-e*this.anchor.x;let s=0;return ro.x>=i&&ro.x<i+e&&(s=-r*this.anchor.y,ro.y>=s&&ro.y<s+r)}destroy(t){if(super.destroy(t),this._texture.off("update",this._onTextureUpdate,this),this._anchor=null,"boolean"==typeof t?t:null==t?void 0:t.texture){const e="boolean"==typeof t?t:null==t?void 0:t.baseTexture;this._texture.destroy(!!e)}this._texture=null}static from(t,e){const r=t instanceof ps?t:ps.from(t,e);return new so(r)}set roundPixels(t){this._roundPixels!==t&&(this._transformID=-1,this._transformTrimmedID=-1),this._roundPixels=t}get roundPixels(){return this._roundPixels}get width(){return Math.abs(this.scale.x)*this._texture.orig.width}set width(t){const e=Ke(this.scale.x)||1;this.scale.x=e*t/this._texture.orig.width,this._width=t}get height(){return Math.abs(this.scale.y)*this._texture.orig.height}set height(t){const e=Ke(this.scale.y)||1;this.scale.y=e*t/this._texture.orig.height,this._height=t}get anchor(){return this._anchor}set anchor(t){this._anchor.copyFrom(t)}get tint(){return this._tintColor.value}set tint(t){this._tintColor.setValue(t),this._tintRGB=this._tintColor.toLittleEndianNumber()}get tintValue(){return this._tintColor.toNumber()}get texture(){return this._texture}set texture(t){this._texture!==t&&(this._texture&&this._texture.off("update",this._onTextureUpdate,this),this._texture=t||ps.EMPTY,this._cachedTint=16777215,this._textureID=-1,this._textureTrimmedID=-1,t&&(t.baseTexture.valid?this._onTextureUpdate():t.once("update",this._onTextureUpdate,this)))}}const no=new di;Zn.prototype._cacheAsBitmap=!1,Zn.prototype._cacheData=null,Zn.prototype._cacheAsBitmapResolution=null,Zn.prototype._cacheAsBitmapMultisample=null;class oo{constructor(){this.textureCacheId=null,this.originalRender=null,this.originalRenderCanvas=null,this.originalCalculateBounds=null,this.originalGetLocalBounds=null,this.originalUpdateTransform=null,this.originalDestroy=null,this.originalMask=null,this.originalFilterArea=null,this.originalContainsPoint=null,this.sprite=null}}Object.defineProperties(Zn.prototype,{cacheAsBitmapResolution:{get(){return this._cacheAsBitmapResolution},set(t){t!==this._cacheAsBitmapResolution&&(this._cacheAsBitmapResolution=t,this.cacheAsBitmap&&(this.cacheAsBitmap=!1,this.cacheAsBitmap=!0))}},cacheAsBitmapMultisample:{get(){return this._cacheAsBitmapMultisample},set(t){t!==this._cacheAsBitmapMultisample&&(this._cacheAsBitmapMultisample=t,this.cacheAsBitmap&&(this.cacheAsBitmap=!1,this.cacheAsBitmap=!0))}},cacheAsBitmap:{get(){return this._cacheAsBitmap},set(t){if(this._cacheAsBitmap===t)return;let e;this._cacheAsBitmap=t,t?(this._cacheData||(this._cacheData=new oo),e=this._cacheData,e.originalRender=this.render,e.originalRenderCanvas=this.renderCanvas,e.originalUpdateTransform=this.updateTransform,e.originalCalculateBounds=this.calculateBounds,e.originalGetLocalBounds=this.getLocalBounds,e.originalDestroy=this.destroy,e.originalContainsPoint=this.containsPoint,e.originalMask=this._mask,e.originalFilterArea=this.filterArea,this.render=this._renderCached,this.renderCanvas=this._renderCachedCanvas,this.destroy=this._cacheAsBitmapDestroy):(e=this._cacheData,e.sprite&&this._destroyCachedDisplayObject(),this.render=e.originalRender,this.renderCanvas=e.originalRenderCanvas,this.calculateBounds=e.originalCalculateBounds,this.getLocalBounds=e.originalGetLocalBounds,this.destroy=e.originalDestroy,this.updateTransform=e.originalUpdateTransform,this.containsPoint=e.originalContainsPoint,this._mask=e.originalMask,this.filterArea=e.originalFilterArea)}}}),Zn.prototype._renderCached=function(t){!this.visible||this.worldAlpha<=0||!this.renderable||(this._initCachedDisplayObject(t),this._cacheData.sprite.transform._worldID=this.transform._worldID,this._cacheData.sprite.worldAlpha=this.worldAlpha,this._cacheData.sprite._render(t))},Zn.prototype._initCachedDisplayObject=function(t){var e,r,i;if(null!=(e=this._cacheData)&&e.sprite)return;const s=this.alpha;this.alpha=1,t.batch.flush();const n=this.getLocalBounds(new ai,!0);if(null!=(r=this.filters)&&r.length){const t=this.filters[0].padding;n.pad(t)}const o=this.cacheAsBitmapResolution||t.resolution;n.ceil(o),n.width=Math.max(n.width,1/o),n.height=Math.max(n.height,1/o);const a=t.renderTexture.current,h=t.renderTexture.sourceFrame.clone(),l=t.renderTexture.destinationFrame.clone(),u=t.projection.transform,c=_s.create({width:n.width,height:n.height,resolution:o,multisample:null!=(i=this.cacheAsBitmapMultisample)?i:t.multisample}),d=`cacheAsBitmap_${er()}`;this._cacheData.textureCacheId=d,zr.addToCache(c.baseTexture,d),ps.addToCache(c,d);const f=this.transform.localTransform.copyTo(no).invert().translate(-n.x,-n.y);this.render=this._cacheData.originalRender,t.render(this,{renderTexture:c,clear:!0,transform:f,skipUpdateTransform:!1}),t.framebuffer.blit(),t.projection.transform=u,t.renderTexture.bind(a,h,l),this.render=this._renderCached,this.updateTransform=this.displayObjectUpdateTransform,this.calculateBounds=this._calculateCachedBounds,this.getLocalBounds=this._getCachedLocalBounds,this._mask=null,this.filterArea=null,this.alpha=s;const p=new so(c);p.transform.worldTransform=this.transform.worldTransform,p.anchor.x=-n.x/n.width,p.anchor.y=-n.y/n.height,p.alpha=s,p._bounds=this._bounds,this._cacheData.sprite=p,this.transform._parentID=-1,this.parent?this.updateTransform():(this.enableTempParent(),this.updateTransform(),this.disableTempParent(null)),this.containsPoint=p.containsPoint.bind(p)},Zn.prototype._renderCachedCanvas=function(t){!this.visible||this.worldAlpha<=0||!this.renderable||(this._initCachedDisplayObjectCanvas(t),this._cacheData.sprite.worldAlpha=this.worldAlpha,this._cacheData.sprite._renderCanvas(t))},Zn.prototype._initCachedDisplayObjectCanvas=function(t){var e;if(null!=(e=this._cacheData)&&e.sprite)return;const r=this.getLocalBounds(new ai,!0),i=this.alpha;this.alpha=1;const s=t.canvasContext.activeContext,n=t._projTransform,o=this.cacheAsBitmapResolution||t.resolution;r.ceil(o),r.width=Math.max(r.width,1/o),r.height=Math.max(r.height,1/o);const a=_s.create({width:r.width,height:r.height,resolution:o}),h=`cacheAsBitmap_${er()}`;this._cacheData.textureCacheId=h,zr.addToCache(a.baseTexture,h),ps.addToCache(a,h);const l=no;this.transform.localTransform.copyTo(l),l.invert(),l.tx-=r.x,l.ty-=r.y,this.renderCanvas=this._cacheData.originalRenderCanvas,t.render(this,{renderTexture:a,clear:!0,transform:l,skipUpdateTransform:!1}),t.canvasContext.activeContext=s,t._projTransform=n,this.renderCanvas=this._renderCachedCanvas,this.updateTransform=this.displayObjectUpdateTransform,this.calculateBounds=this._calculateCachedBounds,this.getLocalBounds=this._getCachedLocalBounds,this._mask=null,this.filterArea=null,this.alpha=i;const u=new so(a);u.transform.worldTransform=this.transform.worldTransform,u.anchor.x=-r.x/r.width,u.anchor.y=-r.y/r.height,u.alpha=i,u._bounds=this._bounds,this._cacheData.sprite=u,this.transform._parentID=-1,this.parent?this.updateTransform():(this.parent=t._tempDisplayObjectParent,this.updateTransform(),this.parent=null),this.containsPoint=u.containsPoint.bind(u)},Zn.prototype._calculateCachedBounds=function(){this._bounds.clear(),this._cacheData.sprite.transform._worldID=this.transform._worldID,this._cacheData.sprite._calculateBounds(),this._bounds.updateID=this._boundsID},Zn.prototype._getCachedLocalBounds=function(){return this._cacheData.sprite.getLocalBounds(null)},Zn.prototype._destroyCachedDisplayObject=function(){this._cacheData.sprite._texture.destroy(!0),this._cacheData.sprite=null,zr.removeFromCache(this._cacheData.textureCacheId),ps.removeFromCache(this._cacheData.textureCacheId),this._cacheData.textureCacheId=null},Zn.prototype._cacheAsBitmapDestroy=function(t){this.cacheAsBitmap=!1,this.destroy(t)},Zn.prototype.name=null,eo.prototype.getChildByName=function(t,e){for(let e=0,r=this.children.length;e<r;e++)if(this.children[e].name===t)return this.children[e];if(e)for(let e=0,r=this.children.length;e<r;e++){const r=this.children[e];if(!r.getChildByName)continue;const i=r.getChildByName(t,!0);if(i)return i}return null},Zn.prototype.getGlobalPosition=function(t=new ni,e=!1){return this.parent?this.parent.toGlobal(this.position,t,e):(t.x=this.position.x,t.y=this.position.y),t};class ao extends rs{constructor(t=1){super(In,"varying vec2 vTextureCoord;\n\nuniform sampler2D uSampler;\nuniform float uAlpha;\n\nvoid main(void)\n{\n   gl_FragColor = texture2D(uSampler, vTextureCoord) * uAlpha;\n}\n",{uAlpha:1}),this.alpha=t}get alpha(){return this.uniforms.uAlpha}set alpha(t){this.uniforms.uAlpha=t}}const ho={5:[.153388,.221461,.250301],7:[.071303,.131514,.189879,.214607],9:[.028532,.067234,.124009,.179044,.20236],11:[.0093,.028002,.065984,.121703,.175713,.198596],13:[.002406,.009255,.027867,.065666,.121117,.174868,.197641],15:[489e-6,.002403,.009246,.02784,.065602,.120999,.174697,.197448]},lo=["varying vec2 vBlurTexCoords[%size%];","uniform sampler2D uSampler;","void main(void)","{","    gl_FragColor = vec4(0.0);","    %blur%","}"].join("\n");class uo extends rs{constructor(t,e=8,r=4,i=rs.defaultResolution,s=5){const n=function(t,e){const r=Math.ceil(t/2);let i,s="\n    attribute vec2 aVertexPosition;\n\n    uniform mat3 projectionMatrix;\n\n    uniform float strength;\n\n    varying vec2 vBlurTexCoords[%size%];\n\n    uniform vec4 inputSize;\n    uniform vec4 outputFrame;\n\n    vec4 filterVertexPosition( void )\n    {\n        vec2 position = aVertexPosition * max(outputFrame.zw, vec2(0.)) + outputFrame.xy;\n\n        return vec4((projectionMatrix * vec3(position, 1.0)).xy, 0.0, 1.0);\n    }\n\n    vec2 filterTextureCoord( void )\n    {\n        return aVertexPosition * (outputFrame.zw * inputSize.zw);\n    }\n\n    void main(void)\n    {\n        gl_Position = filterVertexPosition();\n\n        vec2 textureCoord = filterTextureCoord();\n        %blur%\n    }",n="";i=e?"vBlurTexCoords[%index%] =  textureCoord + vec2(%sampleIndex% * strength, 0.0);":"vBlurTexCoords[%index%] =  textureCoord + vec2(0.0, %sampleIndex% * strength);";for(let e=0;e<t;e++){let t=i.replace("%index%",e.toString());t=t.replace("%sampleIndex%",e-(r-1)+".0"),n+=t,n+="\n"}return s=s.replace("%blur%",n),s=s.replace("%size%",t.toString()),s}(s,t),o=function(t){const e=ho[t],r=e.length;let i,s=lo,n="";for(let s=0;s<t;s++){let o="gl_FragColor += texture2D(uSampler, vBlurTexCoords[%index%]) * %value%;".replace("%index%",s.toString());i=s,s>=r&&(i=t-s-1),o=o.replace("%value%",e[i].toString()),n+=o,n+="\n"}return s=s.replace("%blur%",n),s=s.replace("%size%",t.toString()),s}(s);super(n,o),this.horizontal=t,this.resolution=i,this._quality=0,this.quality=r,this.blur=e}apply(t,e,r,i){if(r?this.horizontal?this.uniforms.strength=1/r.width*(r.width/e.width):this.uniforms.strength=1/r.height*(r.height/e.height):this.horizontal?this.uniforms.strength=1/t.renderer.width*(t.renderer.width/e.width):this.uniforms.strength=1/t.renderer.height*(t.renderer.height/e.height),this.uniforms.strength*=this.strength,this.uniforms.strength/=this.passes,1===this.passes)t.applyFilter(this,e,r,i);else{const s=t.getFilterTexture(),n=t.renderer;let o=e,a=s;this.state.blend=!1,t.applyFilter(this,o,a,_.CLEAR);for(let e=1;e<this.passes-1;e++){t.bindAndClear(o,_.BLIT),this.uniforms.uSampler=a;const e=a;a=o,o=e,n.shader.bind(this),n.geometry.draw(5)}this.state.blend=!0,t.applyFilter(this,a,r,i),t.returnFilterTexture(s)}}get blur(){return this.strength}set blur(t){this.padding=1+2*Math.abs(t),this.strength=t}get quality(){return this._quality}set quality(t){this._quality=t,this.passes=t}}class co extends rs{constructor(t=8,e=4,r=rs.defaultResolution,i=5){super(),this._repeatEdgePixels=!1,this.blurXFilter=new uo(!0,t,e,r,i),this.blurYFilter=new uo(!1,t,e,r,i),this.resolution=r,this.quality=e,this.blur=t,this.repeatEdgePixels=!1}apply(t,e,r,i){const s=Math.abs(this.blurXFilter.strength),n=Math.abs(this.blurYFilter.strength);if(s&&n){const s=t.getFilterTexture();this.blurXFilter.apply(t,e,s,_.CLEAR),this.blurYFilter.apply(t,s,r,i),t.returnFilterTexture(s)}else n?this.blurYFilter.apply(t,e,r,i):this.blurXFilter.apply(t,e,r,i)}updatePadding(){this._repeatEdgePixels?this.padding=0:this.padding=2*Math.max(Math.abs(this.blurXFilter.strength),Math.abs(this.blurYFilter.strength))}get blur(){return this.blurXFilter.blur}set blur(t){this.blurXFilter.blur=this.blurYFilter.blur=t,this.updatePadding()}get quality(){return this.blurXFilter.quality}set quality(t){this.blurXFilter.quality=this.blurYFilter.quality=t}get blurX(){return this.blurXFilter.blur}set blurX(t){this.blurXFilter.blur=t,this.updatePadding()}get blurY(){return this.blurYFilter.blur}set blurY(t){this.blurYFilter.blur=t,this.updatePadding()}get blendMode(){return this.blurYFilter.blendMode}set blendMode(t){this.blurYFilter.blendMode=t}get repeatEdgePixels(){return this._repeatEdgePixels}set repeatEdgePixels(t){this._repeatEdgePixels=t,this.updatePadding()}}class fo extends rs{constructor(){const t={m:new Float32Array([1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0]),uAlpha:1};super(Rn,"varying vec2 vTextureCoord;\nuniform sampler2D uSampler;\nuniform float m[20];\nuniform float uAlpha;\n\nvoid main(void)\n{\n    vec4 c = texture2D(uSampler, vTextureCoord);\n\n    if (uAlpha == 0.0) {\n        gl_FragColor = c;\n        return;\n    }\n\n    // Un-premultiply alpha before applying the color matrix. See issue #3539.\n    if (c.a > 0.0) {\n      c.rgb /= c.a;\n    }\n\n    vec4 result;\n\n    result.r = (m[0] * c.r);\n        result.r += (m[1] * c.g);\n        result.r += (m[2] * c.b);\n        result.r += (m[3] * c.a);\n        result.r += m[4];\n\n    result.g = (m[5] * c.r);\n        result.g += (m[6] * c.g);\n        result.g += (m[7] * c.b);\n        result.g += (m[8] * c.a);\n        result.g += m[9];\n\n    result.b = (m[10] * c.r);\n       result.b += (m[11] * c.g);\n       result.b += (m[12] * c.b);\n       result.b += (m[13] * c.a);\n       result.b += m[14];\n\n    result.a = (m[15] * c.r);\n       result.a += (m[16] * c.g);\n       result.a += (m[17] * c.b);\n       result.a += (m[18] * c.a);\n       result.a += m[19];\n\n    vec3 rgb = mix(c.rgb, result.rgb, uAlpha);\n\n    // Premultiply alpha again.\n    rgb *= result.a;\n\n    gl_FragColor = vec4(rgb, result.a);\n}\n",t),this.alpha=1}_loadMatrix(t,e=!1){let r=t;e&&(this._multiply(r,this.uniforms.m,t),r=this._colorMatrix(r)),this.uniforms.m=r}_multiply(t,e,r){return t[0]=e[0]*r[0]+e[1]*r[5]+e[2]*r[10]+e[3]*r[15],t[1]=e[0]*r[1]+e[1]*r[6]+e[2]*r[11]+e[3]*r[16],t[2]=e[0]*r[2]+e[1]*r[7]+e[2]*r[12]+e[3]*r[17],t[3]=e[0]*r[3]+e[1]*r[8]+e[2]*r[13]+e[3]*r[18],t[4]=e[0]*r[4]+e[1]*r[9]+e[2]*r[14]+e[3]*r[19]+e[4],t[5]=e[5]*r[0]+e[6]*r[5]+e[7]*r[10]+e[8]*r[15],t[6]=e[5]*r[1]+e[6]*r[6]+e[7]*r[11]+e[8]*r[16],t[7]=e[5]*r[2]+e[6]*r[7]+e[7]*r[12]+e[8]*r[17],t[8]=e[5]*r[3]+e[6]*r[8]+e[7]*r[13]+e[8]*r[18],t[9]=e[5]*r[4]+e[6]*r[9]+e[7]*r[14]+e[8]*r[19]+e[9],t[10]=e[10]*r[0]+e[11]*r[5]+e[12]*r[10]+e[13]*r[15],t[11]=e[10]*r[1]+e[11]*r[6]+e[12]*r[11]+e[13]*r[16],t[12]=e[10]*r[2]+e[11]*r[7]+e[12]*r[12]+e[13]*r[17],t[13]=e[10]*r[3]+e[11]*r[8]+e[12]*r[13]+e[13]*r[18],t[14]=e[10]*r[4]+e[11]*r[9]+e[12]*r[14]+e[13]*r[19]+e[14],t[15]=e[15]*r[0]+e[16]*r[5]+e[17]*r[10]+e[18]*r[15],t[16]=e[15]*r[1]+e[16]*r[6]+e[17]*r[11]+e[18]*r[16],t[17]=e[15]*r[2]+e[16]*r[7]+e[17]*r[12]+e[18]*r[17],t[18]=e[15]*r[3]+e[16]*r[8]+e[17]*r[13]+e[18]*r[18],t[19]=e[15]*r[4]+e[16]*r[9]+e[17]*r[14]+e[18]*r[19]+e[19],t}_colorMatrix(t){const e=new Float32Array(t);return e[4]/=255,e[9]/=255,e[14]/=255,e[19]/=255,e}brightness(t,e){const r=[t,0,0,0,0,0,t,0,0,0,0,0,t,0,0,0,0,0,1,0];this._loadMatrix(r,e)}tint(t,e){const[r,i,s]=Ue.shared.setValue(t).toArray(),n=[r,0,0,0,0,0,i,0,0,0,0,0,s,0,0,0,0,0,1,0];this._loadMatrix(n,e)}greyscale(t,e){const r=[t,t,t,0,0,t,t,t,0,0,t,t,t,0,0,0,0,0,1,0];this._loadMatrix(r,e)}blackAndWhite(t){this._loadMatrix([.3,.6,.1,0,0,.3,.6,.1,0,0,.3,.6,.1,0,0,0,0,0,1,0],t)}hue(t,e){t=(t||0)/180*Math.PI;const r=Math.cos(t),i=Math.sin(t),s=1/3,n=(0,Math.sqrt)(s),o=[r+(1-r)*s,s*(1-r)-n*i,s*(1-r)+n*i,0,0,s*(1-r)+n*i,r+s*(1-r),s*(1-r)-n*i,0,0,s*(1-r)-n*i,s*(1-r)+n*i,r+s*(1-r),0,0,0,0,0,1,0];this._loadMatrix(o,e)}contrast(t,e){const r=(t||0)+1,i=-.5*(r-1),s=[r,0,0,0,i,0,r,0,0,i,0,0,r,0,i,0,0,0,1,0];this._loadMatrix(s,e)}saturate(t=0,e){const r=2*t/3+1,i=-.5*(r-1),s=[r,i,i,0,0,i,r,i,0,0,i,i,r,0,0,0,0,0,1,0];this._loadMatrix(s,e)}desaturate(){this.saturate(-1)}negative(t){this._loadMatrix([-1,0,0,1,0,0,-1,0,1,0,0,0,-1,1,0,0,0,0,1,0],t)}sepia(t){this._loadMatrix([.393,.7689999,.18899999,0,0,.349,.6859999,.16799999,0,0,.272,.5339999,.13099999,0,0,0,0,0,1,0],t)}technicolor(t){this._loadMatrix([1.9125277891456083,-.8545344976951645,-.09155508482755585,0,11.793603434377337,-.3087833385928097,1.7658908555458428,-.10601743074722245,0,-70.35205161461398,-.231103377548616,-.7501899197440212,1.847597816108189,0,30.950940869491138,0,0,0,1,0],t)}polaroid(t){this._loadMatrix([1.438,-.062,-.062,0,0,-.122,1.378,-.122,0,0,-.016,-.016,1.483,0,0,0,0,0,1,0],t)}toBGR(t){this._loadMatrix([0,0,1,0,0,0,1,0,0,0,1,0,0,0,0,0,0,0,1,0],t)}kodachrome(t){this._loadMatrix([1.1285582396593525,-.3967382283601348,-.03992559172921793,0,63.72958762196502,-.16404339962244616,1.0835251566291304,-.05498805115633132,0,24.732407896706203,-.16786010706155763,-.5603416277695248,1.6014850761964943,0,35.62982807460946,0,0,0,1,0],t)}browni(t){this._loadMatrix([.5997023498159715,.34553243048391263,-.2708298674538042,0,47.43192855600873,-.037703249837783157,.8609577587992641,.15059552388459913,0,-36.96841498319127,.24113635128153335,-.07441037908422492,.44972182064877153,0,-7.562075277591283,0,0,0,1,0],t)}vintage(t){this._loadMatrix([.6279345635605994,.3202183420819367,-.03965408211312453,0,9.651285835294123,.02578397704808868,.6441188644374771,.03259127616149294,0,7.462829176470591,.0466055556782719,-.0851232987247891,.5241648018700465,0,5.159190588235296,0,0,0,1,0],t)}colorTone(t,e,r,i,s){t=t||.2,e=e||.15,r=r||16770432,i=i||3375104;const n=Ue.shared,[o,a,h]=n.setValue(r).toArray(),[l,u,c]=n.setValue(i).toArray(),d=[.3,.59,.11,0,0,o,a,h,t,0,l,u,c,e,0,o-l,a-u,h-c,0,0];this._loadMatrix(d,s)}night(t,e){const r=[-2*(t=t||.1),-t,0,0,0,-t,0,t,0,0,0,t,2*t,0,0,0,0,0,1,0];this._loadMatrix(r,e)}predator(t,e){const r=[11.224130630493164*t,-4.794486999511719*t,-2.8746118545532227*t,0*t,.40342438220977783*t,-3.6330697536468506*t,9.193157196044922*t,-2.951810836791992*t,0*t,-1.316135048866272*t,-3.2184197902679443*t,-4.2375030517578125*t,7.476448059082031*t,0*t,.8044459223747253*t,0,0,0,1,0];this._loadMatrix(r,e)}lsd(t){this._loadMatrix([2,-.4,.5,0,0,-.5,2,-.4,0,0,-.4,-.5,3,0,0,0,0,0,1,0],t)}reset(){this._loadMatrix([1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0],!1)}get matrix(){return this.uniforms.m}set matrix(t){this.uniforms.m=t}get alpha(){return this.uniforms.uAlpha}set alpha(t){this.uniforms.uAlpha=t}}fo.prototype.grayscale=fo.prototype.greyscale;class po extends rs{constructor(t,e){const r=new di;t.renderable=!1,super("attribute vec2 aVertexPosition;\n\nuniform mat3 projectionMatrix;\nuniform mat3 filterMatrix;\n\nvarying vec2 vTextureCoord;\nvarying vec2 vFilterCoord;\n\nuniform vec4 inputSize;\nuniform vec4 outputFrame;\n\nvec4 filterVertexPosition( void )\n{\n    vec2 position = aVertexPosition * max(outputFrame.zw, vec2(0.)) + outputFrame.xy;\n\n    return vec4((projectionMatrix * vec3(position, 1.0)).xy, 0.0, 1.0);\n}\n\nvec2 filterTextureCoord( void )\n{\n    return aVertexPosition * (outputFrame.zw * inputSize.zw);\n}\n\nvoid main(void)\n{\n\tgl_Position = filterVertexPosition();\n\tvTextureCoord = filterTextureCoord();\n\tvFilterCoord = ( filterMatrix * vec3( vTextureCoord, 1.0)  ).xy;\n}\n","varying vec2 vFilterCoord;\nvarying vec2 vTextureCoord;\n\nuniform vec2 scale;\nuniform mat2 rotation;\nuniform sampler2D uSampler;\nuniform sampler2D mapSampler;\n\nuniform highp vec4 inputSize;\nuniform vec4 inputClamp;\n\nvoid main(void)\n{\n  vec4 map =  texture2D(mapSampler, vFilterCoord);\n\n  map -= 0.5;\n  map.xy = scale * inputSize.zw * (rotation * map.xy);\n\n  gl_FragColor = texture2D(uSampler, clamp(vec2(vTextureCoord.x + map.x, vTextureCoord.y + map.y), inputClamp.xy, inputClamp.zw));\n}\n",{mapSampler:t._texture,filterMatrix:r,scale:{x:1,y:1},rotation:new Float32Array([1,0,0,1])}),this.maskSprite=t,this.maskMatrix=r,null==e&&(e=20),this.scale=new ni(e,e)}apply(t,e,r,i){this.uniforms.filterMatrix=t.calculateSpriteMatrix(this.maskMatrix,this.maskSprite),this.uniforms.scale.x=this.scale.x,this.uniforms.scale.y=this.scale.y;const s=this.maskSprite.worldTransform,n=Math.sqrt(s.a*s.a+s.b*s.b),o=Math.sqrt(s.c*s.c+s.d*s.d);0!==n&&0!==o&&(this.uniforms.rotation[0]=s.a/n,this.uniforms.rotation[1]=s.b/n,this.uniforms.rotation[2]=s.c/o,this.uniforms.rotation[3]=s.d/o),t.applyFilter(this,e,r,i)}get map(){return this.uniforms.mapSampler}set map(t){this.uniforms.mapSampler=t}}class _o extends rs{constructor(){super("\nattribute vec2 aVertexPosition;\n\nuniform mat3 projectionMatrix;\n\nvarying vec2 v_rgbNW;\nvarying vec2 v_rgbNE;\nvarying vec2 v_rgbSW;\nvarying vec2 v_rgbSE;\nvarying vec2 v_rgbM;\n\nvarying vec2 vFragCoord;\n\nuniform vec4 inputSize;\nuniform vec4 outputFrame;\n\nvec4 filterVertexPosition( void )\n{\n    vec2 position = aVertexPosition * max(outputFrame.zw, vec2(0.)) + outputFrame.xy;\n\n    return vec4((projectionMatrix * vec3(position, 1.0)).xy, 0.0, 1.0);\n}\n\nvoid texcoords(vec2 fragCoord, vec2 inverseVP,\n               out vec2 v_rgbNW, out vec2 v_rgbNE,\n               out vec2 v_rgbSW, out vec2 v_rgbSE,\n               out vec2 v_rgbM) {\n    v_rgbNW = (fragCoord + vec2(-1.0, -1.0)) * inverseVP;\n    v_rgbNE = (fragCoord + vec2(1.0, -1.0)) * inverseVP;\n    v_rgbSW = (fragCoord + vec2(-1.0, 1.0)) * inverseVP;\n    v_rgbSE = (fragCoord + vec2(1.0, 1.0)) * inverseVP;\n    v_rgbM = vec2(fragCoord * inverseVP);\n}\n\nvoid main(void) {\n\n   gl_Position = filterVertexPosition();\n\n   vFragCoord = aVertexPosition * outputFrame.zw;\n\n   texcoords(vFragCoord, inputSize.zw, v_rgbNW, v_rgbNE, v_rgbSW, v_rgbSE, v_rgbM);\n}\n",'varying vec2 v_rgbNW;\nvarying vec2 v_rgbNE;\nvarying vec2 v_rgbSW;\nvarying vec2 v_rgbSE;\nvarying vec2 v_rgbM;\n\nvarying vec2 vFragCoord;\nuniform sampler2D uSampler;\nuniform highp vec4 inputSize;\n\n\n/**\n Basic FXAA implementation based on the code on geeks3d.com with the\n modification that the texture2DLod stuff was removed since it\'s\n unsupported by WebGL.\n\n --\n\n From:\n https://github.com/mitsuhiko/webgl-meincraft\n\n Copyright (c) 2011 by Armin Ronacher.\n\n Some rights reserved.\n\n Redistribution and use in source and binary forms, with or without\n modification, are permitted provided that the following conditions are\n met:\n\n * Redistributions of source code must retain the above copyright\n notice, this list of conditions and the following disclaimer.\n\n * Redistributions in binary form must reproduce the above\n copyright notice, this list of conditions and the following\n disclaimer in the documentation and/or other materials provided\n with the distribution.\n\n * The names of the contributors may not be used to endorse or\n promote products derived from this software without specific\n prior written permission.\n\n THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS\n "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT\n LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR\n A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT\n OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,\n SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT\n LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,\n DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY\n THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT\n (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE\n OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n */\n\n#ifndef FXAA_REDUCE_MIN\n#define FXAA_REDUCE_MIN   (1.0/ 128.0)\n#endif\n#ifndef FXAA_REDUCE_MUL\n#define FXAA_REDUCE_MUL   (1.0 / 8.0)\n#endif\n#ifndef FXAA_SPAN_MAX\n#define FXAA_SPAN_MAX     8.0\n#endif\n\n//optimized version for mobile, where dependent\n//texture reads can be a bottleneck\nvec4 fxaa(sampler2D tex, vec2 fragCoord, vec2 inverseVP,\n          vec2 v_rgbNW, vec2 v_rgbNE,\n          vec2 v_rgbSW, vec2 v_rgbSE,\n          vec2 v_rgbM) {\n    vec4 color;\n    vec3 rgbNW = texture2D(tex, v_rgbNW).xyz;\n    vec3 rgbNE = texture2D(tex, v_rgbNE).xyz;\n    vec3 rgbSW = texture2D(tex, v_rgbSW).xyz;\n    vec3 rgbSE = texture2D(tex, v_rgbSE).xyz;\n    vec4 texColor = texture2D(tex, v_rgbM);\n    vec3 rgbM  = texColor.xyz;\n    vec3 luma = vec3(0.299, 0.587, 0.114);\n    float lumaNW = dot(rgbNW, luma);\n    float lumaNE = dot(rgbNE, luma);\n    float lumaSW = dot(rgbSW, luma);\n    float lumaSE = dot(rgbSE, luma);\n    float lumaM  = dot(rgbM,  luma);\n    float lumaMin = min(lumaM, min(min(lumaNW, lumaNE), min(lumaSW, lumaSE)));\n    float lumaMax = max(lumaM, max(max(lumaNW, lumaNE), max(lumaSW, lumaSE)));\n\n    mediump vec2 dir;\n    dir.x = -((lumaNW + lumaNE) - (lumaSW + lumaSE));\n    dir.y =  ((lumaNW + lumaSW) - (lumaNE + lumaSE));\n\n    float dirReduce = max((lumaNW + lumaNE + lumaSW + lumaSE) *\n                          (0.25 * FXAA_REDUCE_MUL), FXAA_REDUCE_MIN);\n\n    float rcpDirMin = 1.0 / (min(abs(dir.x), abs(dir.y)) + dirReduce);\n    dir = min(vec2(FXAA_SPAN_MAX, FXAA_SPAN_MAX),\n              max(vec2(-FXAA_SPAN_MAX, -FXAA_SPAN_MAX),\n                  dir * rcpDirMin)) * inverseVP;\n\n    vec3 rgbA = 0.5 * (\n                       texture2D(tex, fragCoord * inverseVP + dir * (1.0 / 3.0 - 0.5)).xyz +\n                       texture2D(tex, fragCoord * inverseVP + dir * (2.0 / 3.0 - 0.5)).xyz);\n    vec3 rgbB = rgbA * 0.5 + 0.25 * (\n                                     texture2D(tex, fragCoord * inverseVP + dir * -0.5).xyz +\n                                     texture2D(tex, fragCoord * inverseVP + dir * 0.5).xyz);\n\n    float lumaB = dot(rgbB, luma);\n    if ((lumaB < lumaMin) || (lumaB > lumaMax))\n        color = vec4(rgbA, texColor.a);\n    else\n        color = vec4(rgbB, texColor.a);\n    return color;\n}\n\nvoid main() {\n\n      vec4 color;\n\n      color = fxaa(uSampler, vFragCoord, inputSize.zw, v_rgbNW, v_rgbNE, v_rgbSW, v_rgbSE, v_rgbM);\n\n      gl_FragColor = color;\n}\n')}}class mo extends rs{constructor(t=.5,e=Math.random()){super(Rn,"precision highp float;\n\nvarying vec2 vTextureCoord;\nvarying vec4 vColor;\n\nuniform float uNoise;\nuniform float uSeed;\nuniform sampler2D uSampler;\n\nfloat rand(vec2 co)\n{\n    return fract(sin(dot(co.xy, vec2(12.9898, 78.233))) * 43758.5453);\n}\n\nvoid main()\n{\n    vec4 color = texture2D(uSampler, vTextureCoord);\n    float randomValue = rand(gl_FragCoord.xy * uSeed);\n    float diff = (randomValue - 0.5) * uNoise;\n\n    // Un-premultiply alpha before applying the color matrix. See issue #3539.\n    if (color.a > 0.0) {\n        color.rgb /= color.a;\n    }\n\n    color.r += diff;\n    color.g += diff;\n    color.b += diff;\n\n    // Premultiply alpha again.\n    color.rgb *= color.a;\n\n    gl_FragColor = color;\n}\n",{uNoise:0,uSeed:0}),this.noise=t,this.seed=e}get noise(){return this.uniforms.uNoise}set noise(t){this.uniforms.uNoise=t}get seed(){return this.uniforms.uSeed}set seed(t){this.uniforms.uSeed=t}}const go={AlphaFilter:ao,BlurFilter:co,BlurFilterPass:uo,ColorMatrixFilter:fo,DisplacementFilter:po,FXAAFilter:_o,NoiseFilter:mo};Object.entries(go).forEach((([t,e])=>{Object.defineProperty(go,t,{get:()=>(Qt("7.1.0",`filters.${t} has moved to ${t}`),e)})}));const yo=new class{constructor(){this.interactionFrequency=10,this._deltaTime=0,this._didMove=!1,this.tickerAdded=!1,this._pauseUpdate=!0}init(t){this.removeTickerListener(),this.events=t,this.interactionFrequency=10,this._deltaTime=0,this._didMove=!1,this.tickerAdded=!1,this._pauseUpdate=!0}get pauseUpdate(){return this._pauseUpdate}set pauseUpdate(t){this._pauseUpdate=t}addTickerListener(){this.tickerAdded||!this.domElement||(Cn.system.add(this.tickerUpdate,this,En.INTERACTION),this.tickerAdded=!0)}removeTickerListener(){this.tickerAdded&&(Cn.system.remove(this.tickerUpdate,this),this.tickerAdded=!1)}pointerMoved(){this._didMove=!0}update(){if(!this.domElement||this._pauseUpdate)return;if(this._didMove)return void(this._didMove=!1);const t=this.events.rootPointerEvent;this.events.supportsTouchEvents&&"touch"===t.pointerType||globalThis.document.dispatchEvent(new PointerEvent("pointermove",{clientX:t.clientX,clientY:t.clientY}))}tickerUpdate(t){this._deltaTime+=t,!(this._deltaTime<this.interactionFrequency)&&(this._deltaTime=0,this.update())}};class bo{constructor(t){this.bubbles=!0,this.cancelBubble=!0,this.cancelable=!1,this.composed=!1,this.defaultPrevented=!1,this.eventPhase=bo.prototype.NONE,this.propagationStopped=!1,this.propagationImmediatelyStopped=!1,this.layer=new ni,this.page=new ni,this.NONE=0,this.CAPTURING_PHASE=1,this.AT_TARGET=2,this.BUBBLING_PHASE=3,this.manager=t}get layerX(){return this.layer.x}get layerY(){return this.layer.y}get pageX(){return this.page.x}get pageY(){return this.page.y}get data(){return this}composedPath(){return this.manager&&(!this.path||this.path[this.path.length-1]!==this.target)&&(this.path=this.target?this.manager.propagationPath(this.target):[]),this.path}initEvent(t,e,r){throw new Error("initEvent() is a legacy DOM API. It is not implemented in the Federated Events API.")}initUIEvent(t,e,r,i,s){throw new Error("initUIEvent() is a legacy DOM API. It is not implemented in the Federated Events API.")}preventDefault(){this.nativeEvent instanceof Event&&this.nativeEvent.cancelable&&this.nativeEvent.preventDefault(),this.defaultPrevented=!0}stopImmediatePropagation(){this.propagationImmediatelyStopped=!0}stopPropagation(){this.propagationStopped=!0}}class vo extends bo{constructor(){super(...arguments),this.client=new ni,this.movement=new ni,this.offset=new ni,this.global=new ni,this.screen=new ni}get clientX(){return this.client.x}get clientY(){return this.client.y}get x(){return this.clientX}get y(){return this.clientY}get movementX(){return this.movement.x}get movementY(){return this.movement.y}get offsetX(){return this.offset.x}get offsetY(){return this.offset.y}get globalX(){return this.global.x}get globalY(){return this.global.y}get screenX(){return this.screen.x}get screenY(){return this.screen.y}getLocalPosition(t,e,r){return t.worldTransform.applyInverse(r||this.global,e)}getModifierState(t){return"getModifierState"in this.nativeEvent&&this.nativeEvent.getModifierState(t)}initMouseEvent(t,e,r,i,s,n,o,a,h,l,u,c,d,f,p){throw new Error("Method not implemented.")}}class xo extends vo{constructor(){super(...arguments),this.width=0,this.height=0,this.isPrimary=!1}getCoalescedEvents(){return"pointermove"===this.type||"mousemove"===this.type||"touchmove"===this.type?[this]:[]}getPredictedEvents(){throw new Error("getPredictedEvents is not supported!")}}class Ao extends vo{constructor(){super(...arguments),this.DOM_DELTA_PIXEL=0,this.DOM_DELTA_LINE=1,this.DOM_DELTA_PAGE=2}}Ao.DOM_DELTA_PIXEL=0,Ao.DOM_DELTA_LINE=1,Ao.DOM_DELTA_PAGE=2;const To=new ni,Eo=new ni;class wo{constructor(t){this.dispatch=new W,this.moveOnAll=!1,this.enableGlobalMoveEvents=!0,this.mappingState={trackingData:{}},this.eventPool=new Map,this._allInteractiveElements=[],this._hitElements=[],this._isPointerMoveEvent=!1,this.rootTarget=t,this.hitPruneFn=this.hitPruneFn.bind(this),this.hitTestFn=this.hitTestFn.bind(this),this.mapPointerDown=this.mapPointerDown.bind(this),this.mapPointerMove=this.mapPointerMove.bind(this),this.mapPointerOut=this.mapPointerOut.bind(this),this.mapPointerOver=this.mapPointerOver.bind(this),this.mapPointerUp=this.mapPointerUp.bind(this),this.mapPointerUpOutside=this.mapPointerUpOutside.bind(this),this.mapWheel=this.mapWheel.bind(this),this.mappingTable={},this.addEventMapping("pointerdown",this.mapPointerDown),this.addEventMapping("pointermove",this.mapPointerMove),this.addEventMapping("pointerout",this.mapPointerOut),this.addEventMapping("pointerleave",this.mapPointerOut),this.addEventMapping("pointerover",this.mapPointerOver),this.addEventMapping("pointerup",this.mapPointerUp),this.addEventMapping("pointerupoutside",this.mapPointerUpOutside),this.addEventMapping("wheel",this.mapWheel)}addEventMapping(t,e){this.mappingTable[t]||(this.mappingTable[t]=[]),this.mappingTable[t].push({fn:e,priority:0}),this.mappingTable[t].sort(((t,e)=>t.priority-e.priority))}dispatchEvent(t,e){t.propagationStopped=!1,t.propagationImmediatelyStopped=!1,this.propagate(t,e),this.dispatch.emit(e||t.type,t)}mapEvent(t){if(!this.rootTarget)return;const e=this.mappingTable[t.type];if(e)for(let r=0,i=e.length;r<i;r++)e[r].fn(t);else console.warn(`[EventBoundary]: Event mapping not defined for ${t.type}`)}hitTest(t,e){yo.pauseUpdate=!0;const r=this[this._isPointerMoveEvent&&this.enableGlobalMoveEvents?"hitTestMoveRecursive":"hitTestRecursive"](this.rootTarget,this.rootTarget.eventMode,To.set(t,e),this.hitTestFn,this.hitPruneFn);return r&&r[0]}propagate(t,e){if(!t.target)return;const r=t.composedPath();t.eventPhase=t.CAPTURING_PHASE;for(let i=0,s=r.length-1;i<s;i++)if(t.currentTarget=r[i],this.notifyTarget(t,e),t.propagationStopped||t.propagationImmediatelyStopped)return;if(t.eventPhase=t.AT_TARGET,t.currentTarget=t.target,this.notifyTarget(t,e),!t.propagationStopped&&!t.propagationImmediatelyStopped){t.eventPhase=t.BUBBLING_PHASE;for(let i=r.length-2;i>=0;i--)if(t.currentTarget=r[i],this.notifyTarget(t,e),t.propagationStopped||t.propagationImmediatelyStopped)return}}all(t,e,r=this._allInteractiveElements){if(0===r.length)return;t.eventPhase=t.BUBBLING_PHASE;const i=Array.isArray(e)?e:[e];for(let e=r.length-1;e>=0;e--)i.forEach((i=>{t.currentTarget=r[e],this.notifyTarget(t,i)}))}propagationPath(t){const e=[t];for(let r=0;r<2048&&t!==this.rootTarget;r++){if(!t.parent)throw new Error("Cannot find propagation path to disconnected target");e.push(t.parent),t=t.parent}return e.reverse(),e}hitTestMoveRecursive(t,e,r,i,s,n=!1){let o=!1;if(this._interactivePrune(t))return null;if(("dynamic"===t.eventMode||"dynamic"===e)&&(yo.pauseUpdate=!1),t.interactiveChildren&&t.children){const a=t.children;for(let h=a.length-1;h>=0;h--){const l=a[h],u=this.hitTestMoveRecursive(l,this._isInteractive(e)?e:l.eventMode,r,i,s,n||s(t,r));if(u){if(u.length>0&&!u[u.length-1].parent)continue;const e=t.isInteractive();(u.length>0||e)&&(e&&this._allInteractiveElements.push(t),u.push(t)),0===this._hitElements.length&&(this._hitElements=u),o=!0}}}const a=this._isInteractive(e),h=t.isInteractive();return a&&h&&this._allInteractiveElements.push(t),n||this._hitElements.length>0?null:o?this._hitElements:a&&!s(t,r)&&i(t,r)?h?[t]:[]:null}hitTestRecursive(t,e,r,i,s){if(this._interactivePrune(t)||s(t,r))return null;if(("dynamic"===t.eventMode||"dynamic"===e)&&(yo.pauseUpdate=!1),t.interactiveChildren&&t.children){const n=t.children;for(let o=n.length-1;o>=0;o--){const a=n[o],h=this.hitTestRecursive(a,this._isInteractive(e)?e:a.eventMode,r,i,s);if(h){if(h.length>0&&!h[h.length-1].parent)continue;const e=t.isInteractive();return(h.length>0||e)&&h.push(t),h}}}const n=this._isInteractive(e),o=t.isInteractive();return n&&i(t,r)?o?[t]:[]:null}_isInteractive(t){return"static"===t||"dynamic"===t}_interactivePrune(t){return!(t&&!t.isMask&&t.visible&&t.renderable&&"none"!==t.eventMode&&("passive"!==t.eventMode||t.interactiveChildren)&&!t.isMask)}hitPruneFn(t,e){var r;if(t.hitArea&&(t.worldTransform.applyInverse(e,Eo),!t.hitArea.contains(Eo.x,Eo.y)))return!0;if(t._mask){const i=t._mask.isMaskData?t._mask.maskObject:t._mask;if(i&&(null==(r=i.containsPoint)||!r.call(i,e)))return!0}return!1}hitTestFn(t,e){return"passive"!==t.eventMode&&(!!t.hitArea||!!t.containsPoint&&t.containsPoint(e))}notifyTarget(t,e){var r,i;const s=`on${e=null!=e?e:t.type}`;null==(i=(r=t.currentTarget)[s])||i.call(r,t);const n=t.eventPhase===t.CAPTURING_PHASE||t.eventPhase===t.AT_TARGET?`${e}capture`:e;this.notifyListeners(t,n),t.eventPhase===t.AT_TARGET&&this.notifyListeners(t,e)}mapPointerDown(t){if(!(t instanceof xo))return void console.warn("EventBoundary cannot map a non-pointer event as a pointer event");const e=this.createPointerEvent(t);if(this.dispatchEvent(e,"pointerdown"),"touch"===e.pointerType)this.dispatchEvent(e,"touchstart");else if("mouse"===e.pointerType||"pen"===e.pointerType){const t=2===e.button;this.dispatchEvent(e,t?"rightdown":"mousedown")}this.trackingData(t.pointerId).pressTargetsByButton[t.button]=e.composedPath(),this.freeEvent(e)}mapPointerMove(t){var e,r,i;if(!(t instanceof xo))return void console.warn("EventBoundary cannot map a non-pointer event as a pointer event");this._allInteractiveElements.length=0,this._hitElements.length=0,this._isPointerMoveEvent=!0;const s=this.createPointerEvent(t);this._isPointerMoveEvent=!1;const n="mouse"===s.pointerType||"pen"===s.pointerType,o=this.trackingData(t.pointerId),a=this.findMountedTarget(o.overTargets);if((null==(e=o.overTargets)?void 0:e.length)>0&&a!==s.target){const e="mousemove"===t.type?"mouseout":"pointerout",r=this.createPointerEvent(t,e,a);if(this.dispatchEvent(r,"pointerout"),n&&this.dispatchEvent(r,"mouseout"),!s.composedPath().includes(a)){const e=this.createPointerEvent(t,"pointerleave",a);for(e.eventPhase=e.AT_TARGET;e.target&&!s.composedPath().includes(e.target);)e.currentTarget=e.target,this.notifyTarget(e),n&&this.notifyTarget(e,"mouseleave"),e.target=e.target.parent;this.freeEvent(e)}this.freeEvent(r)}if(a!==s.target){const e="mousemove"===t.type?"mouseover":"pointerover",r=this.clonePointerEvent(s,e);this.dispatchEvent(r,"pointerover"),n&&this.dispatchEvent(r,"mouseover");let i=null==a?void 0:a.parent;for(;i&&i!==this.rootTarget.parent&&i!==s.target;)i=i.parent;if(!i||i===this.rootTarget.parent){const t=this.clonePointerEvent(s,"pointerenter");for(t.eventPhase=t.AT_TARGET;t.target&&t.target!==a&&t.target!==this.rootTarget.parent;)t.currentTarget=t.target,this.notifyTarget(t),n&&this.notifyTarget(t,"mouseenter"),t.target=t.target.parent;this.freeEvent(t)}this.freeEvent(r)}const h=[],l=null==(r=this.enableGlobalMoveEvents)||r;this.moveOnAll?h.push("pointermove"):this.dispatchEvent(s,"pointermove"),l&&h.push("globalpointermove"),"touch"===s.pointerType&&(this.moveOnAll?h.splice(1,0,"touchmove"):this.dispatchEvent(s,"touchmove"),l&&h.push("globaltouchmove")),n&&(this.moveOnAll?h.splice(1,0,"mousemove"):this.dispatchEvent(s,"mousemove"),l&&h.push("globalmousemove"),this.cursor=null==(i=s.target)?void 0:i.cursor),h.length>0&&this.all(s,h),this._allInteractiveElements.length=0,this._hitElements.length=0,o.overTargets=s.composedPath(),this.freeEvent(s)}mapPointerOver(t){var e;if(!(t instanceof xo))return void console.warn("EventBoundary cannot map a non-pointer event as a pointer event");const r=this.trackingData(t.pointerId),i=this.createPointerEvent(t),s="mouse"===i.pointerType||"pen"===i.pointerType;this.dispatchEvent(i,"pointerover"),s&&this.dispatchEvent(i,"mouseover"),"mouse"===i.pointerType&&(this.cursor=null==(e=i.target)?void 0:e.cursor);const n=this.clonePointerEvent(i,"pointerenter");for(n.eventPhase=n.AT_TARGET;n.target&&n.target!==this.rootTarget.parent;)n.currentTarget=n.target,this.notifyTarget(n),s&&this.notifyTarget(n,"mouseenter"),n.target=n.target.parent;r.overTargets=i.composedPath(),this.freeEvent(i),this.freeEvent(n)}mapPointerOut(t){if(!(t instanceof xo))return void console.warn("EventBoundary cannot map a non-pointer event as a pointer event");const e=this.trackingData(t.pointerId);if(e.overTargets){const r="mouse"===t.pointerType||"pen"===t.pointerType,i=this.findMountedTarget(e.overTargets),s=this.createPointerEvent(t,"pointerout",i);this.dispatchEvent(s),r&&this.dispatchEvent(s,"mouseout");const n=this.createPointerEvent(t,"pointerleave",i);for(n.eventPhase=n.AT_TARGET;n.target&&n.target!==this.rootTarget.parent;)n.currentTarget=n.target,this.notifyTarget(n),r&&this.notifyTarget(n,"mouseleave"),n.target=n.target.parent;e.overTargets=null,this.freeEvent(s),this.freeEvent(n)}this.cursor=null}mapPointerUp(t){if(!(t instanceof xo))return void console.warn("EventBoundary cannot map a non-pointer event as a pointer event");const e=performance.now(),r=this.createPointerEvent(t);if(this.dispatchEvent(r,"pointerup"),"touch"===r.pointerType)this.dispatchEvent(r,"touchend");else if("mouse"===r.pointerType||"pen"===r.pointerType){const t=2===r.button;this.dispatchEvent(r,t?"rightup":"mouseup")}const i=this.trackingData(t.pointerId),s=this.findMountedTarget(i.pressTargetsByButton[t.button]);let n=s;if(s&&!r.composedPath().includes(s)){let e=s;for(;e&&!r.composedPath().includes(e);){if(r.currentTarget=e,this.notifyTarget(r,"pointerupoutside"),"touch"===r.pointerType)this.notifyTarget(r,"touchendoutside");else if("mouse"===r.pointerType||"pen"===r.pointerType){const t=2===r.button;this.notifyTarget(r,t?"rightupoutside":"mouseupoutside")}e=e.parent}delete i.pressTargetsByButton[t.button],n=e}if(n){const s=this.clonePointerEvent(r,"click");s.target=n,s.path=null,i.clicksByButton[t.button]||(i.clicksByButton[t.button]={clickCount:0,target:s.target,timeStamp:e});const o=i.clicksByButton[t.button];if(o.target===s.target&&e-o.timeStamp<200?++o.clickCount:o.clickCount=1,o.target=s.target,o.timeStamp=e,s.detail=o.clickCount,"mouse"===s.pointerType){const t=2===s.button;this.dispatchEvent(s,t?"rightclick":"click")}else"touch"===s.pointerType&&this.dispatchEvent(s,"tap");this.dispatchEvent(s,"pointertap"),this.freeEvent(s)}this.freeEvent(r)}mapPointerUpOutside(t){if(!(t instanceof xo))return void console.warn("EventBoundary cannot map a non-pointer event as a pointer event");const e=this.trackingData(t.pointerId),r=this.findMountedTarget(e.pressTargetsByButton[t.button]),i=this.createPointerEvent(t);if(r){let s=r;for(;s;)i.currentTarget=s,this.notifyTarget(i,"pointerupoutside"),"touch"===i.pointerType?this.notifyTarget(i,"touchendoutside"):("mouse"===i.pointerType||"pen"===i.pointerType)&&this.notifyTarget(i,2===i.button?"rightupoutside":"mouseupoutside"),s=s.parent;delete e.pressTargetsByButton[t.button]}this.freeEvent(i)}mapWheel(t){if(!(t instanceof Ao))return void console.warn("EventBoundary cannot map a non-wheel event as a wheel event");const e=this.createWheelEvent(t);this.dispatchEvent(e),this.freeEvent(e)}findMountedTarget(t){if(!t)return null;let e=t[0];for(let r=1;r<t.length&&t[r].parent===e;r++)e=t[r];return e}createPointerEvent(t,e,r){var i;const s=this.allocateEvent(xo);return this.copyPointerData(t,s),this.copyMouseData(t,s),this.copyData(t,s),s.nativeEvent=t.nativeEvent,s.originalEvent=t,s.target=null!=(i=null!=r?r:this.hitTest(s.global.x,s.global.y))?i:this._hitElements[0],"string"==typeof e&&(s.type=e),s}createWheelEvent(t){const e=this.allocateEvent(Ao);return this.copyWheelData(t,e),this.copyMouseData(t,e),this.copyData(t,e),e.nativeEvent=t.nativeEvent,e.originalEvent=t,e.target=this.hitTest(e.global.x,e.global.y),e}clonePointerEvent(t,e){const r=this.allocateEvent(xo);return r.nativeEvent=t.nativeEvent,r.originalEvent=t.originalEvent,this.copyPointerData(t,r),this.copyMouseData(t,r),this.copyData(t,r),r.target=t.target,r.path=t.composedPath().slice(),r.type=null!=e?e:r.type,r}copyWheelData(t,e){e.deltaMode=t.deltaMode,e.deltaX=t.deltaX,e.deltaY=t.deltaY,e.deltaZ=t.deltaZ}copyPointerData(t,e){t instanceof xo&&e instanceof xo&&(e.pointerId=t.pointerId,e.width=t.width,e.height=t.height,e.isPrimary=t.isPrimary,e.pointerType=t.pointerType,e.pressure=t.pressure,e.tangentialPressure=t.tangentialPressure,e.tiltX=t.tiltX,e.tiltY=t.tiltY,e.twist=t.twist)}copyMouseData(t,e){t instanceof vo&&e instanceof vo&&(e.altKey=t.altKey,e.button=t.button,e.buttons=t.buttons,e.client.copyFrom(t.client),e.ctrlKey=t.ctrlKey,e.metaKey=t.metaKey,e.movement.copyFrom(t.movement),e.screen.copyFrom(t.screen),e.shiftKey=t.shiftKey,e.global.copyFrom(t.global))}copyData(t,e){e.isTrusted=t.isTrusted,e.srcElement=t.srcElement,e.timeStamp=performance.now(),e.type=t.type,e.detail=t.detail,e.view=t.view,e.which=t.which,e.layer.copyFrom(t.layer),e.page.copyFrom(t.page)}trackingData(t){return this.mappingState.trackingData[t]||(this.mappingState.trackingData[t]={pressTargetsByButton:{},clicksByButton:{},overTarget:null}),this.mappingState.trackingData[t]}allocateEvent(t){this.eventPool.has(t)||this.eventPool.set(t,[]);const e=this.eventPool.get(t).pop()||new t(this);return e.eventPhase=e.NONE,e.currentTarget=null,e.path=null,e.target=null,e}freeEvent(t){if(t.manager!==this)throw new Error("It is illegal to free an event not managed by this EventBoundary!");const e=t.constructor;this.eventPool.has(e)||this.eventPool.set(e,[]),this.eventPool.get(e).push(t)}notifyListeners(t,e){const r=t.currentTarget._events[e];if(r&&t.currentTarget.isInteractive())if("fn"in r)r.once&&t.currentTarget.removeListener(e,r.fn,void 0,!0),r.fn.call(r.context,t);else for(let i=0,s=r.length;i<s&&!t.propagationImmediatelyStopped;i++)r[i].once&&t.currentTarget.removeListener(e,r[i].fn,void 0,!0),r[i].fn.call(r[i].context,t)}}var So=Object.defineProperty,Co=Object.getOwnPropertySymbols,Po=Object.prototype.hasOwnProperty,Mo=Object.prototype.propertyIsEnumerable,$o=(t,e,r)=>e in t?So(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r;const Io={touchstart:"pointerdown",touchend:"pointerup",touchendoutside:"pointerupoutside",touchmove:"pointermove",touchcancel:"pointercancel"},Ro=class t{constructor(e){this.supportsTouchEvents="ontouchstart"in globalThis,this.supportsPointerEvents=!!globalThis.PointerEvent,this.domElement=null,this.resolution=1,this.renderer=e,this.rootBoundary=new wo(null),yo.init(this),this.autoPreventDefault=!0,this.eventsAdded=!1,this.rootPointerEvent=new xo(null),this.rootWheelEvent=new Ao(null),this.cursorStyles={default:"inherit",pointer:"pointer"},this.features=new Proxy(((t,e)=>{for(var r in e||(e={}))Po.call(e,r)&&$o(t,r,e[r]);if(Co)for(var r of Co(e))Mo.call(e,r)&&$o(t,r,e[r]);return t})({},t.defaultEventFeatures),{set:(t,e,r)=>("globalMove"===e&&(this.rootBoundary.enableGlobalMoveEvents=r),t[e]=r,!0)}),this.onPointerDown=this.onPointerDown.bind(this),this.onPointerMove=this.onPointerMove.bind(this),this.onPointerUp=this.onPointerUp.bind(this),this.onPointerOverOut=this.onPointerOverOut.bind(this),this.onWheel=this.onWheel.bind(this)}static get defaultEventMode(){return this._defaultEventMode}init(e){var r,i;const{view:s,resolution:n}=this.renderer;this.setTargetElement(s),this.resolution=n,t._defaultEventMode=null!=(r=e.eventMode)?r:"auto",Object.assign(this.features,null!=(i=e.eventFeatures)?i:{}),this.rootBoundary.enableGlobalMoveEvents=this.features.globalMove}resolutionChange(t){this.resolution=t}destroy(){this.setTargetElement(null),this.renderer=null}setCursor(t){t=t||"default";let e=!0;if(globalThis.OffscreenCanvas&&this.domElement instanceof OffscreenCanvas&&(e=!1),this.currentCursor===t)return;this.currentCursor=t;const r=this.cursorStyles[t];if(r)switch(typeof r){case"string":e&&(this.domElement.style.cursor=r);break;case"function":r(t);break;case"object":e&&Object.assign(this.domElement.style,r)}else e&&"string"==typeof t&&!Object.prototype.hasOwnProperty.call(this.cursorStyles,t)&&(this.domElement.style.cursor=t)}get pointer(){return this.rootPointerEvent}onPointerDown(t){if(!this.features.click)return;this.rootBoundary.rootTarget=this.renderer.lastObjectRendered;const e=this.normalizeToPointerData(t);this.autoPreventDefault&&e[0].isNormalized&&(t.cancelable||!("cancelable"in t))&&t.preventDefault();for(let t=0,r=e.length;t<r;t++){const r=e[t],i=this.bootstrapEvent(this.rootPointerEvent,r);this.rootBoundary.mapEvent(i)}this.setCursor(this.rootBoundary.cursor)}onPointerMove(t){if(!this.features.move)return;this.rootBoundary.rootTarget=this.renderer.lastObjectRendered,yo.pointerMoved();const e=this.normalizeToPointerData(t);for(let t=0,r=e.length;t<r;t++){const r=this.bootstrapEvent(this.rootPointerEvent,e[t]);this.rootBoundary.mapEvent(r)}this.setCursor(this.rootBoundary.cursor)}onPointerUp(t){if(!this.features.click)return;this.rootBoundary.rootTarget=this.renderer.lastObjectRendered;let e=t.target;t.composedPath&&t.composedPath().length>0&&(e=t.composedPath()[0]);const r=e!==this.domElement?"outside":"",i=this.normalizeToPointerData(t);for(let t=0,e=i.length;t<e;t++){const e=this.bootstrapEvent(this.rootPointerEvent,i[t]);e.type+=r,this.rootBoundary.mapEvent(e)}this.setCursor(this.rootBoundary.cursor)}onPointerOverOut(t){if(!this.features.click)return;this.rootBoundary.rootTarget=this.renderer.lastObjectRendered;const e=this.normalizeToPointerData(t);for(let t=0,r=e.length;t<r;t++){const r=this.bootstrapEvent(this.rootPointerEvent,e[t]);this.rootBoundary.mapEvent(r)}this.setCursor(this.rootBoundary.cursor)}onWheel(t){if(!this.features.wheel)return;const e=this.normalizeWheelEvent(t);this.rootBoundary.rootTarget=this.renderer.lastObjectRendered,this.rootBoundary.mapEvent(e)}setTargetElement(t){this.removeEvents(),this.domElement=t,yo.domElement=t,this.addEvents()}addEvents(){if(this.eventsAdded||!this.domElement)return;yo.addTickerListener();const t=this.domElement.style;t&&(globalThis.navigator.msPointerEnabled?(t.msContentZooming="none",t.msTouchAction="none"):this.supportsPointerEvents&&(t.touchAction="none")),this.supportsPointerEvents?(globalThis.document.addEventListener("pointermove",this.onPointerMove,!0),this.domElement.addEventListener("pointerdown",this.onPointerDown,!0),this.domElement.addEventListener("pointerleave",this.onPointerOverOut,!0),this.domElement.addEventListener("pointerover",this.onPointerOverOut,!0),globalThis.addEventListener("pointerup",this.onPointerUp,!0)):(globalThis.document.addEventListener("mousemove",this.onPointerMove,!0),this.domElement.addEventListener("mousedown",this.onPointerDown,!0),this.domElement.addEventListener("mouseout",this.onPointerOverOut,!0),this.domElement.addEventListener("mouseover",this.onPointerOverOut,!0),globalThis.addEventListener("mouseup",this.onPointerUp,!0),this.supportsTouchEvents&&(this.domElement.addEventListener("touchstart",this.onPointerDown,!0),this.domElement.addEventListener("touchend",this.onPointerUp,!0),this.domElement.addEventListener("touchmove",this.onPointerMove,!0))),this.domElement.addEventListener("wheel",this.onWheel,{passive:!0,capture:!0}),this.eventsAdded=!0}removeEvents(){if(!this.eventsAdded||!this.domElement)return;yo.removeTickerListener();const t=this.domElement.style;globalThis.navigator.msPointerEnabled?(t.msContentZooming="",t.msTouchAction=""):this.supportsPointerEvents&&(t.touchAction=""),this.supportsPointerEvents?(globalThis.document.removeEventListener("pointermove",this.onPointerMove,!0),this.domElement.removeEventListener("pointerdown",this.onPointerDown,!0),this.domElement.removeEventListener("pointerleave",this.onPointerOverOut,!0),this.domElement.removeEventListener("pointerover",this.onPointerOverOut,!0),globalThis.removeEventListener("pointerup",this.onPointerUp,!0)):(globalThis.document.removeEventListener("mousemove",this.onPointerMove,!0),this.domElement.removeEventListener("mousedown",this.onPointerDown,!0),this.domElement.removeEventListener("mouseout",this.onPointerOverOut,!0),this.domElement.removeEventListener("mouseover",this.onPointerOverOut,!0),globalThis.removeEventListener("mouseup",this.onPointerUp,!0),this.supportsTouchEvents&&(this.domElement.removeEventListener("touchstart",this.onPointerDown,!0),this.domElement.removeEventListener("touchend",this.onPointerUp,!0),this.domElement.removeEventListener("touchmove",this.onPointerMove,!0))),this.domElement.removeEventListener("wheel",this.onWheel,!0),this.domElement=null,this.eventsAdded=!1}mapPositionToPoint(t,e,r){const i=this.domElement.isConnected?this.domElement.getBoundingClientRect():{x:0,y:0,width:this.domElement.width,height:this.domElement.height,left:0,top:0},s=1/this.resolution;t.x=(e-i.left)*(this.domElement.width/i.width)*s,t.y=(r-i.top)*(this.domElement.height/i.height)*s}normalizeToPointerData(t){const e=[];if(this.supportsTouchEvents&&t instanceof TouchEvent)for(let r=0,i=t.changedTouches.length;r<i;r++){const i=t.changedTouches[r];void 0===i.button&&(i.button=0),void 0===i.buttons&&(i.buttons=1),void 0===i.isPrimary&&(i.isPrimary=1===t.touches.length&&"touchstart"===t.type),void 0===i.width&&(i.width=i.radiusX||1),void 0===i.height&&(i.height=i.radiusY||1),void 0===i.tiltX&&(i.tiltX=0),void 0===i.tiltY&&(i.tiltY=0),void 0===i.pointerType&&(i.pointerType="touch"),void 0===i.pointerId&&(i.pointerId=i.identifier||0),void 0===i.pressure&&(i.pressure=i.force||.5),void 0===i.twist&&(i.twist=0),void 0===i.tangentialPressure&&(i.tangentialPressure=0),void 0===i.layerX&&(i.layerX=i.offsetX=i.clientX),void 0===i.layerY&&(i.layerY=i.offsetY=i.clientY),i.isNormalized=!0,i.type=t.type,e.push(i)}else if(globalThis.MouseEvent&&(!(t instanceof MouseEvent)||this.supportsPointerEvents&&t instanceof globalThis.PointerEvent))e.push(t);else{const r=t;void 0===r.isPrimary&&(r.isPrimary=!0),void 0===r.width&&(r.width=1),void 0===r.height&&(r.height=1),void 0===r.tiltX&&(r.tiltX=0),void 0===r.tiltY&&(r.tiltY=0),void 0===r.pointerType&&(r.pointerType="mouse"),void 0===r.pointerId&&(r.pointerId=1),void 0===r.pressure&&(r.pressure=.5),void 0===r.twist&&(r.twist=0),void 0===r.tangentialPressure&&(r.tangentialPressure=0),r.isNormalized=!0,e.push(r)}return e}normalizeWheelEvent(t){const e=this.rootWheelEvent;return this.transferMouseData(e,t),e.deltaX=t.deltaX,e.deltaY=t.deltaY,e.deltaZ=t.deltaZ,e.deltaMode=t.deltaMode,this.mapPositionToPoint(e.screen,t.clientX,t.clientY),e.global.copyFrom(e.screen),e.offset.copyFrom(e.screen),e.nativeEvent=t,e.type=t.type,e}bootstrapEvent(t,e){return t.originalEvent=null,t.nativeEvent=e,t.pointerId=e.pointerId,t.width=e.width,t.height=e.height,t.isPrimary=e.isPrimary,t.pointerType=e.pointerType,t.pressure=e.pressure,t.tangentialPressure=e.tangentialPressure,t.tiltX=e.tiltX,t.tiltY=e.tiltY,t.twist=e.twist,this.transferMouseData(t,e),this.mapPositionToPoint(t.screen,e.clientX,e.clientY),t.global.copyFrom(t.screen),t.offset.copyFrom(t.screen),t.isTrusted=e.isTrusted,"pointerleave"===t.type&&(t.type="pointerout"),t.type.startsWith("mouse")&&(t.type=t.type.replace("mouse","pointer")),t.type.startsWith("touch")&&(t.type=Io[t.type]||t.type),t}transferMouseData(t,e){t.isTrusted=e.isTrusted,t.srcElement=e.srcElement,t.timeStamp=performance.now(),t.type=e.type,t.altKey=e.altKey,t.button=e.button,t.buttons=e.buttons,t.client.x=e.clientX,t.client.y=e.clientY,t.ctrlKey=e.ctrlKey,t.metaKey=e.metaKey,t.movement.x=e.movementX,t.movement.y=e.movementY,t.page.x=e.pageX,t.page.y=e.pageY,t.relatedTarget=null,t.shiftKey=e.shiftKey}};Ro.extension={name:"events",type:[Tr.RendererSystem,Tr.CanvasRendererSystem]},Ro.defaultEventFeatures={move:!0,globalMove:!0,click:!0,wheel:!0};let Do=Ro;function Lo(t){return"dynamic"===t||"static"===t}Sr.add(Do);const Fo={onclick:null,onmousedown:null,onmouseenter:null,onmouseleave:null,onmousemove:null,onglobalmousemove:null,onmouseout:null,onmouseover:null,onmouseup:null,onmouseupoutside:null,onpointercancel:null,onpointerdown:null,onpointerenter:null,onpointerleave:null,onpointermove:null,onglobalpointermove:null,onpointerout:null,onpointerover:null,onpointertap:null,onpointerup:null,onpointerupoutside:null,onrightclick:null,onrightdown:null,onrightup:null,onrightupoutside:null,ontap:null,ontouchcancel:null,ontouchend:null,ontouchendoutside:null,ontouchmove:null,onglobaltouchmove:null,ontouchstart:null,onwheel:null,_internalInteractive:void 0,get interactive(){var t;return null!=(t=this._internalInteractive)?t:Lo(Do.defaultEventMode)},set interactive(t){this._internalInteractive=t,this.eventMode=t?"static":"auto"},_internalEventMode:void 0,get eventMode(){var t;return null!=(t=this._internalEventMode)?t:Do.defaultEventMode},set eventMode(t){this._internalInteractive=Lo(t),this._internalEventMode=t},isInteractive(){return"static"===this.eventMode||"dynamic"===this.eventMode},interactiveChildren:!0,hitArea:null,addEventListener(t,e,r){const i="boolean"==typeof r&&r||"object"==typeof r&&r.capture,s="object"==typeof r?r.signal:void 0,n="object"==typeof r&&!0===r.once,o="function"==typeof e?void 0:e;t=i?`${t}capture`:t;const a="function"==typeof e?e:e.handleEvent,h=this;s&&s.addEventListener("abort",(()=>{h.off(t,a,o)})),n?h.once(t,a,o):h.on(t,a,o)},removeEventListener(t,e,r){const i="function"==typeof e?void 0:e;t="boolean"==typeof r&&r||"object"==typeof r&&r.capture?`${t}capture`:t,e="function"==typeof e?e:e.handleEvent,this.off(t,e,i)},dispatchEvent(t){if(!(t instanceof bo))throw new Error("DisplayObject cannot propagate events outside of the Federated Events API");return t.defaultPrevented=!1,t.path=null,t.target=this,t.manager.dispatchEvent(t),!t.defaultPrevented}};Zn.mixin(Fo);const Oo={accessible:!1,accessibleTitle:null,accessibleHint:null,tabIndex:0,_accessibleActive:!1,_accessibleDiv:null,accessibleType:"button",accessiblePointerEvents:"auto",accessibleChildren:!0,renderId:-1};Zn.mixin(Oo);class ko{constructor(t){this.debug=!1,this._isActive=!1,this._isMobileAccessibility=!1,this.pool=[],this.renderId=0,this.children=[],this.androidUpdateCount=0,this.androidUpdateFrequency=500,this._hookDiv=null,(V.tablet||V.phone)&&this.createTouchHook();const e=document.createElement("div");e.style.width="100px",e.style.height="100px",e.style.position="absolute",e.style.top="0px",e.style.left="0px",e.style.zIndex=2..toString(),this.div=e,this.renderer=t,this._onKeyDown=this._onKeyDown.bind(this),this._onMouseMove=this._onMouseMove.bind(this),globalThis.addEventListener("keydown",this._onKeyDown,!1)}get isActive(){return this._isActive}get isMobileAccessibility(){return this._isMobileAccessibility}createTouchHook(){const t=document.createElement("button");t.style.width="1px",t.style.height="1px",t.style.position="absolute",t.style.top="-1000px",t.style.left="-1000px",t.style.zIndex=2..toString(),t.style.backgroundColor="#FF0000",t.title="select to enable accessibility for this content",t.addEventListener("focus",(()=>{this._isMobileAccessibility=!0,this.activate(),this.destroyTouchHook()})),document.body.appendChild(t),this._hookDiv=t}destroyTouchHook(){this._hookDiv&&(document.body.removeChild(this._hookDiv),this._hookDiv=null)}activate(){var t;this._isActive||(this._isActive=!0,globalThis.document.addEventListener("mousemove",this._onMouseMove,!0),globalThis.removeEventListener("keydown",this._onKeyDown,!1),this.renderer.on("postrender",this.update,this),null==(t=this.renderer.view.parentNode)||t.appendChild(this.div))}deactivate(){var t;!this._isActive||this._isMobileAccessibility||(this._isActive=!1,globalThis.document.removeEventListener("mousemove",this._onMouseMove,!0),globalThis.addEventListener("keydown",this._onKeyDown,!1),this.renderer.off("postrender",this.update),null==(t=this.div.parentNode)||t.removeChild(this.div))}updateAccessibleObjects(t){if(!t.visible||!t.accessibleChildren)return;t.accessible&&t.isInteractive()&&(t._accessibleActive||this.addChild(t),t.renderId=this.renderId);const e=t.children;if(e)for(let t=0;t<e.length;t++)this.updateAccessibleObjects(e[t])}update(){const t=performance.now();if(V.android.device&&t<this.androidUpdateCount||(this.androidUpdateCount=t+this.androidUpdateFrequency,!this.renderer.renderingToScreen))return;this.renderer.lastObjectRendered&&this.updateAccessibleObjects(this.renderer.lastObjectRendered);const{x:e,y:r,width:i,height:s}=this.renderer.view.getBoundingClientRect(),{width:n,height:o,resolution:a}=this.renderer,h=i/n*a,l=s/o*a;let u=this.div;u.style.left=`${e}px`,u.style.top=`${r}px`,u.style.width=`${n}px`,u.style.height=`${o}px`;for(let t=0;t<this.children.length;t++){const e=this.children[t];if(e.renderId!==this.renderId)e._accessibleActive=!1,Je(this.children,t,1),this.div.removeChild(e._accessibleDiv),this.pool.push(e._accessibleDiv),e._accessibleDiv=null,t--;else{u=e._accessibleDiv;let t=e.hitArea;const r=e.worldTransform;e.hitArea?(u.style.left=(r.tx+t.x*r.a)*h+"px",u.style.top=(r.ty+t.y*r.d)*l+"px",u.style.width=t.width*r.a*h+"px",u.style.height=t.height*r.d*l+"px"):(t=e.getBounds(),this.capHitArea(t),u.style.left=t.x*h+"px",u.style.top=t.y*l+"px",u.style.width=t.width*h+"px",u.style.height=t.height*l+"px",u.title!==e.accessibleTitle&&null!==e.accessibleTitle&&(u.title=e.accessibleTitle),u.getAttribute("aria-label")!==e.accessibleHint&&null!==e.accessibleHint&&u.setAttribute("aria-label",e.accessibleHint)),(e.accessibleTitle!==u.title||e.tabIndex!==u.tabIndex)&&(u.title=e.accessibleTitle,u.tabIndex=e.tabIndex,this.debug&&this.updateDebugHTML(u))}}this.renderId++}updateDebugHTML(t){t.innerHTML=`type: ${t.type}</br> title : ${t.title}</br> tabIndex: ${t.tabIndex}`}capHitArea(t){t.x<0&&(t.width+=t.x,t.x=0),t.y<0&&(t.height+=t.y,t.y=0);const{width:e,height:r}=this.renderer;t.x+t.width>e&&(t.width=e-t.x),t.y+t.height>r&&(t.height=r-t.y)}addChild(t){let e=this.pool.pop();e||(e=document.createElement("button"),e.style.width="100px",e.style.height="100px",e.style.backgroundColor=this.debug?"rgba(255,255,255,0.5)":"transparent",e.style.position="absolute",e.style.zIndex=2..toString(),e.style.borderStyle="none",navigator.userAgent.toLowerCase().includes("chrome")?e.setAttribute("aria-live","off"):e.setAttribute("aria-live","polite"),navigator.userAgent.match(/rv:.*Gecko\//)?e.setAttribute("aria-relevant","additions"):e.setAttribute("aria-relevant","text"),e.addEventListener("click",this._onClick.bind(this)),e.addEventListener("focus",this._onFocus.bind(this)),e.addEventListener("focusout",this._onFocusOut.bind(this))),e.style.pointerEvents=t.accessiblePointerEvents,e.type=t.accessibleType,t.accessibleTitle&&null!==t.accessibleTitle?e.title=t.accessibleTitle:(!t.accessibleHint||null===t.accessibleHint)&&(e.title=`displayObject ${t.tabIndex}`),t.accessibleHint&&null!==t.accessibleHint&&e.setAttribute("aria-label",t.accessibleHint),this.debug&&this.updateDebugHTML(e),t._accessibleActive=!0,t._accessibleDiv=e,e.displayObject=t,this.children.push(t),this.div.appendChild(t._accessibleDiv),t._accessibleDiv.tabIndex=t.tabIndex}_dispatchEvent(t,e){const{displayObject:r}=t.target,i=this.renderer.events.rootBoundary,s=Object.assign(new bo(i),{target:r});i.rootTarget=this.renderer.lastObjectRendered,e.forEach((t=>i.dispatchEvent(s,t)))}_onClick(t){this._dispatchEvent(t,["click","pointertap","tap"])}_onFocus(t){t.target.getAttribute("aria-live")||t.target.setAttribute("aria-live","assertive"),this._dispatchEvent(t,["mouseover"])}_onFocusOut(t){t.target.getAttribute("aria-live")||t.target.setAttribute("aria-live","polite"),this._dispatchEvent(t,["mouseout"])}_onKeyDown(t){9===t.keyCode&&this.activate()}_onMouseMove(t){0===t.movementX&&0===t.movementY||this.deactivate()}destroy(){this.destroyTouchHook(),this.div=null,globalThis.document.removeEventListener("mousemove",this._onMouseMove,!0),globalThis.removeEventListener("keydown",this._onKeyDown),this.pool=null,this.children=null,this.renderer=null}}ko.extension={name:"accessibility",type:[Tr.RendererPlugin,Tr.CanvasRendererPlugin]},Sr.add(ko);const Bo=class t{constructor(e){this.stage=new eo,e=Object.assign({forceCanvas:!1},e),this.renderer=$n(e),t._plugins.forEach((t=>{t.init.call(this,e)}))}render(){this.renderer.render(this.stage)}get view(){var t;return null==(t=this.renderer)?void 0:t.view}get screen(){var t;return null==(t=this.renderer)?void 0:t.screen}destroy(e,r){const i=t._plugins.slice(0);i.reverse(),i.forEach((t=>{t.destroy.call(this)})),this.stage.destroy(r),this.stage=null,this.renderer.destroy(e),this.renderer=null}};Bo._plugins=[];let No=Bo;Sr.handleByList(Tr.Application,No._plugins);class Uo{static init(t){Object.defineProperty(this,"resizeTo",{set(t){globalThis.removeEventListener("resize",this.queueResize),this._resizeTo=t,t&&(globalThis.addEventListener("resize",this.queueResize),this.resize())},get(){return this._resizeTo}}),this.queueResize=()=>{this._resizeTo&&(this.cancelResize(),this._resizeId=requestAnimationFrame((()=>this.resize())))},this.cancelResize=()=>{this._resizeId&&(cancelAnimationFrame(this._resizeId),this._resizeId=null)},this.resize=()=>{if(!this._resizeTo)return;let t,e;if(this.cancelResize(),this._resizeTo===globalThis.window)t=globalThis.innerWidth,e=globalThis.innerHeight;else{const{clientWidth:r,clientHeight:i}=this._resizeTo;t=r,e=i}this.renderer.resize(t,e),this.render()},this._resizeId=null,this._resizeTo=null,this.resizeTo=t.resizeTo||null}static destroy(){globalThis.removeEventListener("resize",this.queueResize),this.cancelResize(),this.cancelResize=null,this.queueResize=null,this.resizeTo=null,this.resize=null}}Uo.extension=Tr.Application,Sr.add(Uo);const Go={loader:Tr.LoadParser,resolver:Tr.ResolveParser,cache:Tr.CacheParser,detection:Tr.DetectionParser};Sr.handle(Tr.Asset,(t=>{const e=t.ref;Object.entries(Go).filter((([t])=>!!e[t])).forEach((([t,r])=>{var i;return Sr.add(Object.assign(e[t],{extension:null!=(i=e[t].extension)?i:r}))}))}),(t=>{const e=t.ref;Object.keys(Go).filter((t=>!!e[t])).forEach((t=>Sr.remove(e[t])))}));class Vo{constructor(t,e=!1){this._loader=t,this._assetList=[],this._isLoading=!1,this._maxConcurrent=1,this.verbose=e}add(t){t.forEach((t=>{this._assetList.push(t)})),this.verbose&&console.log("[BackgroundLoader] assets: ",this._assetList),this._isActive&&!this._isLoading&&this._next()}async _next(){if(this._assetList.length&&this._isActive){this._isLoading=!0;const t=[],e=Math.min(this._assetList.length,this._maxConcurrent);for(let r=0;r<e;r++)t.push(this._assetList.pop());await this._loader.load(t),this._isLoading=!1,this._next()}}get active(){return this._isActive}set active(t){this._isActive!==t&&(this._isActive=t,t&&!this._isLoading&&this._next())}}function Ho(t,e){if(Array.isArray(e)){for(const r of e)if(t.startsWith(`data:${r}`))return!0;return!1}return t.startsWith(`data:${e}`)}function zo(t,e){const r=t.split("?")[0],i=ee.extname(r).toLowerCase();return Array.isArray(e)?e.includes(i):i===e}const Xo=(t,e,r=!1)=>(Array.isArray(t)||(t=[t]),e?t.map((t=>"string"==typeof t||r?e(t):t)):t),Wo=(t,e)=>{const r=e.split("?")[1];return r&&(t+=`?${r}`),t};function Yo(t,e,r,i,s){const n=e[r];for(let o=0;o<n.length;o++){const a=n[o];r<e.length-1?Yo(t.replace(i[r],a),e,r+1,i,s):s.push(t.replace(i[r],a))}}function jo(t){const e=t.match(/\{(.*?)\}/g),r=[];if(e){const i=[];e.forEach((t=>{const e=t.substring(1,t.length-1).split(",");i.push(e)})),Yo(t,i,0,e,r)}else r.push(t);return r}const qo=t=>!Array.isArray(t);const Zo=new class{constructor(){this._parsers=[],this._cache=new Map,this._cacheMap=new Map}reset(){this._cacheMap.clear(),this._cache.clear()}has(t){return this._cache.has(t)}get(t){return this._cache.get(t)}set(t,e){const r=Xo(t);let i;for(let t=0;t<this.parsers.length;t++){const s=this.parsers[t];if(s.test(e)){i=s.getCacheableAssets(r,e);break}}i||(i={},r.forEach((t=>{i[t]=e})));const s=Object.keys(i),n={cacheKeys:s,keys:r};if(r.forEach((t=>{this._cacheMap.set(t,n)})),s.forEach((t=>{this._cache.has(t)&&this._cache.get(t),this._cache.set(t,i[t])})),e instanceof ps){const t=e;r.forEach((e=>{t.baseTexture!==ps.EMPTY.baseTexture&&zr.addToCache(t.baseTexture,e),ps.addToCache(t,e)}))}}remove(t){if(!this._cacheMap.has(t))return;const e=this._cacheMap.get(t);e.cacheKeys.forEach((t=>{this._cache.delete(t)})),e.keys.forEach((t=>{this._cacheMap.delete(t)}))}get parsers(){return this._parsers}};var Qo=Object.defineProperty,Jo=Object.defineProperties,Ko=Object.getOwnPropertyDescriptors,ta=Object.getOwnPropertySymbols,ea=Object.prototype.hasOwnProperty,ra=Object.prototype.propertyIsEnumerable,ia=(t,e,r)=>e in t?Qo(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r;class sa{constructor(){this._parsers=[],this._parsersValidated=!1,this.parsers=new Proxy(this._parsers,{set:(t,e,r)=>(this._parsersValidated=!1,t[e]=r,!0)}),this.promiseCache={}}reset(){this._parsersValidated=!1,this.promiseCache={}}_getLoadPromiseAndParser(t,e){const r={promise:null,parser:null};return r.promise=(async()=>{var i,s;let n=null,o=null;if(e.loadParser&&(o=this._parserHash[e.loadParser]),!o){for(let r=0;r<this.parsers.length;r++){const s=this.parsers[r];if(s.load&&null!=(i=s.test)&&i.call(s,t,e,this)){o=s;break}}if(!o)return null}n=await o.load(t,e,this),r.parser=o;for(let t=0;t<this.parsers.length;t++){const i=this.parsers[t];i.parse&&i.parse&&await(null==(s=i.testParse)?void 0:s.call(i,n,e,this))&&(n=await i.parse(n,e,this)||n,r.parser=i)}return n})(),r}async load(t,e){this._parsersValidated||this._validateParsers();let r=0;const i={},s=qo(t),n=Xo(t,(t=>({alias:[t],src:t}))),o=n.length,a=n.map((async t=>{const s=ee.toAbsolute(t.src);if(!i[t.src])try{this.promiseCache[s]||(this.promiseCache[s]=this._getLoadPromiseAndParser(s,t)),i[t.src]=await this.promiseCache[s].promise,e&&e(++r/o)}catch(e){throw delete this.promiseCache[s],delete i[t.src],new Error(`[Loader.load] Failed to load ${s}.\n${e}`)}}));return await Promise.all(a),s?i[n[0].src]:i}async unload(t){const e=Xo(t,(t=>({alias:[t],src:t}))).map((async t=>{var e,r;const i=ee.toAbsolute(t.src),s=this.promiseCache[i];if(s){const n=await s.promise;delete this.promiseCache[i],null==(r=null==(e=s.parser)?void 0:e.unload)||r.call(e,n,t,this)}}));await Promise.all(e)}_validateParsers(){this._parsersValidated=!0,this._parserHash=this._parsers.filter((t=>t.name)).reduce(((t,e)=>(t[e.name],((t,e)=>Jo(t,Ko(e)))(((t,e)=>{for(var r in e||(e={}))ea.call(e,r)&&ia(t,r,e[r]);if(ta)for(var r of ta(e))ra.call(e,r)&&ia(t,r,e[r]);return t})({},t),{[e.name]:e}))),{})}}var na=(t=>(t[t.Low=0]="Low",t[t.Normal=1]="Normal",t[t.High=2]="High",t))(na||{});const oa={extension:{type:Tr.LoadParser,priority:na.Low},name:"loadJson",test:t=>Ho(t,"application/json")||zo(t,".json"),load:async t=>await(await T.ADAPTER.fetch(t)).json()};Sr.add(oa);const aa={name:"loadTxt",extension:{type:Tr.LoadParser,priority:na.Low},test:t=>Ho(t,"text/plain")||zo(t,".txt"),load:async t=>await(await T.ADAPTER.fetch(t)).text()};Sr.add(aa);var ha=Object.defineProperty,la=Object.defineProperties,ua=Object.getOwnPropertyDescriptors,ca=Object.getOwnPropertySymbols,da=Object.prototype.hasOwnProperty,fa=Object.prototype.propertyIsEnumerable,pa=(t,e,r)=>e in t?ha(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,_a=(t,e)=>{for(var r in e||(e={}))da.call(e,r)&&pa(t,r,e[r]);if(ca)for(var r of ca(e))fa.call(e,r)&&pa(t,r,e[r]);return t},ma=(t,e)=>la(t,ua(e));const ga=["normal","bold","100","200","300","400","500","600","700","800","900"],ya=[".ttf",".otf",".woff",".woff2"],ba=["font/ttf","font/otf","font/woff","font/woff2"],va=/^(--|-?[A-Z_])[0-9A-Z_-]*$/i;function xa(t){const e=ee.extname(t),r=ee.basename(t,e).replace(/(-|_)/g," ").toLowerCase().split(" ").map((t=>t.charAt(0).toUpperCase()+t.slice(1)));let i=r.length>0;for(const t of r)if(!t.match(va)){i=!1;break}let s=r.join(" ");return i||(s=`"${s.replace(/[\\"]/g,"\\$&")}"`),s}const Aa=/^[0-9A-Za-z%:/?#\[\]@!\$&'()\*\+,;=\-._~]*$/;function Ta(t){return Aa.test(t)?t:encodeURI(t)}const Ea={extension:{type:Tr.LoadParser,priority:na.Low},name:"loadWebFont",test:t=>Ho(t,ba)||zo(t,ya),async load(t,e){var r,i,s,n,o,a;const h=T.ADAPTER.getFontFaceSet();if(h){const l=[],u=null!=(i=null==(r=e.data)?void 0:r.family)?i:xa(t),c=null!=(o=null==(n=null==(s=e.data)?void 0:s.weights)?void 0:n.filter((t=>ga.includes(t))))?o:["normal"],d=null!=(a=e.data)?a:{};for(let e=0;e<c.length;e++){const r=c[e],i=new FontFace(u,`url(${Ta(t)})`,ma(_a({},d),{weight:r}));await i.load(),h.add(i),l.push(i)}return 1===l.length?l[0]:l}return null},unload(t){(Array.isArray(t)?t:[t]).forEach((t=>T.ADAPTER.getFontFaceSet().delete(t)))}};Sr.add(Ea);let wa=null,Sa=class{constructor(){wa||(wa=URL.createObjectURL(new Blob(['(function(){"use strict";const e="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAQAAAC1HAwCAAAAC0lEQVR42mP8/x8AAwMCAO+ip1sAAAAASUVORK5CYII=";async function a(){try{if(typeof createImageBitmap!="function")return!1;const A=await(await fetch(e)).blob(),t=await createImageBitmap(A);return t.width===1&&t.height===1}catch(A){return!1}}a().then(A=>{self.postMessage(A)})})();\n'],{type:"application/javascript"}))),this.worker=new Worker(wa)}};Sa.revokeObjectURL=function(){wa&&(URL.revokeObjectURL(wa),wa=null)};let Ca=null;class Pa{constructor(){Ca||(Ca=URL.createObjectURL(new Blob(['(function(){"use strict";async function e(t){const a=await fetch(t);if(!a.ok)throw new Error(`[WorkerManager.loadImageBitmap] Failed to fetch ${t}: ${a.status} ${a.statusText}`);const s=await a.blob();return await createImageBitmap(s)}self.onmessage=async t=>{try{const a=await e(t.data.data[0]);self.postMessage({data:a,uuid:t.data.uuid,id:t.data.id},[a])}catch(a){self.postMessage({error:a,uuid:t.data.uuid,id:t.data.id})}}})();\n'],{type:"application/javascript"}))),this.worker=new Worker(Ca)}}Pa.revokeObjectURL=function(){Ca&&(URL.revokeObjectURL(Ca),Ca=null)};let Ma,$a=0;const Ia=new class{constructor(){this._initialized=!1,this._createdWorkers=0,this.workerPool=[],this.queue=[],this.resolveHash={}}isImageBitmapSupported(){return void 0!==this._isImageBitmapSupported||(this._isImageBitmapSupported=new Promise((t=>{const{worker:e}=new Sa;e.addEventListener("message",(r=>{e.terminate(),Sa.revokeObjectURL(),t(r.data)}))}))),this._isImageBitmapSupported}loadImageBitmap(t){return this._run("loadImageBitmap",[t])}async _initWorkers(){this._initialized||(this._initialized=!0)}getWorker(){void 0===Ma&&(Ma=navigator.hardwareConcurrency||4);let t=this.workerPool.pop();return!t&&this._createdWorkers<Ma&&(this._createdWorkers++,t=(new Pa).worker,t.addEventListener("message",(t=>{this.complete(t.data),this.returnWorker(t.target),this.next()}))),t}returnWorker(t){this.workerPool.push(t)}complete(t){void 0!==t.error?this.resolveHash[t.uuid].reject(t.error):this.resolveHash[t.uuid].resolve(t.data),this.resolveHash[t.uuid]=null}async _run(t,e){await this._initWorkers();const r=new Promise(((r,i)=>{this.queue.push({id:t,arguments:e,resolve:r,reject:i})}));return this.next(),r}next(){if(!this.queue.length)return;const t=this.getWorker();if(!t)return;const e=this.queue.pop(),r=e.id;this.resolveHash[$a]={resolve:e.resolve,reject:e.reject},t.postMessage({data:e.arguments,uuid:$a++,id:r})}};function Ra(t,e,r){t.resource.internal=!0;const i=new ps(t),s=()=>{delete e.promiseCache[r],Zo.has(r)&&Zo.remove(r)};return i.baseTexture.once("destroyed",(()=>{r in e.promiseCache&&(console.warn("[Assets] A BaseTexture managed by Assets was destroyed instead of unloaded! Use Assets.unload() instead of destroying the BaseTexture."),s())})),i.once("destroyed",(()=>{t.destroyed||(console.warn("[Assets] A Texture managed by Assets was destroyed instead of unloaded! Use Assets.unload() instead of destroying the Texture."),s())})),i}var Da=Object.defineProperty,La=Object.getOwnPropertySymbols,Fa=Object.prototype.hasOwnProperty,Oa=Object.prototype.propertyIsEnumerable,ka=(t,e,r)=>e in t?Da(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Ba=(t,e)=>{for(var r in e||(e={}))Fa.call(e,r)&&ka(t,r,e[r]);if(La)for(var r of La(e))Oa.call(e,r)&&ka(t,r,e[r]);return t};const Na=[".jpeg",".jpg",".png",".webp",".avif"],Ua=["image/jpeg","image/png","image/webp","image/avif"];async function Ga(t){const e=await T.ADAPTER.fetch(t);if(!e.ok)throw new Error(`[loadImageBitmap] Failed to fetch ${t}: ${e.status} ${e.statusText}`);const r=await e.blob();return await createImageBitmap(r)}const Va={name:"loadTextures",extension:{type:Tr.LoadParser,priority:na.High},config:{preferWorkers:!0,preferCreateImageBitmap:!0,crossOrigin:"anonymous"},test:t=>Ho(t,Ua)||zo(t,Na),async load(t,e,r){var i;const s=globalThis.createImageBitmap&&this.config.preferCreateImageBitmap;let n;n=s?this.config.preferWorkers&&await Ia.isImageBitmapSupported()?await Ia.loadImageBitmap(t):await Ga(t):await new Promise(((e,r)=>{const i=new Image;i.crossOrigin=this.config.crossOrigin,i.src=t,i.complete?e(i):(i.onload=()=>e(i),i.onerror=t=>r(t))}));const o=Ba({},e.data);null!=o.resolution||(o.resolution=fr(t)),s&&void 0===(null==(i=o.resourceOptions)?void 0:i.ownsImageBitmap)&&(o.resourceOptions=Ba({},o.resourceOptions),o.resourceOptions.ownsImageBitmap=!0);const a=new zr(n,o);return a.resource.src=t,Ra(a,r,t)},unload(t){t.destroy(!0)}};Sr.add(Va);var Ha=Object.defineProperty,za=Object.getOwnPropertySymbols,Xa=Object.prototype.hasOwnProperty,Wa=Object.prototype.propertyIsEnumerable,Ya=(t,e,r)=>e in t?Ha(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r;const ja={extension:{type:Tr.LoadParser,priority:na.High},name:"loadSVG",test:t=>Ho(t,"image/svg+xml")||zo(t,".svg"),testParse:async t=>Wn.test(t),async parse(t,e,r){var i;const s=new Wn(t,null==(i=null==e?void 0:e.data)?void 0:i.resourceOptions);await s.load();const n=new zr(s,((t,e)=>{for(var r in e||(e={}))Xa.call(e,r)&&Ya(t,r,e[r]);if(za)for(var r of za(e))Wa.call(e,r)&&Ya(t,r,e[r]);return t})({resolution:fr(t)},null==e?void 0:e.data));return n.resource.src=e.src,Ra(n,r,e.src)},load:async(t,e)=>(await T.ADAPTER.fetch(t)).text(),unload:Va.unload};Sr.add(ja);var qa=Object.defineProperty,Za=Object.defineProperties,Qa=Object.getOwnPropertyDescriptors,Ja=Object.getOwnPropertySymbols,Ka=Object.prototype.hasOwnProperty,th=Object.prototype.propertyIsEnumerable,eh=(t,e,r)=>e in t?qa(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,rh=(t,e)=>{for(var r in e||(e={}))Ka.call(e,r)&&eh(t,r,e[r]);if(Ja)for(var r of Ja(e))th.call(e,r)&&eh(t,r,e[r]);return t};const ih=[".mp4",".m4v",".webm",".ogv"],sh=["video/mp4","video/webm","video/ogg"],nh={name:"loadVideo",extension:{type:Tr.LoadParser,priority:na.High},config:{defaultAutoPlay:!0,defaultUpdateFPS:0,defaultLoop:!1,defaultMuted:!1,defaultPlaysinline:!0},test:t=>Ho(t,sh)||zo(t,ih),async load(t,e,r){var i;let s;const n=await(await T.ADAPTER.fetch(t)).blob(),o=URL.createObjectURL(n);try{const n=((t,e)=>Za(t,Qa(e)))(rh({autoPlay:this.config.defaultAutoPlay,updateFPS:this.config.defaultUpdateFPS,loop:this.config.defaultLoop,muted:this.config.defaultMuted,playsinline:this.config.defaultPlaysinline},null==(i=null==e?void 0:e.data)?void 0:i.resourceOptions),{autoLoad:!0}),a=new jn(o,n);await a.load();const h=new zr(a,rh({alphaMode:await se(),resolution:fr(t)},null==e?void 0:e.data));h.resource.src=t,s=Ra(h,r,t),s.baseTexture.once("destroyed",(()=>{URL.revokeObjectURL(o)}))}catch(t){throw URL.revokeObjectURL(o),t}return s},unload(t){t.destroy(!0)}};Sr.add(nh);var oh=Object.defineProperty,ah=Object.defineProperties,hh=Object.getOwnPropertyDescriptors,lh=Object.getOwnPropertySymbols,uh=Object.prototype.hasOwnProperty,ch=Object.prototype.propertyIsEnumerable,dh=(t,e,r)=>e in t?oh(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,fh=(t,e)=>{for(var r in e||(e={}))uh.call(e,r)&&dh(t,r,e[r]);if(lh)for(var r of lh(e))ch.call(e,r)&&dh(t,r,e[r]);return t},ph=(t,e)=>ah(t,hh(e));class _h{constructor(){this._defaultBundleIdentifierOptions={connector:"-",createBundleAssetId:(t,e)=>`${t}${this._bundleIdConnector}${e}`,extractAssetIdFromBundle:(t,e)=>e.replace(`${t}${this._bundleIdConnector}`,"")},this._bundleIdConnector=this._defaultBundleIdentifierOptions.connector,this._createBundleAssetId=this._defaultBundleIdentifierOptions.createBundleAssetId,this._extractAssetIdFromBundle=this._defaultBundleIdentifierOptions.extractAssetIdFromBundle,this._assetMap={},this._preferredOrder=[],this._parsers=[],this._resolverHash={},this._bundles={}}setBundleIdentifier(t){var e,r,i;if(this._bundleIdConnector=null!=(e=t.connector)?e:this._bundleIdConnector,this._createBundleAssetId=null!=(r=t.createBundleAssetId)?r:this._createBundleAssetId,this._extractAssetIdFromBundle=null!=(i=t.extractAssetIdFromBundle)?i:this._extractAssetIdFromBundle,"bar"!==this._extractAssetIdFromBundle("foo",this._createBundleAssetId("foo","bar")))throw new Error("[Resolver] GenerateBundleAssetId are not working correctly")}prefer(...t){t.forEach((t=>{this._preferredOrder.push(t),t.priority||(t.priority=Object.keys(t.params))})),this._resolverHash={}}set basePath(t){this._basePath=t}get basePath(){return this._basePath}set rootPath(t){this._rootPath=t}get rootPath(){return this._rootPath}get parsers(){return this._parsers}reset(){this.setBundleIdentifier(this._defaultBundleIdentifierOptions),this._assetMap={},this._preferredOrder=[],this._resolverHash={},this._rootPath=null,this._basePath=null,this._manifest=null,this._bundles={},this._defaultSearchParams=null}setDefaultSearchParams(t){if("string"==typeof t)this._defaultSearchParams=t;else{const e=t;this._defaultSearchParams=Object.keys(e).map((t=>`${encodeURIComponent(t)}=${encodeURIComponent(e[t])}`)).join("&")}}getAlias(t){const{alias:e,name:r,src:i,srcs:s}=t;return Xo(e||r||i||s,(t=>{var e;return"string"==typeof t?t:Array.isArray(t)?t.map((t=>{var e,r;return null!=(r=null!=(e=null==t?void 0:t.src)?e:null==t?void 0:t.srcs)?r:t})):null!=t&&t.src||null!=t&&t.srcs?null!=(e=t.src)?e:t.srcs:t}),!0)}addManifest(t){this._manifest,this._manifest=t,t.bundles.forEach((t=>{this.addBundle(t.name,t.assets)}))}addBundle(t,e){const r=[];Array.isArray(e)?e.forEach((e=>{var i,s;const n=null!=(i=e.src)?i:e.srcs,o=null!=(s=e.alias)?s:e.name;let a;if("string"==typeof o){const e=this._createBundleAssetId(t,o);r.push(e),a=[o,e]}else{const e=o.map((e=>this._createBundleAssetId(t,e)));r.push(...e),a=[...o,...e]}this.add(ph(fh({},e),{alias:a,src:n}))})):Object.keys(e).forEach((i=>{var s;const n=[i,this._createBundleAssetId(t,i)];if("string"==typeof e[i])this.add({alias:n,src:e[i]});else if(Array.isArray(e[i]))this.add({alias:n,src:e[i]});else{const t=e[i],r=null!=(s=t.src)?s:t.srcs;this.add(ph(fh({},t),{alias:n,src:Array.isArray(r)?r:[r]}))}r.push(...n)})),this._bundles[t]=r}add(t,e,r,i,s){const n=[];"string"==typeof t||Array.isArray(t)&&"string"==typeof t[0]?n.push({alias:t,src:e,data:r,format:i,loadParser:s}):Array.isArray(t)?n.push(...t):n.push(t),Xo(n).forEach((t=>{const{src:e,srcs:r}=t;let{data:i,format:s,loadParser:n}=t;const o=Xo(e||r).map((t=>"string"==typeof t?jo(t):Array.isArray(t)?t:[t])),a=this.getAlias(t),h=[];o.forEach((t=>{t.forEach((t=>{var e,r,o;let l={};if("object"!=typeof t){l.src=t;for(let e=0;e<this._parsers.length;e++){const r=this._parsers[e];if(r.test(t)){l=r.parse(t);break}}}else i=null!=(e=t.data)?e:i,s=null!=(r=t.format)?r:s,n=null!=(o=t.loadParser)?o:n,l=fh(fh({},l),t);if(!a)throw new Error(`[Resolver] alias is undefined for this asset: ${l.src}`);l=this.buildResolvedAsset(l,{aliases:a,data:i,format:s,loadParser:n}),h.push(l)}))})),a.forEach((t=>{this._assetMap[t]=h}))}))}resolveBundle(t){const e=qo(t);t=Xo(t);const r={};return t.forEach((t=>{const e=this._bundles[t];if(e){const i=this.resolve(e),s={};for(const e in i){const r=i[e];s[this._extractAssetIdFromBundle(t,e)]=r}r[t]=s}})),e?r[t[0]]:r}resolveUrl(t){const e=this.resolve(t);if("string"!=typeof t){const t={};for(const r in e)t[r]=e[r].src;return t}return e.src}resolve(t){const e=qo(t);t=Xo(t);const r={};return t.forEach((t=>{var e;if(!this._resolverHash[t])if(this._assetMap[t]){let r=this._assetMap[t];const i=r[0],s=this._getPreferredOrder(r);null==s||s.priority.forEach((t=>{s.params[t].forEach((e=>{const i=r.filter((r=>!!r[t]&&r[t]===e));i.length&&(r=i)}))})),this._resolverHash[t]=null!=(e=r[0])?e:i}else this._resolverHash[t]=this.buildResolvedAsset({alias:[t],src:t},{});r[t]=this._resolverHash[t]})),e?r[t[0]]:r}hasKey(t){return!!this._assetMap[t]}hasBundle(t){return!!this._bundles[t]}_getPreferredOrder(t){for(let e=0;e<t.length;e++){const e=t[0],r=this._preferredOrder.find((t=>t.params.format.includes(e.format)));if(r)return r}return this._preferredOrder[0]}_appendDefaultSearchParams(t){if(!this._defaultSearchParams)return t;return`${t}${/\?/.test(t)?"&":"?"}${this._defaultSearchParams}`}buildResolvedAsset(t,e){var r,i;const{aliases:s,data:n,loadParser:o,format:a}=e;return(this._basePath||this._rootPath)&&(t.src=ee.toAbsolute(t.src,this._basePath,this._rootPath)),t.alias=null!=(r=null!=s?s:t.alias)?r:[t.src],t.src=this._appendDefaultSearchParams(t.src),t.data=fh(fh({},n||{}),t.data),t.loadParser=null!=o?o:t.loadParser,t.format=null!=(i=null!=a?a:t.format)?i:ee.extname(t.src).slice(1),t.srcs=t.src,t.name=t.alias,t}}class mh{constructor(){this._detections=[],this._initialized=!1,this.resolver=new _h,this.loader=new sa,this.cache=Zo,this._backgroundLoader=new Vo(this.loader),this._backgroundLoader.active=!0,this.reset()}async init(t={}){var e,r,i;if(this._initialized)return;if(this._initialized=!0,t.defaultSearchParams&&this.resolver.setDefaultSearchParams(t.defaultSearchParams),t.basePath&&(this.resolver.basePath=t.basePath),t.bundleIdentifier&&this.resolver.setBundleIdentifier(t.bundleIdentifier),t.manifest){let e=t.manifest;"string"==typeof e&&(e=await this.load(e)),this.resolver.addManifest(e)}const s=null!=(r=null==(e=t.texturePreference)?void 0:e.resolution)?r:1,n="number"==typeof s?[s]:s,o=await this._detectFormats({preferredFormats:null==(i=t.texturePreference)?void 0:i.format,skipDetections:t.skipDetections,detections:this._detections});this.resolver.prefer({params:{format:o,resolution:n}}),t.preferences&&this.setPreferences(t.preferences)}add(t,e,r,i,s){this.resolver.add(t,e,r,i,s)}async load(t,e){this._initialized||await this.init();const r=qo(t),i=Xo(t).map((t=>{if("string"!=typeof t){const e=this.resolver.getAlias(t);return e.some((t=>!this.resolver.hasKey(t)))&&this.add(t),Array.isArray(e)?e[0]:e}return this.resolver.hasKey(t)||this.add({alias:t,src:t}),t})),s=this.resolver.resolve(i),n=await this._mapLoadToResolve(s,e);return r?n[i[0]]:n}addBundle(t,e){this.resolver.addBundle(t,e)}async loadBundle(t,e){this._initialized||await this.init();let r=!1;"string"==typeof t&&(r=!0,t=[t]);const i=this.resolver.resolveBundle(t),s={},n=Object.keys(i);let o=0,a=0;const h=()=>{null==e||e(++o/a)},l=n.map((t=>{const e=i[t];return a+=Object.keys(e).length,this._mapLoadToResolve(e,h).then((e=>{s[t]=e}))}));return await Promise.all(l),r?s[t[0]]:s}async backgroundLoad(t){this._initialized||await this.init(),"string"==typeof t&&(t=[t]);const e=this.resolver.resolve(t);this._backgroundLoader.add(Object.values(e))}async backgroundLoadBundle(t){this._initialized||await this.init(),"string"==typeof t&&(t=[t]);const e=this.resolver.resolveBundle(t);Object.values(e).forEach((t=>{this._backgroundLoader.add(Object.values(t))}))}reset(){this.resolver.reset(),this.loader.reset(),this.cache.reset(),this._initialized=!1}get(t){if("string"==typeof t)return Zo.get(t);const e={};for(let r=0;r<t.length;r++)e[r]=Zo.get(t[r]);return e}async _mapLoadToResolve(t,e){const r=Object.values(t),i=Object.keys(t);this._backgroundLoader.active=!1;const s=await this.loader.load(r,e);this._backgroundLoader.active=!0;const n={};return r.forEach(((t,e)=>{const r=s[t.src],o=[t.src];t.alias&&o.push(...t.alias),n[i[e]]=r,Zo.set(o,r)})),n}async unload(t){this._initialized||await this.init();const e=Xo(t).map((t=>"string"!=typeof t?t.src:t)),r=this.resolver.resolve(e);await this._unloadFromResolved(r)}async unloadBundle(t){this._initialized||await this.init(),t=Xo(t);const e=this.resolver.resolveBundle(t),r=Object.keys(e).map((t=>this._unloadFromResolved(e[t])));await Promise.all(r)}async _unloadFromResolved(t){const e=Object.values(t);e.forEach((t=>{Zo.remove(t.src)})),await this.loader.unload(e)}async _detectFormats(t){let e=[];t.preferredFormats&&(e=Array.isArray(t.preferredFormats)?t.preferredFormats:[t.preferredFormats]);for(const r of t.detections)t.skipDetections||await r.test()?e=await r.add(e):t.skipDetections||(e=await r.remove(e));return e=e.filter(((t,r)=>e.indexOf(t)===r)),e}get detections(){return this._detections}get preferWorkers(){return Va.config.preferWorkers}set preferWorkers(t){this.setPreferences({preferWorkers:t})}setPreferences(t){this.loader.parsers.forEach((e=>{e.config&&Object.keys(e.config).filter((e=>e in t)).forEach((r=>{e.config[r]=t[r]}))}))}}const gh=new mh;Sr.handleByList(Tr.LoadParser,gh.loader.parsers).handleByList(Tr.ResolveParser,gh.resolver.parsers).handleByList(Tr.CacheParser,gh.cache.parsers).handleByList(Tr.DetectionParser,gh.detections);const yh={extension:Tr.CacheParser,test:t=>Array.isArray(t)&&t.every((t=>t instanceof ps)),getCacheableAssets:(t,e)=>{const r={};return t.forEach((t=>{e.forEach(((e,i)=>{r[t+(0===i?"":i+1)]=e}))})),r}};async function bh(t){if("Image"in globalThis)return new Promise((e=>{const r=new Image;r.onload=()=>{e(!0)},r.onerror=()=>{e(!1)},r.src=t}));if("createImageBitmap"in globalThis&&"fetch"in globalThis){try{const e=await(await fetch(t)).blob();await createImageBitmap(e)}catch(t){return!1}return!0}return!1}Sr.add(yh);const vh={extension:{type:Tr.DetectionParser,priority:1},test:async()=>bh("data:image/avif;base64,AAAAIGZ0eXBhdmlmAAAAAGF2aWZtaWYxbWlhZk1BMUIAAADybWV0YQAAAAAAAAAoaGRscgAAAAAAAAAAcGljdAAAAAAAAAAAAAAAAGxpYmF2aWYAAAAADnBpdG0AAAAAAAEAAAAeaWxvYwAAAABEAAABAAEAAAABAAABGgAAAB0AAAAoaWluZgAAAAAAAQAAABppbmZlAgAAAAABAABhdjAxQ29sb3IAAAAAamlwcnAAAABLaXBjbwAAABRpc3BlAAAAAAAAAAIAAAACAAAAEHBpeGkAAAAAAwgICAAAAAxhdjFDgQ0MAAAAABNjb2xybmNseAACAAIAAYAAAAAXaXBtYQAAAAAAAAABAAEEAQKDBAAAACVtZGF0EgAKCBgANogQEAwgMg8f8D///8WfhwB8+ErK42A="),add:async t=>[...t,"avif"],remove:async t=>t.filter((t=>"avif"!==t))};Sr.add(vh);const xh={extension:{type:Tr.DetectionParser,priority:0},test:async()=>bh("data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAAAAAAfQ//73v/+BiOh/AAA="),add:async t=>[...t,"webp"],remove:async t=>t.filter((t=>"webp"!==t))};Sr.add(xh);const Ah=["png","jpg","jpeg"],Th={extension:{type:Tr.DetectionParser,priority:-1},test:()=>Promise.resolve(!0),add:async t=>[...t,...Ah],remove:async t=>t.filter((t=>!Ah.includes(t)))};Sr.add(Th);const Eh="WorkerGlobalScope"in globalThis&&globalThis instanceof globalThis.WorkerGlobalScope;function wh(t){return!Eh&&""!==document.createElement("video").canPlayType(t)}const Sh={extension:{type:Tr.DetectionParser,priority:0},test:async()=>wh("video/webm"),add:async t=>[...t,"webm"],remove:async t=>t.filter((t=>"webm"!==t))};Sr.add(Sh);const Ch={extension:{type:Tr.DetectionParser,priority:0},test:async()=>wh("video/mp4"),add:async t=>[...t,"mp4","m4v"],remove:async t=>t.filter((t=>"mp4"!==t&&"m4v"!==t))};Sr.add(Ch);const Ph={extension:{type:Tr.DetectionParser,priority:0},test:async()=>wh("video/ogg"),add:async t=>[...t,"ogv"],remove:async t=>t.filter((t=>"ogv"!==t))};Sr.add(Ph);const Mh={extension:Tr.ResolveParser,test:Va.test,parse:t=>{var e,r;return{resolution:parseFloat(null!=(r=null==(e=T.RETINA_PREFIX.exec(t))?void 0:e[1])?r:"1"),format:ee.extname(t).slice(1),src:t}}};Sr.add(Mh);var $h=(t=>(t[t.COMPRESSED_RGB_S3TC_DXT1_EXT=33776]="COMPRESSED_RGB_S3TC_DXT1_EXT",t[t.COMPRESSED_RGBA_S3TC_DXT1_EXT=33777]="COMPRESSED_RGBA_S3TC_DXT1_EXT",t[t.COMPRESSED_RGBA_S3TC_DXT3_EXT=33778]="COMPRESSED_RGBA_S3TC_DXT3_EXT",t[t.COMPRESSED_RGBA_S3TC_DXT5_EXT=33779]="COMPRESSED_RGBA_S3TC_DXT5_EXT",t[t.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT=35917]="COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT",t[t.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT=35918]="COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT",t[t.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT=35919]="COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT",t[t.COMPRESSED_SRGB_S3TC_DXT1_EXT=35916]="COMPRESSED_SRGB_S3TC_DXT1_EXT",t[t.COMPRESSED_R11_EAC=37488]="COMPRESSED_R11_EAC",t[t.COMPRESSED_SIGNED_R11_EAC=37489]="COMPRESSED_SIGNED_R11_EAC",t[t.COMPRESSED_RG11_EAC=37490]="COMPRESSED_RG11_EAC",t[t.COMPRESSED_SIGNED_RG11_EAC=37491]="COMPRESSED_SIGNED_RG11_EAC",t[t.COMPRESSED_RGB8_ETC2=37492]="COMPRESSED_RGB8_ETC2",t[t.COMPRESSED_RGBA8_ETC2_EAC=37496]="COMPRESSED_RGBA8_ETC2_EAC",t[t.COMPRESSED_SRGB8_ETC2=37493]="COMPRESSED_SRGB8_ETC2",t[t.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC=37497]="COMPRESSED_SRGB8_ALPHA8_ETC2_EAC",t[t.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2=37494]="COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2",t[t.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2=37495]="COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2",t[t.COMPRESSED_RGB_PVRTC_4BPPV1_IMG=35840]="COMPRESSED_RGB_PVRTC_4BPPV1_IMG",t[t.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG=35842]="COMPRESSED_RGBA_PVRTC_4BPPV1_IMG",t[t.COMPRESSED_RGB_PVRTC_2BPPV1_IMG=35841]="COMPRESSED_RGB_PVRTC_2BPPV1_IMG",t[t.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG=35843]="COMPRESSED_RGBA_PVRTC_2BPPV1_IMG",t[t.COMPRESSED_RGB_ETC1_WEBGL=36196]="COMPRESSED_RGB_ETC1_WEBGL",t[t.COMPRESSED_RGB_ATC_WEBGL=35986]="COMPRESSED_RGB_ATC_WEBGL",t[t.COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL=35987]="COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL",t[t.COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL=34798]="COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL",t[t.COMPRESSED_RGBA_ASTC_4x4_KHR=37808]="COMPRESSED_RGBA_ASTC_4x4_KHR",t[t.COMPRESSED_RGBA_BPTC_UNORM_EXT=36492]="COMPRESSED_RGBA_BPTC_UNORM_EXT",t[t.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT=36493]="COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT",t[t.COMPRESSED_RGB_BPTC_SIGNED_FLOAT_EXT=36494]="COMPRESSED_RGB_BPTC_SIGNED_FLOAT_EXT",t[t.COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT_EXT=36495]="COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT_EXT",t))($h||{});const Ih={33776:.5,33777:.5,33778:1,33779:1,35916:.5,35917:.5,35918:1,35919:1,37488:.5,37489:.5,37490:1,37491:1,37492:.5,37496:1,37493:.5,37497:1,37494:.5,37495:.5,35840:.5,35842:.5,35841:.25,35843:.25,36196:.5,35986:.5,35987:1,34798:1,37808:1,36492:1,36493:1,36494:1,36495:1};let Rh,Dh;function Lh(){Dh={bptc:Rh.getExtension("EXT_texture_compression_bptc"),astc:Rh.getExtension("WEBGL_compressed_texture_astc"),etc:Rh.getExtension("WEBGL_compressed_texture_etc"),s3tc:Rh.getExtension("WEBGL_compressed_texture_s3tc"),s3tc_sRGB:Rh.getExtension("WEBGL_compressed_texture_s3tc_srgb"),pvrtc:Rh.getExtension("WEBGL_compressed_texture_pvrtc")||Rh.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc"),etc1:Rh.getExtension("WEBGL_compressed_texture_etc1"),atc:Rh.getExtension("WEBGL_compressed_texture_atc")}}const Fh={extension:{type:Tr.DetectionParser,priority:2},test:async()=>{const t=T.ADAPTER.createCanvas().getContext("webgl");return!!t&&(Rh=t,!0)},add:async t=>{Dh||Lh();const e=[];for(const t in Dh)Dh[t]&&e.push(t);return[...e,...t]},remove:async t=>(Dh||Lh(),t.filter((t=>!(t in Dh))))};Sr.add(Fh);class Oh extends Or{constructor(t,e={width:1,height:1,autoLoad:!0}){let r,i;"string"==typeof t?(r=t,i=new Uint8Array):(r=null,i=t),super(i,e),this.origin=r,this.buffer=i?new Cr(i):null,this._load=null,this.loaded=!1,null!==this.origin&&!1!==e.autoLoad&&this.load(),null===this.origin&&this.buffer&&(this._load=Promise.resolve(this),this.loaded=!0,this.onBlobLoaded(this.buffer.rawBinaryData))}onBlobLoaded(t){}load(){return this._load||(this._load=fetch(this.origin).then((t=>t.blob())).then((t=>t.arrayBuffer())).then((t=>(this.data=new Uint32Array(t),this.buffer=new Cr(t),this.loaded=!0,this.onBlobLoaded(t),this.update(),this)))),this._load}}class kh extends Oh{constructor(t,e){super(t,e),this.format=e.format,this.levels=e.levels||1,this._width=e.width,this._height=e.height,this._extension=kh._formatToExtension(this.format),(e.levelBuffers||this.buffer)&&(this._levelBuffers=e.levelBuffers||kh._createLevelBuffers(t instanceof Uint8Array?t:this.buffer.uint8View,this.format,this.levels,4,4,this.width,this.height))}upload(t,e,r){const i=t.gl;if(!t.context.extensions[this._extension])throw new Error(`${this._extension} textures are not supported on the current machine`);if(!this._levelBuffers)return!1;i.pixelStorei(i.UNPACK_ALIGNMENT,4);for(let t=0,e=this.levels;t<e;t++){const{levelID:e,levelWidth:r,levelHeight:s,levelBuffer:n}=this._levelBuffers[t];i.compressedTexImage2D(i.TEXTURE_2D,e,this.format,r,s,0,n)}return!0}onBlobLoaded(){this._levelBuffers=kh._createLevelBuffers(this.buffer.uint8View,this.format,this.levels,4,4,this.width,this.height)}static _formatToExtension(t){if(t>=33776&&t<=33779)return"s3tc";if(t>=35916&&t<=35919)return"s3tc_sRGB";if(t>=37488&&t<=37497)return"etc";if(t>=35840&&t<=35843)return"pvrtc";if(36196===t)return"etc1";if(35986===t||35987===t||34798===t)return"atc";if(t>=36492&&t<=36495)return"bptc";if(37808===t)return"astc";throw new Error(`Invalid (compressed) texture format given: ${t}`)}static _createLevelBuffers(t,e,r,i,s,n,o){const a=new Array(r);let h=t.byteOffset,l=n,u=o,c=l+i-1&~(i-1),d=u+s-1&~(s-1),f=c*d*Ih[e];for(let n=0;n<r;n++)a[n]={levelID:n,levelWidth:r>1?l:c,levelHeight:r>1?u:d,levelBuffer:new Uint8Array(t.buffer,h,f)},h+=f,l=l>>1||1,u=u>>1||1,c=l+i-1&~(i-1),d=u+s-1&~(s-1),f=c*d*Ih[e];return a}}const Bh=124,Nh=3,Uh=4,Gh=7,Vh=19,Hh=2,zh=0,Xh=1,Wh=2,Yh=3,jh=827611204,qh=861165636,Zh=894720068,Qh={[jh]:$h.COMPRESSED_RGBA_S3TC_DXT1_EXT,[qh]:$h.COMPRESSED_RGBA_S3TC_DXT3_EXT,[Zh]:$h.COMPRESSED_RGBA_S3TC_DXT5_EXT},Jh={70:$h.COMPRESSED_RGBA_S3TC_DXT1_EXT,71:$h.COMPRESSED_RGBA_S3TC_DXT1_EXT,73:$h.COMPRESSED_RGBA_S3TC_DXT3_EXT,74:$h.COMPRESSED_RGBA_S3TC_DXT3_EXT,76:$h.COMPRESSED_RGBA_S3TC_DXT5_EXT,77:$h.COMPRESSED_RGBA_S3TC_DXT5_EXT,72:$h.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT,75:$h.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT,78:$h.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT,96:$h.COMPRESSED_RGB_BPTC_SIGNED_FLOAT_EXT,95:$h.COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT_EXT,98:$h.COMPRESSED_RGBA_BPTC_UNORM_EXT,99:$h.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT};function Kh(t){const e=new Uint32Array(t);if(542327876!==e[0])throw new Error("Invalid DDS file magic word");const r=new Uint32Array(t,0,Bh/Uint32Array.BYTES_PER_ELEMENT),i=r[Nh],s=r[Uh],n=r[Gh],o=new Uint32Array(t,Vh*Uint32Array.BYTES_PER_ELEMENT,32/Uint32Array.BYTES_PER_ELEMENT),a=o[1];if(4&a){const r=o[Hh];if(808540228!==r){const e=Qh[r],o=new Uint8Array(t,128);return[new kh(o,{format:e,width:s,height:i,levels:n})]}const a=128,h=new Uint32Array(e.buffer,a,20/Uint32Array.BYTES_PER_ELEMENT),l=h[zh],u=h[Xh],c=h[Wh],d=h[Yh],f=Jh[l];if(void 0===f)throw new Error(`DDSParser cannot parse texture data with DXGI format ${l}`);if(4===c)throw new Error("DDSParser does not support cubemap textures");if(6===u)throw new Error("DDSParser does not supported 3D texture data");const p=new Array,_=148;if(1===d)p.push(new Uint8Array(t,_));else{const e=Ih[f];let r=0,o=s,a=i;for(let t=0;t<n;t++){r+=Math.max(1,o+3&-4)*Math.max(1,a+3&-4)*e,o>>>=1,a>>>=1}let h=_;for(let e=0;e<d;e++)p.push(new Uint8Array(t,h,r)),h+=r}return p.map((t=>new kh(t,{format:f,width:s,height:i,levels:n})))}throw 64&a?new Error("DDSParser does not support uncompressed texture data."):512&a?new Error("DDSParser does not supported YUV uncompressed texture data."):131072&a?new Error("DDSParser does not support single-channel (lumninance) texture data!"):2&a?new Error("DDSParser does not support single-channel (alpha) texture data!"):new Error("DDSParser failed to load a texture file due to an unknown reason!")}const tl=[171,75,84,88,32,49,49,187,13,10,26,10],el=12,rl=16,il=24,sl=28,nl=36,ol=40,al=44,hl=48,ll=52,ul=56,cl=60,dl={[l.UNSIGNED_BYTE]:1,[l.UNSIGNED_SHORT]:2,[l.INT]:4,[l.UNSIGNED_INT]:4,[l.FLOAT]:4,[l.HALF_FLOAT]:8},fl={[a.RGBA]:4,[a.RGB]:3,[a.RG]:2,[a.RED]:1,[a.LUMINANCE]:1,[a.LUMINANCE_ALPHA]:2,[a.ALPHA]:1},pl={[l.UNSIGNED_SHORT_4_4_4_4]:2,[l.UNSIGNED_SHORT_5_5_5_1]:2,[l.UNSIGNED_SHORT_5_6_5]:2};function _l(t,e,r=!1){const i=new DataView(e);if(!function(t,e){for(let t=0;t<tl.length;t++)if(e.getUint8(t)!==tl[t])return!1;return!0}(0,i))return null;const s=67305985===i.getUint32(el,!0),n=i.getUint32(rl,s),o=i.getUint32(il,s),a=i.getUint32(sl,s),h=i.getUint32(nl,s),u=i.getUint32(ol,s)||1,c=i.getUint32(al,s)||1,d=i.getUint32(hl,s)||1,f=i.getUint32(ll,s),p=i.getUint32(ul,s),_=i.getUint32(cl,s);if(0===u||1!==c)throw new Error("Only 2D textures are supported");if(1!==f)throw new Error("CubeTextures are not supported by KTXLoader yet!");if(1!==d)throw new Error("WebGL does not support array textures");const m=h+3&-4,g=u+3&-4,y=new Array(d);let b,v=h*u;if(0===n&&(v=m*g),b=0!==n?dl[n]?dl[n]*fl[o]:pl[n]:Ih[a],void 0===b)throw new Error("Unable to resolve the pixel format stored in the *.ktx file!");const x=r?function(t,e,r){const i=new Map;let s=0;for(;s<e;){const n=t.getUint32(64+s,r),o=64+s+4,a=3-(n+3)%4;if(0===n||n>e-s){console.error("KTXLoader: keyAndValueByteSize out of bounds");break}let h=0;for(;h<n&&0!==t.getUint8(o+h);h++);if(-1===h){console.error("KTXLoader: Failed to find null byte terminating kvData key");break}const l=(new TextDecoder).decode(new Uint8Array(t.buffer,o,h)),u=new DataView(t.buffer,o+h+1,n-h-1);i.set(l,u),s+=4+n+a}return i}(i,_,s):null;let A=v*b,T=h,E=u,w=m,S=g,C=64+_;for(let t=0;t<p;t++){const r=i.getUint32(C,s);let o=C+4;for(let r=0;r<d;r++){let i=y[r];i||(i=y[r]=new Array(p)),i[t]={levelID:t,levelWidth:p>1||0!==n?T:w,levelHeight:p>1||0!==n?E:S,levelBuffer:new Uint8Array(e,o,A)},o+=A}C+=r+4,C=C%4!=0?C+4-C%4:C,T=T>>1||1,E=E>>1||1,w=T+4-1&-4,S=E+4-1&-4,A=w*S*b}return 0!==n?{uncompressed:y.map((t=>{let e=t[0].levelBuffer,r=!1;return n===l.FLOAT?e=new Float32Array(t[0].levelBuffer.buffer,t[0].levelBuffer.byteOffset,t[0].levelBuffer.byteLength/4):n===l.UNSIGNED_INT?(r=!0,e=new Uint32Array(t[0].levelBuffer.buffer,t[0].levelBuffer.byteOffset,t[0].levelBuffer.byteLength/4)):n===l.INT&&(r=!0,e=new Int32Array(t[0].levelBuffer.buffer,t[0].levelBuffer.byteOffset,t[0].levelBuffer.byteLength/4)),{resource:new Or(e,{width:t[0].levelWidth,height:t[0].levelHeight}),type:n,format:r?ml(o):o}})),kvData:x}:{compressed:y.map((t=>new kh(null,{format:a,width:h,height:u,levels:p,levelBuffers:t}))),kvData:x}}function ml(t){switch(t){case a.RGBA:return a.RGBA_INTEGER;case a.RGB:return a.RGB_INTEGER;case a.RG:return a.RG_INTEGER;case a.RED:return a.RED_INTEGER;default:return t}}var gl=Object.defineProperty,yl=Object.getOwnPropertySymbols,bl=Object.prototype.hasOwnProperty,vl=Object.prototype.propertyIsEnumerable,xl=(t,e,r)=>e in t?gl(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r;const Al={extension:{type:Tr.LoadParser,priority:na.High},name:"loadDDS",test:t=>zo(t,".dds"),async load(t,e,r){const i=Kh(await(await T.ADAPTER.fetch(t)).arrayBuffer()).map((i=>{const s=new zr(i,((t,e)=>{for(var r in e||(e={}))bl.call(e,r)&&xl(t,r,e[r]);if(yl)for(var r of yl(e))vl.call(e,r)&&xl(t,r,e[r]);return t})({mipmap:f.OFF,alphaMode:p.NO_PREMULTIPLIED_ALPHA,resolution:fr(t)},e.data));return Ra(s,r,t)}));return 1===i.length?i[0]:i},unload(t){Array.isArray(t)?t.forEach((t=>t.destroy(!0))):t.destroy(!0)}};Sr.add(Al);var Tl=Object.defineProperty,El=Object.getOwnPropertySymbols,wl=Object.prototype.hasOwnProperty,Sl=Object.prototype.propertyIsEnumerable,Cl=(t,e,r)=>e in t?Tl(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r;const Pl={extension:{type:Tr.LoadParser,priority:na.High},name:"loadKTX",test:t=>zo(t,".ktx"),async load(t,e,r){const i=await(await T.ADAPTER.fetch(t)).arrayBuffer(),{compressed:s,uncompressed:n,kvData:o}=_l(0,i),a=null!=s?s:n,h=((t,e)=>{for(var r in e||(e={}))wl.call(e,r)&&Cl(t,r,e[r]);if(El)for(var r of El(e))Sl.call(e,r)&&Cl(t,r,e[r]);return t})({mipmap:f.OFF,alphaMode:p.NO_PREMULTIPLIED_ALPHA,resolution:fr(t)},e.data),l=a.map((e=>{var i;a===n&&Object.assign(h,{type:e.type,format:e.format});const s=null!=(i=e.resource)?i:e,l=new zr(s,h);return l.ktxKeyValueData=o,Ra(l,r,t)}));return 1===l.length?l[0]:l},unload(t){Array.isArray(t)?t.forEach((t=>t.destroy(!0))):t.destroy(!0)}};Sr.add(Pl);const Ml=["s3tc","s3tc_sRGB","etc","etc1","pvrtc","atc","astc","bptc"],$l={extension:Tr.ResolveParser,test:t=>{const e=ee.extname(t).slice(1);return["basis","ktx","dds"].includes(e)},parse:t=>{var e,r,i,s;const n=t.split("."),o=n.pop();if(["ktx","dds"].includes(o)){const i=n.pop();if(Ml.includes(i))return{resolution:parseFloat(null!=(r=null==(e=T.RETINA_PREFIX.exec(t))?void 0:e[1])?r:"1"),format:i,src:t}}return{resolution:parseFloat(null!=(s=null==(i=T.RETINA_PREFIX.exec(t))?void 0:i[1])?s:"1"),format:o,src:t}}};Sr.add($l);const Il=new ai,Rl=class t{constructor(t){this.renderer=t,this._rendererPremultipliedAlpha=!1}contextChange(){var t;const e=null==(t=this.renderer)?void 0:t.gl.getContextAttributes();this._rendererPremultipliedAlpha=!!(e&&e.alpha&&e.premultipliedAlpha)}async image(t,e,r,i){const s=new Image;return s.src=await this.base64(t,e,r,i),s}async base64(t,e,r,i){const s=this.canvas(t,i);if(void 0!==s.toBlob)return new Promise(((t,i)=>{s.toBlob((e=>{if(!e)return void i(new Error("ICanvas.toBlob failed!"));const r=new FileReader;r.onload=()=>t(r.result),r.onerror=i,r.readAsDataURL(e)}),e,r)}));if(void 0!==s.toDataURL)return s.toDataURL(e,r);if(void 0!==s.convertToBlob){const t=await s.convertToBlob({type:e,quality:r});return new Promise(((e,r)=>{const i=new FileReader;i.onload=()=>e(i.result),i.onerror=r,i.readAsDataURL(t)}))}throw new Error("Extract.base64() requires ICanvas.toDataURL, ICanvas.toBlob, or ICanvas.convertToBlob to be implemented")}canvas(e,r){const{pixels:i,width:s,height:n,flipY:o,premultipliedAlpha:a}=this._rawPixels(e,r);o&&t._flipY(i,s,n),a&&t._unpremultiplyAlpha(i);const h=new ar(s,n,1),l=new ImageData(new Uint8ClampedArray(i.buffer),s,n);return h.context.putImageData(l,0,0),h.canvas}pixels(e,r){const{pixels:i,width:s,height:n,flipY:o,premultipliedAlpha:a}=this._rawPixels(e,r);return o&&t._flipY(i,s,n),a&&t._unpremultiplyAlpha(i),i}_rawPixels(t,e){const r=this.renderer;if(!r)throw new Error("The Extract has already been destroyed");let i,s,n=!1,o=!1,h=!1;t&&(t instanceof _s?s=t:(s=r.generateTexture(t,{region:e,resolution:r.resolution,multisample:r.multisample}),h=!0,e&&(Il.width=e.width,Il.height=e.height,e=Il)));const l=r.gl;if(s){if(i=s.baseTexture.resolution,e=null!=e?e:s.frame,n=!1,o=s.baseTexture.alphaMode>0&&s.baseTexture.format===a.RGBA,!h){r.renderTexture.bind(s);const t=s.framebuffer.glFramebuffers[r.CONTEXT_UID];t.blitFramebuffer&&r.framebuffer.bind(t.blitFramebuffer)}}else i=r.resolution,e||((e=Il).width=r.width/i,e.height=r.height/i),n=!0,o=this._rendererPremultipliedAlpha,r.renderTexture.bind();const u=Math.max(Math.round(e.width*i),1),c=Math.max(Math.round(e.height*i),1),d=new Uint8Array(4*u*c);return l.readPixels(Math.round(e.x*i),Math.round(e.y*i),u,c,l.RGBA,l.UNSIGNED_BYTE,d),h&&(null==s||s.destroy(!0)),{pixels:d,width:u,height:c,flipY:n,premultipliedAlpha:o}}destroy(){this.renderer=null}static _flipY(t,e,r){const i=e<<2,s=r>>1,n=new Uint8Array(i);for(let e=0;e<s;e++){const s=e*i,o=(r-e-1)*i;n.set(t.subarray(s,s+i)),t.copyWithin(s,o,o+i),t.set(n,o)}}static _unpremultiplyAlpha(t){t instanceof Uint8ClampedArray&&(t=new Uint8Array(t.buffer));const e=t.length;for(let r=0;r<e;r+=4){const e=t[r+3];if(0!==e){const i=255.001/e;t[r]=t[r]*i+.5,t[r+1]=t[r+1]*i+.5,t[r+2]=t[r+2]*i+.5}}}};Rl.extension={name:"extract",type:Tr.RendererSystem};let Dl=Rl;Sr.add(Dl);const Ll={build(t){const e=t.points;let r,i,s,n,o,a;if(t.type===si.CIRC){const e=t.shape;r=e.x,i=e.y,o=a=e.radius,s=n=0}else if(t.type===si.ELIP){const e=t.shape;r=e.x,i=e.y,o=e.width,a=e.height,s=n=0}else{const e=t.shape,h=e.width/2,l=e.height/2;r=e.x+h,i=e.y+l,o=a=Math.max(0,Math.min(e.radius,Math.min(h,l))),s=h-o,n=l-a}if(!(o>=0&&a>=0&&s>=0&&n>=0))return void(e.length=0);const h=Math.ceil(2.3*Math.sqrt(o+a)),l=8*h+(s?4:0)+(n?4:0);if(e.length=l,0===l)return;if(0===h)return e.length=8,e[0]=e[6]=r+s,e[1]=e[3]=i+n,e[2]=e[4]=r-s,void(e[5]=e[7]=i-n);let u=0,c=4*h+(s?2:0)+2,d=c,f=l;{const t=s+o,a=n,h=r+t,l=r-t,p=i+a;if(e[u++]=h,e[u++]=p,e[--c]=p,e[--c]=l,n){const t=i-a;e[d++]=l,e[d++]=t,e[--f]=t,e[--f]=h}}for(let t=1;t<h;t++){const l=Math.PI/2*(t/h),p=s+Math.cos(l)*o,_=n+Math.sin(l)*a,m=r+p,g=r-p,y=i+_,b=i-_;e[u++]=m,e[u++]=y,e[--c]=y,e[--c]=g,e[d++]=g,e[d++]=b,e[--f]=b,e[--f]=m}{const t=n+a,o=r+s,h=r-s,l=i+t,c=i-t;e[u++]=o,e[u++]=l,e[--f]=c,e[--f]=o,s&&(e[u++]=h,e[u++]=l,e[--f]=c,e[--f]=h)}},triangulate(t,e){const r=t.points,i=e.points,s=e.indices;if(0===r.length)return;let n=i.length/2;const o=n;let a,h;if(t.type!==si.RREC){const e=t.shape;a=e.x,h=e.y}else{const e=t.shape;a=e.x+e.width/2,h=e.y+e.height/2}const l=t.matrix;i.push(t.matrix?l.a*a+l.c*h+l.tx:a,t.matrix?l.b*a+l.d*h+l.ty:h),n++,i.push(r[0],r[1]);for(let t=2;t<r.length;t+=2)i.push(r[t],r[t+1]),s.push(n++,o,n);s.push(o+1,o,n)}};function Fl(t,e=!1){const r=t.length;if(r<6)return;let i=0;for(let e=0,s=t[r-2],n=t[r-1];e<r;e+=2){const r=t[e],o=t[e+1];i+=(r-s)*(o+n),s=r,n=o}if(!e&&i>0||e&&i<=0){const e=r/2;for(let i=e+e%2;i<r;i+=2){const e=r-i-2,s=r-i-1,n=i,o=i+1;[t[e],t[n]]=[t[n],t[e]],[t[s],t[o]]=[t[o],t[s]]}}}const Ol={build(t){t.points=t.shape.points.slice()},triangulate(t,e){let r=t.points;const i=t.holes,s=e.points,n=e.indices;if(r.length>=6){Fl(r,!1);const t=[];for(let e=0;e<i.length;e++){const s=i[e];Fl(s.points,!0),t.push(r.length/2),r=r.concat(s.points)}const e=vt(r,t,2);if(!e)return;const o=s.length/2;for(let t=0;t<e.length;t+=3)n.push(e[t]+o),n.push(e[t+1]+o),n.push(e[t+2]+o);for(let t=0;t<r.length;t++)s.push(r[t])}}},kl={build(t){const e=t.shape,r=e.x,i=e.y,s=e.width,n=e.height,o=t.points;o.length=0,s>=0&&n>=0&&o.push(r,i,r+s,i,r+s,i+n,r,i+n)},triangulate(t,e){const r=t.points,i=e.points;if(0===r.length)return;const s=i.length/2;i.push(r[0],r[1],r[2],r[3],r[6],r[7],r[4],r[5]),e.indices.push(s,s+1,s+2,s+1,s+2,s+3)}},Bl={build(t){Ll.build(t)},triangulate(t,e){Ll.triangulate(t,e)}};var Nl=(t=>(t.MITER="miter",t.BEVEL="bevel",t.ROUND="round",t))(Nl||{}),Ul=(t=>(t.BUTT="butt",t.ROUND="round",t.SQUARE="square",t))(Ul||{});const Gl={adaptive:!0,maxLength:10,minSegments:8,maxSegments:2048,epsilon:1e-4,_segmentsCount(t,e=20){if(!this.adaptive||!t||isNaN(t))return e;let r=Math.ceil(t/this.maxLength);return r<this.minSegments?r=this.minSegments:r>this.maxSegments&&(r=this.maxSegments),r}},Vl=Gl;class Hl{static curveTo(t,e,r,i,s,n){const o=n[n.length-2],a=n[n.length-1]-e,h=o-t,l=i-e,u=r-t,c=Math.abs(a*u-h*l);if(c<1e-8||0===s)return(n[n.length-2]!==t||n[n.length-1]!==e)&&n.push(t,e),null;const d=a*a+h*h,f=l*l+u*u,p=a*l+h*u,_=s*Math.sqrt(d)/c,m=s*Math.sqrt(f)/c,g=_*p/d,y=m*p/f,b=_*u+m*h,v=_*l+m*a,x=h*(m+g),A=a*(m+g),T=u*(_+y),E=l*(_+y);return{cx:b+t,cy:v+e,radius:s,startAngle:Math.atan2(A-v,x-b),endAngle:Math.atan2(E-v,T-b),anticlockwise:h*l>u*a}}static arc(t,e,r,i,s,n,o,a,h){const l=o-n,u=Gl._segmentsCount(Math.abs(l)*s,40*Math.ceil(Math.abs(l)/ei)),c=l/(2*u),d=2*c,f=Math.cos(c),p=Math.sin(c),_=u-1,m=_%1/_;for(let t=0;t<=_;++t){const e=c+n+d*(t+m*t),o=Math.cos(e),a=-Math.sin(e);h.push((f*o+p*a)*s+r,(f*-a+p*o)*s+i)}}}class zl{constructor(){this.reset()}begin(t,e,r){this.reset(),this.style=t,this.start=e,this.attribStart=r}end(t,e){this.attribSize=e-this.attribStart,this.size=t-this.start}reset(){this.style=null,this.size=0,this.start=0,this.attribStart=0,this.attribSize=0}}class Xl{static curveLength(t,e,r,i,s,n,o,a){let h=0,l=0,u=0,c=0,d=0,f=0,p=0,_=0,m=0,g=0,y=0,b=t,v=e;for(let x=1;x<=10;++x)l=x/10,u=l*l,c=u*l,d=1-l,f=d*d,p=f*d,_=p*t+3*f*l*r+3*d*u*s+c*o,m=p*e+3*f*l*i+3*d*u*n+c*a,g=b-_,y=v-m,b=_,v=m,h+=Math.sqrt(g*g+y*y);return h}static curveTo(t,e,r,i,s,n,o){const a=o[o.length-2],h=o[o.length-1];o.length-=2;const l=Gl._segmentsCount(Xl.curveLength(a,h,t,e,r,i,s,n));let u=0,c=0,d=0,f=0,p=0;o.push(a,h);for(let _=1,m=0;_<=l;++_)m=_/l,u=1-m,c=u*u,d=c*u,f=m*m,p=f*m,o.push(d*a+3*c*m*t+3*u*f*r+p*s,d*h+3*c*m*e+3*u*f*i+p*n)}}function Wl(t,e,r,i,s,n,o,a){let h,l;o?(h=i,l=-r):(h=-i,l=r);const u=t-r*s+h,c=e-i*s+l,d=t+r*n+h,f=e+i*n+l;return a.push(u,c,d,f),2}function Yl(t,e,r,i,s,n,o,a){const h=r-t,l=i-e;let u=Math.atan2(h,l),c=Math.atan2(s-t,n-e);a&&u<c?u+=2*Math.PI:!a&&u>c&&(c+=2*Math.PI);let d=u;const f=c-u,p=Math.abs(f),_=Math.sqrt(h*h+l*l),m=1+(15*p*Math.sqrt(_)/Math.PI|0),g=f/m;if(d+=g,a){o.push(t,e,r,i);for(let r=1,i=d;r<m;r++,i+=g)o.push(t,e,t+Math.sin(i)*_,e+Math.cos(i)*_);o.push(t,e,s,n)}else{o.push(r,i,t,e);for(let r=1,i=d;r<m;r++,i+=g)o.push(t+Math.sin(i)*_,e+Math.cos(i)*_,t,e);o.push(s,n,t,e)}return 2*m}function jl(t,e){t.lineStyle.native?function(t,e){let r=0;const i=t.shape,s=t.points||i.points,n=i.type!==si.POLY||i.closeStroke;if(0===s.length)return;const o=e.points,a=e.indices,h=s.length/2,l=o.length/2;let u=l;for(o.push(s[0],s[1]),r=1;r<h;r++)o.push(s[2*r],s[2*r+1]),a.push(u,u+1),u++;n&&a.push(u,l)}(t,e):function(t,e){const r=t.shape;let i=t.points||r.points.slice();const s=e.closePointEps;if(0===i.length)return;const n=t.lineStyle,o=new ni(i[0],i[1]),a=new ni(i[i.length-2],i[i.length-1]),h=r.type!==si.POLY||r.closeStroke,l=Math.abs(o.x-a.x)<s&&Math.abs(o.y-a.y)<s;if(h){i=i.slice(),l&&(i.pop(),i.pop(),a.set(i[i.length-2],i[i.length-1]));const t=.5*(o.x+a.x),e=.5*(a.y+o.y);i.unshift(t,e),i.push(t,e)}const u=e.points,c=i.length/2;let d=i.length;const f=u.length/2,p=n.width/2,_=p*p,m=n.miterLimit*n.miterLimit;let g=i[0],y=i[1],b=i[2],v=i[3],x=0,A=0,T=-(y-v),E=g-b,w=0,S=0,C=Math.sqrt(T*T+E*E);T/=C,E/=C,T*=p,E*=p;const P=n.alignment,M=2*(1-P),$=2*P;h||(n.cap===Ul.ROUND?d+=Yl(g-T*(M-$)*.5,y-E*(M-$)*.5,g-T*M,y-E*M,g+T*$,y+E*$,u,!0)+2:n.cap===Ul.SQUARE&&(d+=Wl(g,y,T,E,M,$,!0,u))),u.push(g-T*M,y-E*M,g+T*$,y+E*$);for(let t=1;t<c-1;++t){g=i[2*(t-1)],y=i[2*(t-1)+1],b=i[2*t],v=i[2*t+1],x=i[2*(t+1)],A=i[2*(t+1)+1],T=-(y-v),E=g-b,C=Math.sqrt(T*T+E*E),T/=C,E/=C,T*=p,E*=p,w=-(v-A),S=b-x,C=Math.sqrt(w*w+S*S),w/=C,S/=C,w*=p,S*=p;const e=b-g,r=y-v,s=b-x,o=A-v,a=e*s+r*o,h=r*s-o*e,l=h<0;if(Math.abs(h)<.001*Math.abs(a)){u.push(b-T*M,v-E*M,b+T*$,v+E*$),a>=0&&(n.join===Nl.ROUND?d+=Yl(b,v,b-T*M,v-E*M,b-w*M,v-S*M,u,!1)+4:d+=2,u.push(b-w*$,v-S*$,b+w*M,v+S*M));continue}const c=(-T+g)*(-E+v)-(-T+b)*(-E+y),f=(-w+x)*(-S+v)-(-w+b)*(-S+A),P=(e*f-s*c)/h,I=(o*c-r*f)/h,R=(P-b)*(P-b)+(I-v)*(I-v),D=b+(P-b)*M,L=v+(I-v)*M,F=b-(P-b)*$,O=v-(I-v)*$,k=l?M:$,B=R<=Math.min(e*e+r*r,s*s+o*o)+k*k*_;let N=n.join;if(N===Nl.MITER&&R/_>m&&(N=Nl.BEVEL),B)switch(N){case Nl.MITER:u.push(D,L,F,O);break;case Nl.BEVEL:l?u.push(D,L,b+T*$,v+E*$,D,L,b+w*$,v+S*$):u.push(b-T*M,v-E*M,F,O,b-w*M,v-S*M,F,O),d+=2;break;case Nl.ROUND:l?(u.push(D,L,b+T*$,v+E*$),d+=Yl(b,v,b+T*$,v+E*$,b+w*$,v+S*$,u,!0)+4,u.push(D,L,b+w*$,v+S*$)):(u.push(b-T*M,v-E*M,F,O),d+=Yl(b,v,b-T*M,v-E*M,b-w*M,v-S*M,u,!1)+4,u.push(b-w*M,v-S*M,F,O))}else{switch(u.push(b-T*M,v-E*M,b+T*$,v+E*$),N){case Nl.MITER:l?u.push(F,O,F,O):u.push(D,L,D,L),d+=2;break;case Nl.ROUND:d+=l?Yl(b,v,b+T*$,v+E*$,b+w*$,v+S*$,u,!0)+2:Yl(b,v,b-T*M,v-E*M,b-w*M,v-S*M,u,!1)+2}u.push(b-w*M,v-S*M,b+w*$,v+S*$),d+=2}}g=i[2*(c-2)],y=i[2*(c-2)+1],b=i[2*(c-1)],v=i[2*(c-1)+1],T=-(y-v),E=g-b,C=Math.sqrt(T*T+E*E),T/=C,E/=C,T*=p,E*=p,u.push(b-T*M,v-E*M,b+T*$,v+E*$),h||(n.cap===Ul.ROUND?d+=Yl(b-T*(M-$)*.5,v-E*(M-$)*.5,b-T*M,v-E*M,b+T*$,v+E*$,u,!1)+2:n.cap===Ul.SQUARE&&(d+=Wl(b,v,T,E,M,$,!1,u)));const I=e.indices,R=Gl.epsilon*Gl.epsilon;for(let t=f;t<d+f-2;++t)g=u[2*t],y=u[2*t+1],b=u[2*(t+1)],v=u[2*(t+1)+1],x=u[2*(t+2)],A=u[2*(t+2)+1],!(Math.abs(g*(v-A)+b*(A-y)+x*(y-v))<R)&&I.push(t,t+1,t+2)}(t,e)}class ql{static curveLength(t,e,r,i,s,n){const o=t-2*r+s,a=e-2*i+n,h=2*r-2*t,l=2*i-2*e,u=4*(o*o+a*a),c=4*(o*h+a*l),d=h*h+l*l,f=2*Math.sqrt(u+c+d),p=Math.sqrt(u),_=2*u*p,m=2*Math.sqrt(d),g=c/p;return(_*f+p*c*(f-m)+(4*d*u-c*c)*Math.log((2*p+g+f)/(g+m)))/(4*_)}static curveTo(t,e,r,i,s){const n=s[s.length-2],o=s[s.length-1],a=Gl._segmentsCount(ql.curveLength(n,o,t,e,r,i));let h=0,l=0;for(let u=1;u<=a;++u){const c=u/a;h=n+(t-n)*c,l=o+(e-o)*c,s.push(h+(t+(r-t)*c-h)*c,l+(e+(i-e)*c-l)*c)}}}const Zl={[si.POLY]:Ol,[si.CIRC]:Ll,[si.ELIP]:Ll,[si.RECT]:kl,[si.RREC]:Bl},Ql=[],Jl=[];class Kl{constructor(t,e=null,r=null,i=null){this.points=[],this.holes=[],this.shape=t,this.lineStyle=r,this.fillStyle=e,this.matrix=i,this.type=t.type}clone(){return new Kl(this.shape,this.fillStyle,this.lineStyle,this.matrix)}destroy(){this.shape=null,this.holes.length=0,this.holes=null,this.points.length=0,this.points=null,this.lineStyle=null,this.fillStyle=null}}const tu=new ni,eu=class t extends ti{constructor(){super(),this.closePointEps=1e-4,this.boundsPadding=0,this.uvsFloat32=null,this.indicesUint16=null,this.batchable=!1,this.points=[],this.colors=[],this.uvs=[],this.indices=[],this.textureIds=[],this.graphicsData=[],this.drawCalls=[],this.batchDirty=-1,this.batches=[],this.dirty=0,this.cacheDirty=-1,this.clearDirty=0,this.shapeIndex=0,this._bounds=new qn,this.boundsDirty=-1}get bounds(){return this.updateBatches(),this.boundsDirty!==this.dirty&&(this.boundsDirty=this.dirty,this.calculateBounds()),this._bounds}invalidate(){this.boundsDirty=-1,this.dirty++,this.batchDirty++,this.shapeIndex=0,this.points.length=0,this.colors.length=0,this.uvs.length=0,this.indices.length=0,this.textureIds.length=0;for(let t=0;t<this.drawCalls.length;t++)this.drawCalls[t].texArray.clear(),Jl.push(this.drawCalls[t]);this.drawCalls.length=0;for(let t=0;t<this.batches.length;t++){const e=this.batches[t];e.reset(),Ql.push(e)}this.batches.length=0}clear(){return this.graphicsData.length>0&&(this.invalidate(),this.clearDirty++,this.graphicsData.length=0),this}drawShape(t,e=null,r=null,i=null){const s=new Kl(t,e,r,i);return this.graphicsData.push(s),this.dirty++,this}drawHole(t,e=null){if(!this.graphicsData.length)return null;const r=new Kl(t,null,null,e),i=this.graphicsData[this.graphicsData.length-1];return r.lineStyle=i.lineStyle,i.holes.push(r),this.dirty++,this}destroy(){super.destroy();for(let t=0;t<this.graphicsData.length;++t)this.graphicsData[t].destroy();this.points.length=0,this.points=null,this.colors.length=0,this.colors=null,this.uvs.length=0,this.uvs=null,this.indices.length=0,this.indices=null,this.indexBuffer.destroy(),this.indexBuffer=null,this.graphicsData.length=0,this.graphicsData=null,this.drawCalls.length=0,this.drawCalls=null,this.batches.length=0,this.batches=null,this._bounds=null}containsPoint(t){const e=this.graphicsData;for(let r=0;r<e.length;++r){const i=e[r];if(i.fillStyle.visible&&i.shape&&(i.matrix?i.matrix.applyInverse(t,tu):tu.copyFrom(t),i.shape.contains(tu.x,tu.y))){let t=!1;if(i.holes)for(let e=0;e<i.holes.length;e++)if(i.holes[e].shape.contains(tu.x,tu.y)){t=!0;break}if(!t)return!0}}return!1}updateBatches(){if(!this.graphicsData.length)return void(this.batchable=!0);if(!this.validateBatching())return;this.cacheDirty=this.dirty;const t=this.uvs,e=this.graphicsData;let r=null,i=null;this.batches.length>0&&(r=this.batches[this.batches.length-1],i=r.style);for(let s=this.shapeIndex;s<e.length;s++){this.shapeIndex++;const n=e[s],o=n.fillStyle,a=n.lineStyle;Zl[n.type].build(n),n.matrix&&this.transformPoints(n.points,n.matrix),(o.visible||a.visible)&&this.processHoles(n.holes);for(let e=0;e<2;e++){const s=0===e?o:a;if(!s.visible)continue;const h=s.texture.baseTexture,l=this.indices.length,u=this.points.length/2;h.wrapMode=d.REPEAT,0===e?this.processFill(n):this.processLine(n);const c=this.points.length/2-u;0!==c&&(r&&!this._compareStyles(i,s)&&(r.end(l,u),r=null),r||(r=Ql.pop()||new zl,r.begin(s,l,u),this.batches.push(r),i=s),this.addUvs(this.points,t,s.texture,u,c,s.matrix))}}const s=this.indices.length,n=this.points.length/2;if(r&&r.end(s,n),0===this.batches.length)return void(this.batchable=!0);const o=n>65535;this.indicesUint16&&this.indices.length===this.indicesUint16.length&&o===this.indicesUint16.BYTES_PER_ELEMENT>2?this.indicesUint16.set(this.indices):this.indicesUint16=o?new Uint32Array(this.indices):new Uint16Array(this.indices),this.batchable=this.isBatchable(),this.batchable?this.packBatches():this.buildDrawCalls()}_compareStyles(t,e){return!(!t||!e||t.texture.baseTexture!==e.texture.baseTexture||t.color+t.alpha!==e.color+e.alpha||!!t.native!=!!e.native)}validateBatching(){if(this.dirty===this.cacheDirty||!this.graphicsData.length)return!1;for(let t=0,e=this.graphicsData.length;t<e;t++){const e=this.graphicsData[t],r=e.fillStyle,i=e.lineStyle;if(r&&!r.texture.baseTexture.valid||i&&!i.texture.baseTexture.valid)return!1}return!0}packBatches(){this.batchDirty++,this.uvsFloat32=new Float32Array(this.uvs);const t=this.batches;for(let e=0,r=t.length;e<r;e++){const r=t[e];for(let t=0;t<r.size;t++){const e=r.start+t;this.indicesUint16[e]=this.indicesUint16[e]-r.attribStart}}}isBatchable(){if(this.points.length>131070)return!1;const e=this.batches;for(let t=0;t<e.length;t++)if(e[t].style.native)return!1;return this.points.length<2*t.BATCHABLE_SIZE}buildDrawCalls(){let t=++zr._globalBatch;for(let t=0;t<this.drawCalls.length;t++)this.drawCalls[t].texArray.clear(),Jl.push(this.drawCalls[t]);this.drawCalls.length=0;const e=this.colors,r=this.textureIds;let i=Jl.pop();i||(i=new Xr,i.texArray=new Qi),i.texArray.count=0,i.start=0,i.size=0,i.type=o.TRIANGLES;let s=0,n=null,a=0,h=!1,l=o.TRIANGLES,u=0;this.drawCalls.push(i);for(let c=0;c<this.batches.length;c++){const f=this.batches[c],p=8,_=f.style,m=_.texture.baseTexture;h!==!!_.native&&(h=!!_.native,l=h?o.LINES:o.TRIANGLES,n=null,s=p,t++),n!==m&&(n=m,m._batchEnabled!==t&&(s===p&&(t++,s=0,i.size>0&&(i=Jl.pop(),i||(i=new Xr,i.texArray=new Qi),this.drawCalls.push(i)),i.start=u,i.size=0,i.texArray.count=0,i.type=l),m.touched=1,m._batchEnabled=t,m._batchLocation=s,m.wrapMode=d.REPEAT,i.texArray.elements[i.texArray.count++]=m,s++)),i.size+=f.size,u+=f.size,a=m._batchLocation,this.addColors(e,_.color,_.alpha,f.attribSize,f.attribStart),this.addTextureIds(r,a,f.attribSize,f.attribStart)}zr._globalBatch=t,this.packAttributes()}packAttributes(){const t=this.points,e=this.uvs,r=this.colors,i=this.textureIds,s=new ArrayBuffer(3*t.length*4),n=new Float32Array(s),o=new Uint32Array(s);let a=0;for(let s=0;s<t.length/2;s++)n[a++]=t[2*s],n[a++]=t[2*s+1],n[a++]=e[2*s],n[a++]=e[2*s+1],o[a++]=r[s],n[a++]=i[s];this._buffer.update(s),this._indexBuffer.update(this.indicesUint16)}processFill(t){t.holes.length?Ol.triangulate(t,this):Zl[t.type].triangulate(t,this)}processLine(t){jl(t,this);for(let e=0;e<t.holes.length;e++)jl(t.holes[e],this)}processHoles(t){for(let e=0;e<t.length;e++){const r=t[e];Zl[r.type].build(r),r.matrix&&this.transformPoints(r.points,r.matrix)}}calculateBounds(){const t=this._bounds;t.clear(),t.addVertexData(this.points,0,this.points.length),t.pad(this.boundsPadding,this.boundsPadding)}transformPoints(t,e){for(let r=0;r<t.length/2;r++){const i=t[2*r],s=t[2*r+1];t[2*r]=e.a*i+e.c*s+e.tx,t[2*r+1]=e.b*i+e.d*s+e.ty}}addColors(t,e,r,i,s=0){const n=Ue.shared.setValue(e).toLittleEndianNumber(),o=Ue.shared.setValue(n).toPremultiplied(r);t.length=Math.max(t.length,s+i);for(let e=0;e<i;e++)t[s+e]=o}addTextureIds(t,e,r,i=0){t.length=Math.max(t.length,i+r);for(let s=0;s<r;s++)t[i+s]=e}addUvs(t,e,r,i,s,n=null){let o=0;const a=e.length,h=r.frame;for(;o<s;){let r=t[2*(i+o)],s=t[2*(i+o)+1];if(n){const t=n.a*r+n.c*s+n.tx;s=n.b*r+n.d*s+n.ty,r=t}o++,e.push(r/h.width,s/h.height)}const l=r.baseTexture;(h.width<l.width||h.height<l.height)&&this.adjustUvs(e,r,a,s)}adjustUvs(t,e,r,i){const s=e.baseTexture,n=1e-6,o=r+2*i,a=e.frame,h=a.width/s.width,l=a.height/s.height;let u=a.x/a.width,c=a.y/a.height,d=Math.floor(t[r]+n),f=Math.floor(t[r+1]+n);for(let e=r+2;e<o;e+=2)d=Math.min(d,Math.floor(t[e]+n)),f=Math.min(f,Math.floor(t[e+1]+n));u-=d,c-=f;for(let e=r;e<o;e+=2)t[e]=(t[e]+u)*h,t[e+1]=(t[e+1]+c)*l}};eu.BATCHABLE_SIZE=100;let ru=eu;class iu{constructor(){this.color=16777215,this.alpha=1,this.texture=ps.WHITE,this.matrix=null,this.visible=!1,this.reset()}clone(){const t=new iu;return t.color=this.color,t.alpha=this.alpha,t.texture=this.texture,t.matrix=this.matrix,t.visible=this.visible,t}reset(){this.color=16777215,this.alpha=1,this.texture=ps.WHITE,this.matrix=null,this.visible=!1}destroy(){this.texture=null,this.matrix=null}}class su extends iu{constructor(){super(...arguments),this.width=0,this.alignment=.5,this.native=!1,this.cap=Ul.BUTT,this.join=Nl.MITER,this.miterLimit=10}clone(){const t=new su;return t.color=this.color,t.alpha=this.alpha,t.texture=this.texture,t.matrix=this.matrix,t.visible=this.visible,t.width=this.width,t.alignment=this.alignment,t.native=this.native,t.cap=this.cap,t.join=this.join,t.miterLimit=this.miterLimit,t}reset(){super.reset(),this.color=0,this.alignment=.5,this.width=0,this.native=!1,this.cap=Ul.BUTT,this.join=Nl.MITER,this.miterLimit=10}}const nu={},ou=class t extends eo{constructor(t=null){super(),this.shader=null,this.pluginName="batch",this.currentPath=null,this.batches=[],this.batchTint=-1,this.batchDirty=-1,this.vertexData=null,this._fillStyle=new iu,this._lineStyle=new su,this._matrix=null,this._holeMode=!1,this.state=Ir.for2d(),this._geometry=t||new ru,this._geometry.refCount++,this._transformID=-1,this._tintColor=new Ue(16777215),this.blendMode=n.NORMAL}get geometry(){return this._geometry}clone(){return this.finishPoly(),new t(this._geometry)}set blendMode(t){this.state.blendMode=t}get blendMode(){return this.state.blendMode}get tint(){return this._tintColor.value}set tint(t){this._tintColor.setValue(t)}get fill(){return this._fillStyle}get line(){return this._lineStyle}lineStyle(t=null,e=0,r,i=.5,s=!1){return"number"==typeof t&&(t={width:t,color:e,alpha:r,alignment:i,native:s}),this.lineTextureStyle(t)}lineTextureStyle(t){const e={width:0,texture:ps.WHITE,color:null!=t&&t.texture?16777215:0,matrix:null,alignment:.5,native:!1,cap:Ul.BUTT,join:Nl.MITER,miterLimit:10};t=Object.assign(e,t),this.normalizeColor(t),this.currentPath&&this.startPoly();const r=t.width>0&&t.alpha>0;return r?(t.matrix&&(t.matrix=t.matrix.clone(),t.matrix.invert()),Object.assign(this._lineStyle,{visible:r},t)):this._lineStyle.reset(),this}startPoly(){if(this.currentPath){const t=this.currentPath.points,e=this.currentPath.points.length;e>2&&(this.drawShape(this.currentPath),this.currentPath=new ui,this.currentPath.closeStroke=!1,this.currentPath.points.push(t[e-2],t[e-1]))}else this.currentPath=new ui,this.currentPath.closeStroke=!1}finishPoly(){this.currentPath&&(this.currentPath.points.length>2?(this.drawShape(this.currentPath),this.currentPath=null):this.currentPath.points.length=0)}moveTo(t,e){return this.startPoly(),this.currentPath.points[0]=t,this.currentPath.points[1]=e,this}lineTo(t,e){this.currentPath||this.moveTo(0,0);const r=this.currentPath.points,i=r[r.length-2],s=r[r.length-1];return(i!==t||s!==e)&&r.push(t,e),this}_initCurve(t=0,e=0){this.currentPath?0===this.currentPath.points.length&&(this.currentPath.points=[t,e]):this.moveTo(t,e)}quadraticCurveTo(t,e,r,i){this._initCurve();const s=this.currentPath.points;return 0===s.length&&this.moveTo(0,0),ql.curveTo(t,e,r,i,s),this}bezierCurveTo(t,e,r,i,s,n){return this._initCurve(),Xl.curveTo(t,e,r,i,s,n,this.currentPath.points),this}arcTo(t,e,r,i,s){this._initCurve(t,e);const n=this.currentPath.points,o=Hl.curveTo(t,e,r,i,s,n);if(o){const{cx:t,cy:e,radius:r,startAngle:i,endAngle:s,anticlockwise:n}=o;this.arc(t,e,r,i,s,n)}return this}arc(t,e,r,i,s,n=!1){if(i===s)return this;if(!n&&s<=i?s+=ei:n&&i<=s&&(i+=ei),s-i==0)return this;const o=t+Math.cos(i)*r,a=e+Math.sin(i)*r,h=this._geometry.closePointEps;let l=this.currentPath?this.currentPath.points:null;if(l){const t=Math.abs(l[l.length-2]-o),e=Math.abs(l[l.length-1]-a);t<h&&e<h||l.push(o,a)}else this.moveTo(o,a),l=this.currentPath.points;return Hl.arc(o,a,t,e,r,i,s,n,l),this}beginFill(t=0,e){return this.beginTextureFill({texture:ps.WHITE,color:t,alpha:e})}normalizeColor(t){var e;const r=Ue.shared.setValue(null!=(e=t.color)?e:0);t.color=r.toNumber(),null!=t.alpha||(t.alpha=r.alpha)}beginTextureFill(t){const e={texture:ps.WHITE,color:16777215,matrix:null};t=Object.assign(e,t),this.normalizeColor(t),this.currentPath&&this.startPoly();const r=t.alpha>0;return r?(t.matrix&&(t.matrix=t.matrix.clone(),t.matrix.invert()),Object.assign(this._fillStyle,{visible:r},t)):this._fillStyle.reset(),this}endFill(){return this.finishPoly(),this._fillStyle.reset(),this}drawRect(t,e,r,i){return this.drawShape(new ai(t,e,r,i))}drawRoundedRect(t,e,r,i,s){return this.drawShape(new ci(t,e,r,i,s))}drawCircle(t,e,r){return this.drawShape(new hi(t,e,r))}drawEllipse(t,e,r,i){return this.drawShape(new li(t,e,r,i))}drawPolygon(...t){let e,r=!0;const i=t[0];i.points?(r=i.closeStroke,e=i.points):e=Array.isArray(t[0])?t[0]:t;const s=new ui(e);return s.closeStroke=r,this.drawShape(s),this}drawShape(t){return this._holeMode?this._geometry.drawHole(t,this._matrix):this._geometry.drawShape(t,this._fillStyle.clone(),this._lineStyle.clone(),this._matrix),this}clear(){return this._geometry.clear(),this._lineStyle.reset(),this._fillStyle.reset(),this._boundsID++,this._matrix=null,this._holeMode=!1,this.currentPath=null,this}isFastRect(){const t=this._geometry.graphicsData;return!(1!==t.length||t[0].shape.type!==si.RECT||t[0].matrix||t[0].holes.length||t[0].lineStyle.visible&&t[0].lineStyle.width)}_render(t){this.finishPoly();const e=this._geometry;e.updateBatches(),e.batchable?(this.batchDirty!==e.batchDirty&&this._populateBatches(),this._renderBatched(t)):(t.batch.flush(),this._renderDirect(t))}_populateBatches(){const t=this._geometry,e=this.blendMode,r=t.batches.length;this.batchTint=-1,this._transformID=-1,this.batchDirty=t.batchDirty,this.batches.length=r,this.vertexData=new Float32Array(t.points);for(let i=0;i<r;i++){const r=t.batches[i],s=r.style.color,n=new Float32Array(this.vertexData.buffer,4*r.attribStart*2,2*r.attribSize),o=new Float32Array(t.uvsFloat32.buffer,4*r.attribStart*2,2*r.attribSize),a={vertexData:n,blendMode:e,indices:new Uint16Array(t.indicesUint16.buffer,2*r.start,r.size),uvs:o,_batchRGB:Ue.shared.setValue(s).toRgbArray(),_tintRGB:s,_texture:r.style.texture,alpha:r.style.alpha,worldAlpha:1};this.batches[i]=a}}_renderBatched(t){if(this.batches.length){t.batch.setObjectRenderer(t.plugins[this.pluginName]),this.calculateVertices(),this.calculateTints();for(let e=0,r=this.batches.length;e<r;e++){const r=this.batches[e];r.worldAlpha=this.worldAlpha*r.alpha,t.plugins[this.pluginName].render(r)}}}_renderDirect(t){const e=this._resolveDirectShader(t),r=this._geometry,i=this.worldAlpha,s=e.uniforms,n=r.drawCalls;s.translationMatrix=this.transform.worldTransform,Ue.shared.setValue(this._tintColor).premultiply(i).toArray(s.tint),t.shader.bind(e),t.geometry.bind(r,e),t.state.set(this.state);for(let e=0,i=n.length;e<i;e++)this._renderDrawCallDirect(t,r.drawCalls[e])}_renderDrawCallDirect(t,e){const{texArray:r,type:i,size:s,start:n}=e,o=r.count;for(let e=0;e<o;e++)t.texture.bind(r.elements[e],e);t.geometry.draw(i,s,n)}_resolveDirectShader(t){let e=this.shader;const r=this.pluginName;if(!e){if(!nu[r]){const{maxTextures:e}=t.plugins[r],i=new Int32Array(e);for(let t=0;t<e;t++)i[t]=t;const s={tint:new Float32Array([1,1,1,1]),translationMatrix:new di,default:ji.from({uSamplers:i},!0)},n=t.plugins[r]._shader.program;nu[r]=new qi(n,s)}e=nu[r]}return e}_calculateBounds(){this.finishPoly();const t=this._geometry;if(!t.graphicsData.length)return;const{minX:e,minY:r,maxX:i,maxY:s}=t.bounds;this._bounds.addFrame(this.transform,e,r,i,s)}containsPoint(e){return this.worldTransform.applyInverse(e,t._TEMP_POINT),this._geometry.containsPoint(t._TEMP_POINT)}calculateTints(){if(this.batchTint!==this.tint){this.batchTint=this._tintColor.toNumber();for(let t=0;t<this.batches.length;t++){const e=this.batches[t];e._tintRGB=Ue.shared.setValue(this._tintColor).multiply(e._batchRGB).toLittleEndianNumber()}}}calculateVertices(){const t=this.transform._worldID;if(this._transformID===t)return;this._transformID=t;const e=this.transform.worldTransform,r=e.a,i=e.b,s=e.c,n=e.d,o=e.tx,a=e.ty,h=this._geometry.points,l=this.vertexData;let u=0;for(let t=0;t<h.length;t+=2){const e=h[t],c=h[t+1];l[u++]=r*e+s*c+o,l[u++]=n*c+i*e+a}}closePath(){const t=this.currentPath;return t&&(t.closeStroke=!0,this.finishPoly()),this}setMatrix(t){return this._matrix=t,this}beginHole(){return this.finishPoly(),this._holeMode=!0,this}endHole(){return this.finishPoly(),this._holeMode=!1,this}destroy(t){this._geometry.refCount--,0===this._geometry.refCount&&this._geometry.dispose(),this._matrix=null,this.currentPath=null,this._lineStyle.destroy(),this._lineStyle=null,this._fillStyle.destroy(),this._fillStyle=null,this._geometry=null,this.shader=null,this.vertexData=null,this.batches.length=0,this.batches=null,super.destroy(t)}};ou.curves=Gl,ou._TEMP_POINT=new ni;let au=ou;const hu={buildPoly:Ol,buildCircle:Ll,buildRectangle:kl,buildRoundedRectangle:Bl,buildLine:jl,ArcUtils:Hl,BezierUtils:Xl,QuadraticUtils:ql,BatchPart:zl,FILL_COMMANDS:Zl,BATCH_POOL:Ql,DRAW_CALL_POOL:Jl};class lu{constructor(t,e){this.uvBuffer=t,this.uvMatrix=e,this.data=null,this._bufferUpdateId=-1,this._textureUpdateId=-1,this._updateID=0}update(t){if(!t&&this._bufferUpdateId===this.uvBuffer._updateID&&this._textureUpdateId===this.uvMatrix._updateID)return;this._bufferUpdateId=this.uvBuffer._updateID,this._textureUpdateId=this.uvMatrix._updateID;const e=this.uvBuffer.data;(!this.data||this.data.length!==e.length)&&(this.data=new Float32Array(e.length)),this.uvMatrix.multiplyUvs(e,this.data),this._updateID++}}const uu=new ni,cu=new ui,du=class t extends eo{constructor(t,e,r,i=o.TRIANGLES){super(),this.geometry=t,this.shader=e,this.state=r||Ir.for2d(),this.drawMode=i,this.start=0,this.size=0,this.uvs=null,this.indices=null,this.vertexData=new Float32Array(1),this.vertexDirty=-1,this._transformID=-1,this._roundPixels=T.ROUND_PIXELS,this.batchUvs=null}get geometry(){return this._geometry}set geometry(t){this._geometry!==t&&(this._geometry&&(this._geometry.refCount--,0===this._geometry.refCount&&this._geometry.dispose()),this._geometry=t,this._geometry&&this._geometry.refCount++,this.vertexDirty=-1)}get uvBuffer(){return this.geometry.buffers[1]}get verticesBuffer(){return this.geometry.buffers[0]}set material(t){this.shader=t}get material(){return this.shader}set blendMode(t){this.state.blendMode=t}get blendMode(){return this.state.blendMode}set roundPixels(t){this._roundPixels!==t&&(this._transformID=-1),this._roundPixels=t}get roundPixels(){return this._roundPixels}get tint(){return"tint"in this.shader?this.shader.tint:null}set tint(t){this.shader.tint=t}get tintValue(){return this.shader.tintValue}get texture(){return"texture"in this.shader?this.shader.texture:null}set texture(t){this.shader.texture=t}_render(e){const r=this.geometry.buffers[0].data;this.shader.batchable&&this.drawMode===o.TRIANGLES&&r.length<2*t.BATCHABLE_SIZE?this._renderToBatch(e):this._renderDefault(e)}_renderDefault(t){const e=this.shader;e.alpha=this.worldAlpha,e.update&&e.update(),t.batch.flush(),e.uniforms.translationMatrix=this.transform.worldTransform.toArray(!0),t.shader.bind(e),t.state.set(this.state),t.geometry.bind(this.geometry,e),t.geometry.draw(this.drawMode,this.size,this.start,this.geometry.instanceCount)}_renderToBatch(t){const e=this.geometry,r=this.shader;r.uvMatrix&&(r.uvMatrix.update(),this.calculateUvs()),this.calculateVertices(),this.indices=e.indexBuffer.data,this._tintRGB=r._tintRGB,this._texture=r.texture;const i=this.material.pluginName;t.batch.setObjectRenderer(t.plugins[i]),t.plugins[i].render(this)}calculateVertices(){const t=this.geometry.buffers[0],e=t.data,r=t._updateID;if(r===this.vertexDirty&&this._transformID===this.transform._worldID)return;this._transformID=this.transform._worldID,this.vertexData.length!==e.length&&(this.vertexData=new Float32Array(e.length));const i=this.transform.worldTransform,s=i.a,n=i.b,o=i.c,a=i.d,h=i.tx,l=i.ty,u=this.vertexData;for(let t=0;t<u.length/2;t++){const r=e[2*t],i=e[2*t+1];u[2*t]=s*r+o*i+h,u[2*t+1]=n*r+a*i+l}if(this._roundPixels){const t=T.RESOLUTION;for(let e=0;e<u.length;++e)u[e]=Math.round(u[e]*t)/t}this.vertexDirty=r}calculateUvs(){const t=this.geometry.buffers[1],e=this.shader;e.uvMatrix.isSimple?this.uvs=t.data:(this.batchUvs||(this.batchUvs=new lu(t,e.uvMatrix)),this.batchUvs.update(),this.uvs=this.batchUvs.data)}_calculateBounds(){this.calculateVertices(),this._bounds.addVertexData(this.vertexData,0,this.vertexData.length)}containsPoint(t){if(!this.getBounds().contains(t.x,t.y))return!1;this.worldTransform.applyInverse(t,uu);const e=this.geometry.getBuffer("aVertexPosition").data,r=cu.points,i=this.geometry.getIndex().data,s=i.length,n=4===this.drawMode?3:1;for(let t=0;t+2<s;t+=n){const s=2*i[t],n=2*i[t+1],o=2*i[t+2];if(r[0]=e[s],r[1]=e[s+1],r[2]=e[n],r[3]=e[n+1],r[4]=e[o],r[5]=e[o+1],cu.contains(uu.x,uu.y))return!0}return!1}destroy(t){super.destroy(t),this._cachedTexture&&(this._cachedTexture.destroy(),this._cachedTexture=null),this.geometry=null,this.shader=null,this.state=null,this.uvs=null,this.indices=null,this.vertexData=null}};du.BATCHABLE_SIZE=100;let fu=du;class pu extends Kr{constructor(t,e,r){super();const i=new Yr(t),s=new Yr(e,!0),n=new Yr(r,!0,!0);this.addAttribute("aVertexPosition",i,2,!1,l.FLOAT).addAttribute("aTextureCoord",s,2,!1,l.FLOAT).addIndex(n),this._updateId=-1}get vertexDirtyId(){return this.buffers[0]._updateID}}class _u extends qi{constructor(t,e){const r={uSampler:t,alpha:1,uTextureMatrix:di.IDENTITY,uColor:new Float32Array([1,1,1,1])};(e=Object.assign({tint:16777215,alpha:1,pluginName:"batch"},e)).uniforms&&Object.assign(r,e.uniforms),super(e.program||Wi.from("attribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\n\nuniform mat3 projectionMatrix;\nuniform mat3 translationMatrix;\nuniform mat3 uTextureMatrix;\n\nvarying vec2 vTextureCoord;\n\nvoid main(void)\n{\n    gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n\n    vTextureCoord = (uTextureMatrix * vec3(aTextureCoord, 1.0)).xy;\n}\n","varying vec2 vTextureCoord;\nuniform vec4 uColor;\n\nuniform sampler2D uSampler;\n\nvoid main(void)\n{\n    gl_FragColor = texture2D(uSampler, vTextureCoord) * uColor;\n}\n"),r),this._colorDirty=!1,this.uvMatrix=new Ms(t),this.batchable=void 0===e.program,this.pluginName=e.pluginName,this._tintColor=new Ue(e.tint),this._tintRGB=this._tintColor.toLittleEndianNumber(),this._colorDirty=!0,this.alpha=e.alpha}get texture(){return this.uniforms.uSampler}set texture(t){this.uniforms.uSampler!==t&&(!this.uniforms.uSampler.baseTexture.alphaMode!=!t.baseTexture.alphaMode&&(this._colorDirty=!0),this.uniforms.uSampler=t,this.uvMatrix.texture=t)}set alpha(t){t!==this._alpha&&(this._alpha=t,this._colorDirty=!0)}get alpha(){return this._alpha}set tint(t){t!==this.tint&&(this._tintColor.setValue(t),this._tintRGB=this._tintColor.toLittleEndianNumber(),this._colorDirty=!0)}get tint(){return this._tintColor.value}get tintValue(){return this._tintColor.toNumber()}update(){if(this._colorDirty){this._colorDirty=!1;const t=this.texture.baseTexture.alphaMode;Ue.shared.setValue(this._tintColor).premultiply(this._alpha,t).toArray(this.uniforms.uColor)}this.uvMatrix.update()&&(this.uniforms.uTextureMatrix=this.uvMatrix.mapCoord)}}class mu extends pu{constructor(t=100,e=100,r=10,i=10){super(),this.segWidth=r,this.segHeight=i,this.width=t,this.height=e,this.build()}build(){const t=this.segWidth*this.segHeight,e=[],r=[],i=[],s=this.segWidth-1,n=this.segHeight-1,o=this.width/s,a=this.height/n;for(let i=0;i<t;i++){const t=i%this.segWidth,h=i/this.segWidth|0;e.push(t*o,h*a),r.push(t/s,h/n)}const h=s*n;for(let t=0;t<h;t++){const e=t%s,r=t/s|0,n=r*this.segWidth+e,o=r*this.segWidth+e+1,a=(r+1)*this.segWidth+e,h=(r+1)*this.segWidth+e+1;i.push(n,o,a,o,h,a)}this.buffers[0].data=new Float32Array(e),this.buffers[1].data=new Float32Array(r),this.indexBuffer.data=new Uint16Array(i),this.buffers[0].update(),this.buffers[1].update(),this.indexBuffer.update()}}class gu extends pu{constructor(t=200,e,r=0){super(new Float32Array(4*e.length),new Float32Array(4*e.length),new Uint16Array(6*(e.length-1))),this.points=e,this._width=t,this.textureScale=r,this.build()}get width(){return this._width}build(){const t=this.points;if(!t)return;const e=this.getBuffer("aVertexPosition"),r=this.getBuffer("aTextureCoord"),i=this.getIndex();if(t.length<1)return;e.data.length/4!==t.length&&(e.data=new Float32Array(4*t.length),r.data=new Float32Array(4*t.length),i.data=new Uint16Array(6*(t.length-1)));const s=r.data,n=i.data;s[0]=0,s[1]=0,s[2]=0,s[3]=1;let o=0,a=t[0];const h=this._width*this.textureScale,l=t.length;for(let e=0;e<l;e++){const r=4*e;if(this.textureScale>0){const r=a.x-t[e].x,i=a.y-t[e].y,s=Math.sqrt(r*r+i*i);a=t[e],o+=s/h}else o=e/(l-1);s[r]=o,s[r+1]=0,s[r+2]=o,s[r+3]=1}let u=0;for(let t=0;t<l-1;t++){const e=2*t;n[u++]=e,n[u++]=e+1,n[u++]=e+2,n[u++]=e+2,n[u++]=e+1,n[u++]=e+3}r.update(),i.update(),this.updateVertices()}updateVertices(){const t=this.points;if(t.length<1)return;let e,r=t[0],i=0,s=0;const n=this.buffers[0].data,o=t.length,a=this.textureScale>0?this.textureScale*this._width/2:this._width/2;for(let h=0;h<o;h++){const l=t[h],u=4*h;e=h<t.length-1?t[h+1]:l,s=-(e.x-r.x),i=e.y-r.y;let c=10*(1-h/(o-1));c>1&&(c=1);const d=Math.sqrt(i*i+s*s);d<1e-6?(i=0,s=0):(i/=d,s/=d,i*=a,s*=a),n[u]=l.x+i,n[u+1]=l.y+s,n[u+2]=l.x-i,n[u+3]=l.y-s,r=l}this.buffers[0].update()}update(){this.textureScale>0?this.build():this.updateVertices()}}class yu extends fu{constructor(t,e,r){super(new mu(t.width,t.height,e,r),new _u(ps.WHITE)),this.texture=t,this.autoResize=!0}textureUpdated(){this._textureID=this.shader.texture._updateID;const t=this.geometry,{width:e,height:r}=this.shader.texture;this.autoResize&&(t.width!==e||t.height!==r)&&(t.width=this.shader.texture.width,t.height=this.shader.texture.height,t.build())}set texture(t){this.shader.texture!==t&&(this.shader.texture=t,this._textureID=-1,t.baseTexture.valid?this.textureUpdated():t.once("update",this.textureUpdated,this))}get texture(){return this.shader.texture}_render(t){this._textureID!==this.shader.texture._updateID&&this.textureUpdated(),super._render(t)}destroy(t){this.shader.texture.off("update",this.textureUpdated,this),super.destroy(t)}}class bu{constructor(t,e,r){this.geometry=new Kr,this.indexBuffer=null,this.size=r,this.dynamicProperties=[],this.staticProperties=[];for(let r=0;r<t.length;++r){let i=t[r];i={attributeName:i.attributeName,size:i.size,uploadFunction:i.uploadFunction,type:i.type||l.FLOAT,offset:i.offset},e[r]?this.dynamicProperties.push(i):this.staticProperties.push(i)}this.staticStride=0,this.staticBuffer=null,this.staticData=null,this.staticDataUint32=null,this.dynamicStride=0,this.dynamicBuffer=null,this.dynamicData=null,this.dynamicDataUint32=null,this._updateID=0,this.initBuffers()}initBuffers(){const t=this.geometry;let e=0;this.indexBuffer=new Yr(We(this.size),!0,!0),t.addIndex(this.indexBuffer),this.dynamicStride=0;for(let t=0;t<this.dynamicProperties.length;++t){const r=this.dynamicProperties[t];r.offset=e,e+=r.size,this.dynamicStride+=r.size}const r=new ArrayBuffer(this.size*this.dynamicStride*4*4);this.dynamicData=new Float32Array(r),this.dynamicDataUint32=new Uint32Array(r),this.dynamicBuffer=new Yr(this.dynamicData,!1,!1);let i=0;this.staticStride=0;for(let t=0;t<this.staticProperties.length;++t){const e=this.staticProperties[t];e.offset=i,i+=e.size,this.staticStride+=e.size}const s=new ArrayBuffer(this.size*this.staticStride*4*4);this.staticData=new Float32Array(s),this.staticDataUint32=new Uint32Array(s),this.staticBuffer=new Yr(this.staticData,!0,!1);for(let e=0;e<this.dynamicProperties.length;++e){const r=this.dynamicProperties[e];t.addAttribute(r.attributeName,this.dynamicBuffer,0,r.type===l.UNSIGNED_BYTE,r.type,4*this.dynamicStride,4*r.offset)}for(let e=0;e<this.staticProperties.length;++e){const r=this.staticProperties[e];t.addAttribute(r.attributeName,this.staticBuffer,0,r.type===l.UNSIGNED_BYTE,r.type,4*this.staticStride,4*r.offset)}}uploadDynamic(t,e,r){for(let i=0;i<this.dynamicProperties.length;i++){const s=this.dynamicProperties[i];s.uploadFunction(t,e,r,s.type===l.UNSIGNED_BYTE?this.dynamicDataUint32:this.dynamicData,this.dynamicStride,s.offset)}this.dynamicBuffer._updateID++}uploadStatic(t,e,r){for(let i=0;i<this.staticProperties.length;i++){const s=this.staticProperties[i];s.uploadFunction(t,e,r,s.type===l.UNSIGNED_BYTE?this.staticDataUint32:this.staticData,this.staticStride,s.offset)}this.staticBuffer._updateID++}destroy(){this.indexBuffer=null,this.dynamicProperties=null,this.dynamicBuffer=null,this.dynamicData=null,this.dynamicDataUint32=null,this.staticProperties=null,this.staticBuffer=null,this.staticData=null,this.staticDataUint32=null,this.geometry.destroy()}}class vu extends Ji{constructor(t){super(t),this.shader=null,this.properties=null,this.tempMatrix=new di,this.properties=[{attributeName:"aVertexPosition",size:2,uploadFunction:this.uploadVertices,offset:0},{attributeName:"aPositionCoord",size:2,uploadFunction:this.uploadPosition,offset:0},{attributeName:"aRotation",size:1,uploadFunction:this.uploadRotation,offset:0},{attributeName:"aTextureCoord",size:2,uploadFunction:this.uploadUvs,offset:0},{attributeName:"aColor",size:1,type:l.UNSIGNED_BYTE,uploadFunction:this.uploadTint,offset:0}],this.shader=qi.from("attribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\nattribute vec4 aColor;\n\nattribute vec2 aPositionCoord;\nattribute float aRotation;\n\nuniform mat3 translationMatrix;\nuniform vec4 uColor;\n\nvarying vec2 vTextureCoord;\nvarying vec4 vColor;\n\nvoid main(void){\n    float x = (aVertexPosition.x) * cos(aRotation) - (aVertexPosition.y) * sin(aRotation);\n    float y = (aVertexPosition.x) * sin(aRotation) + (aVertexPosition.y) * cos(aRotation);\n\n    vec2 v = vec2(x, y);\n    v = v + aPositionCoord;\n\n    gl_Position = vec4((translationMatrix * vec3(v, 1.0)).xy, 0.0, 1.0);\n\n    vTextureCoord = aTextureCoord;\n    vColor = aColor * uColor;\n}\n","varying vec2 vTextureCoord;\nvarying vec4 vColor;\n\nuniform sampler2D uSampler;\n\nvoid main(void){\n    vec4 color = texture2D(uSampler, vTextureCoord) * vColor;\n    gl_FragColor = color;\n}",{}),this.state=Ir.for2d()}render(t){const e=t.children,r=t._maxSize,i=t._batchSize,s=this.renderer;let n=e.length;if(0===n)return;n>r&&!t.autoResize&&(n=r);let o=t._buffers;o||(o=t._buffers=this.generateBuffers(t));const a=e[0]._texture.baseTexture,h=a.alphaMode>0;this.state.blendMode=ze(t.blendMode,h),s.state.set(this.state);const l=s.gl,u=t.worldTransform.copyTo(this.tempMatrix);u.prepend(s.globalUniforms.uniforms.projectionMatrix),this.shader.uniforms.translationMatrix=u.toArray(!0),this.shader.uniforms.uColor=Ue.shared.setValue(t.tintRgb).premultiply(t.worldAlpha,h).toArray(this.shader.uniforms.uColor),this.shader.uniforms.uSampler=a,this.renderer.shader.bind(this.shader);let c=!1;for(let r=0,a=0;r<n;r+=i,a+=1){let h=n-r;h>i&&(h=i),a>=o.length&&o.push(this._generateOneMoreBuffer(t));const u=o[a];u.uploadDynamic(e,r,h);const d=t._bufferUpdateIDs[a]||0;c=c||u._updateID<d,c&&(u._updateID=t._updateID,u.uploadStatic(e,r,h)),s.geometry.bind(u.geometry),l.drawElements(l.TRIANGLES,6*h,l.UNSIGNED_SHORT,0)}}generateBuffers(t){const e=[],r=t._maxSize,i=t._batchSize,s=t._properties;for(let t=0;t<r;t+=i)e.push(new bu(this.properties,s,i));return e}_generateOneMoreBuffer(t){const e=t._batchSize,r=t._properties;return new bu(this.properties,r,e)}uploadVertices(t,e,r,i,s,n){let o=0,a=0,h=0,l=0;for(let u=0;u<r;++u){const r=t[e+u],c=r._texture,d=r.scale.x,f=r.scale.y,p=c.trim,_=c.orig;p?(a=p.x-r.anchor.x*_.width,o=a+p.width,l=p.y-r.anchor.y*_.height,h=l+p.height):(o=_.width*(1-r.anchor.x),a=_.width*-r.anchor.x,h=_.height*(1-r.anchor.y),l=_.height*-r.anchor.y),i[n]=a*d,i[n+1]=l*f,i[n+s]=o*d,i[n+s+1]=l*f,i[n+2*s]=o*d,i[n+2*s+1]=h*f,i[n+3*s]=a*d,i[n+3*s+1]=h*f,n+=4*s}}uploadPosition(t,e,r,i,s,n){for(let o=0;o<r;o++){const r=t[e+o].position;i[n]=r.x,i[n+1]=r.y,i[n+s]=r.x,i[n+s+1]=r.y,i[n+2*s]=r.x,i[n+2*s+1]=r.y,i[n+3*s]=r.x,i[n+3*s+1]=r.y,n+=4*s}}uploadRotation(t,e,r,i,s,n){for(let o=0;o<r;o++){const r=t[e+o].rotation;i[n]=r,i[n+s]=r,i[n+2*s]=r,i[n+3*s]=r,n+=4*s}}uploadUvs(t,e,r,i,s,n){for(let o=0;o<r;++o){const r=t[e+o]._texture._uvs;r?(i[n]=r.x0,i[n+1]=r.y0,i[n+s]=r.x1,i[n+s+1]=r.y1,i[n+2*s]=r.x2,i[n+2*s+1]=r.y2,i[n+3*s]=r.x3,i[n+3*s+1]=r.y3,n+=4*s):(i[n]=0,i[n+1]=0,i[n+s]=0,i[n+s+1]=0,i[n+2*s]=0,i[n+2*s+1]=0,i[n+3*s]=0,i[n+3*s+1]=0,n+=4*s)}}uploadTint(t,e,r,i,s,n){for(let o=0;o<r;++o){const r=t[e+o],a=Ue.shared.setValue(r._tintRGB).toPremultiplied(r.alpha,r.texture.baseTexture.alphaMode>0);i[n]=a,i[n+s]=a,i[n+2*s]=a,i[n+3*s]=a,n+=4*s}}destroy(){super.destroy(),this.shader&&(this.shader.destroy(),this.shader=null),this.tempMatrix=null}}vu.extension={name:"particle",type:Tr.RendererPlugin},Sr.add(vu);var xu=(t=>(t[t.LINEAR_VERTICAL=0]="LINEAR_VERTICAL",t[t.LINEAR_HORIZONTAL=1]="LINEAR_HORIZONTAL",t))(xu||{});const Au={willReadFrequently:!0},Tu=class t{static get experimentalLetterSpacingSupported(){let e=t._experimentalLetterSpacingSupported;if(void 0!==e){const r=T.ADAPTER.getCanvasRenderingContext2D().prototype;e=t._experimentalLetterSpacingSupported="letterSpacing"in r||"textLetterSpacing"in r}return e}constructor(t,e,r,i,s,n,o,a,h){this.text=t,this.style=e,this.width=r,this.height=i,this.lines=s,this.lineWidths=n,this.lineHeight=o,this.maxLineWidth=a,this.fontProperties=h}static measureText(e,r,i,s=t._canvas){i=null==i?r.wordWrap:i;const n=r.toFontString(),o=t.measureFont(n);0===o.fontSize&&(o.fontSize=r.fontSize,o.ascent=r.fontSize);const a=s.getContext("2d",Au);a.font=n;const h=(i?t.wordWrap(e,r,s):e).split(/(?:\r\n|\r|\n)/),l=new Array(h.length);let u=0;for(let e=0;e<h.length;e++){const i=t._measureText(h[e],r.letterSpacing,a);l[e]=i,u=Math.max(u,i)}let c=u+r.strokeThickness;r.dropShadow&&(c+=r.dropShadowDistance);const d=r.lineHeight||o.fontSize+r.strokeThickness;let f=Math.max(d,o.fontSize+2*r.strokeThickness)+r.leading+(h.length-1)*(d+r.leading);return r.dropShadow&&(f+=r.dropShadowDistance),new t(e,r,c,f,h,l,d+r.leading,u,o)}static _measureText(e,r,i){let s=!1;t.experimentalLetterSpacingSupported&&(t.experimentalLetterSpacing?(i.letterSpacing=`${r}px`,i.textLetterSpacing=`${r}px`,s=!0):(i.letterSpacing="0px",i.textLetterSpacing="0px"));let n=i.measureText(e).width;return n>0&&(s?n-=r:n+=(t.graphemeSegmenter(e).length-1)*r),n}static wordWrap(e,r,i=t._canvas){const s=i.getContext("2d",Au);let n=0,o="",a="";const h=Object.create(null),{letterSpacing:l,whiteSpace:u}=r,c=t.collapseSpaces(u),d=t.collapseNewlines(u);let f=!c;const p=r.wordWrapWidth+l,_=t.tokenize(e);for(let e=0;e<_.length;e++){let i=_[e];if(t.isNewline(i)){if(!d){a+=t.addLine(o),f=!c,o="",n=0;continue}i=" "}if(c){const e=t.isBreakingSpace(i),r=t.isBreakingSpace(o[o.length-1]);if(e&&r)continue}const u=t.getFromCache(i,l,h,s);if(u>p)if(""!==o&&(a+=t.addLine(o),o="",n=0),t.canBreakWords(i,r.breakWords)){const e=t.wordWrapSplit(i);for(let u=0;u<e.length;u++){let c=e[u],d=c,_=1;for(;e[u+_];){const s=e[u+_];if(t.canBreakChars(d,s,i,u,r.breakWords))break;c+=s,d=s,_++}u+=_-1;const m=t.getFromCache(c,l,h,s);m+n>p&&(a+=t.addLine(o),f=!1,o="",n=0),o+=c,n+=m}}else{o.length>0&&(a+=t.addLine(o),o="",n=0);const r=e===_.length-1;a+=t.addLine(i,!r),f=!1,o="",n=0}else u+n>p&&(f=!1,a+=t.addLine(o),o="",n=0),(o.length>0||!t.isBreakingSpace(i)||f)&&(o+=i,n+=u)}return a+=t.addLine(o,!1),a}static addLine(e,r=!0){return e=t.trimRight(e),e=r?`${e}\n`:e}static getFromCache(e,r,i,s){let n=i[e];return"number"!=typeof n&&(n=t._measureText(e,r,s)+r,i[e]=n),n}static collapseSpaces(t){return"normal"===t||"pre-line"===t}static collapseNewlines(t){return"normal"===t}static trimRight(e){if("string"!=typeof e)return"";for(let r=e.length-1;r>=0;r--){const i=e[r];if(!t.isBreakingSpace(i))break;e=e.slice(0,-1)}return e}static isNewline(e){return"string"==typeof e&&t._newlines.includes(e.charCodeAt(0))}static isBreakingSpace(e,r){return"string"==typeof e&&t._breakingSpaces.includes(e.charCodeAt(0))}static tokenize(e){const r=[];let i="";if("string"!=typeof e)return r;for(let s=0;s<e.length;s++){const n=e[s],o=e[s+1];t.isBreakingSpace(n,o)||t.isNewline(n)?(""!==i&&(r.push(i),i=""),r.push(n)):i+=n}return""!==i&&r.push(i),r}static canBreakWords(t,e){return e}static canBreakChars(t,e,r,i,s){return!0}static wordWrapSplit(e){return t.graphemeSegmenter(e)}static measureFont(e){if(t._fonts[e])return t._fonts[e];const r={ascent:0,descent:0,fontSize:0},i=t._canvas,s=t._context;s.font=e;const n=t.METRICS_STRING+t.BASELINE_SYMBOL,o=Math.ceil(s.measureText(n).width);let a=Math.ceil(s.measureText(t.BASELINE_SYMBOL).width);const h=Math.ceil(t.HEIGHT_MULTIPLIER*a);if(a=a*t.BASELINE_MULTIPLIER|0,0===o||0===h)return t._fonts[e]=r,r;i.width=o,i.height=h,s.fillStyle="#f00",s.fillRect(0,0,o,h),s.font=e,s.textBaseline="alphabetic",s.fillStyle="#000",s.fillText(n,0,a);const l=s.getImageData(0,0,o,h).data,u=l.length,c=4*o;let d=0,f=0,p=!1;for(d=0;d<a;++d){for(let t=0;t<c;t+=4)if(255!==l[f+t]){p=!0;break}if(p)break;f+=c}for(r.ascent=a-d,f=u-c,p=!1,d=h;d>a;--d){for(let t=0;t<c;t+=4)if(255!==l[f+t]){p=!0;break}if(p)break;f-=c}return r.descent=d-a,r.fontSize=r.ascent+r.descent,t._fonts[e]=r,r}static clearMetrics(e=""){e?delete t._fonts[e]:t._fonts={}}static get _canvas(){if(!t.__canvas){let e;try{const r=new OffscreenCanvas(0,0),i=r.getContext("2d",Au);if(null!=i&&i.measureText)return t.__canvas=r,r;e=T.ADAPTER.createCanvas()}catch(t){e=T.ADAPTER.createCanvas()}e.width=e.height=10,t.__canvas=e}return t.__canvas}static get _context(){return t.__context||(t.__context=t._canvas.getContext("2d",Au)),t.__context}};Tu.METRICS_STRING="|ÉqÅ",Tu.BASELINE_SYMBOL="M",Tu.BASELINE_MULTIPLIER=1.4,Tu.HEIGHT_MULTIPLIER=2,Tu.graphemeSegmenter=(()=>{if("function"==typeof(null==Intl?void 0:Intl.Segmenter)){const t=new Intl.Segmenter;return e=>[...t.segment(e)].map((t=>t.segment))}return t=>[...t]})(),Tu.experimentalLetterSpacing=!1,Tu._fonts={},Tu._newlines=[10,13],Tu._breakingSpaces=[9,32,8192,8193,8194,8195,8196,8197,8198,8200,8201,8202,8287,12288];let Eu=Tu;const wu=["serif","sans-serif","monospace","cursive","fantasy","system-ui"],Su=class t{constructor(t){this.styleID=0,this.reset(),Mu(this,t,t)}clone(){const e={};return Mu(e,this,t.defaultStyle),new t(e)}reset(){Mu(this,t.defaultStyle,t.defaultStyle)}get align(){return this._align}set align(t){this._align!==t&&(this._align=t,this.styleID++)}get breakWords(){return this._breakWords}set breakWords(t){this._breakWords!==t&&(this._breakWords=t,this.styleID++)}get dropShadow(){return this._dropShadow}set dropShadow(t){this._dropShadow!==t&&(this._dropShadow=t,this.styleID++)}get dropShadowAlpha(){return this._dropShadowAlpha}set dropShadowAlpha(t){this._dropShadowAlpha!==t&&(this._dropShadowAlpha=t,this.styleID++)}get dropShadowAngle(){return this._dropShadowAngle}set dropShadowAngle(t){this._dropShadowAngle!==t&&(this._dropShadowAngle=t,this.styleID++)}get dropShadowBlur(){return this._dropShadowBlur}set dropShadowBlur(t){this._dropShadowBlur!==t&&(this._dropShadowBlur=t,this.styleID++)}get dropShadowColor(){return this._dropShadowColor}set dropShadowColor(t){const e=Pu(t);this._dropShadowColor!==e&&(this._dropShadowColor=e,this.styleID++)}get dropShadowDistance(){return this._dropShadowDistance}set dropShadowDistance(t){this._dropShadowDistance!==t&&(this._dropShadowDistance=t,this.styleID++)}get fill(){return this._fill}set fill(t){const e=Pu(t);this._fill!==e&&(this._fill=e,this.styleID++)}get fillGradientType(){return this._fillGradientType}set fillGradientType(t){this._fillGradientType!==t&&(this._fillGradientType=t,this.styleID++)}get fillGradientStops(){return this._fillGradientStops}set fillGradientStops(t){(function(t,e){if(!Array.isArray(t)||!Array.isArray(e)||t.length!==e.length)return!1;for(let r=0;r<t.length;++r)if(t[r]!==e[r])return!1;return!0})(this._fillGradientStops,t)||(this._fillGradientStops=t,this.styleID++)}get fontFamily(){return this._fontFamily}set fontFamily(t){this.fontFamily!==t&&(this._fontFamily=t,this.styleID++)}get fontSize(){return this._fontSize}set fontSize(t){this._fontSize!==t&&(this._fontSize=t,this.styleID++)}get fontStyle(){return this._fontStyle}set fontStyle(t){this._fontStyle!==t&&(this._fontStyle=t,this.styleID++)}get fontVariant(){return this._fontVariant}set fontVariant(t){this._fontVariant!==t&&(this._fontVariant=t,this.styleID++)}get fontWeight(){return this._fontWeight}set fontWeight(t){this._fontWeight!==t&&(this._fontWeight=t,this.styleID++)}get letterSpacing(){return this._letterSpacing}set letterSpacing(t){this._letterSpacing!==t&&(this._letterSpacing=t,this.styleID++)}get lineHeight(){return this._lineHeight}set lineHeight(t){this._lineHeight!==t&&(this._lineHeight=t,this.styleID++)}get leading(){return this._leading}set leading(t){this._leading!==t&&(this._leading=t,this.styleID++)}get lineJoin(){return this._lineJoin}set lineJoin(t){this._lineJoin!==t&&(this._lineJoin=t,this.styleID++)}get miterLimit(){return this._miterLimit}set miterLimit(t){this._miterLimit!==t&&(this._miterLimit=t,this.styleID++)}get padding(){return this._padding}set padding(t){this._padding!==t&&(this._padding=t,this.styleID++)}get stroke(){return this._stroke}set stroke(t){const e=Pu(t);this._stroke!==e&&(this._stroke=e,this.styleID++)}get strokeThickness(){return this._strokeThickness}set strokeThickness(t){this._strokeThickness!==t&&(this._strokeThickness=t,this.styleID++)}get textBaseline(){return this._textBaseline}set textBaseline(t){this._textBaseline!==t&&(this._textBaseline=t,this.styleID++)}get trim(){return this._trim}set trim(t){this._trim!==t&&(this._trim=t,this.styleID++)}get whiteSpace(){return this._whiteSpace}set whiteSpace(t){this._whiteSpace!==t&&(this._whiteSpace=t,this.styleID++)}get wordWrap(){return this._wordWrap}set wordWrap(t){this._wordWrap!==t&&(this._wordWrap=t,this.styleID++)}get wordWrapWidth(){return this._wordWrapWidth}set wordWrapWidth(t){this._wordWrapWidth!==t&&(this._wordWrapWidth=t,this.styleID++)}toFontString(){const t="number"==typeof this.fontSize?`${this.fontSize}px`:this.fontSize;let e=this.fontFamily;Array.isArray(this.fontFamily)||(e=this.fontFamily.split(","));for(let t=e.length-1;t>=0;t--){let r=e[t].trim();!/([\"\'])[^\'\"]+\1/.test(r)&&!wu.includes(r)&&(r=`"${r}"`),e[t]=r}return`${this.fontStyle} ${this.fontVariant} ${this.fontWeight} ${t} ${e.join(",")}`}};Su.defaultStyle={align:"left",breakWords:!1,dropShadow:!1,dropShadowAlpha:1,dropShadowAngle:Math.PI/6,dropShadowBlur:0,dropShadowColor:"black",dropShadowDistance:5,fill:"black",fillGradientType:xu.LINEAR_VERTICAL,fillGradientStops:[],fontFamily:"Arial",fontSize:26,fontStyle:"normal",fontVariant:"normal",fontWeight:"normal",leading:0,letterSpacing:0,lineHeight:0,lineJoin:"miter",miterLimit:10,padding:0,stroke:"black",strokeThickness:0,textBaseline:"alphabetic",trim:!1,whiteSpace:"pre",wordWrap:!1,wordWrapWidth:100};let Cu=Su;function Pu(t){const e=Ue.shared,r=t=>{const r=e.setValue(t);return 1===r.alpha?r.toHex():r.toRgbaString()};return Array.isArray(t)?t.map(r):r(t)}function Mu(t,e,r){for(const i in r)Array.isArray(e[i])?t[i]=e[i].slice():t[i]=e[i]}const $u={texture:!0,children:!1,baseTexture:!0},Iu=class t extends so{constructor(e,r,i){var s;let n=!1;i||(i=T.ADAPTER.createCanvas(),n=!0),i.width=3,i.height=3;const o=ps.from(i);o.orig=new ai,o.trim=new ai,super(o),this._ownCanvas=n,this.canvas=i,this.context=i.getContext("2d",{willReadFrequently:!0}),this._resolution=null!=(s=t.defaultResolution)?s:T.RESOLUTION,this._autoResolution=t.defaultAutoResolution,this._text=null,this._style=null,this._styleListener=null,this._font="",this.text=e,this.style=r,this.localStyleID=-1}static get experimentalLetterSpacing(){return Eu.experimentalLetterSpacing}static set experimentalLetterSpacing(t){Eu.experimentalLetterSpacing=t}updateText(t){const e=this._style;if(this.localStyleID!==e.styleID&&(this.dirty=!0,this.localStyleID=e.styleID),!this.dirty&&t)return;this._font=this._style.toFontString();const r=this.context,i=Eu.measureText(this._text||" ",this._style,this._style.wordWrap,this.canvas),s=i.width,n=i.height,o=i.lines,a=i.lineHeight,h=i.lineWidths,l=i.maxLineWidth,u=i.fontProperties;let c,d;this.canvas.width=Math.ceil(Math.ceil(Math.max(1,s)+2*e.padding)*this._resolution),this.canvas.height=Math.ceil(Math.ceil(Math.max(1,n)+2*e.padding)*this._resolution),r.scale(this._resolution,this._resolution),r.clearRect(0,0,this.canvas.width,this.canvas.height),r.font=this._font,r.lineWidth=e.strokeThickness,r.textBaseline=e.textBaseline,r.lineJoin=e.lineJoin,r.miterLimit=e.miterLimit;const f=e.dropShadow?2:1;for(let t=0;t<f;++t){const s=e.dropShadow&&0===t,f=s?Math.ceil(Math.max(1,n)+2*e.padding):0,p=f*this._resolution;if(s){r.fillStyle="black",r.strokeStyle="black";const t=e.dropShadowColor,i=e.dropShadowBlur*this._resolution,s=e.dropShadowDistance*this._resolution;r.shadowColor=Ue.shared.setValue(t).setAlpha(e.dropShadowAlpha).toRgbaString(),r.shadowBlur=i,r.shadowOffsetX=Math.cos(e.dropShadowAngle)*s,r.shadowOffsetY=Math.sin(e.dropShadowAngle)*s+p}else r.fillStyle=this._generateFillStyle(e,o,i),r.strokeStyle=e.stroke,r.shadowColor="black",r.shadowBlur=0,r.shadowOffsetX=0,r.shadowOffsetY=0;let _=(a-u.fontSize)/2;a-u.fontSize<0&&(_=0);for(let t=0;t<o.length;t++)c=e.strokeThickness/2,d=e.strokeThickness/2+t*a+u.ascent+_,"right"===e.align?c+=l-h[t]:"center"===e.align&&(c+=(l-h[t])/2),e.stroke&&e.strokeThickness&&this.drawLetterSpacing(o[t],c+e.padding,d+e.padding-f,!0),e.fill&&this.drawLetterSpacing(o[t],c+e.padding,d+e.padding-f)}this.updateTexture()}drawLetterSpacing(t,e,r,i=!1){const s=this._style.letterSpacing;let n=!1;if(Eu.experimentalLetterSpacingSupported&&(Eu.experimentalLetterSpacing?(this.context.letterSpacing=`${s}px`,this.context.textLetterSpacing=`${s}px`,n=!0):(this.context.letterSpacing="0px",this.context.textLetterSpacing="0px")),0===s||n)return void(i?this.context.strokeText(t,e,r):this.context.fillText(t,e,r));let o=e;const a=Eu.graphemeSegmenter(t);let h=this.context.measureText(t).width,l=0;for(let t=0;t<a.length;++t){const e=a[t];i?this.context.strokeText(e,o,r):this.context.fillText(e,o,r);let n="";for(let e=t+1;e<a.length;++e)n+=a[e];l=this.context.measureText(n).width,o+=h-l+s,h=l}}updateTexture(){const t=this.canvas;if(this._style.trim){const e=cr(t);e.data&&(t.width=e.width,t.height=e.height,this.context.putImageData(e.data,0,0))}const e=this._texture,r=this._style,i=r.trim?0:r.padding,s=e.baseTexture;e.trim.width=e._frame.width=t.width/this._resolution,e.trim.height=e._frame.height=t.height/this._resolution,e.trim.x=-i,e.trim.y=-i,e.orig.width=e._frame.width-2*i,e.orig.height=e._frame.height-2*i,this._onTextureUpdate(),s.setRealSize(t.width,t.height,this._resolution),e.updateUvs(),this.dirty=!1}_render(t){this._autoResolution&&this._resolution!==t.resolution&&(this._resolution=t.resolution,this.dirty=!0),this.updateText(!0),super._render(t)}updateTransform(){this.updateText(!0),super.updateTransform()}getBounds(t,e){return this.updateText(!0),-1===this._textureID&&(t=!1),super.getBounds(t,e)}getLocalBounds(t){return this.updateText(!0),super.getLocalBounds.call(this,t)}_calculateBounds(){this.calculateVertices(),this._bounds.addQuad(this.vertexData)}_generateFillStyle(t,e,r){const i=t.fill;if(!Array.isArray(i))return i;if(1===i.length)return i[0];let s;const n=t.dropShadow?t.dropShadowDistance:0,o=t.padding||0,a=this.canvas.width/this._resolution-n-2*o,h=this.canvas.height/this._resolution-n-2*o,l=i.slice(),u=t.fillGradientStops.slice();if(!u.length){const t=l.length+1;for(let e=1;e<t;++e)u.push(e/t)}if(l.unshift(i[0]),u.unshift(0),l.push(i[i.length-1]),u.push(1),t.fillGradientType===xu.LINEAR_VERTICAL){s=this.context.createLinearGradient(a/2,o,a/2,h+o);const i=r.fontProperties.fontSize+t.strokeThickness;for(let t=0;t<e.length;t++){const n=r.lineHeight*(t-1)+i,o=r.lineHeight*t;let a=o;t>0&&n>o&&(a=(o+n)/2);const c=o+i,d=r.lineHeight*(t+1);let f=c;t+1<e.length&&d<c&&(f=(c+d)/2);const p=(f-a)/h;for(let t=0;t<l.length;t++){let e=0;e="number"==typeof u[t]?u[t]:t/l.length;let r=Math.min(1,Math.max(0,a/h+e*p));r=Number(r.toFixed(5)),s.addColorStop(r,l[t])}}}else{s=this.context.createLinearGradient(o,h/2,a+o,h/2);const t=l.length+1;let e=1;for(let r=0;r<l.length;r++){let i;i="number"==typeof u[r]?u[r]:e/t,s.addColorStop(i,l[r]),e++}}return s}destroy(t){"boolean"==typeof t&&(t={children:t}),t=Object.assign({},$u,t),super.destroy(t),this._ownCanvas&&(this.canvas.height=this.canvas.width=0),this.context=null,this.canvas=null,this._style=null}get width(){return this.updateText(!0),Math.abs(this.scale.x)*this._texture.orig.width}set width(t){this.updateText(!0);const e=Ke(this.scale.x)||1;this.scale.x=e*t/this._texture.orig.width,this._width=t}get height(){return this.updateText(!0),Math.abs(this.scale.y)*this._texture.orig.height}set height(t){this.updateText(!0);const e=Ke(this.scale.y)||1;this.scale.y=e*t/this._texture.orig.height,this._height=t}get style(){return this._style}set style(t){t=t||{},this._style=t instanceof Cu?t:new Cu(t),this.localStyleID=-1,this.dirty=!0}get text(){return this._text}set text(t){t=String(null==t?"":t),this._text!==t&&(this._text=t,this.dirty=!0)}get resolution(){return this._resolution}set resolution(t){this._autoResolution=!1,this._resolution!==t&&(this._resolution=t,this.dirty=!0)}};Iu.defaultAutoResolution=!0;let Ru=Iu;class Du{constructor(t){this.maxItemsPerFrame=t,this.itemsLeft=0}beginFrame(){this.itemsLeft=this.maxItemsPerFrame}allowedToUpload(){return this.itemsLeft-- >0}}function Lu(t,e){var r;let i=!1;if(null!=(r=null==t?void 0:t._textures)&&r.length)for(let r=0;r<t._textures.length;r++)if(t._textures[r]instanceof ps){const s=t._textures[r].baseTexture;e.includes(s)||(e.push(s),i=!0)}return i}function Fu(t,e){if(t.baseTexture instanceof zr){const r=t.baseTexture;return e.includes(r)||e.push(r),!0}return!1}function Ou(t,e){if(t._texture&&t._texture instanceof ps){const r=t._texture.baseTexture;return e.includes(r)||e.push(r),!0}return!1}function ku(t,e){return e instanceof Ru&&(e.updateText(!0),!0)}function Bu(t,e){if(e instanceof Cu){const t=e.toFontString();return Eu.measureFont(t),!0}return!1}function Nu(t,e){if(t instanceof Ru){e.includes(t.style)||e.push(t.style),e.includes(t)||e.push(t);const r=t._texture.baseTexture;return e.includes(r)||e.push(r),!0}return!1}function Uu(t,e){return t instanceof Cu&&(e.includes(t)||e.push(t),!0)}const Gu=class t{constructor(e){this.limiter=new Du(t.uploadsPerFrame),this.renderer=e,this.uploadHookHelper=null,this.queue=[],this.addHooks=[],this.uploadHooks=[],this.completes=[],this.ticking=!1,this.delayedTick=()=>{this.queue&&this.prepareItems()},this.registerFindHook(Nu),this.registerFindHook(Uu),this.registerFindHook(Lu),this.registerFindHook(Fu),this.registerFindHook(Ou),this.registerUploadHook(ku),this.registerUploadHook(Bu)}upload(t){return new Promise((e=>{t&&this.add(t),this.queue.length?(this.completes.push(e),this.ticking||(this.ticking=!0,Cn.system.addOnce(this.tick,this,En.UTILITY))):e()}))}tick(){setTimeout(this.delayedTick,0)}prepareItems(){for(this.limiter.beginFrame();this.queue.length&&this.limiter.allowedToUpload();){const t=this.queue[0];let e=!1;if(t&&!t._destroyed)for(let r=0,i=this.uploadHooks.length;r<i;r++)if(this.uploadHooks[r](this.uploadHookHelper,t)){this.queue.shift(),e=!0;break}e||this.queue.shift()}if(this.queue.length)Cn.system.addOnce(this.tick,this,En.UTILITY);else{this.ticking=!1;const t=this.completes.slice(0);this.completes.length=0;for(let e=0,r=t.length;e<r;e++)t[e]()}}registerFindHook(t){return t&&this.addHooks.push(t),this}registerUploadHook(t){return t&&this.uploadHooks.push(t),this}add(t){for(let e=0,r=this.addHooks.length;e<r&&!this.addHooks[e](t,this.queue);e++);if(t instanceof eo)for(let e=t.children.length-1;e>=0;e--)this.add(t.children[e]);return this}destroy(){this.ticking&&Cn.system.remove(this.tick,this),this.ticking=!1,this.addHooks=null,this.uploadHooks=null,this.renderer=null,this.completes=null,this.queue=null,this.limiter=null,this.uploadHookHelper=null}};Gu.uploadsPerFrame=4;let Vu=Gu;function Hu(t,e){return e instanceof zr&&(e._glTextures[t.CONTEXT_UID]||t.texture.bind(e),!0)}function zu(t,e){if(!(e instanceof au))return!1;const{geometry:r}=e;e.finishPoly(),r.updateBatches();const{batches:i}=r;for(let e=0;e<i.length;e++){const{texture:r}=i[e].style;r&&Hu(t,r.baseTexture)}return r.batchable||t.geometry.bind(r,e._resolveDirectShader(t)),!0}function Xu(t,e){return t instanceof au&&(e.push(t),!0)}Object.defineProperties(T,{UPLOADS_PER_FRAME:{get:()=>Vu.uploadsPerFrame,set(t){Vu.uploadsPerFrame=t}}});class Wu extends Vu{constructor(t){super(t),this.uploadHookHelper=this.renderer,this.registerFindHook(Xu),this.registerUploadHook(Hu),this.registerUploadHook(zu)}}Wu.extension={name:"prepare",type:Tr.RendererSystem},Sr.add(Wu);class Yu extends so{constructor(t,e=!0){super(t[0]instanceof ps?t[0]:t[0].texture),this._textures=null,this._durations=null,this._autoUpdate=e,this._isConnectedToTicker=!1,this.animationSpeed=1,this.loop=!0,this.updateAnchor=!1,this.onComplete=null,this.onFrameChange=null,this.onLoop=null,this._currentTime=0,this._playing=!1,this._previousFrame=null,this.textures=t}stop(){this._playing&&(this._playing=!1,this._autoUpdate&&this._isConnectedToTicker&&(Cn.shared.remove(this.update,this),this._isConnectedToTicker=!1))}play(){this._playing||(this._playing=!0,this._autoUpdate&&!this._isConnectedToTicker&&(Cn.shared.add(this.update,this,En.HIGH),this._isConnectedToTicker=!0))}gotoAndStop(t){this.stop(),this.currentFrame=t}gotoAndPlay(t){this.currentFrame=t,this.play()}update(t){if(!this._playing)return;const e=this.animationSpeed*t,r=this.currentFrame;if(null!==this._durations){let r=this._currentTime%1*this._durations[this.currentFrame];for(r+=e/60*1e3;r<0;)this._currentTime--,r+=this._durations[this.currentFrame];const i=Math.sign(this.animationSpeed*t);for(this._currentTime=Math.floor(this._currentTime);r>=this._durations[this.currentFrame];)r-=this._durations[this.currentFrame]*i,this._currentTime+=i;this._currentTime+=r/this._durations[this.currentFrame]}else this._currentTime+=e;this._currentTime<0&&!this.loop?(this.gotoAndStop(0),this.onComplete&&this.onComplete()):this._currentTime>=this._textures.length&&!this.loop?(this.gotoAndStop(this._textures.length-1),this.onComplete&&this.onComplete()):r!==this.currentFrame&&(this.loop&&this.onLoop&&(this.animationSpeed>0&&this.currentFrame<r||this.animationSpeed<0&&this.currentFrame>r)&&this.onLoop(),this.updateTexture())}updateTexture(){const t=this.currentFrame;this._previousFrame!==t&&(this._previousFrame=t,this._texture=this._textures[t],this._textureID=-1,this._textureTrimmedID=-1,this._cachedTint=16777215,this.uvs=this._texture._uvs.uvsFloat32,this.updateAnchor&&this._anchor.copyFrom(this._texture.defaultAnchor),this.onFrameChange&&this.onFrameChange(this.currentFrame))}destroy(t){this.stop(),super.destroy(t),this.onComplete=null,this.onFrameChange=null,this.onLoop=null}static fromFrames(t){const e=[];for(let r=0;r<t.length;++r)e.push(ps.from(t[r]));return new Yu(e)}static fromImages(t){const e=[];for(let r=0;r<t.length;++r)e.push(ps.from(t[r]));return new Yu(e)}get totalFrames(){return this._textures.length}get textures(){return this._textures}set textures(t){if(t[0]instanceof ps)this._textures=t,this._durations=null;else{this._textures=[],this._durations=[];for(let e=0;e<t.length;e++)this._textures.push(t[e].texture),this._durations.push(t[e].time)}this._previousFrame=null,this.gotoAndStop(0),this.updateTexture()}get currentFrame(){let t=Math.floor(this._currentTime)%this._textures.length;return t<0&&(t+=this._textures.length),t}set currentFrame(t){if(t<0||t>this.totalFrames-1)throw new Error(`[AnimatedSprite]: Invalid frame index value ${t}, expected to be between 0 and totalFrames ${this.totalFrames}.`);const e=this.currentFrame;this._currentTime=t,e!==this.currentFrame&&this.updateTexture()}get playing(){return this._playing}get autoUpdate(){return this._autoUpdate}set autoUpdate(t){t!==this._autoUpdate&&(this._autoUpdate=t,!this._autoUpdate&&this._isConnectedToTicker?(Cn.shared.remove(this.update,this),this._isConnectedToTicker=!1):this._autoUpdate&&!this._isConnectedToTicker&&this._playing&&(Cn.shared.add(this.update,this),this._isConnectedToTicker=!0))}}const ju=new ni;class qu extends so{constructor(t,e=100,r=100){super(t),this.tileTransform=new Ti,this._width=e,this._height=r,this.uvMatrix=this.texture.uvMatrix||new Ms(t),this.pluginName="tilingSprite",this.uvRespectAnchor=!1}get clampMargin(){return this.uvMatrix.clampMargin}set clampMargin(t){this.uvMatrix.clampMargin=t,this.uvMatrix.update(!0)}get tileScale(){return this.tileTransform.scale}set tileScale(t){this.tileTransform.scale.copyFrom(t)}get tilePosition(){return this.tileTransform.position}set tilePosition(t){this.tileTransform.position.copyFrom(t)}_onTextureUpdate(){this.uvMatrix&&(this.uvMatrix.texture=this._texture),this._cachedTint=16777215}_render(t){const e=this._texture;!e||!e.valid||(this.tileTransform.updateLocalTransform(),this.uvMatrix.update(),t.batch.setObjectRenderer(t.plugins[this.pluginName]),t.plugins[this.pluginName].render(this))}_calculateBounds(){const t=this._width*-this._anchor._x,e=this._height*-this._anchor._y,r=this._width*(1-this._anchor._x),i=this._height*(1-this._anchor._y);this._bounds.addFrame(this.transform,t,e,r,i)}getLocalBounds(t){return 0===this.children.length?(this._bounds.minX=this._width*-this._anchor._x,this._bounds.minY=this._height*-this._anchor._y,this._bounds.maxX=this._width*(1-this._anchor._x),this._bounds.maxY=this._height*(1-this._anchor._y),t||(this._localBoundsRect||(this._localBoundsRect=new ai),t=this._localBoundsRect),this._bounds.getRectangle(t)):super.getLocalBounds.call(this,t)}containsPoint(t){this.worldTransform.applyInverse(t,ju);const e=this._width,r=this._height,i=-e*this.anchor._x;if(ju.x>=i&&ju.x<i+e){const t=-r*this.anchor._y;if(ju.y>=t&&ju.y<t+r)return!0}return!1}destroy(t){super.destroy(t),this.tileTransform=null,this.uvMatrix=null}static from(t,e){const r=t instanceof ps?t:ps.from(t,e);return new qu(r,e.width,e.height)}get width(){return this._width}set width(t){this._width=t}get height(){return this._height}set height(t){this._height=t}}var Zu="#version 100\n#define SHADER_NAME Tiling-Sprite-100\n\nprecision lowp float;\n\nattribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\n\nuniform mat3 projectionMatrix;\nuniform mat3 translationMatrix;\nuniform mat3 uTransform;\n\nvarying vec2 vTextureCoord;\n\nvoid main(void)\n{\n    gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n\n    vTextureCoord = (uTransform * vec3(aTextureCoord, 1.0)).xy;\n}\n";const Qu=new di;class Ju extends Ji{constructor(t){super(t),t.runners.contextChange.add(this),this.quad=new ys,this.state=Ir.for2d()}contextChange(){const t=this.renderer,e={globals:t.globalUniforms};this.simpleShader=qi.from(Zu,"#version 100\n#define SHADER_NAME Tiling-Sprite-Simple-100\n\nprecision lowp float;\n\nvarying vec2 vTextureCoord;\n\nuniform sampler2D uSampler;\nuniform vec4 uColor;\n\nvoid main(void)\n{\n    vec4 texSample = texture2D(uSampler, vTextureCoord);\n    gl_FragColor = texSample * uColor;\n}\n",e),this.shader=t.context.webGLVersion>1?qi.from("#version 300 es\n#define SHADER_NAME Tiling-Sprite-300\n\nprecision lowp float;\n\nin vec2 aVertexPosition;\nin vec2 aTextureCoord;\n\nuniform mat3 projectionMatrix;\nuniform mat3 translationMatrix;\nuniform mat3 uTransform;\n\nout vec2 vTextureCoord;\n\nvoid main(void)\n{\n    gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n\n    vTextureCoord = (uTransform * vec3(aTextureCoord, 1.0)).xy;\n}\n","#version 300 es\n#define SHADER_NAME Tiling-Sprite-100\n\nprecision lowp float;\n\nin vec2 vTextureCoord;\n\nout vec4 fragmentColor;\n\nuniform sampler2D uSampler;\nuniform vec4 uColor;\nuniform mat3 uMapCoord;\nuniform vec4 uClampFrame;\nuniform vec2 uClampOffset;\n\nvoid main(void)\n{\n    vec2 coord = vTextureCoord + ceil(uClampOffset - vTextureCoord);\n    coord = (uMapCoord * vec3(coord, 1.0)).xy;\n    vec2 unclamped = coord;\n    coord = clamp(coord, uClampFrame.xy, uClampFrame.zw);\n\n    vec4 texSample = texture(uSampler, coord, unclamped == coord ? 0.0f : -32.0f);// lod-bias very negative to force lod 0\n\n    fragmentColor = texSample * uColor;\n}\n",e):qi.from(Zu,"#version 100\n#ifdef GL_EXT_shader_texture_lod\n    #extension GL_EXT_shader_texture_lod : enable\n#endif\n#define SHADER_NAME Tiling-Sprite-100\n\nprecision lowp float;\n\nvarying vec2 vTextureCoord;\n\nuniform sampler2D uSampler;\nuniform vec4 uColor;\nuniform mat3 uMapCoord;\nuniform vec4 uClampFrame;\nuniform vec2 uClampOffset;\n\nvoid main(void)\n{\n    vec2 coord = vTextureCoord + ceil(uClampOffset - vTextureCoord);\n    coord = (uMapCoord * vec3(coord, 1.0)).xy;\n    vec2 unclamped = coord;\n    coord = clamp(coord, uClampFrame.xy, uClampFrame.zw);\n\n    #ifdef GL_EXT_shader_texture_lod\n        vec4 texSample = unclamped == coord\n            ? texture2D(uSampler, coord) \n            : texture2DLodEXT(uSampler, coord, 0);\n    #else\n        vec4 texSample = texture2D(uSampler, coord);\n    #endif\n\n    gl_FragColor = texSample * uColor;\n}\n",e)}render(t){const e=this.renderer,r=this.quad;let i=r.vertices;i[0]=i[6]=t._width*-t.anchor.x,i[1]=i[3]=t._height*-t.anchor.y,i[2]=i[4]=t._width*(1-t.anchor.x),i[5]=i[7]=t._height*(1-t.anchor.y);const s=t.uvRespectAnchor?t.anchor.x:0,n=t.uvRespectAnchor?t.anchor.y:0;i=r.uvs,i[0]=i[6]=-s,i[1]=i[3]=-n,i[2]=i[4]=1-s,i[5]=i[7]=1-n,r.invalidate();const o=t._texture,a=o.baseTexture,h=a.alphaMode>0,l=t.tileTransform.localTransform,u=t.uvMatrix;let c=a.isPowerOfTwo&&o.frame.width===a.width&&o.frame.height===a.height;c&&(a._glTextures[e.CONTEXT_UID]?c=a.wrapMode!==d.CLAMP:a.wrapMode===d.CLAMP&&(a.wrapMode=d.REPEAT));const f=c?this.simpleShader:this.shader,p=o.width,_=o.height,m=t._width,g=t._height;Qu.set(l.a*p/m,l.b*p/g,l.c*_/m,l.d*_/g,l.tx/m,l.ty/g),Qu.invert(),c?Qu.prepend(u.mapCoord):(f.uniforms.uMapCoord=u.mapCoord.toArray(!0),f.uniforms.uClampFrame=u.uClampFrame,f.uniforms.uClampOffset=u.uClampOffset),f.uniforms.uTransform=Qu.toArray(!0),f.uniforms.uColor=Ue.shared.setValue(t.tint).premultiply(t.worldAlpha,h).toArray(f.uniforms.uColor),f.uniforms.translationMatrix=t.transform.worldTransform.toArray(!0),f.uniforms.uSampler=o,e.shader.bind(f),e.geometry.bind(r),this.state.blendMode=ze(t.blendMode,h),e.state.set(this.state),e.geometry.draw(this.renderer.gl.TRIANGLES,6,0)}}Ju.extension={name:"tilingSprite",type:Tr.RendererPlugin},Sr.add(Ju);const Ku=class t{constructor(t,e,r){this.linkedSheets=[],(t instanceof zr||t instanceof ps)&&(t={texture:t,data:e,resolutionFilename:r});const{texture:i,data:s,resolutionFilename:n=null,cachePrefix:o=""}=t;this.cachePrefix=o,this._texture=i instanceof ps?i:null,this.baseTexture=i instanceof zr?i:this._texture.baseTexture,this.textures={},this.animations={},this.data=s;const a=this.baseTexture.resource;this.resolution=this._updateResolution(n||(a?a.url:null)),this._frames=this.data.frames,this._frameKeys=Object.keys(this._frames),this._batchIndex=0,this._callback=null}_updateResolution(t=null){const{scale:e}=this.data.meta;let r=fr(t,null);return null===r&&(r="number"==typeof e?e:parseFloat(null!=e?e:"1")),1!==r&&this.baseTexture.setResolution(r),r}parse(){return new Promise((e=>{this._callback=e,this._batchIndex=0,this._frameKeys.length<=t.BATCH_SIZE?(this._processFrames(0),this._processAnimations(),this._parseComplete()):this._nextBatch()}))}_processFrames(e){let r=e;const i=t.BATCH_SIZE;for(;r-e<i&&r<this._frameKeys.length;){const t=this._frameKeys[r],e=this._frames[t],i=e.frame;if(i){let r=null,s=null;const n=!1!==e.trimmed&&e.sourceSize?e.sourceSize:e.frame,o=new ai(0,0,Math.floor(n.w)/this.resolution,Math.floor(n.h)/this.resolution);r=e.rotated?new ai(Math.floor(i.x)/this.resolution,Math.floor(i.y)/this.resolution,Math.floor(i.h)/this.resolution,Math.floor(i.w)/this.resolution):new ai(Math.floor(i.x)/this.resolution,Math.floor(i.y)/this.resolution,Math.floor(i.w)/this.resolution,Math.floor(i.h)/this.resolution),!1!==e.trimmed&&e.spriteSourceSize&&(s=new ai(Math.floor(e.spriteSourceSize.x)/this.resolution,Math.floor(e.spriteSourceSize.y)/this.resolution,Math.floor(i.w)/this.resolution,Math.floor(i.h)/this.resolution)),this.textures[t]=new ps(this.baseTexture,r,o,s,e.rotated?2:0,e.anchor,e.borders),ps.addToCache(this.textures[t],this.cachePrefix+t.toString())}r++}}_processAnimations(){const t=this.data.animations||{};for(const e in t){this.animations[e]=[];for(let r=0;r<t[e].length;r++){const i=t[e][r];this.animations[e].push(this.textures[i])}}}_parseComplete(){const t=this._callback;this._callback=null,this._batchIndex=0,t.call(this,this.textures)}_nextBatch(){this._processFrames(this._batchIndex*t.BATCH_SIZE),this._batchIndex++,setTimeout((()=>{this._batchIndex*t.BATCH_SIZE<this._frameKeys.length?this._nextBatch():(this._processAnimations(),this._parseComplete())}),0)}destroy(t=!1){var e;for(const t in this.textures)this.textures[t].destroy();this._frames=null,this._frameKeys=null,this.data=null,this.textures=null,t&&(null==(e=this._texture)||e.destroy(),this.baseTexture.destroy()),this._texture=null,this.baseTexture=null,this.linkedSheets=[]}};Ku.BATCH_SIZE=1e3;let tc=Ku;const ec=["jpg","png","jpeg","avif","webp","s3tc","s3tc_sRGB","etc","etc1","pvrtc","atc","astc","bptc"];function rc(t,e,r){const i={};if(t.forEach((t=>{i[t]=e})),Object.keys(e.textures).forEach((t=>{i[`${e.cachePrefix}${t}`]=e.textures[t]})),!r){const r=ee.dirname(t[0]);e.linkedSheets.forEach(((t,s)=>{Object.assign(i,rc([`${r}/${e.data.meta.related_multi_packs[s]}`],t,!0))}))}return i}const ic={extension:Tr.Asset,cache:{test:t=>t instanceof tc,getCacheableAssets:(t,e)=>rc(t,e,!1)},resolver:{test:t=>{const e=t.split("?")[0].split("."),r=e.pop(),i=e.pop();return"json"===r&&ec.includes(i)},parse:t=>{var e,r;const i=t.split(".");return{resolution:parseFloat(null!=(r=null==(e=T.RETINA_PREFIX.exec(t))?void 0:e[1])?r:"1"),format:i[i.length-2],src:t}}},loader:{name:"spritesheetLoader",extension:{type:Tr.LoadParser,priority:na.Normal},testParse:async(t,e)=>".json"===ee.extname(e.src).toLowerCase()&&!!t.frames,async parse(t,e,r){var i,s,n;const{texture:o,imageFilename:a,cachePrefix:h}=null!=(i=null==e?void 0:e.data)?i:{};let l,u=ee.dirname(e.src);if(u&&u.lastIndexOf("/")!==u.length-1&&(u+="/"),o&&o.baseTexture)l=o;else{const i=Wo(u+(null!=a?a:t.meta.image),e.src);l=(await r.load([i]))[i]}const c=new tc({texture:l.baseTexture,data:t,resolutionFilename:e.src,cachePrefix:h});await c.parse();const d=null==(s=null==t?void 0:t.meta)?void 0:s.related_multi_packs;if(Array.isArray(d)){const t=[];for(const i of d){if("string"!=typeof i)continue;let s=u+i;null!=(n=e.data)&&n.ignoreMultiPack||(s=Wo(s,e.src),t.push(r.load({src:s,data:{ignoreMultiPack:!0}})))}const i=await Promise.all(t);c.linkedSheets=i,i.forEach((t=>{t.linkedSheets=[c].concat(c.linkedSheets.filter((e=>e!==t)))}))}return c},unload(t){t.destroy(!0)}}};Sr.add(ic);class sc{constructor(){this.info=[],this.common=[],this.page=[],this.char=[],this.kerning=[],this.distanceField=[]}}class nc{static test(t){return"string"==typeof t&&t.startsWith("info face=")}static parse(t){const e=t.match(/^[a-z]+\s+.+$/gm),r={info:[],common:[],page:[],char:[],chars:[],kerning:[],kernings:[],distanceField:[]};for(const t in e){const i=e[t].match(/^[a-z]+/gm)[0],s=e[t].match(/[a-zA-Z]+=([^\s"']+|"([^"]*)")/gm),n={};for(const t in s){const e=s[t].split("="),r=e[0],i=e[1].replace(/"/gm,""),o=parseFloat(i),a=isNaN(o)?i:o;n[r]=a}r[i].push(n)}const i=new sc;return r.info.forEach((t=>i.info.push({face:t.face,size:parseInt(t.size,10)}))),r.common.forEach((t=>i.common.push({lineHeight:parseInt(t.lineHeight,10)}))),r.page.forEach((t=>i.page.push({id:parseInt(t.id,10),file:t.file}))),r.char.forEach((t=>i.char.push({id:parseInt(t.id,10),page:parseInt(t.page,10),x:parseInt(t.x,10),y:parseInt(t.y,10),width:parseInt(t.width,10),height:parseInt(t.height,10),xoffset:parseInt(t.xoffset,10),yoffset:parseInt(t.yoffset,10),xadvance:parseInt(t.xadvance,10)}))),r.kerning.forEach((t=>i.kerning.push({first:parseInt(t.first,10),second:parseInt(t.second,10),amount:parseInt(t.amount,10)}))),r.distanceField.forEach((t=>i.distanceField.push({distanceRange:parseInt(t.distanceRange,10),fieldType:t.fieldType}))),i}}class oc{static test(t){const e=t;return"string"!=typeof t&&"getElementsByTagName"in t&&e.getElementsByTagName("page").length&&null!==e.getElementsByTagName("info")[0].getAttribute("face")}static parse(t){const e=new sc,r=t.getElementsByTagName("info"),i=t.getElementsByTagName("common"),s=t.getElementsByTagName("page"),n=t.getElementsByTagName("char"),o=t.getElementsByTagName("kerning"),a=t.getElementsByTagName("distanceField");for(let t=0;t<r.length;t++)e.info.push({face:r[t].getAttribute("face"),size:parseInt(r[t].getAttribute("size"),10)});for(let t=0;t<i.length;t++)e.common.push({lineHeight:parseInt(i[t].getAttribute("lineHeight"),10)});for(let t=0;t<s.length;t++)e.page.push({id:parseInt(s[t].getAttribute("id"),10)||0,file:s[t].getAttribute("file")});for(let t=0;t<n.length;t++){const r=n[t];e.char.push({id:parseInt(r.getAttribute("id"),10),page:parseInt(r.getAttribute("page"),10)||0,x:parseInt(r.getAttribute("x"),10),y:parseInt(r.getAttribute("y"),10),width:parseInt(r.getAttribute("width"),10),height:parseInt(r.getAttribute("height"),10),xoffset:parseInt(r.getAttribute("xoffset"),10),yoffset:parseInt(r.getAttribute("yoffset"),10),xadvance:parseInt(r.getAttribute("xadvance"),10)})}for(let t=0;t<o.length;t++)e.kerning.push({first:parseInt(o[t].getAttribute("first"),10),second:parseInt(o[t].getAttribute("second"),10),amount:parseInt(o[t].getAttribute("amount"),10)});for(let t=0;t<a.length;t++)e.distanceField.push({fieldType:a[t].getAttribute("fieldType"),distanceRange:parseInt(a[t].getAttribute("distanceRange"),10)});return e}}class ac{static test(t){return!("string"!=typeof t||!t.includes("<font>"))&&oc.test(T.ADAPTER.parseXML(t))}static parse(t){return oc.parse(T.ADAPTER.parseXML(t))}}const hc=[nc,oc,ac];function lc(t){for(let e=0;e<hc.length;e++)if(hc[e].test(t))return hc[e];return null}function uc(t,e,r,i,s,n,o){const a=r.text,h=r.fontProperties;e.translate(i,s),e.scale(n,n);const l=o.strokeThickness/2,u=-o.strokeThickness/2;if(e.font=o.toFontString(),e.lineWidth=o.strokeThickness,e.textBaseline=o.textBaseline,e.lineJoin=o.lineJoin,e.miterLimit=o.miterLimit,e.fillStyle=function(t,e,r,i,s,n){const o=r.fill;if(!Array.isArray(o))return o;if(1===o.length)return o[0];let a;const h=r.dropShadow?r.dropShadowDistance:0,l=r.padding||0,u=t.width/i-h-2*l,c=t.height/i-h-2*l,d=o.slice(),f=r.fillGradientStops.slice();if(!f.length){const t=d.length+1;for(let e=1;e<t;++e)f.push(e/t)}if(d.unshift(o[0]),f.unshift(0),d.push(o[o.length-1]),f.push(1),r.fillGradientType===xu.LINEAR_VERTICAL){a=e.createLinearGradient(u/2,l,u/2,c+l);let t=0;const i=(n.fontProperties.fontSize+r.strokeThickness)/c;for(let e=0;e<s.length;e++){const r=n.lineHeight*e;for(let e=0;e<d.length;e++){let s=0;s="number"==typeof f[e]?f[e]:e/d.length;const n=r/c+s*i;let o=Math.max(t,n);o=Math.min(o,1),a.addColorStop(o,d[e]),t=o}}}else{a=e.createLinearGradient(l,c/2,u+l,c/2);const t=d.length+1;let r=1;for(let e=0;e<d.length;e++){let i;i="number"==typeof f[e]?f[e]:r/t,a.addColorStop(i,d[e]),r++}}return a}(t,e,o,n,[a],r),e.strokeStyle=o.stroke,o.dropShadow){const t=o.dropShadowColor,r=o.dropShadowBlur*n,i=o.dropShadowDistance*n;e.shadowColor=Ue.shared.setValue(t).setAlpha(o.dropShadowAlpha).toRgbaString(),e.shadowBlur=r,e.shadowOffsetX=Math.cos(o.dropShadowAngle)*i,e.shadowOffsetY=Math.sin(o.dropShadowAngle)*i}else e.shadowColor="black",e.shadowBlur=0,e.shadowOffsetX=0,e.shadowOffsetY=0;o.stroke&&o.strokeThickness&&e.strokeText(a,l,u+r.lineHeight-h.descent),o.fill&&e.fillText(a,l,u+r.lineHeight-h.descent),e.setTransform(1,0,0,1,0,0),e.fillStyle="rgba(0, 0, 0, 0)"}function cc(t){return t.codePointAt?t.codePointAt(0):t.charCodeAt(0)}function dc(t){return Array.from?Array.from(t):t.split("")}var fc=Object.defineProperty,pc=Object.getOwnPropertySymbols,_c=Object.prototype.hasOwnProperty,mc=Object.prototype.propertyIsEnumerable,gc=(t,e,r)=>e in t?fc(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,yc=(t,e)=>{for(var r in e||(e={}))_c.call(e,r)&&gc(t,r,e[r]);if(pc)for(var r of pc(e))mc.call(e,r)&&gc(t,r,e[r]);return t};const bc=class t{constructor(t,e,r){var i,s;const[n]=t.info,[o]=t.common,[a]=t.page,[h]=t.distanceField,l=fr(a.file),u={};this._ownsTextures=r,this.font=n.face,this.size=n.size,this.lineHeight=o.lineHeight/l,this.chars={},this.pageTextures=u;for(let r=0;r<t.page.length;r++){const{id:i,file:s}=t.page[r];u[i]=e instanceof Array?e[r]:e[s],null!=h&&h.fieldType&&"none"!==h.fieldType&&(u[i].baseTexture.alphaMode=p.NO_PREMULTIPLIED_ALPHA,u[i].baseTexture.mipmap=f.OFF)}for(let e=0;e<t.char.length;e++){const{id:r,page:i}=t.char[e];let{x:s,y:n,width:o,height:a,xoffset:h,yoffset:c,xadvance:d}=t.char[e];s/=l,n/=l,o/=l,a/=l,h/=l,c/=l,d/=l;const f=new ai(s+u[i].frame.x/l,n+u[i].frame.y/l,o,a);this.chars[r]={xOffset:h,yOffset:c,xAdvance:d,kerning:{},texture:new ps(u[i].baseTexture,f),page:i}}for(let e=0;e<t.kerning.length;e++){let{first:r,second:i,amount:s}=t.kerning[e];r/=l,i/=l,s/=l,this.chars[i]&&(this.chars[i].kerning[r]=s)}this.distanceFieldRange=null==h?void 0:h.distanceRange,this.distanceFieldType=null!=(s=null==(i=null==h?void 0:h.fieldType)?void 0:i.toLowerCase())?s:"none"}destroy(){for(const t in this.chars)this.chars[t].texture.destroy(),this.chars[t].texture=null;for(const t in this.pageTextures)this._ownsTextures&&this.pageTextures[t].destroy(!0),this.pageTextures[t]=null;this.chars=null,this.pageTextures=null}static install(e,r,i){let s;if(e instanceof sc)s=e;else{const t=lc(e);if(!t)throw new Error("Unrecognized data format for font.");s=t.parse(e)}r instanceof ps&&(r=[r]);const n=new t(s,r,i);return t.available[n.font]=n,n}static uninstall(e){const r=t.available[e];if(!r)throw new Error(`No font found named '${e}'`);r.destroy(),delete t.available[e]}static from(e,r,i){if(!e)throw new Error("[BitmapFont] Property `name` is required.");const s=Object.assign({},t.defaultOptions,i),{chars:n,padding:o,resolution:a,textureWidth:h,textureHeight:l}=s,u=((t,e)=>{var r={};for(var i in t)_c.call(t,i)&&e.indexOf(i)<0&&(r[i]=t[i]);if(null!=t&&pc)for(var i of pc(t))e.indexOf(i)<0&&mc.call(t,i)&&(r[i]=t[i]);return r})(s,["chars","padding","resolution","textureWidth","textureHeight"]),c=function(t){"string"==typeof t&&(t=[t]);const e=[];for(let r=0,i=t.length;r<i;r++){const i=t[r];if(Array.isArray(i)){if(2!==i.length)throw new Error(`[BitmapFont]: Invalid character range length, expecting 2 got ${i.length}.`);const t=i[0].charCodeAt(0),r=i[1].charCodeAt(0);if(r<t)throw new Error("[BitmapFont]: Invalid character range.");for(let i=t,s=r;i<=s;i++)e.push(String.fromCharCode(i))}else e.push(...dc(i))}if(0===e.length)throw new Error("[BitmapFont]: Empty set when resolving characters.");return e}(n),d=r instanceof Cu?r:new Cu(r),f=h,p=new sc;p.info[0]={face:d.fontFamily,size:d.fontSize},p.common[0]={lineHeight:d.fontSize};let _,m,g,y=0,b=0,v=0;const x=[],A=[];for(let t=0;t<c.length;t++){_||(_=T.ADAPTER.createCanvas(),_.width=h,_.height=l,m=_.getContext("2d"),g=new zr(_,yc({resolution:a},u)),x.push(g),A.push(new ps(g)),p.page.push({id:A.length-1,file:""}));const e=c[t],r=Eu.measureText(e,d,!1,_),i=r.width,s=Math.ceil(r.height),n=Math.ceil(("italic"===d.fontStyle?2:1)*i);if(b>=l-s*a){if(0===b)throw new Error(`[BitmapFont] textureHeight ${l}px is too small (fontFamily: '${d.fontFamily}', fontSize: ${d.fontSize}px, char: '${e}')`);--t,_=null,m=null,g=null,b=0,y=0,v=0;continue}if(v=Math.max(s+r.fontProperties.descent,v),n*a+y>=f){if(0===y)throw new Error(`[BitmapFont] textureWidth ${h}px is too small (fontFamily: '${d.fontFamily}', fontSize: ${d.fontSize}px, char: '${e}')`);--t,b+=v*a,b=Math.ceil(b),y=0,v=0;continue}uc(_,m,r,y,b,a,d);const E=cc(r.text);p.char.push({id:E,page:A.length-1,x:y/a,y:b/a,width:n,height:s,xoffset:0,yoffset:0,xadvance:i-(d.dropShadow?d.dropShadowDistance:0)-(d.stroke?d.strokeThickness:0)}),y+=(n+2*o)*a,y=Math.ceil(y)}if(null==i||!i.skipKerning)for(let t=0,e=c.length;t<e;t++){const r=c[t];for(let t=0;t<e;t++){const e=c[t],i=m.measureText(r).width,s=m.measureText(e).width,n=m.measureText(r+e).width-(i+s);n&&p.kerning.push({first:cc(r),second:cc(e),amount:n})}}const E=new t(p,A,!0);return void 0!==t.available[e]&&t.uninstall(e),t.available[e]=E,E}};bc.ALPHA=[["a","z"],["A","Z"]," "],bc.NUMERIC=[["0","9"]],bc.ALPHANUMERIC=[["a","z"],["A","Z"],["0","9"]," "],bc.ASCII=[[" ","~"]],bc.defaultOptions={resolution:1,textureWidth:512,textureHeight:512,padding:4,chars:bc.ALPHANUMERIC},bc.available={};let vc=bc;const xc=[],Ac=[],Tc=[],Ec=class t extends eo{constructor(e,r={}){super();const{align:i,tint:s,maxWidth:n,letterSpacing:o,fontName:a,fontSize:h}=Object.assign({},t.styleDefaults,r);if(!vc.available[a])throw new Error(`Missing BitmapFont "${a}"`);this._activePagesMeshData=[],this._textWidth=0,this._textHeight=0,this._align=i,this._tintColor=new Ue(s),this._font=void 0,this._fontName=a,this._fontSize=h,this.text=e,this._maxWidth=n,this._maxLineHeight=0,this._letterSpacing=o,this._anchor=new xi((()=>{this.dirty=!0}),this,0,0),this._roundPixels=T.ROUND_PIXELS,this.dirty=!0,this._resolution=T.RESOLUTION,this._autoResolution=!0,this._textureCache={}}updateText(){var t;const e=vc.available[this._fontName],r=this.fontSize,i=r/e.size,s=new ni,o=[],a=[],h=[],l=dc(this._text.replace(/(?:\r\n|\r)/g,"\n")||" "),u=this._maxWidth*e.size/r,c="none"===e.distanceFieldType?xc:Ac;let d=null,f=0,p=0,_=0,m=-1,g=0,y=0,b=0,v=0;for(let t=0;t<l.length;t++){const r=l[t],i=cc(r);if(/(?:\s)/.test(r)&&(m=t,g=f,v++),"\r"===r||"\n"===r){a.push(f),h.push(-1),p=Math.max(p,f),++_,++y,s.x=0,s.y+=e.lineHeight,d=null,v=0;continue}const n=e.chars[i];if(!n)continue;d&&n.kerning[d]&&(s.x+=n.kerning[d]);const c=Tc.pop()||{texture:ps.EMPTY,line:0,charCode:0,prevSpaces:0,position:new ni};c.texture=n.texture,c.line=_,c.charCode=i,c.position.x=Math.round(s.x+n.xOffset+this._letterSpacing/2),c.position.y=Math.round(s.y+n.yOffset),c.prevSpaces=v,o.push(c),f=c.position.x+Math.max(n.xAdvance-n.xOffset,n.texture.orig.width),s.x+=n.xAdvance+this._letterSpacing,b=Math.max(b,n.yOffset+n.texture.height),d=i,-1!==m&&u>0&&s.x>u&&(++y,Je(o,1+m-y,1+t-m),t=m,m=-1,a.push(g),h.push(o.length>0?o[o.length-1].prevSpaces:0),p=Math.max(p,g),_++,s.x=0,s.y+=e.lineHeight,d=null,v=0)}const x=l[l.length-1];"\r"!==x&&"\n"!==x&&(/(?:\s)/.test(x)&&(f=g),a.push(f),p=Math.max(p,f),h.push(-1));const A=[];for(let t=0;t<=_;t++){let e=0;"right"===this._align?e=p-a[t]:"center"===this._align?e=(p-a[t])/2:"justify"===this._align&&(e=h[t]<0?0:(p-a[t])/h[t]),A.push(e)}const T=o.length,E={},w=[],S=this._activePagesMeshData;c.push(...S);for(let t=0;t<T;t++){const r=o[t].texture,i=r.baseTexture.uid;if(!E[i]){let t=c.pop();if(!t){const r=new pu;let i,s;"none"===e.distanceFieldType?(i=new _u(ps.EMPTY),s=n.NORMAL):(i=new _u(ps.EMPTY,{program:Wi.from("// Mesh material default fragment\r\nattribute vec2 aVertexPosition;\r\nattribute vec2 aTextureCoord;\r\n\r\nuniform mat3 projectionMatrix;\r\nuniform mat3 translationMatrix;\r\nuniform mat3 uTextureMatrix;\r\n\r\nvarying vec2 vTextureCoord;\r\n\r\nvoid main(void)\r\n{\r\n    gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\r\n\r\n    vTextureCoord = (uTextureMatrix * vec3(aTextureCoord, 1.0)).xy;\r\n}\r\n","// Pixi texture info\r\nvarying vec2 vTextureCoord;\r\nuniform sampler2D uSampler;\r\n\r\n// Tint\r\nuniform vec4 uColor;\r\n\r\n// on 2D applications fwidth is screenScale / glyphAtlasScale * distanceFieldRange\r\nuniform float uFWidth;\r\n\r\nvoid main(void) {\r\n\r\n  // To stack MSDF and SDF we need a non-pre-multiplied-alpha texture.\r\n  vec4 texColor = texture2D(uSampler, vTextureCoord);\r\n\r\n  // MSDF\r\n  float median = texColor.r + texColor.g + texColor.b -\r\n                  min(texColor.r, min(texColor.g, texColor.b)) -\r\n                  max(texColor.r, max(texColor.g, texColor.b));\r\n  // SDF\r\n  median = min(median, texColor.a);\r\n\r\n  float screenPxDistance = uFWidth * (median - 0.5);\r\n  float alpha = clamp(screenPxDistance + 0.5, 0.0, 1.0);\r\n  if (median < 0.01) {\r\n    alpha = 0.0;\r\n  } else if (median > 0.99) {\r\n    alpha = 1.0;\r\n  }\r\n\r\n  // Gamma correction for coverage-like alpha\r\n  float luma = dot(uColor.rgb, vec3(0.299, 0.587, 0.114));\r\n  float gamma = mix(1.0, 1.0 / 2.2, luma);\r\n  float coverage = pow(uColor.a * alpha, gamma);  \r\n\r\n  // NPM Textures, NPM outputs\r\n  gl_FragColor = vec4(uColor.rgb, coverage);\r\n}\r\n"),uniforms:{uFWidth:0}}),s=n.NORMAL_NPM);const o=new fu(r,i);o.blendMode=s,t={index:0,indexCount:0,vertexCount:0,uvsCount:0,total:0,mesh:o,vertices:null,uvs:null,indices:null}}t.index=0,t.indexCount=0,t.vertexCount=0,t.uvsCount=0,t.total=0;const{_textureCache:s}=this;s[i]=s[i]||new ps(r.baseTexture),t.mesh.texture=s[i],t.mesh.tint=this._tintColor.value,w.push(t),E[i]=t}E[i].total++}for(let t=0;t<S.length;t++)w.includes(S[t])||this.removeChild(S[t].mesh);for(let t=0;t<w.length;t++)w[t].mesh.parent!==this&&this.addChild(w[t].mesh);this._activePagesMeshData=w;for(const e in E){const r=E[e],i=r.total;if(!((null==(t=r.indices)?void 0:t.length)>6*i)||r.vertices.length<2*fu.BATCHABLE_SIZE)r.vertices=new Float32Array(8*i),r.uvs=new Float32Array(8*i),r.indices=new Uint16Array(6*i);else{const t=r.total,e=r.vertices;for(let r=4*t*2;r<e.length;r++)e[r]=0}r.mesh.size=6*i}for(let t=0;t<T;t++){const e=o[t];let r=e.position.x+A[e.line]*("justify"===this._align?e.prevSpaces:1);this._roundPixels&&(r=Math.round(r));const s=r*i,n=e.position.y*i,a=e.texture,h=E[a.baseTexture.uid],l=a.frame,u=a._uvs,c=h.index++;h.indices[6*c+0]=0+4*c,h.indices[6*c+1]=1+4*c,h.indices[6*c+2]=2+4*c,h.indices[6*c+3]=0+4*c,h.indices[6*c+4]=2+4*c,h.indices[6*c+5]=3+4*c,h.vertices[8*c+0]=s,h.vertices[8*c+1]=n,h.vertices[8*c+2]=s+l.width*i,h.vertices[8*c+3]=n,h.vertices[8*c+4]=s+l.width*i,h.vertices[8*c+5]=n+l.height*i,h.vertices[8*c+6]=s,h.vertices[8*c+7]=n+l.height*i,h.uvs[8*c+0]=u.x0,h.uvs[8*c+1]=u.y0,h.uvs[8*c+2]=u.x1,h.uvs[8*c+3]=u.y1,h.uvs[8*c+4]=u.x2,h.uvs[8*c+5]=u.y2,h.uvs[8*c+6]=u.x3,h.uvs[8*c+7]=u.y3}this._textWidth=p*i,this._textHeight=(s.y+e.lineHeight)*i;for(const t in E){const e=E[t];if(0!==this.anchor.x||0!==this.anchor.y){let t=0;const r=this._textWidth*this.anchor.x,i=this._textHeight*this.anchor.y;for(let s=0;s<e.total;s++)e.vertices[t++]-=r,e.vertices[t++]-=i,e.vertices[t++]-=r,e.vertices[t++]-=i,e.vertices[t++]-=r,e.vertices[t++]-=i,e.vertices[t++]-=r,e.vertices[t++]-=i}this._maxLineHeight=b*i;const r=e.mesh.geometry.getBuffer("aVertexPosition"),s=e.mesh.geometry.getBuffer("aTextureCoord"),n=e.mesh.geometry.getIndex();r.data=e.vertices,s.data=e.uvs,n.data=e.indices,r.update(),s.update(),n.update()}for(let t=0;t<o.length;t++)Tc.push(o[t]);this._font=e,this.dirty=!1}updateTransform(){this.validate(),this.containerUpdateTransform()}_render(t){this._autoResolution&&this._resolution!==t.resolution&&(this._resolution=t.resolution,this.dirty=!0);const{distanceFieldRange:e,distanceFieldType:r,size:i}=vc.available[this._fontName];if("none"!==r){const{a:r,b:s,c:n,d:o}=this.worldTransform,a=Math.sqrt(r*r+s*s),h=Math.sqrt(n*n+o*o),l=(Math.abs(a)+Math.abs(h))/2,u=this.fontSize/i,c=t._view.resolution;for(const t of this._activePagesMeshData)t.mesh.shader.uniforms.uFWidth=l*e*u*c}super._render(t)}getLocalBounds(){return this.validate(),super.getLocalBounds()}validate(){const t=vc.available[this._fontName];if(!t)throw new Error(`Missing BitmapFont "${this._fontName}"`);this._font!==t&&(this.dirty=!0),this.dirty&&this.updateText()}get tint(){return this._tintColor.value}set tint(t){if(this.tint!==t){this._tintColor.setValue(t);for(let e=0;e<this._activePagesMeshData.length;e++)this._activePagesMeshData[e].mesh.tint=t}}get align(){return this._align}set align(t){this._align!==t&&(this._align=t,this.dirty=!0)}get fontName(){return this._fontName}set fontName(t){if(!vc.available[t])throw new Error(`Missing BitmapFont "${t}"`);this._fontName!==t&&(this._fontName=t,this.dirty=!0)}get fontSize(){var t;return null!=(t=this._fontSize)?t:vc.available[this._fontName].size}set fontSize(t){this._fontSize!==t&&(this._fontSize=t,this.dirty=!0)}get anchor(){return this._anchor}set anchor(t){"number"==typeof t?this._anchor.set(t):this._anchor.copyFrom(t)}get text(){return this._text}set text(t){t=String(null==t?"":t),this._text!==t&&(this._text=t,this.dirty=!0)}get maxWidth(){return this._maxWidth}set maxWidth(t){this._maxWidth!==t&&(this._maxWidth=t,this.dirty=!0)}get maxLineHeight(){return this.validate(),this._maxLineHeight}get textWidth(){return this.validate(),this._textWidth}get letterSpacing(){return this._letterSpacing}set letterSpacing(t){this._letterSpacing!==t&&(this._letterSpacing=t,this.dirty=!0)}get roundPixels(){return this._roundPixels}set roundPixels(t){t!==this._roundPixels&&(this._roundPixels=t,this.dirty=!0)}get textHeight(){return this.validate(),this._textHeight}get resolution(){return this._resolution}set resolution(t){this._autoResolution=!1,this._resolution!==t&&(this._resolution=t,this.dirty=!0)}destroy(t){const{_textureCache:e}=this,r="none"===vc.available[this._fontName].distanceFieldType?xc:Ac;r.push(...this._activePagesMeshData);for(const t of this._activePagesMeshData)this.removeChild(t.mesh);this._activePagesMeshData=[],r.filter((t=>e[t.mesh.texture.baseTexture.uid])).forEach((t=>{t.mesh.texture=ps.EMPTY}));for(const t in e)e[t].destroy(),delete e[t];this._font=null,this._tintColor=null,this._textureCache=null,super.destroy(t)}};Ec.styleDefaults={align:"left",tint:16777215,maxWidth:0,letterSpacing:0};let wc=Ec;const Sc=[".xml",".fnt"],Cc={extension:{type:Tr.LoadParser,priority:na.Normal},name:"loadBitmapFont",test:t=>Sc.includes(ee.extname(t).toLowerCase()),testParse:async t=>nc.test(t)||ac.test(t),async parse(t,e,r){const i=nc.test(t)?nc.parse(t):ac.parse(t),{src:s}=e,{page:n}=i,o=[];for(let t=0;t<n.length;++t){const e=n[t].file;let r=ee.join(ee.dirname(s),e);r=Wo(r,s),o.push(r)}const a=await r.load(o),h=o.map((t=>a[t]));return vc.install(i,h,!0)},load:async(t,e)=>(await T.ADAPTER.fetch(t)).text(),unload(t){t.destroy()}};Sr.add(Cc);var Pc=Object.defineProperty,Mc=Object.defineProperties,$c=Object.getOwnPropertyDescriptors,Ic=Object.getOwnPropertySymbols,Rc=Object.prototype.hasOwnProperty,Dc=Object.prototype.propertyIsEnumerable,Lc=(t,e,r)=>e in t?Pc(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r;const Fc=class t extends Cu{constructor(){super(...arguments),this._fonts=[],this._overrides=[],this._stylesheet="",this.fontsDirty=!1}static from(e){return new t(Object.keys(t.defaultOptions).reduce(((t,r)=>((t,e)=>Mc(t,$c(e)))(((t,e)=>{for(var r in e||(e={}))Rc.call(e,r)&&Lc(t,r,e[r]);if(Ic)for(var r of Ic(e))Dc.call(e,r)&&Lc(t,r,e[r]);return t})({},t),{[r]:e[r]})),{}))}cleanFonts(){this._fonts.length>0&&(this._fonts.forEach((e=>{URL.revokeObjectURL(e.src),e.refs--,0===e.refs&&(e.fontFace&&document.fonts.delete(e.fontFace),delete t.availableFonts[e.originalUrl])})),this.fontFamily="Arial",this._fonts.length=0,this.styleID++,this.fontsDirty=!0)}loadFont(e,r={}){const{availableFonts:i}=t;if(i[e]){const t=i[e];return this._fonts.push(t),t.refs++,this.styleID++,this.fontsDirty=!0,Promise.resolve()}return T.ADAPTER.fetch(e).then((t=>t.blob())).then((async t=>new Promise(((e,r)=>{const i=URL.createObjectURL(t),s=new FileReader;s.onload=()=>e([i,s.result]),s.onerror=r,s.readAsDataURL(t)})))).then((async([t,s])=>{const n=Object.assign({family:ee.basename(e,ee.extname(e)),weight:"normal",style:"normal",display:"auto",src:t,dataSrc:s,refs:1,originalUrl:e,fontFace:null},r);i[e]=n,this._fonts.push(n),this.styleID++;const o=new FontFace(n.family,`url(${n.src})`,{weight:n.weight,style:n.style,display:n.display});n.fontFace=o,await o.load(),document.fonts.add(o),await document.fonts.ready,this.styleID++,this.fontsDirty=!0}))}addOverride(...t){const e=t.filter((t=>!this._overrides.includes(t)));e.length>0&&(this._overrides.push(...e),this.styleID++)}removeOverride(...t){const e=t.filter((t=>this._overrides.includes(t)));e.length>0&&(this._overrides=this._overrides.filter((t=>!e.includes(t))),this.styleID++)}toCSS(t){return[`transform: scale(${t})`,"transform-origin: top left","display: inline-block",`color: ${this.normalizeColor(this.fill)}`,`font-size: ${this.fontSize}px`,`font-family: ${this.fontFamily}`,`font-weight: ${this.fontWeight}`,`font-style: ${this.fontStyle}`,`font-variant: ${this.fontVariant}`,`letter-spacing: ${this.letterSpacing}px`,`text-align: ${this.align}`,`padding: ${this.padding}px`,`white-space: ${this.whiteSpace}`,...this.lineHeight?[`line-height: ${this.lineHeight}px`]:[],...this.wordWrap?["word-wrap: "+(this.breakWords?"break-all":"break-word"),`max-width: ${this.wordWrapWidth}px`]:[],...this.strokeThickness?[`-webkit-text-stroke-width: ${this.strokeThickness}px`,`-webkit-text-stroke-color: ${this.normalizeColor(this.stroke)}`,`text-stroke-width: ${this.strokeThickness}px`,`text-stroke-color: ${this.normalizeColor(this.stroke)}`,"paint-order: stroke"]:[],...this.dropShadow?[this.dropShadowToCSS()]:[],...this._overrides].join(";")}toGlobalCSS(){return this._fonts.reduce(((t,e)=>`${t}\n            @font-face {\n                font-family: "${e.family}";\n                src: url('${e.dataSrc}');\n                font-weight: ${e.weight};\n                font-style: ${e.style};\n                font-display: ${e.display};\n            }`),this._stylesheet)}get stylesheet(){return this._stylesheet}set stylesheet(t){this._stylesheet!==t&&(this._stylesheet=t,this.styleID++)}normalizeColor(t){return Array.isArray(t)&&(t=Ve(t)),"number"==typeof t?Ge(t):t}dropShadowToCSS(){let t=this.normalizeColor(this.dropShadowColor);const e=this.dropShadowAlpha,r=Math.round(Math.cos(this.dropShadowAngle)*this.dropShadowDistance),i=Math.round(Math.sin(this.dropShadowAngle)*this.dropShadowDistance);t.startsWith("#")&&e<1&&(t+=(255*e|0).toString(16).padStart(2,"0"));const s=`${r}px ${i}px`;return this.dropShadowBlur>0?`text-shadow: ${s} ${this.dropShadowBlur}px ${t}`:`text-shadow: ${s} ${t}`}reset(){Object.assign(this,t.defaultOptions)}onBeforeDraw(){const{fontsDirty:t}=this;return this.fontsDirty=!1,this.isSafari&&this._fonts.length>0&&t?new Promise((t=>setTimeout(t,100))):Promise.resolve()}get isSafari(){const{userAgent:t}=T.ADAPTER.getNavigator();return/^((?!chrome|android).)*safari/i.test(t)}set fillGradientStops(t){console.warn("[HTMLTextStyle] fillGradientStops is not supported by HTMLText")}get fillGradientStops(){return super.fillGradientStops}set fillGradientType(t){console.warn("[HTMLTextStyle] fillGradientType is not supported by HTMLText")}get fillGradientType(){return super.fillGradientType}set miterLimit(t){console.warn("[HTMLTextStyle] miterLimit is not supported by HTMLText")}get miterLimit(){return super.miterLimit}set trim(t){console.warn("[HTMLTextStyle] trim is not supported by HTMLText")}get trim(){return super.trim}set textBaseline(t){console.warn("[HTMLTextStyle] textBaseline is not supported by HTMLText")}get textBaseline(){return super.textBaseline}set leading(t){console.warn("[HTMLTextStyle] leading is not supported by HTMLText")}get leading(){return super.leading}set lineJoin(t){console.warn("[HTMLTextStyle] lineJoin is not supported by HTMLText")}get lineJoin(){return super.lineJoin}};Fc.availableFonts={},Fc.defaultOptions={align:"left",breakWords:!1,dropShadow:!1,dropShadowAlpha:1,dropShadowAngle:Math.PI/6,dropShadowBlur:0,dropShadowColor:"black",dropShadowDistance:5,fill:"black",fontFamily:"Arial",fontSize:26,fontStyle:"normal",fontVariant:"normal",fontWeight:"normal",letterSpacing:0,lineHeight:0,padding:0,stroke:"black",strokeThickness:0,whiteSpace:"normal",wordWrap:!1,wordWrapWidth:100};let Oc=Fc;const kc=class t extends so{constructor(e="",r={}){var i;super(ps.EMPTY),this._text=null,this._style=null,this._autoResolution=!0,this.localStyleID=-1,this.dirty=!1,this._updateID=0,this.ownsStyle=!1;const s=new Image,n=ps.from(s,{scaleMode:T.SCALE_MODE,resourceOptions:{autoLoad:!1}});n.orig=new ai,n.trim=new ai,this.texture=n;const o="http://www.w3.org/2000/svg",a="http://www.w3.org/1999/xhtml",h=document.createElementNS(o,"svg"),l=document.createElementNS(o,"foreignObject"),u=document.createElementNS(a,"div"),c=document.createElementNS(a,"style");l.setAttribute("width","10000"),l.setAttribute("height","10000"),l.style.overflow="hidden",h.appendChild(l),this.maxWidth=t.defaultMaxWidth,this.maxHeight=t.defaultMaxHeight,this._domElement=u,this._styleElement=c,this._svgRoot=h,this._foreignObject=l,this._foreignObject.appendChild(c),this._foreignObject.appendChild(u),this._image=s,this._loadImage=new Image,this._autoResolution=t.defaultAutoResolution,this._resolution=null!=(i=t.defaultResolution)?i:T.RESOLUTION,this.text=e,this.style=r}measureText(t){var e,r;const{text:i,style:s,resolution:n}=Object.assign({text:this._text,style:this._style,resolution:this._resolution},t);Object.assign(this._domElement,{innerHTML:i,style:s.toCSS(n)}),this._styleElement.textContent=s.toGlobalCSS(),document.body.appendChild(this._svgRoot);const o=this._domElement.getBoundingClientRect();this._svgRoot.remove();const{width:a,height:h}=o,l=Math.min(this.maxWidth,Math.ceil(a)),u=Math.min(this.maxHeight,Math.ceil(h));return this._svgRoot.setAttribute("width",l.toString()),this._svgRoot.setAttribute("height",u.toString()),i!==this._text&&(this._domElement.innerHTML=this._text),s!==this._style&&(Object.assign(this._domElement,{style:null==(e=this._style)?void 0:e.toCSS(n)}),this._styleElement.textContent=null==(r=this._style)?void 0:r.toGlobalCSS()),{width:l+2*s.padding,height:u+2*s.padding}}async updateText(t=!0){const{style:e,_image:r,_loadImage:i}=this;if(this.localStyleID!==e.styleID&&(this.dirty=!0,this.localStyleID=e.styleID),!this.dirty&&t)return;const{width:s,height:n}=this.measureText();r.width=i.width=Math.ceil(Math.max(1,s)),r.height=i.height=Math.ceil(Math.max(1,n)),this._updateID++;const o=this._updateID;await new Promise((t=>{i.onload=async()=>{o<this._updateID||(await e.onBeforeDraw(),r.src=i.src,i.onload=null,i.src="",this.updateTexture()),t()};const s=(new XMLSerializer).serializeToString(this._svgRoot);i.src=`data:image/svg+xml;charset=utf8,${encodeURIComponent(s)}`}))}get source(){return this._image}updateTexture(){const{style:t,texture:e,_image:r,resolution:i}=this,{padding:s}=t,{baseTexture:n}=e;e.trim.width=e._frame.width=r.width/i,e.trim.height=e._frame.height=r.height/i,e.trim.x=-s,e.trim.y=-s,e.orig.width=e._frame.width-2*s,e.orig.height=e._frame.height-2*s,this._onTextureUpdate(),n.setRealSize(r.width,r.height,i),this.dirty=!1}_render(t){this._autoResolution&&this._resolution!==t.resolution&&(this._resolution=t.resolution,this.dirty=!0),this.updateText(!0),super._render(t)}_renderCanvas(t){this._autoResolution&&this._resolution!==t.resolution&&(this._resolution=t.resolution,this.dirty=!0),this.updateText(!0),super._renderCanvas(t)}getLocalBounds(t){return this.updateText(!0),super.getLocalBounds(t)}_calculateBounds(){this.updateText(!0),this.calculateVertices(),this._bounds.addQuad(this.vertexData)}_onStyleChange(){this.dirty=!0}destroy(e){var r,i,s,n,o;"boolean"==typeof e&&(e={children:e}),e=Object.assign({},t.defaultDestroyOptions,e),super.destroy(e);const a=null;this.ownsStyle&&(null==(r=this._style)||r.cleanFonts()),this._style=a,null==(i=this._svgRoot)||i.remove(),this._svgRoot=a,null==(s=this._domElement)||s.remove(),this._domElement=a,null==(n=this._foreignObject)||n.remove(),this._foreignObject=a,null==(o=this._styleElement)||o.remove(),this._styleElement=a,this._loadImage.src="",this._loadImage.onload=null,this._loadImage=a,this._image.src="",this._image=a}get width(){return this.updateText(!0),Math.abs(this.scale.x)*this._image.width/this.resolution}set width(t){this.updateText(!0);const e=Ke(this.scale.x)||1;this.scale.x=e*t/this._image.width/this.resolution,this._width=t}get height(){return this.updateText(!0),Math.abs(this.scale.y)*this._image.height/this.resolution}set height(t){this.updateText(!0);const e=Ke(this.scale.y)||1;this.scale.y=e*t/this._image.height/this.resolution,this._height=t}get style(){return this._style}set style(t){this._style!==t&&((t=t||{})instanceof Oc?(this.ownsStyle=!1,this._style=t):t instanceof Cu?(console.warn("[HTMLText] Cloning TextStyle, if this is not what you want, use HTMLTextStyle"),this.ownsStyle=!0,this._style=Oc.from(t)):(this.ownsStyle=!0,this._style=new Oc(t)),this.localStyleID=-1,this.dirty=!0)}get text(){return this._text}set text(t){t=String(""===t||null==t?" ":t),t=this.sanitiseText(t),this._text!==t&&(this._text=t,this.dirty=!0)}get resolution(){return this._resolution}set resolution(t){this._autoResolution=!1,this._resolution!==t&&(this._resolution=t,this.dirty=!0)}sanitiseText(t){return t.replace(/<br>/gi,"<br/>").replace(/<hr>/gi,"<hr/>").replace(/&nbsp;/gi,"&#160;")}};kc.defaultDestroyOptions={texture:!0,children:!1,baseTexture:!0},kc.defaultMaxWidth=2024,kc.defaultMaxHeight=2024,kc.defaultAutoResolution=!0;let Bc=kc;return t.ALPHA_MODES=p,t.AbstractMultiResource=Nn,t.AccessibilityManager=ko,t.AlphaFilter=ao,t.AnimatedSprite=Yu,t.Application=No,t.ArrayResource=Un,t.Assets=gh,t.AssetsClass=mh,t.Attribute=jr,t.BLEND_MODES=n,t.BUFFER_BITS=s,t.BUFFER_TYPE=x,t.BackgroundSystem=is,t.BaseImageResource=ls,t.BasePrepare=Vu,t.BaseRenderTexture=hs,t.BaseTexture=zr,t.BatchDrawCall=Xr,t.BatchGeometry=ti,t.BatchRenderer=ts,t.BatchShaderGenerator=Zi,t.BatchSystem=ss,t.BatchTextureArray=Qi,t.BitmapFont=vc,t.BitmapFontData=sc,t.BitmapText=wc,t.BlobResource=Oh,t.BlurFilter=co,t.BlurFilterPass=uo,t.Bounds=qn,t.BrowserAdapter=A,t.Buffer=Yr,t.BufferResource=Or,t.BufferSystem=Fn,t.CLEAR_MODES=_,t.COLOR_MASK_BITS=b,t.Cache=Zo,t.CanvasResource=Gn,t.Circle=hi,t.Color=Ue,t.ColorMatrixFilter=fo,t.CompressedTextureResource=kh,t.Container=eo,t.ContextSystem=os,t.CountLimiter=Du,t.CubeResource=Hn,t.DEG_TO_RAD=ii,t.DRAW_MODES=o,t.DisplacementFilter=po,t.DisplayObject=Zn,t.ENV=r,t.Ellipse=li,t.EventBoundary=wo,t.EventSystem=Do,t.ExtensionType=Tr,t.Extract=Dl,t.FORMATS=a,t.FORMATS_TO_COMPONENTS=fl,t.FXAAFilter=_o,t.FederatedDisplayObject=Fo,t.FederatedEvent=bo,t.FederatedMouseEvent=vo,t.FederatedPointerEvent=xo,t.FederatedWheelEvent=Ao,t.FillStyle=iu,t.Filter=rs,t.FilterState=bs,t.FilterSystem=As,t.Framebuffer=as,t.FramebufferSystem=ws,t.GC_MODES=m,t.GLFramebuffer=Ts,t.GLProgram=Zs,t.GLTexture=pn,t.GRAPHICS_CURVES=Vl,t.GenerateTextureSystem=Ws,t.Geometry=Kr,t.GeometrySystem=Cs,t.Graphics=au,t.GraphicsData=Kl,t.GraphicsGeometry=ru,t.HTMLText=Bc,t.HTMLTextStyle=Oc,t.IGLUniformData=class{},t.INSTALLED=Rr,t.INTERNAL_FORMATS=$h,t.INTERNAL_FORMAT_TO_BYTES_PER_PIXEL=Ih,t.ImageBitmapResource=zn,t.ImageResource=us,t.LINE_CAP=Ul,t.LINE_JOIN=Nl,t.LineStyle=su,t.LoaderParserPriority=na,t.MASK_TYPES=y,t.MIPMAP_MODES=f,t.MSAA_QUALITY=v,t.MaskData=Is,t.MaskSystem=Rs,t.Matrix=di,t.Mesh=fu,t.MeshBatchUvs=lu,t.MeshGeometry=pu,t.MeshMaterial=_u,t.MultisampleSystem=Dn,t.NineSlicePlane=class extends yu{constructor(t,e,r,i,s){var n,o,a,h,l,u,c,d;super(ps.WHITE,4,4),this._origWidth=t.orig.width,this._origHeight=t.orig.height,this._width=this._origWidth,this._height=this._origHeight,this._leftWidth=null!=(o=null!=e?e:null==(n=t.defaultBorders)?void 0:n.left)?o:10,this._rightWidth=null!=(h=null!=i?i:null==(a=t.defaultBorders)?void 0:a.right)?h:10,this._topHeight=null!=(u=null!=r?r:null==(l=t.defaultBorders)?void 0:l.top)?u:10,this._bottomHeight=null!=(d=null!=s?s:null==(c=t.defaultBorders)?void 0:c.bottom)?d:10,this.texture=t}textureUpdated(){this._textureID=this.shader.texture._updateID,this._refresh()}get vertices(){return this.geometry.getBuffer("aVertexPosition").data}set vertices(t){this.geometry.getBuffer("aVertexPosition").data=t}updateHorizontalVertices(){const t=this.vertices,e=this._getMinScale();t[9]=t[11]=t[13]=t[15]=this._topHeight*e,t[17]=t[19]=t[21]=t[23]=this._height-this._bottomHeight*e,t[25]=t[27]=t[29]=t[31]=this._height}updateVerticalVertices(){const t=this.vertices,e=this._getMinScale();t[2]=t[10]=t[18]=t[26]=this._leftWidth*e,t[4]=t[12]=t[20]=t[28]=this._width-this._rightWidth*e,t[6]=t[14]=t[22]=t[30]=this._width}_getMinScale(){const t=this._leftWidth+this._rightWidth,e=this._width>t?1:this._width/t,r=this._topHeight+this._bottomHeight,i=this._height>r?1:this._height/r;return Math.min(e,i)}get width(){return this._width}set width(t){this._width=t,this._refresh()}get height(){return this._height}set height(t){this._height=t,this._refresh()}get leftWidth(){return this._leftWidth}set leftWidth(t){this._leftWidth=t,this._refresh()}get rightWidth(){return this._rightWidth}set rightWidth(t){this._rightWidth=t,this._refresh()}get topHeight(){return this._topHeight}set topHeight(t){this._topHeight=t,this._refresh()}get bottomHeight(){return this._bottomHeight}set bottomHeight(t){this._bottomHeight=t,this._refresh()}_refresh(){const t=this.texture,e=this.geometry.buffers[1].data;this._origWidth=t.orig.width,this._origHeight=t.orig.height;const r=1/this._origWidth,i=1/this._origHeight;e[0]=e[8]=e[16]=e[24]=0,e[1]=e[3]=e[5]=e[7]=0,e[6]=e[14]=e[22]=e[30]=1,e[25]=e[27]=e[29]=e[31]=1,e[2]=e[10]=e[18]=e[26]=r*this._leftWidth,e[4]=e[12]=e[20]=e[28]=1-r*this._rightWidth,e[9]=e[11]=e[13]=e[15]=i*this._topHeight,e[17]=e[19]=e[21]=e[23]=1-i*this._bottomHeight,this.updateHorizontalVertices(),this.updateVerticalVertices(),this.geometry.buffers[0].update(),this.geometry.buffers[1].update()}},t.NoiseFilter=mo,t.ObjectRenderer=Ji,t.ObjectRendererSystem=On,t.ObservablePoint=xi,t.PI_2=ei,t.PRECISION=g,t.ParticleContainer=class extends eo{constructor(t=1500,e,r=16384,i=!1){super();r>16384&&(r=16384),this._properties=[!1,!0,!1,!1,!1],this._maxSize=t,this._batchSize=r,this._buffers=null,this._bufferUpdateIDs=[],this._updateID=0,this.interactiveChildren=!1,this.blendMode=n.NORMAL,this.autoResize=i,this.roundPixels=!0,this.baseTexture=null,this.setProperties(e),this._tintColor=new Ue(0),this.tintRgb=new Float32Array(3),this.tint=16777215}setProperties(t){t&&(this._properties[0]="vertices"in t||"scale"in t?!!t.vertices||!!t.scale:this._properties[0],this._properties[1]="position"in t?!!t.position:this._properties[1],this._properties[2]="rotation"in t?!!t.rotation:this._properties[2],this._properties[3]="uvs"in t?!!t.uvs:this._properties[3],this._properties[4]="tint"in t||"alpha"in t?!!t.tint||!!t.alpha:this._properties[4])}updateTransform(){this.displayObjectUpdateTransform()}get tint(){return this._tintColor.value}set tint(t){this._tintColor.setValue(t),this._tintColor.toRgbArray(this.tintRgb)}render(t){!this.visible||this.worldAlpha<=0||!this.children.length||!this.renderable||(this.baseTexture||(this.baseTexture=this.children[0]._texture.baseTexture,this.baseTexture.valid||this.baseTexture.once("update",(()=>this.onChildrenChange(0)))),t.batch.setObjectRenderer(t.plugins.particle),t.plugins.particle.render(this))}onChildrenChange(t){const e=Math.floor(t/this._batchSize);for(;this._bufferUpdateIDs.length<e;)this._bufferUpdateIDs.push(0);this._bufferUpdateIDs[e]=++this._updateID}dispose(){if(this._buffers){for(let t=0;t<this._buffers.length;++t)this._buffers[t].destroy();this._buffers=null}}destroy(t){super.destroy(t),this.dispose(),this._properties=null,this._buffers=null,this._bufferUpdateIDs=null}},t.ParticleRenderer=vu,t.PlaneGeometry=mu,t.PluginSystem=Ns,t.Point=ni,t.Polygon=ui,t.Prepare=Wu,t.Program=Wi,t.ProjectionSystem=Us,t.Quad=gs,t.QuadUv=ys,t.RAD_TO_DEG=ri,t.RENDERER_TYPE=i,t.Rectangle=ai,t.RenderTexture=_s,t.RenderTexturePool=ms,t.RenderTextureSystem=qs,t.Renderer=Bn,t.ResizePlugin=Uo,t.Resource=Fr,t.RopeGeometry=gu,t.RoundedRectangle=ci,t.Runner=Lr,t.SAMPLER_TYPES=u,t.SCALE_MODES=c,t.SHAPES=si,t.SVGResource=Wn,t.ScissorSystem=ks,t.Shader=qi,t.ShaderSystem=an,t.SimpleMesh=class extends fu{constructor(t=ps.EMPTY,e,r,i,s){const n=new pu(e,r,i);n.getBuffer("aVertexPosition").static=!1;super(n,new _u(t),null,s),this.autoUpdate=!0}get vertices(){return this.geometry.getBuffer("aVertexPosition").data}set vertices(t){this.geometry.getBuffer("aVertexPosition").data=t}_render(t){this.autoUpdate&&this.geometry.getBuffer("aVertexPosition").update(),super._render(t)}},t.SimplePlane=yu,t.SimpleRope=class extends fu{constructor(t,e,r=0){const i=new gu(t.height,e,r),s=new _u(t);r>0&&(t.baseTexture.wrapMode=d.REPEAT),super(i,s),this.autoUpdate=!0}_render(t){const e=this.geometry;(this.autoUpdate||e._width!==this.shader.texture.height)&&(e._width=this.shader.texture.height,e.update()),super._render(t)}},t.Sprite=so,t.SpriteMaskFilter=$s,t.Spritesheet=tc,t.StartupSystem=hn,t.State=Ir,t.StateSystem=un,t.StencilSystem=Bs,t.SystemManager=cn,t.TARGETS=h,t.TEXT_GRADIENT=xu,t.TYPES=l,t.TYPES_TO_BYTES_PER_COMPONENT=dl,t.TYPES_TO_BYTES_PER_PIXEL=pl,t.TemporaryDisplayObject=Qn,t.Text=Ru,t.TextFormat=nc,t.TextMetrics=Eu,t.TextStyle=Cu,t.Texture=ps,t.TextureGCSystem=fn,t.TextureMatrix=Ms,t.TextureSystem=_n,t.TextureUvs=cs,t.Ticker=Cn,t.TickerPlugin=Pn,t.TilingSprite=qu,t.TilingSpriteRenderer=Ju,t.TimeLimiter=class{constructor(t){this.maxMilliseconds=t,this.frameStart=0}beginFrame(){this.frameStart=Date.now()}allowedToUpload(){return Date.now()-this.frameStart<this.maxMilliseconds}},t.Transform=Ti,t.TransformFeedback=class{constructor(){this._glTransformFeedbacks={},this.buffers=[],this.disposeRunner=new Lr("disposeTransformFeedback")}bindBuffer(t,e){this.buffers[t]=e}destroy(){this.disposeRunner.emit(this,!1)}},t.TransformFeedbackSystem=mn,t.UPDATE_PRIORITY=En,t.UniformGroup=ji,t.VERSION="7.4.2",t.VideoResource=jn,t.ViewSystem=gn,t.ViewableBuffer=Cr,t.WRAP_MODES=d,t.XMLFormat=oc,t.XMLStringFormat=ac,t.accessibleTarget=Oo,t.autoDetectFormat=lc,t.autoDetectRenderer=$n,t.autoDetectResource=Dr,t.cacheTextureArray=yh,t.checkDataUrl=Ho,t.checkExtension=zo,t.checkMaxIfStatementsInShader=$r,t.convertToList=Xo,t.copySearchParams=Wo,t.createStringVariations=jo,t.createTexture=Ra,t.createUBOElements=en,t.curves=Gl,t.defaultFilterVertex=Rn,t.defaultVertex=In,t.detectAvif=vh,t.detectCompressedTextures=Fh,t.detectDefaults=Th,t.detectMp4=Ch,t.detectOgv=Ph,t.detectWebm=Sh,t.detectWebp=xh,t.extensions=Sr,t.filters=go,t.generateProgram=Qs,t.generateUniformBufferSync=sn,t.getFontFamilyName=xa,t.getTestContext=Di,t.getUBOData=rn,t.graphicsUtils=hu,t.groupD8=vi,t.isMobile=V,t.isSingleItem=qo,t.loadBitmapFont=Cc,t.loadDDS=Al,t.loadImageBitmap=Ga,t.loadJson=oa,t.loadKTX=Pl,t.loadSVG=ja,t.loadTextures=Va,t.loadTxt=aa,t.loadVideo=nh,t.loadWebFont=Ea,t.parseDDS=Kh,t.parseKTX=_l,t.resolveCompressedTextureUrl=$l,t.resolveTextureUrl=Mh,t.settings=T,t.spritesheetAsset=ic,t.uniformParsers=Ci,t.unsafeEvalSupported=Vi,t.utils=pr,t}({});let app,model4;!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("@pixi/core"),require("@pixi/display")):"function"==typeof define&&define.amd?define(["exports","@pixi/core","@pixi/display"],e):e(((t="undefined"!=typeof globalThis?globalThis:t||self).PIXI=t.PIXI||{},t.PIXI.live2d=t.PIXI.live2d||{}),t.PIXI,t.PIXI)}(this,(function(t,e,r){"use strict";var i,s,n=Object.defineProperty,o=Math.pow,a=(t,e,r)=>(((t,e,r)=>{e in t?n(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r})(t,"symbol"!=typeof e?e+"":e,r),r),h=(t,e,r)=>new Promise(((i,s)=>{var n=t=>{try{a(r.next(t))}catch(t){s(t)}},o=t=>{try{a(r.throw(t))}catch(t){s(t)}},a=t=>t.done?i(t.value):Promise.resolve(t.value).then(n,o);a((r=r.apply(t,e)).next())}));(s=i||(i={})).supportMoreMaskDivisions=!0,s.setOpacityFromMotion=!1;const l={LOG_LEVEL_VERBOSE:0,LOG_LEVEL_WARNING:1,LOG_LEVEL_ERROR:2,LOG_LEVEL_NONE:999,logLevel:1,sound:!0,motionSync:!0,motionFadingDuration:500,idleMotionFadingDuration:2e3,expressionFadingDuration:500,preserveExpressionOnMotion:!0,cubism4:i},u={log(t,...e){l.logLevel<=l.LOG_LEVEL_VERBOSE&&console.log(`[${t}]`,...e)},warn(t,...e){l.logLevel<=l.LOG_LEVEL_WARNING&&console.warn(`[${t}]`,...e)},error(t,...e){l.logLevel<=l.LOG_LEVEL_ERROR&&console.error(`[${t}]`,...e)}};function c(t,e,r){return t<e?e:t>r?r:t}function d(t,e){return Math.random()*(e-t)+t}function f(t,e,r,i,s){const n=e[i];null!==n&&typeof n===t&&(r[s]=n)}function p(t,e,r,i,s){const n=e[i];Array.isArray(n)&&(r[s]=n.filter((e=>null!==e&&typeof e===t)))}function _(t,e){e.forEach((e=>{Object.getOwnPropertyNames(e.prototype).forEach((r=>{"constructor"!==r&&Object.defineProperty(t.prototype,r,Object.getOwnPropertyDescriptor(e.prototype,r))}))}))}function m(t){let e=t.lastIndexOf("/");return-1!=e&&(t=t.slice(0,e)),e=t.lastIndexOf("/"),-1!==e&&(t=t.slice(e+1)),t}function g(t,e){const r=t.indexOf(e);-1!==r&&t.splice(r,1)}class y extends e.utils.EventEmitter{constructor(t,e){super(),a(this,"tag"),a(this,"settings"),a(this,"expressions",[]),a(this,"defaultExpression"),a(this,"currentExpression"),a(this,"reserveExpressionIndex",-1),a(this,"destroyed",!1),this.settings=t,this.tag=`ExpressionManager(${t.name})`}init(){this.defaultExpression=this.createExpression({},void 0),this.currentExpression=this.defaultExpression,this.stopAllExpressions()}loadExpression(t){return h(this,null,(function*(){if(!this.definitions[t])return void u.warn(this.tag,`Undefined expression at [${t}]`);if(null===this.expressions[t])return void u.warn(this.tag,`Cannot set expression at [${t}] because it's already failed in loading.`);if(this.expressions[t])return this.expressions[t];const e=yield this._loadExpression(t);return this.expressions[t]=e,e}))}_loadExpression(t){throw new Error("Not implemented.")}setRandomExpression(){return h(this,null,(function*(){if(this.definitions.length){const t=[];for(let e=0;e<this.definitions.length;e++)null!==this.expressions[e]&&this.expressions[e]!==this.currentExpression&&e!==this.reserveExpressionIndex&&t.push(e);if(t.length){const e=Math.floor(Math.random()*t.length);return this.setExpression(e)}}return!1}))}resetExpression(){this._setExpression(this.defaultExpression)}restoreExpression(){this._setExpression(this.currentExpression)}setExpression(t){return h(this,null,(function*(){if("number"!=typeof t&&(t=this.getExpressionIndex(t)),!(t>-1&&t<this.definitions.length))return!1;if(t===this.expressions.indexOf(this.currentExpression))return!1;this.reserveExpressionIndex=t;const e=yield this.loadExpression(t);return!(!e||this.reserveExpressionIndex!==t||(this.reserveExpressionIndex=-1,this.currentExpression=e,this._setExpression(e),0))}))}update(t,e){return!this.isFinished()&&this.updateParameters(t,e)}destroy(){this.destroyed=!0,this.emit("destroy"),this.definitions=void 0,this.expressions=void 0}}const b=40/7.5,v=1/150;class x{constructor(){a(this,"targetX",0),a(this,"targetY",0),a(this,"x",0),a(this,"y",0),a(this,"vx",0),a(this,"vy",0)}focus(t,e,r=!1){this.targetX=c(t,-1,1),this.targetY=c(e,-1,1),r&&(this.x=this.targetX,this.y=this.targetY)}update(t){const e=this.targetX-this.x,r=this.targetY-this.y;if(Math.abs(e)<.01&&Math.abs(r)<.01)return;const i=Math.sqrt(o(e,2)+o(r,2)),s=b/(1e3/t);let n=s*(e/i)-this.vx,a=s*(r/i)-this.vy;const h=Math.sqrt(o(n,2)+o(a,2)),l=s*v*t;h>l&&(n*=l/h,a*=l/h),this.vx+=n,this.vy+=a;const u=Math.sqrt(o(this.vx,2)+o(this.vy,2)),c=.5*(Math.sqrt(o(l,2)+8*l*i)-l);u>c&&(this.vx*=c/u,this.vy*=c/u),this.x+=this.vx,this.y+=this.vy}}class A{constructor(t){a(this,"json"),a(this,"name"),a(this,"url"),a(this,"pose"),a(this,"physics"),this.json=t;const e=t.url;if("string"!=typeof e)throw new TypeError("The `url` field in settings JSON must be defined as a string.");this.url=e,this.name=m(this.url)}resolveURL(t){return e.utils.url.resolve(this.url,t)}replaceFiles(t){this.moc=t(this.moc,"moc"),void 0!==this.pose&&(this.pose=t(this.pose,"pose")),void 0!==this.physics&&(this.physics=t(this.physics,"physics"));for(let e=0;e<this.textures.length;e++)this.textures[e]=t(this.textures[e],`textures[${e}]`)}getDefinedFiles(){const t=[];return this.replaceFiles((e=>(t.push(e),e))),t}validateFiles(t){const e=(e,r)=>{const i=this.resolveURL(e);if(!t.includes(i)){if(r)throw new Error(`File "${e}" is defined in settings, but doesn't exist in given files`);return!1}return!0};return[this.moc,...this.textures].forEach((t=>e(t,!0))),this.getDefinedFiles().filter((t=>e(t,!1)))}}var T=(t=>(t[t.NONE=0]="NONE",t[t.IDLE=1]="IDLE",t[t.NORMAL=2]="NORMAL",t[t.FORCE=3]="FORCE",t))(T||{});class E{constructor(){a(this,"tag"),a(this,"debug",!1),a(this,"currentPriority",0),a(this,"reservePriority",0),a(this,"currentGroup"),a(this,"currentIndex"),a(this,"reservedGroup"),a(this,"reservedIndex"),a(this,"reservedIdleGroup"),a(this,"reservedIdleIndex")}reserve(t,e,r){if(r<=0)return u.log(this.tag,"Cannot start a motion with MotionPriority.NONE."),!1;if(t===this.currentGroup&&e===this.currentIndex)return u.log(this.tag,"Motion is already playing.",this.dump(t,e)),!1;if(t===this.reservedGroup&&e===this.reservedIndex||t===this.reservedIdleGroup&&e===this.reservedIdleIndex)return u.log(this.tag,"Motion is already reserved.",this.dump(t,e)),!1;if(1===r){if(0!==this.currentPriority)return u.log(this.tag,"Cannot start idle motion because another motion is playing.",this.dump(t,e)),!1;if(void 0!==this.reservedIdleGroup)return u.log(this.tag,"Cannot start idle motion because another idle motion has reserved.",this.dump(t,e)),!1;this.setReservedIdle(t,e)}else{if(r<3){if(r<=this.currentPriority)return u.log(this.tag,"Cannot start motion because another motion is playing as an equivalent or higher priority.",this.dump(t,e)),!1;if(r<=this.reservePriority)return u.log(this.tag,"Cannot start motion because another motion has reserved as an equivalent or higher priority.",this.dump(t,e)),!1}this.setReserved(t,e,r)}return!0}start(t,e,r,i){if(1===i){if(this.setReservedIdle(void 0,void 0),0!==this.currentPriority)return u.log(this.tag,"Cannot start idle motion because another motion is playing.",this.dump(e,r)),!1}else{if(e!==this.reservedGroup||r!==this.reservedIndex)return u.log(this.tag,"Cannot start motion because another motion has taken the place.",this.dump(e,r)),!1;this.setReserved(void 0,void 0,0)}return!!t&&(this.setCurrent(e,r,i),!0)}complete(){this.setCurrent(void 0,void 0,0)}setCurrent(t,e,r){this.currentPriority=r,this.currentGroup=t,this.currentIndex=e}setReserved(t,e,r){this.reservePriority=r,this.reservedGroup=t,this.reservedIndex=e}setReservedIdle(t,e){this.reservedIdleGroup=t,this.reservedIdleIndex=e}isActive(t,e){return t===this.currentGroup&&e===this.currentIndex||t===this.reservedGroup&&e===this.reservedIndex||t===this.reservedIdleGroup&&e===this.reservedIdleIndex}reset(){this.setCurrent(void 0,void 0,0),this.setReserved(void 0,void 0,0),this.setReservedIdle(void 0,void 0)}shouldRequestIdleMotion(){return void 0===this.currentGroup&&void 0===this.reservedIdleGroup}shouldOverrideExpression(){return!l.preserveExpressionOnMotion&&this.currentPriority>1}dump(t,e){return this.debug?`\n<Requested> group = "${t}", index = ${e}\n`+["currentPriority","reservePriority","currentGroup","currentIndex","reservedGroup","reservedIndex","reservedIdleGroup","reservedIdleIndex"].map((t=>"["+t+"] "+this[t])).join("\n"):""}}class w{static get volume(){return this._volume}static set volume(t){this._volume=(t>1?1:t<0?0:t)||0,this.audios.forEach((t=>t.volume=this._volume))}static add(t,e,r,i){const s=new Audio(t);return s.volume=this._volume,s.preload="auto",s.crossOrigin=i,s.addEventListener("ended",(()=>{this.dispose(s),null==e||e()})),s.addEventListener("error",(e=>{this.dispose(s),u.warn("SoundManager",`Error occurred on "${t}"`,e.error),null==r||r(e.error)})),this.audios.push(s),s}static play(t){return new Promise(((e,r)=>{var i;null==(i=t.play())||i.catch((e=>{t.dispatchEvent(new ErrorEvent("error",{error:e})),r(e)})),t.readyState===t.HAVE_ENOUGH_DATA?e():t.addEventListener("canplaythrough",e)}))}static addContext(t){const e=new AudioContext;return this.contexts.push(e),e}static addAnalyzer(t,e){const r=e.createMediaElementSource(t),i=e.createAnalyser();return i.fftSize=256,i.minDecibels=-90,i.maxDecibels=-10,i.smoothingTimeConstant=.85,r.connect(i),i.connect(e.destination),this.analysers.push(i),i}static analyze(t){if(null!=t){const e=new Float32Array(t.fftSize);let r=0;t.getFloatTimeDomainData(e);for(const t of e)r+=t*t;return parseFloat(Math.sqrt(r/e.length*20).toFixed(1))}return parseFloat(Math.random().toFixed(1))}static dispose(t){t.pause(),t.removeAttribute("src"),g(this.audios,t)}static destroy(){for(let t=this.contexts.length-1;t>=0;t--)this.contexts[t].close();for(let t=this.audios.length-1;t>=0;t--)this.dispose(this.audios[t])}}a(w,"audios",[]),a(w,"analysers",[]),a(w,"contexts",[]),a(w,"_volume",.5);var S=(t=>(t.ALL="ALL",t.IDLE="IDLE",t.NONE="NONE",t))(S||{});class C extends e.utils.EventEmitter{constructor(t,e){super(),a(this,"tag"),a(this,"settings"),a(this,"motionGroups",{}),a(this,"state",new E),a(this,"currentAudio"),a(this,"currentAnalyzer"),a(this,"currentContext"),a(this,"playing",!1),a(this,"destroyed",!1),this.settings=t,this.tag=`MotionManager(${t.name})`,this.state.tag=this.tag}init(t){(null==t?void 0:t.idleMotionGroup)&&(this.groups.idle=t.idleMotionGroup),this.setupMotions(t),this.stopAllMotions()}setupMotions(t){for(const t of Object.keys(this.definitions))this.motionGroups[t]=[];let e;switch(null==t?void 0:t.motionPreload){case"NONE":return;case"ALL":e=Object.keys(this.definitions);break;default:e=[this.groups.idle]}for(const t of e)if(this.definitions[t])for(let e=0;e<this.definitions[t].length;e++)this.loadMotion(t,e).then()}loadMotion(t,e){return h(this,null,(function*(){var r;if(!(null==(r=this.definitions[t])?void 0:r[e]))return void u.warn(this.tag,`Undefined motion at "${t}"[${e}]`);if(null===this.motionGroups[t][e])return void u.warn(this.tag,`Cannot start motion at "${t}"[${e}] because it's already failed in loading.`);if(this.motionGroups[t][e])return this.motionGroups[t][e];const i=yield this._loadMotion(t,e);return this.destroyed?void 0:(this.motionGroups[t][e]=null!=i?i:null,i)}))}_loadMotion(t,e){throw new Error("Not implemented.")}speak(t){return h(this,arguments,(function*(t,{volume:e=.5,expression:r,resetExpression:i=!0,crossOrigin:s,onFinish:n,onError:o}={}){if(!l.sound)return!1;let a,h,c,d;if(this.currentAudio&&!this.currentAudio.ended)return!1;const f=t&&t.startsWith("data:");if(console.log(n),t&&!f){const e=document.createElement("a");e.href=t,d=t=e.href}else d="data:audio/";const p=t;if(p)try{a=w.add(p,((t=this)=>{console.log("Audio finished playing"),null==n||n(),i&&r&&t.expressionManager&&t.expressionManager.resetExpression(),t.currentAudio=void 0}),((t,e=this)=>{console.log("Error during audio playback:",t),null==o||o(t),i&&r&&e.expressionManager&&e.expressionManager.resetExpression(),e.currentAudio=void 0}),s),this.currentAudio=a,w.volume=e,c=w.addContext(this.currentAudio),this.currentContext=c,h=w.addAnalyzer(this.currentAudio,this.currentContext),this.currentAnalyzer=h}catch(t){return u.warn(this.tag,"Failed to create audio",d,t),!1}if(a){let t=!0;const e=w.play(a).catch((e=>{u.warn(this.tag,"Failed to play audio",a.src,e),t=!1}));if(l.motionSync&&(yield e,!t))return!1}return this.state.shouldOverrideExpression()&&this.expressionManager&&this.expressionManager.resetExpression(),r&&this.expressionManager&&this.expressionManager.setExpression(r),this.playing=!0,!0}))}startMotion(t,e){return h(this,arguments,(function*(t,e,r=T.NORMAL,{sound:i,volume:s=.5,expression:n,resetExpression:o=!0,crossOrigin:a,onFinish:h,onError:c}={}){var d;if(!this.state.reserve(t,e,r))return!1;if(this.currentAudio&&!this.currentAudio.ended&&r!=T.FORCE)return!1;const f=null==(d=this.definitions[t])?void 0:d[e];if(!f)return!1;let p,_,m,g;this.currentAudio&&w.dispose(this.currentAudio);const y=i&&i.startsWith("data:");if(i&&!y){const t=document.createElement("a");t.href=i,g=i=t.href}else g=this.getSoundFile(f),g&&(g=this.settings.resolveURL(g));const b=g;if(b)try{p=w.add(b,((t=this)=>{console.log("Audio finished playing"),null==h||h(),console.log(h),o&&n&&t.expressionManager&&t.expressionManager.resetExpression(),t.currentAudio=void 0}),((t,e=this)=>{console.log("Error during audio playback:",t),null==c||c(t),o&&n&&e.expressionManager&&e.expressionManager.resetExpression(),e.currentAudio=void 0}),a),this.currentAudio=p,w.volume=s,m=w.addContext(this.currentAudio),this.currentContext=m,_=w.addAnalyzer(this.currentAudio,this.currentContext),this.currentAnalyzer=_}catch(t){u.warn(this.tag,"Failed to create audio",g,t)}const v=yield this.loadMotion(t,e);if(p){const t=w.play(p).catch((t=>u.warn(this.tag,"Failed to play audio",p.src,t)));l.motionSync&&(yield t)}return this.state.start(v,t,e,r)?(this.state.shouldOverrideExpression()&&this.expressionManager&&this.expressionManager.resetExpression(),u.log(this.tag,"Start motion:",this.getMotionName(f)),this.emit("motionStart",t,e,p),n&&this.expressionManager&&this.state.shouldOverrideExpression()&&this.expressionManager.setExpression(n),this.playing=!0,this._startMotion(v),!0):(p&&(w.dispose(p),this.currentAudio=void 0),!1)}))}startRandomMotion(t,e){return h(this,arguments,(function*(t,e,{sound:r,volume:i=.5,expression:s,resetExpression:n=!0,crossOrigin:o,onFinish:a,onError:h}={}){const l=this.definitions[t];if(null==l?void 0:l.length){const u=[];for(let e=0;e<l.length;e++)null===this.motionGroups[t][e]||this.state.isActive(t,e)||u.push(e);if(u.length){const l=u[Math.floor(Math.random()*u.length)];return this.startMotion(t,l,e,{sound:r,volume:i,expression:s,resetExpression:n,crossOrigin:o,onFinish:a,onError:h})}}return!1}))}stopSpeaking(){this.currentAudio&&(w.dispose(this.currentAudio),this.currentAudio=void 0)}stopAllMotions(){this._stopAllMotions(),this.state.reset(),this.stopSpeaking()}update(t,e){var r;return this.isFinished()&&(this.playing&&(this.playing=!1,this.emit("motionFinish")),this.state.shouldOverrideExpression()&&(null==(r=this.expressionManager)||r.restoreExpression()),this.state.complete(),this.state.shouldRequestIdleMotion()&&this.startRandomMotion(this.groups.idle,T.IDLE)),this.updateParameters(t,e)}mouthSync(){return this.currentAnalyzer?w.analyze(this.currentAnalyzer):0}destroy(){var t;this.destroyed=!0,this.emit("destroy"),this.stopAllMotions(),null==(t=this.expressionManager)||t.destroy(),this.definitions=void 0,this.motionGroups=void 0}}const P={x:0,y:0,width:0,height:0};class M extends e.utils.EventEmitter{constructor(){super(...arguments),a(this,"focusController",new x),a(this,"pose"),a(this,"physics"),a(this,"originalWidth",0),a(this,"originalHeight",0),a(this,"width",0),a(this,"height",0),a(this,"localTransform",new e.Matrix),a(this,"drawingMatrix",new e.Matrix),a(this,"hitAreas",{}),a(this,"textureFlipY",!1),a(this,"viewport",[0,0,0,0]),a(this,"destroyed",!1)}init(){this.setupLayout(),this.setupHitAreas()}setupLayout(){const t=this,e=this.getSize();t.originalWidth=e[0],t.originalHeight=e[1];const r=Object.assign({width:2,height:2},this.getLayout());this.localTransform.scale(r.width/2,r.height/2),t.width=this.originalWidth*this.localTransform.a,t.height=this.originalHeight*this.localTransform.d;const i=void 0!==r.x&&r.x-r.width/2||void 0!==r.centerX&&r.centerX||void 0!==r.left&&r.left-r.width/2||void 0!==r.right&&r.right+r.width/2||0,s=void 0!==r.y&&r.y-r.height/2||void 0!==r.centerY&&r.centerY||void 0!==r.top&&r.top-r.height/2||void 0!==r.bottom&&r.bottom+r.height/2||0;this.localTransform.translate(this.width*i,-this.height*s)}setupHitAreas(){const t=this.getHitAreaDefs().filter((t=>t.index>=0));for(const e of t)this.hitAreas[e.name]=e}hitTest(t,e){return Object.keys(this.hitAreas).filter((r=>this.isHit(r,t,e)))}isHit(t,e,r){if(!this.hitAreas[t])return!1;const i=this.hitAreas[t].index,s=this.getDrawableBounds(i,P);return s.x<=e&&e<=s.x+s.width&&s.y<=r&&r<=s.y+s.height}getDrawableBounds(t,e){const r=this.getDrawableVertices(t);let i=r[0],s=r[0],n=r[1],o=r[1];for(let t=0;t<r.length;t+=2){const e=r[t],a=r[t+1];i=Math.min(e,i),s=Math.max(e,s),n=Math.min(a,n),o=Math.max(a,o)}return null!=e||(e={}),e.x=i,e.y=n,e.width=s-i,e.height=o-n,e}updateTransform(t){this.drawingMatrix.copyFrom(t).append(this.localTransform)}update(t,e){this.focusController.update(t)}destroy(){this.destroyed=!0,this.emit("destroy"),this.motionManager.destroy(),this.motionManager=void 0}}class $ extends Error{constructor(t,e,r,i=!1){super(t),this.url=e,this.status=r,this.aborted=i}}const I=class t{static createXHR(e,r,i,s,n){const o=new XMLHttpRequest;if(t.allXhrSet.add(o),e){let r=t.xhrMap.get(e);r?r.add(o):(r=new Set([o]),t.xhrMap.set(e,r)),e.listeners("destroy").includes(t.cancelXHRs)||e.once("destroy",t.cancelXHRs)}return o.open("GET",r),o.responseType=i,o.onload=()=>{200!==o.status&&0!==o.status||!o.response?o.onerror():s(o.response)},o.onerror=()=>{u.warn("XHRLoader",`Failed to load resource as ${o.responseType} (Status ${o.status}): ${r}`),n(new $("Network error.",r,o.status))},o.onabort=()=>n(new $("Aborted.",r,o.status,!0)),o.onloadend=()=>{var r;t.allXhrSet.delete(o),e&&(null==(r=t.xhrMap.get(e))||r.delete(o))},o}static cancelXHRs(){var e;null==(e=t.xhrMap.get(this))||e.forEach((e=>{e.abort(),t.allXhrSet.delete(e)})),t.xhrMap.delete(this)}static release(){t.allXhrSet.forEach((t=>t.abort())),t.allXhrSet.clear(),t.xhrMap=new WeakMap}};a(I,"xhrMap",new WeakMap),a(I,"allXhrSet",new Set),a(I,"loader",((t,e)=>new Promise(((e,r)=>{I.createXHR(t.target,t.settings?t.settings.resolveURL(t.url):t.url,t.type,(r=>{t.result=r,e()}),r).send()}))));let R=I;function D(t,e){let r=-1;return function i(s,n){if(n)return Promise.reject(n);if(s<=r)return Promise.reject(new Error("next() called multiple times"));r=s;const o=t[s];if(!o)return Promise.resolve();try{return Promise.resolve(o(e,i.bind(null,s+1)))}catch(t){return Promise.reject(t)}}(0)}class L{static load(t){return D(this.middlewares,t).then((()=>t.result))}}function F(){}a(L,"middlewares",[R.loader]);const O="Live2DFactory",k=(t,e)=>h(this,null,(function*(){if("string"==typeof t.source){const e=yield L.load({url:t.source,type:"json",target:t.live2dModel});e.url=t.source,t.source=e,t.live2dModel.emit("settingsJSONLoaded",e)}return e()})),B=(t,e)=>h(this,null,(function*(){if(t.source instanceof A)return t.settings=t.source,e();if("object"==typeof t.source){const r=j.findRuntime(t.source);if(r){const i=r.createModelSettings(t.source);return t.settings=i,t.live2dModel.emit("settingsLoaded",i),e()}}throw new TypeError("Unknown settings format.")})),N=(t,e)=>{if(t.settings){const r=j.findRuntime(t.settings);if(r)return r.ready().then(e)}return e()},U=(t,e)=>h(this,null,(function*(){yield e();const r=t.internalModel;if(r){const e=t.settings,i=j.findRuntime(e);if(i){const s=[];e.pose&&s.push(L.load({settings:e,url:e.pose,type:"json",target:r}).then((e=>{r.pose=i.createPose(r.coreModel,e),t.live2dModel.emit("poseLoaded",r.pose)})).catch((e=>{t.live2dModel.emit("poseLoadError",e),u.warn(O,"Failed to load pose.",e)}))),e.physics&&s.push(L.load({settings:e,url:e.physics,type:"json",target:r}).then((e=>{r.physics=i.createPhysics(r.coreModel,e),t.live2dModel.emit("physicsLoaded",r.physics)})).catch((e=>{t.live2dModel.emit("physicsLoadError",e),u.warn(O,"Failed to load physics.",e)}))),s.length&&(yield Promise.all(s))}}})),G=(t,r)=>h(this,null,(function*(){if(!t.settings)throw new TypeError("Missing settings.");{const i=t.live2dModel,s=Promise.all(t.settings.textures.map((r=>function(t,r={}){const i={resourceOptions:{crossorigin:r.crossOrigin}};if(e.Texture.fromURL)return e.Texture.fromURL(t,i).catch((t=>{if(t instanceof Error)throw t;const e=new Error("Texture loading error");throw e.event=t,e}));i.resourceOptions.autoLoad=!1;const s=e.Texture.from(t,i);if(s.baseTexture.valid)return Promise.resolve(s);const n=s.baseTexture.resource;return null!=n._live2d_load||(n._live2d_load=new Promise(((t,e)=>{const r=t=>{n.source.removeEventListener("error",r);const i=new Error("Texture loading error");i.event=t,e(i)};n.source.addEventListener("error",r),n.load().then((()=>t(s))).catch(r)}))),n._live2d_load}(t.settings.resolveURL(r),{crossOrigin:t.options.crossOrigin}))));if(s.catch(F),yield r(),!t.internalModel)throw new TypeError("Missing internal model.");i.internalModel=t.internalModel,i.emit("modelLoaded",t.internalModel),i.textures=yield s,i.emit("textureLoaded",i.textures)}})),V=(t,e)=>h(this,null,(function*(){const r=t.settings;if(r instanceof A){const i=j.findRuntime(r);if(!i)throw new TypeError("Unknown model settings.");const s=yield L.load({settings:r,url:r.moc,type:"arraybuffer",target:t.live2dModel});if(!i.isValidMoc(s))throw new Error("Invalid moc data");const n=i.createCoreModel(s);return t.internalModel=i.createInternalModel(n,r,t.options),e()}throw new TypeError("Missing settings.")})),H=class t{static unzip(r,i){return h(this,null,(function*(){const s=yield t.getFilePaths(r),n=[];for(const t of i.getDefinedFiles()){const r=decodeURI(e.utils.url.resolve(i.url,t));s.includes(r)&&n.push(r)}const o=yield t.getFiles(r,n);for(let t=0;t<o.length;t++){const e=n[t],r=o[t];Object.defineProperty(r,"webkitRelativePath",{value:e})}return o}))}static createSettings(e){return h(this,null,(function*(){const r=(yield t.getFilePaths(e)).find((t=>t.endsWith("model.json")||t.endsWith("model3.json")));if(!r)throw new Error("Settings file not found");const i=yield t.readText(e,r);if(!i)throw new Error("Empty settings file: "+r);const s=JSON.parse(i);s.url=r;const n=t.live2dFactory.findRuntime(s);if(!n)throw new Error("Unknown settings JSON");return n.createModelSettings(s)}))}static zipReader(t,e){return h(this,null,(function*(){throw new Error("Not implemented")}))}static getFilePaths(t){return h(this,null,(function*(){throw new Error("Not implemented")}))}static getFiles(t,e){return h(this,null,(function*(){throw new Error("Not implemented")}))}static readText(t,e){return h(this,null,(function*(){throw new Error("Not implemented")}))}static releaseReader(t){}};a(H,"live2dFactory"),a(H,"ZIP_PROTOCOL","zip://"),a(H,"uid",0),a(H,"factory",((t,e)=>h(H,null,(function*(){const r=t.source;let i,s,n;if("string"==typeof r&&(r.endsWith(".zip")||r.startsWith(H.ZIP_PROTOCOL))?(i=r.startsWith(H.ZIP_PROTOCOL)?r.slice(H.ZIP_PROTOCOL.length):r,s=yield L.load({url:i,type:"blob",target:t.live2dModel})):Array.isArray(r)&&1===r.length&&r[0]instanceof File&&r[0].name.endsWith(".zip")&&(s=r[0],i=URL.createObjectURL(s),n=r.settings),s){if(!s.size)throw new Error("Empty zip file");const e=yield H.zipReader(s,i);n||(n=yield H.createSettings(e)),n._objectURL=H.ZIP_PROTOCOL+H.uid+"/"+n.url;const r=yield H.unzip(e,n);r.settings=n,t.source=r,i.startsWith("blob:")&&t.live2dModel.once("modelLoaded",(t=>{t.once("destroy",(function(){URL.revokeObjectURL(i)}))})),H.releaseReader(e)}return e()}))));let z=H;const X=class t{static resolveURL(e,r){var i;const s=null==(i=t.filesMap[e])?void 0:i[r];if(void 0===s)throw new Error("Cannot find this file from uploaded files: "+r);return s}static upload(r,i){return h(this,null,(function*(){const s={};for(const t of i.getDefinedFiles()){const n=decodeURI(e.utils.url.resolve(i.url,t)),o=r.find((t=>t.webkitRelativePath===n));o&&(s[t]=URL.createObjectURL(o))}t.filesMap[i._objectURL]=s}))}static createSettings(e){return h(this,null,(function*(){const r=e.find((t=>t.name.endsWith("model.json")||t.name.endsWith("model3.json")));if(!r)throw new TypeError("Settings file not found");const i=yield t.readText(r),s=JSON.parse(i);s.url=r.webkitRelativePath;const n=j.findRuntime(s);if(!n)throw new Error("Unknown settings JSON");const o=n.createModelSettings(s);return o._objectURL=URL.createObjectURL(r),o}))}static readText(t){return h(this,null,(function*(){return new Promise(((e,r)=>{const i=new FileReader;i.onload=()=>e(i.result),i.onerror=r,i.readAsText(t,"utf8")}))}))}};a(X,"live2dFactory"),a(X,"filesMap",{}),a(X,"factory",((t,e)=>h(X,null,(function*(){if(Array.isArray(t.source)&&t.source[0]instanceof File){const e=t.source;let r=e.settings;if(r){if(!r._objectURL)throw new Error('"_objectURL" must be specified in ModelSettings')}else r=yield X.createSettings(e);r.validateFiles(e.map((t=>encodeURI(t.webkitRelativePath)))),yield X.upload(e,r),r.resolveURL=function(t){return X.resolveURL(this._objectURL,t)},t.source=r,t.live2dModel.once("modelLoaded",(t=>{t.once("destroy",(function(){const t=this.settings._objectURL;if(URL.revokeObjectURL(t),X.filesMap[t])for(const e of Object.values(X.filesMap[t]))URL.revokeObjectURL(e);delete X.filesMap[t]}))}))}return e()}))));let W=X;const Y=class t{static registerRuntime(e){t.runtimes.push(e),t.runtimes.sort(((t,e)=>e.version-t.version))}static findRuntime(e){for(const r of t.runtimes)if(r.test(e))return r}static setupLive2DModel(e,r,i){return h(this,null,(function*(){const s=new Promise((t=>e.once("textureLoaded",t))),n=new Promise((t=>e.once("modelLoaded",t))),o=Promise.all([s,n]).then((()=>e.emit("ready")));yield D(t.live2DModelMiddlewares,{live2dModel:e,source:r,options:i||{}}),yield o,e.emit("load")}))}static loadMotion(e,r,i){var s;const n=t=>e.emit("motionLoadError",r,i,t);try{const o=null==(s=e.definitions[r])?void 0:s[i];if(!o)return Promise.resolve(void 0);e.listeners("destroy").includes(t.releaseTasks)||e.once("destroy",t.releaseTasks);let a=t.motionTasksMap.get(e);a||(a={},t.motionTasksMap.set(e,a));let h=a[r];h||(h=[],a[r]=h);const l=e.getMotionFile(o);return null!=h[i]||(h[i]=L.load({url:l,settings:e.settings,type:e.motionDataType,target:e}).then((s=>{var n;const a=null==(n=t.motionTasksMap.get(e))?void 0:n[r];a&&delete a[i];const h=e.createMotion(s,r,o);return e.emit("motionLoaded",r,i,h),h})).catch((t=>{u.warn(e.tag,`Failed to load motion: ${l}\n`,t),n(t)}))),h[i]}catch(t){u.warn(e.tag,`Failed to load motion at "${r}"[${i}]\n`,t),n(t)}return Promise.resolve(void 0)}static loadExpression(e,r){const i=t=>e.emit("expressionLoadError",r,t);try{const s=e.definitions[r];if(!s)return Promise.resolve(void 0);e.listeners("destroy").includes(t.releaseTasks)||e.once("destroy",t.releaseTasks);let n=t.expressionTasksMap.get(e);n||(n=[],t.expressionTasksMap.set(e,n));const o=e.getExpressionFile(s);return null!=n[r]||(n[r]=L.load({url:o,settings:e.settings,type:"json",target:e}).then((i=>{const n=t.expressionTasksMap.get(e);n&&delete n[r];const o=e.createExpression(i,s);return e.emit("expressionLoaded",r,o),o})).catch((t=>{u.warn(e.tag,`Failed to load expression: ${o}\n`,t),i(t)}))),n[r]}catch(t){u.warn(e.tag,`Failed to load expression at [${r}]\n`,t),i(t)}return Promise.resolve(void 0)}static releaseTasks(){this instanceof C?t.motionTasksMap.delete(this):t.expressionTasksMap.delete(this)}};a(Y,"runtimes",[]),a(Y,"urlToJSON",k),a(Y,"jsonToSettings",B),a(Y,"waitUntilReady",N),a(Y,"setupOptionals",U),a(Y,"setupEssentials",G),a(Y,"createInternalModel",V),a(Y,"live2DModelMiddlewares",[z.factory,W.factory,k,B,N,U,G,V]),a(Y,"motionTasksMap",new WeakMap),a(Y,"expressionTasksMap",new WeakMap);let j=Y;C.prototype._loadMotion=function(t,e){return j.loadMotion(this,t,e)},y.prototype._loadExpression=function(t){return j.loadExpression(this,t)},W.live2dFactory=j,z.live2dFactory=j;const q=class t{constructor(e,{autoUpdate:r=!0,autoHitTest:i=!0,autoFocus:s=!0,autoInteract:n,ticker:o}={}){a(this,"model"),a(this,"destroyed",!1),a(this,"_ticker"),a(this,"_autoUpdate",!1),a(this,"_autoHitTest",!1),a(this,"_autoFocus",!1),o||(t.defaultTicker?o=t.defaultTicker:void 0!==PIXI&&(o=PIXI.Ticker.shared)),void 0!==n&&(i=n,s=n,u.warn(e.tag,"options.autoInteract is deprecated since v0.5.0, use autoHitTest and autoFocus instead.")),this.model=e,this.ticker=o,this.autoUpdate=r,this.autoHitTest=i,this.autoFocus=s,(i||s)&&(this.model.eventMode="static")}get ticker(){return this._ticker}set ticker(t){var e;this._ticker&&this._ticker.remove(Q,this),this._ticker=t,this._autoUpdate&&(null==(e=this._ticker)||e.add(Q,this))}get autoUpdate(){return this._autoUpdate}set autoUpdate(t){var e;this.destroyed||(t?this._ticker?(this._ticker.add(Q,this),this._autoUpdate=!0):u.warn(this.model.tag,"No Ticker to be used for automatic updates. Either set option.ticker when creating Live2DModel, or expose PIXI to global scope (window.PIXI = PIXI)."):(null==(e=this._ticker)||e.remove(Q,this),this._autoUpdate=!1))}get autoHitTest(){return this._autoHitTest}set autoHitTest(t){t!==this.autoHitTest&&(t?this.model.on("pointertap",J,this):this.model.off("pointertap",J,this),this._autoHitTest=t)}get autoFocus(){return this._autoFocus}set autoFocus(t){t!==this.autoFocus&&(t?this.model.on("globalpointermove",K,this):this.model.off("globalpointermove",K,this),this._autoFocus=t)}get autoInteract(){return this._autoHitTest&&this._autoFocus}set autoInteract(t){this.autoHitTest=t,this.autoFocus=t}onTickerUpdate(){const t=this.ticker.deltaMS;this.model.update(t)}onTap(t){this.model.tap(t.global.x,t.global.y)}onPointerMove(t){this.model.focus(t.global.x,t.global.y)}destroy(){this.autoFocus=!1,this.autoHitTest=!1,this.autoUpdate=!1,this.ticker=void 0,this.destroyed=!0}};a(q,"defaultTicker");let Z=q;function Q(){this.onTickerUpdate()}function J(t){this.onTap(t)}function K(t){this.onPointerMove(t)}class tt extends e.Transform{}const et=new e.Point,rt=new e.Matrix;class it extends r.Container{constructor(t){super(),a(this,"tag","Live2DModel(uninitialized)"),a(this,"internalModel"),a(this,"textures",[]),a(this,"transform",new tt),a(this,"anchor",new e.ObservablePoint(this.onAnchorChange,this,0,0)),a(this,"glContextID",-1),a(this,"elapsedTime",0),a(this,"deltaTime",0),a(this,"automator"),this.automator=new Z(this,t),this.once("modelLoaded",(()=>this.init(t)))}static from(t,e){const r=new this(e);return j.setupLive2DModel(r,t,e).then((()=>r))}static fromSync(t,e){const r=new this(e);return j.setupLive2DModel(r,t,e).then(null==e?void 0:e.onLoad).catch(null==e?void 0:e.onError),r}static registerTicker(t){Z.defaultTicker=t.shared}init(t){this.tag=`Live2DModel(${this.internalModel.settings.name})`}onAnchorChange(){this.pivot.set(this.anchor.x*this.internalModel.width,this.anchor.y*this.internalModel.height)}motion(t,e,r,{sound:i,volume:s=.5,expression:n,resetExpression:o=!0,crossOrigin:a,onFinish:h,onError:l}={}){return void 0===e?this.internalModel.motionManager.startRandomMotion(t,r,{sound:i,volume:s,expression:n,resetExpression:o,crossOrigin:a,onFinish:h,onError:l}):this.internalModel.motionManager.startMotion(t,e,r,{sound:i,volume:s,expression:n,resetExpression:o,crossOrigin:a,onFinish:h,onError:l})}stopMotions(){return this.internalModel.motionManager.stopAllMotions()}speak(t,{volume:e=.5,expression:r,resetExpression:i=!0,crossOrigin:s,onFinish:n,onError:o}={}){return this.internalModel.motionManager.speak(t,{volume:e,expression:r,resetExpression:i,crossOrigin:s,onFinish:n,onError:o})}stopSpeaking(){return this.internalModel.motionManager.stopSpeaking()}expression(t){return this.internalModel.motionManager.expressionManager?void 0===t?this.internalModel.motionManager.expressionManager.setRandomExpression():this.internalModel.motionManager.expressionManager.setExpression(t):Promise.resolve(!1)}focus(t,e,r=!1){et.x=t,et.y=e,this.toModelPosition(et,et,!0);const i=et.x/this.internalModel.originalWidth*2-1,s=et.y/this.internalModel.originalHeight*2-1,n=Math.atan2(s,i);this.internalModel.focusController.focus(Math.cos(n),-Math.sin(n),r)}tap(t,e){const r=this.hitTest(t,e);r.length&&(u.log(this.tag,"Hit",r),this.emit("hit",r))}hitTest(t,e){return et.x=t,et.y=e,this.toModelPosition(et,et),this.internalModel.hitTest(et.x,et.y)}toModelPosition(t,e=t.clone(),r){return r||(this._recursivePostUpdateTransform(),this.parent?this.displayObjectUpdateTransform():(this.parent=this._tempDisplayObjectParent,this.displayObjectUpdateTransform(),this.parent=null)),this.transform.worldTransform.applyInverse(t,e),this.internalModel.localTransform.applyInverse(e,e),e}containsPoint(t){return this.getBounds(!0).contains(t.x,t.y)}_calculateBounds(){this._bounds.addFrame(this.transform,0,0,this.internalModel.width,this.internalModel.height)}update(t){this.deltaTime+=t,this.elapsedTime+=t}_render(t){t.batch.reset(),t.geometry.reset(),t.shader.reset(),t.state.reset();let e=!1;this.glContextID!==t.CONTEXT_UID&&(this.glContextID=t.CONTEXT_UID,this.internalModel.updateWebGLContext(t.gl,this.glContextID),e=!0);for(let r=0;r<this.textures.length;r++){const i=this.textures[r];i.valid&&(!e&&i.baseTexture._glTextures[this.glContextID]||(t.gl.pixelStorei(WebGLRenderingContext.UNPACK_FLIP_Y_WEBGL,this.internalModel.textureFlipY),t.texture.bind(i.baseTexture,0)),this.internalModel.bindTexture(r,i.baseTexture._glTextures[this.glContextID].texture),i.baseTexture.touched=t.textureGC.count)}const r=t.framebuffer.viewport;this.internalModel.viewport=[r.x,r.y,r.width,r.height],this.deltaTime&&(this.internalModel.update(this.deltaTime,this.elapsedTime),this.deltaTime=0);const i=rt.copyFrom(t.globalUniforms.uniforms.projectionMatrix).append(this.worldTransform);this.internalModel.updateTransform(i),this.internalModel.draw(t.gl),t.state.reset(),t.texture.reset()}destroy(t){this.emit("destroy"),(null==t?void 0:t.texture)&&this.textures.forEach((e=>e.destroy(t.baseTexture))),this.automator.destroy(),this.internalModel.destroy(),super.destroy(t)}}if(!window.Live2D)throw new Error("Could not find Cubism 2 runtime. This plugin requires live2d.min.js to be loaded.");const st=Live2DMotion.prototype.updateParam;Live2DMotion.prototype.updateParam=function(t,e){st.call(this,t,e),e.isFinished()&&this.onFinishHandler&&(this.onFinishHandler(this),delete this.onFinishHandler)};class nt extends AMotion{constructor(t){super(),a(this,"params",[]),this.setFadeIn(t.fade_in>0?t.fade_in:l.expressionFadingDuration),this.setFadeOut(t.fade_out>0?t.fade_out:l.expressionFadingDuration),Array.isArray(t.params)&&t.params.forEach((t=>{const e=t.calc||"add";if("add"===e){const e=t.def||0;t.val-=e}else if("mult"===e){const e=t.def||1;t.val/=e}this.params.push({calc:e,val:t.val,id:t.id})}))}updateParamExe(t,e,r,i){this.params.forEach((e=>{t.setParamFloat(e.id,e.val*r)}))}}class ot extends y{constructor(t,e){var r;super(t,e),a(this,"queueManager",new MotionQueueManager),a(this,"definitions"),this.definitions=null!=(r=this.settings.expressions)?r:[],this.init()}isFinished(){return this.queueManager.isFinished()}getExpressionIndex(t){return this.definitions.findIndex((e=>e.name===t))}getExpressionFile(t){return t.file}createExpression(t,e){return new nt(t)}_setExpression(t){return this.queueManager.startMotion(t)}stopAllExpressions(){this.queueManager.stopAllMotions()}updateParameters(t,e){return this.queueManager.updateParam(t)}}class at extends C{constructor(t,e){super(t,e),a(this,"definitions"),a(this,"groups",{idle:"idle"}),a(this,"motionDataType","arraybuffer"),a(this,"queueManager",new MotionQueueManager),a(this,"lipSyncIds"),a(this,"expressionManager"),this.definitions=this.settings.motions,this.init(e),this.lipSyncIds=["PARAM_MOUTH_OPEN_Y"]}init(t){super.init(t),this.settings.expressions&&(this.expressionManager=new ot(this.settings,t))}isFinished(){return this.queueManager.isFinished()}createMotion(t,e,r){const i=Live2DMotion.loadMotion(t),s=e===this.groups.idle?l.idleMotionFadingDuration:l.motionFadingDuration;return i.setFadeIn(r.fade_in>0?r.fade_in:s),i.setFadeOut(r.fade_out>0?r.fade_out:s),i}getMotionFile(t){return t.file}getMotionName(t){return t.file}getSoundFile(t){return t.sound}_startMotion(t,e){return t.onFinishHandler=e,this.queueManager.stopAllMotions(),this.queueManager.startMotion(t)}_stopAllMotions(){this.queueManager.stopAllMotions()}updateParameters(t,e){return this.queueManager.updateParam(t)}destroy(){super.destroy(),this.queueManager=void 0}}class ht{constructor(t){a(this,"leftParam"),a(this,"rightParam"),a(this,"blinkInterval",4e3),a(this,"closingDuration",100),a(this,"closedDuration",50),a(this,"openingDuration",150),a(this,"eyeState",0),a(this,"eyeParamValue",1),a(this,"closedTimer",0),a(this,"nextBlinkTimeLeft",this.blinkInterval),this.coreModel=t,this.leftParam=t.getParamIndex("PARAM_EYE_L_OPEN"),this.rightParam=t.getParamIndex("PARAM_EYE_R_OPEN")}setEyeParams(t){this.eyeParamValue=c(t,0,1),this.coreModel.setParamFloat(this.leftParam,this.eyeParamValue),this.coreModel.setParamFloat(this.rightParam,this.eyeParamValue)}update(t){switch(this.eyeState){case 0:this.nextBlinkTimeLeft-=t,this.nextBlinkTimeLeft<0&&(this.eyeState=1,this.nextBlinkTimeLeft=this.blinkInterval+this.closingDuration+this.closedDuration+this.openingDuration+d(0,2e3));break;case 1:this.setEyeParams(this.eyeParamValue+t/this.closingDuration),this.eyeParamValue<=0&&(this.eyeState=2,this.closedTimer=0);break;case 2:this.closedTimer+=t,this.closedTimer>=this.closedDuration&&(this.eyeState=3);break;case 3:this.setEyeParams(this.eyeParamValue+t/this.openingDuration),this.eyeParamValue>=1&&(this.eyeState=0)}}}const lt=new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]);class ut extends M{constructor(t,e,r){super(),a(this,"settings"),a(this,"coreModel"),a(this,"motionManager"),a(this,"eyeBlink"),a(this,"eyeballXParamIndex"),a(this,"eyeballYParamIndex"),a(this,"angleXParamIndex"),a(this,"angleYParamIndex"),a(this,"angleZParamIndex"),a(this,"bodyAngleXParamIndex"),a(this,"breathParamIndex"),a(this,"textureFlipY",!0),a(this,"lipSync",!0),a(this,"drawDataCount",0),a(this,"disableCulling",!1),a(this,"hasDrawn",!1),this.coreModel=t,this.settings=e,this.motionManager=new at(e,r),this.eyeBlink=new ht(t),this.eyeballXParamIndex=t.getParamIndex("PARAM_EYE_BALL_X"),this.eyeballYParamIndex=t.getParamIndex("PARAM_EYE_BALL_Y"),this.angleXParamIndex=t.getParamIndex("PARAM_ANGLE_X"),this.angleYParamIndex=t.getParamIndex("PARAM_ANGLE_Y"),this.angleZParamIndex=t.getParamIndex("PARAM_ANGLE_Z"),this.bodyAngleXParamIndex=t.getParamIndex("PARAM_BODY_ANGLE_X"),this.breathParamIndex=t.getParamIndex("PARAM_BREATH"),this.init()}init(){super.init(),this.settings.initParams&&this.settings.initParams.forEach((({id:t,value:e})=>this.coreModel.setParamFloat(t,e))),this.settings.initOpacities&&this.settings.initOpacities.forEach((({id:t,value:e})=>this.coreModel.setPartsOpacity(t,e))),this.coreModel.saveParam();const t=this.coreModel.getModelContext()._$aS;(null==t?void 0:t.length)&&(this.drawDataCount=t.length);let e=this.coreModel.drawParamWebGL.culling;Object.defineProperty(this.coreModel.drawParamWebGL,"culling",{set:t=>e=t,get:()=>!this.disableCulling&&e});const r=this.coreModel.getModelContext().clipManager,i=r.setupClip;r.setupClip=(t,e)=>{i.call(r,t,e),e.gl.viewport(...this.viewport)}}getSize(){return[this.coreModel.getCanvasWidth(),this.coreModel.getCanvasHeight()]}getLayout(){const t={};if(this.settings.layout)for(const[e,r]of Object.entries(this.settings.layout)){let i=e;"center_x"===e?i="centerX":"center_y"===e&&(i="centerY"),t[i]=r}return t}updateWebGLContext(t,e){const r=this.coreModel.drawParamWebGL;r.firstDraw=!0,r.setGL(t),r.glno=e;for(const[t,e]of Object.entries(r))e instanceof WebGLBuffer&&(r[t]=null);const i=this.coreModel.getModelContext().clipManager;i.curFrameNo=e;const s=t.getParameter(t.FRAMEBUFFER_BINDING);i.getMaskRenderTexture(),t.bindFramebuffer(t.FRAMEBUFFER,s)}bindTexture(t,e){this.coreModel.setTexture(t,e)}getHitAreaDefs(){var t;return(null==(t=this.settings.hitAreas)?void 0:t.map((t=>({id:t.id,name:t.name,index:this.coreModel.getDrawDataIndex(t.id)}))))||[]}getDrawableIDs(){const t=this.coreModel.getModelContext(),e=[];for(let r=0;r<this.drawDataCount;r++){const i=t.getDrawData(r);i&&e.push(i.getDrawDataID().id)}return e}getDrawableIndex(t){return this.coreModel.getDrawDataIndex(t)}getDrawableVertices(t){if("string"==typeof t&&-1===(t=this.coreModel.getDrawDataIndex(t)))throw new TypeError("Unable to find drawable ID: "+t);return this.coreModel.getTransformedPoints(t).slice()}hitTest(t,e){return this.hasDrawn||u.warn("Trying to hit-test a Cubism 2 model that has not been rendered yet. The result will always be empty since the draw data is not ready."),super.hitTest(t,e)}update(t,e){var r,i,s,n;super.update(t,e);const o=this.coreModel;this.emit("beforeMotionUpdate");const a=this.motionManager.update(this.coreModel,e);if(this.emit("afterMotionUpdate"),o.saveParam(),null==(r=this.motionManager.expressionManager)||r.update(o,e),a||null==(i=this.eyeBlink)||i.update(t),this.updateFocus(),this.updateNaturalMovements(t,e),this.lipSync&&this.motionManager.currentAudio){let t=this.motionManager.mouthSync(),e=0;const r=1,i=1.2,s=.7;t>0&&(e=.4),t=Math.pow(t,s),t=c(t*i,e,r);for(let e=0;e<this.motionManager.lipSyncIds.length;++e)this.coreModel.setParamFloat(this.coreModel.getParamIndex(this.motionManager.lipSyncIds[e]),t)}null==(s=this.physics)||s.update(e),null==(n=this.pose)||n.update(t),this.emit("beforeModelUpdate"),o.update(),o.loadParam()}updateFocus(){this.coreModel.addToParamFloat(this.eyeballXParamIndex,this.focusController.x),this.coreModel.addToParamFloat(this.eyeballYParamIndex,this.focusController.y),this.coreModel.addToParamFloat(this.angleXParamIndex,30*this.focusController.x),this.coreModel.addToParamFloat(this.angleYParamIndex,30*this.focusController.y),this.coreModel.addToParamFloat(this.angleZParamIndex,this.focusController.x*this.focusController.y*-30),this.coreModel.addToParamFloat(this.bodyAngleXParamIndex,10*this.focusController.x)}updateNaturalMovements(t,e){const r=e/1e3*2*Math.PI;this.coreModel.addToParamFloat(this.angleXParamIndex,15*Math.sin(r/6.5345)*.5),this.coreModel.addToParamFloat(this.angleYParamIndex,8*Math.sin(r/3.5345)*.5),this.coreModel.addToParamFloat(this.angleZParamIndex,10*Math.sin(r/5.5345)*.5),this.coreModel.addToParamFloat(this.bodyAngleXParamIndex,4*Math.sin(r/15.5345)*.5),this.coreModel.setParamFloat(this.breathParamIndex,.5+.5*Math.sin(r/3.2345))}draw(t){const e=this.disableCulling;t.getParameter(t.FRAMEBUFFER_BINDING)&&(this.disableCulling=!0);const r=this.drawingMatrix;lt[0]=r.a,lt[1]=r.b,lt[4]=r.c,lt[5]=r.d,lt[12]=r.tx,lt[13]=r.ty,this.coreModel.setMatrix(lt),this.coreModel.draw(),this.hasDrawn=!0,this.disableCulling=e}destroy(){super.destroy(),this.coreModel=void 0}}class ct extends A{constructor(t){if(super(t),a(this,"moc"),a(this,"textures"),a(this,"layout"),a(this,"hitAreas"),a(this,"initParams"),a(this,"initOpacities"),a(this,"expressions"),a(this,"motions",{}),!ct.isValidJSON(t))throw new TypeError("Invalid JSON.");this.moc=t.model,p("string",t,this,"textures","textures"),this.copy(t)}static isValidJSON(t){var e;return!!t&&"string"==typeof t.model&&(null==(e=t.textures)?void 0:e.length)>0&&t.textures.every((t=>"string"==typeof t))}copy(t){f("string",t,this,"name","name"),f("string",t,this,"pose","pose"),f("string",t,this,"physics","physics"),f("object",t,this,"layout","layout"),f("object",t,this,"motions","motions"),p("object",t,this,"hit_areas","hitAreas"),p("object",t,this,"expressions","expressions"),p("object",t,this,"init_params","initParams"),p("object",t,this,"init_opacities","initOpacities")}replaceFiles(t){super.replaceFiles(t);for(const[e,r]of Object.entries(this.motions))for(let i=0;i<r.length;i++)r[i].file=t(r[i].file,`motions.${e}[${i}].file`),void 0!==r[i].sound&&(r[i].sound=t(r[i].sound,`motions.${e}[${i}].sound`));if(this.expressions)for(let e=0;e<this.expressions.length;e++)this.expressions[e].file=t(this.expressions[e].file,`expressions[${e}].file`)}}const dt={x:PhysicsHair.Src.SRC_TO_X,y:PhysicsHair.Src.SRC_TO_Y,angle:PhysicsHair.Src.SRC_TO_G_ANGLE},ft={x:PhysicsHair.Src.SRC_TO_X,y:PhysicsHair.Src.SRC_TO_Y,angle:PhysicsHair.Src.SRC_TO_G_ANGLE};class pt{constructor(t,e){a(this,"physicsHairs",[]),this.coreModel=t,e.physics_hair&&(this.physicsHairs=e.physics_hair.map((t=>{const e=new PhysicsHair;return e.setup(t.setup.length,t.setup.regist,t.setup.mass),t.src.forEach((({id:t,ptype:r,scale:i,weight:s})=>{const n=dt[r];n&&e.addSrcParam(n,t,i,s)})),t.targets.forEach((({id:t,ptype:r,scale:i,weight:s})=>{const n=ft[r];n&&e.addTargetParam(n,t,i,s)})),e})))}update(t){this.physicsHairs.forEach((e=>e.update(this.coreModel,t)))}}class _t{constructor(t){a(this,"paramIndex",-1),a(this,"partsIndex",-1),a(this,"link",[]),this.id=t}initIndex(t){this.paramIndex=t.getParamIndex("VISIBLE:"+this.id),this.partsIndex=t.getPartsDataIndex(PartsDataID.getID(this.id)),t.setParamFloat(this.paramIndex,1)}}class mt{constructor(t,e){a(this,"opacityAnimDuration",500),a(this,"partsGroups",[]),this.coreModel=t,e.parts_visible&&(this.partsGroups=e.parts_visible.map((({group:t})=>t.map((({id:t,link:e})=>{const r=new _t(t);return e&&(r.link=e.map((t=>new _t(t)))),r})))),this.init())}init(){this.partsGroups.forEach((t=>{t.forEach((t=>{if(t.initIndex(this.coreModel),t.paramIndex>=0){const e=0!==this.coreModel.getParamFloat(t.paramIndex);this.coreModel.setPartsOpacity(t.partsIndex,e?1:0),this.coreModel.setParamFloat(t.paramIndex,e?1:0),t.link.length>0&&t.link.forEach((t=>t.initIndex(this.coreModel)))}}))}))}normalizePartsOpacityGroup(t,e){const r=this.coreModel;let i=1,s=t.findIndex((({paramIndex:t,partsIndex:e})=>e>=0&&0!==r.getParamFloat(t)));if(s>=0){const n=r.getPartsOpacity(t[s].partsIndex);i=c(n+e/this.opacityAnimDuration,0,1)}else s=0,i=1;t.forEach((({partsIndex:t},e)=>{if(t>=0)if(s==e)r.setPartsOpacity(t,i);else{let e,s=r.getPartsOpacity(t);e=i<.5?-.5*i/.5+1:.5*(1-i)/.5,(1-e)*(1-i)>.15&&(e=1-.15/(1-i)),s>e&&(s=e),r.setPartsOpacity(t,s)}}))}copyOpacity(t){const e=this.coreModel;t.forEach((({partsIndex:t,link:r})=>{if(t>=0&&r){const i=e.getPartsOpacity(t);r.forEach((({partsIndex:t})=>{t>=0&&e.setPartsOpacity(t,i)}))}}))}update(t){this.partsGroups.forEach((e=>{this.normalizePartsOpacityGroup(e,t),this.copyOpacity(e)}))}}if(j.registerRuntime({version:2,test:t=>t instanceof ct||ct.isValidJSON(t),ready:()=>Promise.resolve(),isValidMoc(t){if(t.byteLength<3)return!1;const e=new Int8Array(t,0,3);return"moc"===String.fromCharCode(...e)},createModelSettings:t=>new ct(t),createCoreModel(t){const e=Live2DModelWebGL.loadModel(t),r=Live2D.getError();if(r)throw r;return e},createInternalModel:(t,e,r)=>new ut(t,e,r),createPose:(t,e)=>new mt(t,e),createPhysics:(t,e)=>new pt(t,e)}),!window.Live2DCubismCore)throw new Error("Could not find Cubism 4 runtime. This plugin requires live2dcubismcore.js to be loaded.");class gt{constructor(t,e){this.x=t||0,this.y=e||0}add(t){const e=new gt(0,0);return e.x=this.x+t.x,e.y=this.y+t.y,e}substract(t){const e=new gt(0,0);return e.x=this.x-t.x,e.y=this.y-t.y,e}multiply(t){const e=new gt(0,0);return e.x=this.x*t.x,e.y=this.y*t.y,e}multiplyByScaler(t){return this.multiply(new gt(t,t))}division(t){const e=new gt(0,0);return e.x=this.x/t.x,e.y=this.y/t.y,e}divisionByScalar(t){return this.division(new gt(t,t))}getLength(){return Math.sqrt(this.x*this.x+this.y*this.y)}getDistanceWith(t){return Math.sqrt((this.x-t.x)*(this.x-t.x)+(this.y-t.y)*(this.y-t.y))}dot(t){return this.x*t.x+this.y*t.y}normalize(){const t=Math.pow(this.x*this.x+this.y*this.y,.5);this.x=this.x/t,this.y=this.y/t}isEqual(t){return this.x==t.x&&this.y==t.y}isNotEqual(t){return!this.isEqual(t)}}const yt=class t{static range(t,e,r){return t<e?t=e:t>r&&(t=r),t}static sin(t){return Math.sin(t)}static cos(t){return Math.cos(t)}static abs(t){return Math.abs(t)}static sqrt(t){return Math.sqrt(t)}static cbrt(t){if(0===t)return t;let e=t;const r=e<0;let i;return r&&(e=-e),e===1/0?i=1/0:(i=Math.exp(Math.log(e)/3),i=(e/(i*i)+2*i)/3),r?-i:i}static getEasingSine(t){return t<0?0:t>1?1:.5-.5*this.cos(t*Math.PI)}static max(t,e){return t>e?t:e}static min(t,e){return t>e?e:t}static degreesToRadian(t){return t/180*Math.PI}static radianToDegrees(t){return 180*t/Math.PI}static directionToRadian(t,e){let r=Math.atan2(e.y,e.x)-Math.atan2(t.y,t.x);for(;r<-Math.PI;)r+=2*Math.PI;for(;r>Math.PI;)r-=2*Math.PI;return r}static directionToDegrees(t,e){const r=this.directionToRadian(t,e);let i=this.radianToDegrees(r);return e.x-t.x>0&&(i=-i),i}static radianToDirection(t){const e=new gt;return e.x=this.sin(t),e.y=this.cos(t),e}static quadraticEquation(e,r,i){return this.abs(e)<t.Epsilon?this.abs(r)<t.Epsilon?-i:-i/r:-(r+this.sqrt(r*r-4*e*i))/(2*e)}static cardanoAlgorithmForBezier(e,r,i,s){if(this.sqrt(e)<t.Epsilon)return this.range(this.quadraticEquation(r,i,s),0,1);const n=r/e,o=i/e,a=(3*o-n*n)/3,h=a/3,l=(2*n*n*n-9*n*o+s/e*27)/27,u=l/2,c=u*u+h*h*h,d=.51;if(c<0){const t=-a/3,e=t*t*t,r=this.sqrt(e),i=-l/(2*r),s=this.range(i,-1,1),o=Math.acos(s),h=2*this.cbrt(r),u=h*this.cos(o/3)-n/3;if(this.abs(u-.5)<d)return this.range(u,0,1);const c=h*this.cos((o+2*Math.PI)/3)-n/3;if(this.abs(c-.5)<d)return this.range(c,0,1);const f=h*this.cos((o+4*Math.PI)/3)-n/3;return this.range(f,0,1)}if(0==c){let t;t=u<0?this.cbrt(-u):-this.cbrt(u);const e=2*t-n/3;if(this.abs(e-.5)<d)return this.range(e,0,1);const r=-t-n/3;return this.range(r,0,1)}const f=this.sqrt(c),p=this.cbrt(f-u)-this.cbrt(f+u)-n/3;return this.range(p,0,1)}constructor(){}};yt.Epsilon=1e-5;let bt=yt;class vt{constructor(){this._tr=new Float32Array(16),this.loadIdentity()}static multiply(t,e,r){const i=new Float32Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]);for(let r=0;r<4;++r)for(let s=0;s<4;++s)for(let n=0;n<4;++n)i[s+4*r]+=t[n+4*r]*e[s+4*n];for(let t=0;t<16;++t)r[t]=i[t]}loadIdentity(){const t=new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]);this.setMatrix(t)}setMatrix(t){for(let e=0;e<16;++e)this._tr[e]=t[e]}getArray(){return this._tr}getScaleX(){return this._tr[0]}getScaleY(){return this._tr[5]}getTranslateX(){return this._tr[12]}getTranslateY(){return this._tr[13]}transformX(t){return this._tr[0]*t+this._tr[12]}transformY(t){return this._tr[5]*t+this._tr[13]}invertTransformX(t){return(t-this._tr[12])/this._tr[0]}invertTransformY(t){return(t-this._tr[13])/this._tr[5]}translateRelative(t,e){const r=new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,t,e,0,1]);vt.multiply(r,this._tr,this._tr)}translate(t,e){this._tr[12]=t,this._tr[13]=e}translateX(t){this._tr[12]=t}translateY(t){this._tr[13]=t}scaleRelative(t,e){const r=new Float32Array([t,0,0,0,0,e,0,0,0,0,1,0,0,0,0,1]);vt.multiply(r,this._tr,this._tr)}scale(t,e){this._tr[0]=t,this._tr[5]=e}multiplyByMatrix(t){vt.multiply(t.getArray(),this._tr,this._tr)}clone(){const t=new vt;for(let e=0;e<this._tr.length;e++)t._tr[e]=this._tr[e];return t}}class xt{initialize(t){this._model=t}drawModel(){null!=this.getModel()&&(this.saveProfile(),this.doDrawModel(),this.restoreProfile())}setMvpMatrix(t){this._mvpMatrix4x4.setMatrix(t.getArray())}getMvpMatrix(){return this._mvpMatrix4x4}setModelColor(t,e,r,i){t<0?t=0:t>1&&(t=1),e<0?e=0:e>1&&(e=1),r<0?r=0:r>1&&(r=1),i<0?i=0:i>1&&(i=1),this._modelColor.R=t,this._modelColor.G=e,this._modelColor.B=r,this._modelColor.A=i}getModelColor(){return Object.assign({},this._modelColor)}setIsPremultipliedAlpha(t){this._isPremultipliedAlpha=t}isPremultipliedAlpha(){return this._isPremultipliedAlpha}setIsCulling(t){this._isCulling=t}isCulling(){return this._isCulling}setAnisotropy(t){this._anisotropy=t}getAnisotropy(){return this._anisotropy}getModel(){return this._model}useHighPrecisionMask(t){this._useHighPrecisionMask=t}isUsingHighPrecisionMask(){return this._useHighPrecisionMask}constructor(){this._isCulling=!1,this._isPremultipliedAlpha=!1,this._anisotropy=0,this._modelColor=new Tt,this._useHighPrecisionMask=!1,this._mvpMatrix4x4=new vt,this._mvpMatrix4x4.loadIdentity()}}var At=(t=>(t[t.CubismBlendMode_Normal=0]="CubismBlendMode_Normal",t[t.CubismBlendMode_Additive=1]="CubismBlendMode_Additive",t[t.CubismBlendMode_Multiplicative=2]="CubismBlendMode_Multiplicative",t))(At||{});class Tt{constructor(t=1,e=1,r=1,i=1){this.R=t,this.G=e,this.B=r,this.A=i}}let Et,wt=!1,St=!1;class Ct{static startUp(t){if(wt)return It("CubismFramework.startUp() is already done."),wt;if(Live2DCubismCore._isStarted)return wt=!0,!0;if(Live2DCubismCore._isStarted=!0,Et=t,Et&&Live2DCubismCore.Logging.csmSetLogFunction(Et.logFunction),wt=!0,wt){const t=Live2DCubismCore.Version.csmGetVersion(),e=(16711680&t)>>16,r=65535&t,i=t;It("Live2D Cubism Core version: {0}.{1}.{2} ({3})",("00"+((4278190080&t)>>24)).slice(-2),("00"+e).slice(-2),("0000"+r).slice(-4),i)}return It("CubismFramework.startUp() is complete."),wt}static cleanUp(){wt=!1,St=!1,Et=void 0}static initialize(t=0){wt?St?Rt("CubismFramework.initialize() skipped, already initialized."):(Live2DCubismCore.Memory.initializeAmountOfMemory(t),St=!0,It("CubismFramework.initialize() is complete.")):Rt("CubismFramework is not started.")}static dispose(){wt?St?(xt.staticRelease(),St=!1,It("CubismFramework.dispose() is complete.")):Rt("CubismFramework.dispose() skipped, not initialized."):Rt("CubismFramework is not started.")}static isStarted(){return wt}static isInitialized(){return St}static coreLogFunction(t){Live2DCubismCore.Logging.csmGetLogFunction()&&Live2DCubismCore.Logging.csmGetLogFunction()(t)}static getLoggingLevel(){return null!=Et?Et.loggingLevel:5}constructor(){}}var Pt=(t=>(t[t.LogLevel_Verbose=0]="LogLevel_Verbose",t[t.LogLevel_Debug=1]="LogLevel_Debug",t[t.LogLevel_Info=2]="LogLevel_Info",t[t.LogLevel_Warning=3]="LogLevel_Warning",t[t.LogLevel_Error=4]="LogLevel_Error",t[t.LogLevel_Off=5]="LogLevel_Off",t))(Pt||{});const Mt="undefined"!=typeof process&&"production"===process.env.NODE_ENV?()=>{}:t=>console.assert(t);function $t(t,...e){Lt.print(Pt.LogLevel_Debug,"[CSM][D]"+t+"\n",e)}function It(t,...e){Lt.print(Pt.LogLevel_Info,"[CSM][I]"+t+"\n",e)}function Rt(t,...e){Lt.print(Pt.LogLevel_Warning,"[CSM][W]"+t+"\n",e)}function Dt(t,...e){Lt.print(Pt.LogLevel_Error,"[CSM][E]"+t+"\n",e)}class Lt{static print(t,e,r){if(t<Ct.getLoggingLevel())return;const i=Ct.coreLogFunction;i&&i(e.replace(/{(\d+)}/g,((t,e)=>r[e])))}static dumpBytes(t,e,r){for(let i=0;i<r;i++)i%16==0&&i>0?this.print(t,"\n"):i%8==0&&i>0&&this.print(t,"  "),this.print(t,"{0} ",[255&e[i]]);this.print(t,"\n")}constructor(){}}class Ft{constructor(){this._fadeInSeconds=-1,this._fadeOutSeconds=-1,this._weight=1,this._offsetSeconds=0,this._firedEventValues=[]}release(){this._weight=0}updateParameters(t,e,r){if(!e.isAvailable()||e.isFinished())return;if(!e.isStarted()){e.setIsStarted(!0),e.setStartTime(r-this._offsetSeconds),e.setFadeInStartTime(r);const t=this.getDuration();e.getEndTime()<0&&e.setEndTime(t<=0?-1:e.getStartTime()+t)}let i=this._weight;i=i*(0==this._fadeInSeconds?1:bt.getEasingSine((r-e.getFadeInStartTime())/this._fadeInSeconds))*(0==this._fadeOutSeconds||e.getEndTime()<0?1:bt.getEasingSine((e.getEndTime()-r)/this._fadeOutSeconds)),e.setState(r,i),Mt(0<=i&&i<=1),this.doUpdateParameters(t,r,i,e),e.getEndTime()>0&&e.getEndTime()<r&&e.setIsFinished(!0)}setFadeInTime(t){this._fadeInSeconds=t}setFadeOutTime(t){this._fadeOutSeconds=t}getFadeOutTime(){return this._fadeOutSeconds}getFadeInTime(){return this._fadeInSeconds}setWeight(t){this._weight=t}getWeight(){return this._weight}getDuration(){return-1}getLoopDuration(){return-1}setOffsetTime(t){this._offsetSeconds=t}getFiredEvent(t,e){return this._firedEventValues}setFinishedMotionHandler(t){this._onFinishedMotion=t}getFinishedMotionHandler(){return this._onFinishedMotion}isExistModelOpacity(){return!1}getModelOpacityIndex(){return-1}getModelOpacityId(t){}getModelOpacityValue(){return 1}}class Ot extends Ft{static create(t){const e=new Ot;return e.parse(t),e}doUpdateParameters(t,e,r,i){for(let e=0;e<this._parameters.length;++e){const i=this._parameters[e];switch(i.blendType){case 0:t.addParameterValueById(i.parameterId,i.value,r);break;case 1:t.multiplyParameterValueById(i.parameterId,i.value,r);break;case 2:t.setParameterValueById(i.parameterId,i.value,r)}}}parse(t){this.setFadeInTime(null!=t.FadeInTime?t.FadeInTime:1),this.setFadeOutTime(null!=t.FadeOutTime?t.FadeOutTime:1);const e=(t.Parameters||[]).length;for(let r=0;r<e;++r){const e=t.Parameters[r],i=e.Id,s=e.Value;let n;n=e.Blend&&"Add"!==e.Blend?"Multiply"===e.Blend?1:"Overwrite"===e.Blend?2:0:0;const o={parameterId:i,blendType:n,value:s};this._parameters.push(o)}}constructor(){super(),this._parameters=[]}}class kt{constructor(){this._autoDelete=!1,this._available=!0,this._finished=!1,this._started=!1,this._startTimeSeconds=-1,this._fadeInStartTimeSeconds=0,this._endTimeSeconds=-1,this._stateTimeSeconds=0,this._stateWeight=0,this._lastEventCheckSeconds=0,this._motionQueueEntryHandle=this,this._fadeOutSeconds=0,this._isTriggeredFadeOut=!1}release(){this._autoDelete&&this._motion&&this._motion.release()}setFadeOut(t){this._fadeOutSeconds=t,this._isTriggeredFadeOut=!0}startFadeOut(t,e){const r=e+t;this._isTriggeredFadeOut=!0,(this._endTimeSeconds<0||r<this._endTimeSeconds)&&(this._endTimeSeconds=r)}isFinished(){return this._finished}isStarted(){return this._started}getStartTime(){return this._startTimeSeconds}getFadeInStartTime(){return this._fadeInStartTimeSeconds}getEndTime(){return this._endTimeSeconds}setStartTime(t){this._startTimeSeconds=t}setFadeInStartTime(t){this._fadeInStartTimeSeconds=t}setEndTime(t){this._endTimeSeconds=t}setIsFinished(t){this._finished=t}setIsStarted(t){this._started=t}isAvailable(){return this._available}setIsAvailable(t){this._available=t}setState(t,e){this._stateTimeSeconds=t,this._stateWeight=e}getStateTime(){return this._stateTimeSeconds}getStateWeight(){return this._stateWeight}getLastCheckEventSeconds(){return this._lastEventCheckSeconds}setLastCheckEventSeconds(t){this._lastEventCheckSeconds=t}isTriggeredFadeOut(){return this._isTriggeredFadeOut}getFadeOutSeconds(){return this._fadeOutSeconds}}class Bt{constructor(){this._userTimeSeconds=0,this._eventCustomData=null,this._motions=[]}release(){for(let t=0;t<this._motions.length;++t)this._motions[t]&&this._motions[t].release();this._motions=void 0}startMotion(t,e,r){if(null==t)return Nt;let i;for(let t=0;t<this._motions.length;++t)i=this._motions[t],null!=i&&i.setFadeOut(i._motion.getFadeOutTime());return i=new kt,i._autoDelete=e,i._motion=t,this._motions.push(i),i._motionQueueEntryHandle}isFinished(){let t=0;for(;t<this._motions.length;){const e=this._motions[t];if(null!=e)if(null!=e._motion){if(!e.isFinished())return!1;t++}else e.release(),this._motions.splice(t,1);else this._motions.splice(t,1)}return!0}isFinishedByHandle(t){for(let e=0;e<this._motions.length;e++){const r=this._motions[e];if(null!=r&&r._motionQueueEntryHandle==t&&!r.isFinished())return!1}return!0}stopAllMotions(){for(let t=0;t<this._motions.length;t++){const e=this._motions[t];null!=e&&e.release()}this._motions=[]}getCubismMotionQueueEntry(t){return this._motions.find((e=>null!=e&&e._motionQueueEntryHandle==t))}setEventCallback(t,e=null){this._eventCallBack=t,this._eventCustomData=e}doUpdateMotion(t,e){let r=!1,i=0;for(;i<this._motions.length;){const s=this._motions[i];if(null==s){this._motions.splice(i,1);continue}const n=s._motion;if(null==n){s.release(),this._motions.splice(i,1);continue}n.updateParameters(t,s,e),r=!0;const o=n.getFiredEvent(s.getLastCheckEventSeconds()-s.getStartTime(),e-s.getStartTime());for(let t=0;t<o.length;++t)this._eventCallBack(this,o[t],this._eventCustomData);s.setLastCheckEventSeconds(e),s.isFinished()?(s.release(),this._motions.splice(i,1)):(s.isTriggeredFadeOut()&&s.startFadeOut(s.getFadeOutSeconds(),e),i++)}return r}}const Nt=-1;class Ut extends y{constructor(t,e){var r;super(t,e),a(this,"queueManager",new Bt),a(this,"definitions"),this.definitions=null!=(r=t.expressions)?r:[],this.init()}isFinished(){return this.queueManager.isFinished()}getExpressionIndex(t){return this.definitions.findIndex((e=>e.Name===t))}getExpressionFile(t){return t.File}createExpression(t,e){return Ot.create(t)}_setExpression(t){return this.queueManager.startMotion(t,!1,performance.now())}stopAllExpressions(){this.queueManager.stopAllMotions()}updateParameters(t,e){return this.queueManager.doUpdateMotion(t,e)}}var Gt=(t=>(t[t.CubismMotionCurveTarget_Model=0]="CubismMotionCurveTarget_Model",t[t.CubismMotionCurveTarget_Parameter=1]="CubismMotionCurveTarget_Parameter",t[t.CubismMotionCurveTarget_PartOpacity=2]="CubismMotionCurveTarget_PartOpacity",t))(Gt||{}),Vt=(t=>(t[t.CubismMotionSegmentType_Linear=0]="CubismMotionSegmentType_Linear",t[t.CubismMotionSegmentType_Bezier=1]="CubismMotionSegmentType_Bezier",t[t.CubismMotionSegmentType_Stepped=2]="CubismMotionSegmentType_Stepped",t[t.CubismMotionSegmentType_InverseStepped=3]="CubismMotionSegmentType_InverseStepped",t))(Vt||{});class Ht{constructor(t=0,e=0){this.time=t,this.value=e}}class zt{constructor(){this.basePointIndex=0,this.segmentType=0}}class Xt{constructor(){this.id="",this.type=0,this.segmentCount=0,this.baseSegmentIndex=0,this.fadeInTime=0,this.fadeOutTime=0}}class Wt{constructor(){this.fireTime=0,this.value=""}}class Yt{constructor(){this.duration=0,this.loop=!1,this.curveCount=0,this.eventCount=0,this.fps=0,this.curves=[],this.segments=[],this.points=[],this.events=[]}}class jt{constructor(t){this._json=t}release(){this._json=void 0}getMotionDuration(){return this._json.Meta.Duration}isMotionLoop(){return this._json.Meta.Loop||!1}getEvaluationOptionFlag(t){return 0==t&&!!this._json.Meta.AreBeziersRestricted}getMotionCurveCount(){return this._json.Meta.CurveCount}getMotionFps(){return this._json.Meta.Fps}getMotionTotalSegmentCount(){return this._json.Meta.TotalSegmentCount}getMotionTotalPointCount(){return this._json.Meta.TotalPointCount}getMotionFadeInTime(){return this._json.Meta.FadeInTime}getMotionFadeOutTime(){return this._json.Meta.FadeOutTime}getMotionCurveTarget(t){return this._json.Curves[t].Target}getMotionCurveId(t){return this._json.Curves[t].Id}getMotionCurveFadeInTime(t){return this._json.Curves[t].FadeInTime}getMotionCurveFadeOutTime(t){return this._json.Curves[t].FadeOutTime}getMotionCurveSegmentCount(t){return this._json.Curves[t].Segments.length}getMotionCurveSegment(t,e){return this._json.Curves[t].Segments[e]}getEventCount(){return this._json.Meta.UserDataCount||0}getTotalEventValueSize(){return this._json.Meta.TotalUserDataSize}getEventTime(t){return this._json.UserData[t].Time}getEventValue(t){return this._json.UserData[t].Value}}var qt=(t=>(t[t.EvaluationOptionFlag_AreBeziersRistricted=0]="EvaluationOptionFlag_AreBeziersRistricted",t))(qt||{});const Zt="Opacity";function Qt(t,e,r){const i=new Ht;return i.time=t.time+(e.time-t.time)*r,i.value=t.value+(e.value-t.value)*r,i}function Jt(t,e){let r=(e-t[0].time)/(t[1].time-t[0].time);return r<0&&(r=0),t[0].value+(t[1].value-t[0].value)*r}function Kt(t,e){let r=(e-t[0].time)/(t[3].time-t[0].time);r<0&&(r=0);const i=Qt(t[0],t[1],r),s=Qt(t[1],t[2],r),n=Qt(t[2],t[3],r),o=Qt(i,s,r),a=Qt(s,n,r);return Qt(o,a,r).value}function te(t,e){const r=e,i=t[0].time,s=t[3].time,n=t[1].time,o=t[2].time,a=s-3*o+3*n-i,h=3*o-6*n+3*i,l=3*n-3*i,u=i-r,c=bt.cardanoAlgorithmForBezier(a,h,l,u),d=Qt(t[0],t[1],c),f=Qt(t[1],t[2],c),p=Qt(t[2],t[3],c),_=Qt(d,f,c),m=Qt(f,p,c);return Qt(_,m,c).value}function ee(t,e){return t[0].value}function re(t,e){return t[1].value}function ie(t,e,r){const i=t.curves[e];let s=-1;const n=i.baseSegmentIndex+i.segmentCount;let o=0;for(let e=i.baseSegmentIndex;e<n;++e)if(o=t.segments[e].basePointIndex+(t.segments[e].segmentType==Vt.CubismMotionSegmentType_Bezier?3:1),t.points[o].time>r){s=e;break}if(-1==s)return t.points[o].value;const a=t.segments[s];return a.evaluate(t.points.slice(a.basePointIndex),r)}class se extends Ft{constructor(){super(),this._eyeBlinkParameterIds=[],this._lipSyncParameterIds=[],this._sourceFrameRate=30,this._loopDurationSeconds=-1,this._isLoop=!1,this._isLoopFadeIn=!0,this._lastWeight=0,this._modelOpacity=1}static create(t,e){const r=new se;return r.parse(t),r._sourceFrameRate=r._motionData.fps,r._loopDurationSeconds=r._motionData.duration,r._onFinishedMotion=e,r}doUpdateParameters(t,e,r,s){null==this._modelCurveIdEyeBlink&&(this._modelCurveIdEyeBlink="EyeBlink"),null==this._modelCurveIdLipSync&&(this._modelCurveIdLipSync="LipSync"),null==this._modelCurveIdOpacity&&(this._modelCurveIdOpacity=Zt);let n=e-s.getStartTime();n<0&&(n=0);let o=Number.MAX_VALUE,a=Number.MAX_VALUE;const h=64;let l=0,u=0;this._eyeBlinkParameterIds.length>h&&$t("too many eye blink targets : {0}",this._eyeBlinkParameterIds.length),this._lipSyncParameterIds.length>h&&$t("too many lip sync targets : {0}",this._lipSyncParameterIds.length);const c=this._fadeInSeconds<=0?1:bt.getEasingSine((e-s.getFadeInStartTime())/this._fadeInSeconds),d=this._fadeOutSeconds<=0||s.getEndTime()<0?1:bt.getEasingSine((s.getEndTime()-e)/this._fadeOutSeconds);let f,p,_,m=n;if(this._isLoop)for(;m>this._motionData.duration;)m-=this._motionData.duration;const g=this._motionData.curves;for(p=0;p<this._motionData.curveCount&&g[p].type==Gt.CubismMotionCurveTarget_Model;++p)f=ie(this._motionData,p,m),g[p].id==this._modelCurveIdEyeBlink?a=f:g[p].id==this._modelCurveIdLipSync?o=f:g[p].id==this._modelCurveIdOpacity&&(this._modelOpacity=f,t.setModelOapcity(this.getModelOpacityValue()));for(;p<this._motionData.curveCount&&g[p].type==Gt.CubismMotionCurveTarget_Parameter;++p){if(_=t.getParameterIndex(g[p].id),-1==_)continue;const i=t.getParameterValueByIndex(_);if(f=ie(this._motionData,p,m),a!=Number.MAX_VALUE)for(let t=0;t<this._eyeBlinkParameterIds.length&&t<h;++t)if(this._eyeBlinkParameterIds[t]==g[p].id){f*=a,u|=1<<t;break}if(o!=Number.MAX_VALUE)for(let t=0;t<this._lipSyncParameterIds.length&&t<h;++t)if(this._lipSyncParameterIds[t]==g[p].id){f+=o,l|=1<<t;break}let n;if(g[p].fadeInTime<0&&g[p].fadeOutTime<0)n=i+(f-i)*r;else{let t,r;t=g[p].fadeInTime<0?c:0==g[p].fadeInTime?1:bt.getEasingSine((e-s.getFadeInStartTime())/g[p].fadeInTime),r=g[p].fadeOutTime<0?d:0==g[p].fadeOutTime||s.getEndTime()<0?1:bt.getEasingSine((s.getEndTime()-e)/g[p].fadeOutTime),n=i+(f-i)*(this._weight*t*r)}t.setParameterValueByIndex(_,n,1)}if(a!=Number.MAX_VALUE)for(let e=0;e<this._eyeBlinkParameterIds.length&&e<h;++e){const i=t.getParameterValueById(this._eyeBlinkParameterIds[e]);if(u>>e&1)continue;const s=i+(a-i)*r;t.setParameterValueById(this._eyeBlinkParameterIds[e],s)}if(o!=Number.MAX_VALUE)for(let e=0;e<this._lipSyncParameterIds.length&&e<h;++e){const i=t.getParameterValueById(this._lipSyncParameterIds[e]);if(l>>e&1)continue;const s=i+(o-i)*r;t.setParameterValueById(this._lipSyncParameterIds[e],s)}for(;p<this._motionData.curveCount&&g[p].type==Gt.CubismMotionCurveTarget_PartOpacity;++p)if(f=ie(this._motionData,p,m),i.setOpacityFromMotion)t.setPartOpacityById(g[p].id,f);else{if(_=t.getParameterIndex(g[p].id),-1==_)continue;t.setParameterValueByIndex(_,f)}n>=this._motionData.duration&&(this._isLoop?(s.setStartTime(e),this._isLoopFadeIn&&s.setFadeInStartTime(e)):(this._onFinishedMotion&&this._onFinishedMotion(this),s.setIsFinished(!0))),this._lastWeight=r}setIsLoop(t){this._isLoop=t}isLoop(){return this._isLoop}setIsLoopFadeIn(t){this._isLoopFadeIn=t}isLoopFadeIn(){return this._isLoopFadeIn}getDuration(){return this._isLoop?-1:this._loopDurationSeconds}getLoopDuration(){return this._loopDurationSeconds}setParameterFadeInTime(t,e){const r=this._motionData.curves;for(let i=0;i<this._motionData.curveCount;++i)if(t==r[i].id)return void(r[i].fadeInTime=e)}setParameterFadeOutTime(t,e){const r=this._motionData.curves;for(let i=0;i<this._motionData.curveCount;++i)if(t==r[i].id)return void(r[i].fadeOutTime=e)}getParameterFadeInTime(t){const e=this._motionData.curves;for(let r=0;r<this._motionData.curveCount;++r)if(t==e[r].id)return e[r].fadeInTime;return-1}getParameterFadeOutTime(t){const e=this._motionData.curves;for(let r=0;r<this._motionData.curveCount;++r)if(t==e[r].id)return e[r].fadeOutTime;return-1}setEffectIds(t,e){this._eyeBlinkParameterIds=t,this._lipSyncParameterIds=e}release(){this._motionData=void 0}parse(t){this._motionData=new Yt;const e=new jt(t);this._motionData.duration=e.getMotionDuration(),this._motionData.loop=e.isMotionLoop(),this._motionData.curveCount=e.getMotionCurveCount(),this._motionData.fps=e.getMotionFps(),this._motionData.eventCount=e.getEventCount();const r=e.getEvaluationOptionFlag(qt.EvaluationOptionFlag_AreBeziersRistricted),i=e.getMotionFadeInTime(),s=e.getMotionFadeOutTime();this._fadeInSeconds=void 0!==i?i<0?1:i:1,this._fadeOutSeconds=void 0!==s?s<0?1:s:1,this._motionData.curves=Array.from({length:this._motionData.curveCount}).map((()=>new Xt)),this._motionData.segments=Array.from({length:e.getMotionTotalSegmentCount()}).map((()=>new zt)),this._motionData.events=Array.from({length:this._motionData.eventCount}).map((()=>new Wt)),this._motionData.points=[];let n=0,o=0;for(let t=0;t<this._motionData.curveCount;++t){const i=this._motionData.curves[t];switch(e.getMotionCurveTarget(t)){case"Model":i.type=Gt.CubismMotionCurveTarget_Model;break;case"Parameter":i.type=Gt.CubismMotionCurveTarget_Parameter;break;case"PartOpacity":i.type=Gt.CubismMotionCurveTarget_PartOpacity;break;default:Rt('Warning : Unable to get segment type from Curve! The number of "CurveCount" may be incorrect!')}i.id=e.getMotionCurveId(t),i.baseSegmentIndex=o;const s=e.getMotionCurveFadeInTime(t),a=e.getMotionCurveFadeOutTime(t);i.fadeInTime=void 0!==s?s:-1,i.fadeOutTime=void 0!==a?a:-1;for(let s=0;s<e.getMotionCurveSegmentCount(t);){switch(0==s?(this._motionData.segments[o].basePointIndex=n,this._motionData.points[n]=new Ht(e.getMotionCurveSegment(t,s),e.getMotionCurveSegment(t,s+1)),n+=1,s+=2):this._motionData.segments[o].basePointIndex=n-1,e.getMotionCurveSegment(t,s)){case Vt.CubismMotionSegmentType_Linear:this._motionData.segments[o].segmentType=Vt.CubismMotionSegmentType_Linear,this._motionData.segments[o].evaluate=Jt,this._motionData.points[n]=new Ht(e.getMotionCurveSegment(t,s+1),e.getMotionCurveSegment(t,s+2)),n+=1,s+=3;break;case Vt.CubismMotionSegmentType_Bezier:this._motionData.segments[o].segmentType=Vt.CubismMotionSegmentType_Bezier,this._motionData.segments[o].evaluate=r?Kt:te,this._motionData.points[n]=new Ht(e.getMotionCurveSegment(t,s+1),e.getMotionCurveSegment(t,s+2)),this._motionData.points[n+1]=new Ht(e.getMotionCurveSegment(t,s+3),e.getMotionCurveSegment(t,s+4)),this._motionData.points[n+2]=new Ht(e.getMotionCurveSegment(t,s+5),e.getMotionCurveSegment(t,s+6)),n+=3,s+=7;break;case Vt.CubismMotionSegmentType_Stepped:this._motionData.segments[o].segmentType=Vt.CubismMotionSegmentType_Stepped,this._motionData.segments[o].evaluate=ee,this._motionData.points[n]=new Ht(e.getMotionCurveSegment(t,s+1),e.getMotionCurveSegment(t,s+2)),n+=1,s+=3;break;case Vt.CubismMotionSegmentType_InverseStepped:this._motionData.segments[o].segmentType=Vt.CubismMotionSegmentType_InverseStepped,this._motionData.segments[o].evaluate=re,this._motionData.points[n]=new Ht(e.getMotionCurveSegment(t,s+1),e.getMotionCurveSegment(t,s+2)),n+=1,s+=3;break;default:Mt(0)}++i.segmentCount,++o}this._motionData.curves.push(i)}for(let t=0;t<e.getEventCount();++t)this._motionData.events[t].fireTime=e.getEventTime(t),this._motionData.events[t].value=e.getEventValue(t);e.release()}getFiredEvent(t,e){this._firedEventValues.length=0;for(let r=0;r<this._motionData.eventCount;++r)this._motionData.events[r].fireTime>t&&this._motionData.events[r].fireTime<=e&&this._firedEventValues.push(this._motionData.events[r].value);return this._firedEventValues}isExistModelOpacity(){for(let t=0;t<this._motionData.curveCount;t++){const e=this._motionData.curves[t];if(e.type==Gt.CubismMotionCurveTarget_Model&&e.id===Zt)return!0}return!1}getModelOpacityIndex(){if(this.isExistModelOpacity())for(let t=0;t<this._motionData.curveCount;t++){const e=this._motionData.curves[t];if(e.type==Gt.CubismMotionCurveTarget_Model&&e.id===Zt)return t}return-1}getModelOpacityId(t){if(-1!=t){const e=this._motionData.curves[t];if(e.type==Gt.CubismMotionCurveTarget_Model&&e.id===Zt)return e.id}}getModelOpacityValue(){return this._modelOpacity}}class ne extends C{constructor(t,e){var r;super(t,e),a(this,"definitions"),a(this,"groups",{idle:"Idle"}),a(this,"motionDataType","json"),a(this,"queueManager",new Bt),a(this,"expressionManager"),a(this,"eyeBlinkIds"),a(this,"lipSyncIds",["ParamMouthOpenY"]),this.definitions=null!=(r=t.motions)?r:{},this.eyeBlinkIds=t.getEyeBlinkParameters()||[];const i=t.getLipSyncParameters();(null==i?void 0:i.length)&&(this.lipSyncIds=i),this.init(e)}init(t){super.init(t),this.settings.expressions&&(this.expressionManager=new Ut(this.settings,t)),this.queueManager.setEventCallback(((t,e,r)=>{this.emit("motion:"+e)}))}isFinished(){return this.queueManager.isFinished()}_startMotion(t,e){return t.setFinishedMotionHandler(e),this.queueManager.stopAllMotions(),this.queueManager.startMotion(t,!1,performance.now())}_stopAllMotions(){this.queueManager.stopAllMotions()}createMotion(t,e,r){const i=se.create(t),s=new jt(t),n=(e===this.groups.idle?l.idleMotionFadingDuration:l.motionFadingDuration)/1e3;return void 0===s.getMotionFadeInTime()&&i.setFadeInTime(r.FadeInTime>0?r.FadeInTime:n),void 0===s.getMotionFadeOutTime()&&i.setFadeOutTime(r.FadeOutTime>0?r.FadeOutTime:n),i.setEffectIds(this.eyeBlinkIds,this.lipSyncIds),i}getMotionFile(t){return t.File}getMotionName(t){return t.File}getSoundFile(t){return t.Sound}updateParameters(t,e){return this.queueManager.doUpdateMotion(t,e)}destroy(){super.destroy(),this.queueManager.release(),this.queueManager=void 0}}class oe{constructor(){this._breathParameters=[],this._currentTime=0}static create(){return new oe}setParameters(t){this._breathParameters=t}getParameters(){return this._breathParameters}updateParameters(t,e){this._currentTime+=e;const r=2*this._currentTime*3.14159;for(let e=0;e<this._breathParameters.length;++e){const i=this._breathParameters[e];t.addParameterValueById(i.parameterId,i.offset+i.peak*Math.sin(r/i.cycle),i.weight)}}}class ae{constructor(t,e,r,i,s){this.parameterId=null==t?void 0:t,this.offset=null==e?0:e,this.peak=null==r?0:r,this.cycle=null==i?0:i,this.weight=null==s?0:s}}const he=class t{static create(e){return new t(e)}setBlinkingInterval(t){this._blinkingIntervalSeconds=t}setBlinkingSetting(t,e,r){this._closingSeconds=t,this._closedSeconds=e,this._openingSeconds=r}setParameterIds(t){this._parameterIds=t}getParameterIds(){return this._parameterIds}updateParameters(e,r){let i;this._userTimeSeconds+=r;let s=0;switch(this._blinkingState){case 2:s=(this._userTimeSeconds-this._stateStartTimeSeconds)/this._closingSeconds,s>=1&&(s=1,this._blinkingState=3,this._stateStartTimeSeconds=this._userTimeSeconds),i=1-s;break;case 3:s=(this._userTimeSeconds-this._stateStartTimeSeconds)/this._closedSeconds,s>=1&&(this._blinkingState=4,this._stateStartTimeSeconds=this._userTimeSeconds),i=0;break;case 4:s=(this._userTimeSeconds-this._stateStartTimeSeconds)/this._openingSeconds,s>=1&&(s=1,this._blinkingState=1,this._nextBlinkingTime=this.determinNextBlinkingTiming()),i=s;break;case 1:this._nextBlinkingTime<this._userTimeSeconds&&(this._blinkingState=2,this._stateStartTimeSeconds=this._userTimeSeconds),i=1;break;default:this._blinkingState=1,this._nextBlinkingTime=this.determinNextBlinkingTiming(),i=1}t.CloseIfZero||(i=-i);for(let t=0;t<this._parameterIds.length;++t)e.setParameterValueById(this._parameterIds[t],i)}constructor(t){var e,r;this._blinkingState=0,this._nextBlinkingTime=0,this._stateStartTimeSeconds=0,this._blinkingIntervalSeconds=4,this._closingSeconds=.1,this._closedSeconds=.05,this._openingSeconds=.15,this._userTimeSeconds=0,this._parameterIds=[],null!=t&&(this._parameterIds=null!=(r=null==(e=t.getEyeBlinkParameters())?void 0:e.slice())?r:this._parameterIds)}determinNextBlinkingTiming(){const t=Math.random();return this._userTimeSeconds+t*(2*this._blinkingIntervalSeconds-1)}};he.CloseIfZero=!0;let le,ue,ce,de=he;class fe{constructor(t=0,e=0,r=0,i=0){this.x=t,this.y=e,this.width=r,this.height=i}getCenterX(){return this.x+.5*this.width}getCenterY(){return this.y+.5*this.height}getRight(){return this.x+this.width}getBottom(){return this.y+this.height}setRect(t){this.x=t.x,this.y=t.y,this.width=t.width,this.height=t.height}expand(t,e){this.x-=t,this.y-=e,this.width+=2*t,this.height+=2*e}}class pe{getChannelFlagAsColor(t){return this._channelColors[t]}getMaskRenderTexture(){if(this._maskTexture&&null!=this._maskTexture.textures)this._maskTexture.frameNo=this._currentFrameNo;else{this._maskRenderTextures=[],this._maskColorBuffers=[];const t=this._clippingMaskBufferSize;for(let e=0;e<this._renderTextureCount;e++)this._maskColorBuffers.push(this.gl.createTexture()),this.gl.bindTexture(this.gl.TEXTURE_2D,this._maskColorBuffers[e]),this.gl.texImage2D(this.gl.TEXTURE_2D,0,this.gl.RGBA,t,t,0,this.gl.RGBA,this.gl.UNSIGNED_BYTE,null),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_WRAP_S,this.gl.CLAMP_TO_EDGE),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_WRAP_T,this.gl.CLAMP_TO_EDGE),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_MIN_FILTER,this.gl.LINEAR),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_MAG_FILTER,this.gl.LINEAR),this.gl.bindTexture(this.gl.TEXTURE_2D,null),this._maskRenderTextures.push(this.gl.createFramebuffer()),this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,this._maskRenderTextures[e]),this.gl.framebufferTexture2D(this.gl.FRAMEBUFFER,this.gl.COLOR_ATTACHMENT0,this.gl.TEXTURE_2D,this._maskColorBuffers[e],0);this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,ce),this._maskTexture=new _e(this._currentFrameNo,this._maskRenderTextures)}return this._maskTexture.textures}setGL(t){this.gl=t}calcClippedDrawTotalBounds(t,e){let r=Number.MAX_VALUE,i=Number.MAX_VALUE,s=Number.MIN_VALUE,n=Number.MIN_VALUE;const o=e._clippedDrawableIndexList.length;for(let a=0;a<o;a++){const o=e._clippedDrawableIndexList[a],h=t.getDrawableVertexCount(o),l=t.getDrawableVertices(o);let u=Number.MAX_VALUE,c=Number.MAX_VALUE,d=-Number.MAX_VALUE,f=-Number.MAX_VALUE;const p=2*h;for(let t=0;t<p;t+=2){const e=l[t],r=l[t+1];e<u&&(u=e),e>d&&(d=e),r<c&&(c=r),r>f&&(f=r)}if(u!=Number.MAX_VALUE)if(u<r&&(r=u),c<i&&(i=c),d>s&&(s=d),f>n&&(n=f),r==Number.MAX_VALUE)e._allClippedDrawRect.x=0,e._allClippedDrawRect.y=0,e._allClippedDrawRect.width=0,e._allClippedDrawRect.height=0,e._isUsing=!1;else{e._isUsing=!0;const t=s-r,o=n-i;e._allClippedDrawRect.x=r,e._allClippedDrawRect.y=i,e._allClippedDrawRect.width=t,e._allClippedDrawRect.height=o}}}constructor(){this._currentMaskRenderTexture=null,this._currentFrameNo=0,this._renderTextureCount=0,this._clippingMaskBufferSize=256,this._clippingContextListForMask=[],this._clippingContextListForDraw=[],this._channelColors=[],this._tmpBoundsOnModel=new fe,this._tmpMatrix=new vt,this._tmpMatrixForMask=new vt,this._tmpMatrixForDraw=new vt;let t=new Tt;t.R=1,t.G=0,t.B=0,t.A=0,this._channelColors.push(t),t=new Tt,t.R=0,t.G=1,t.B=0,t.A=0,this._channelColors.push(t),t=new Tt,t.R=0,t.G=0,t.B=1,t.A=0,this._channelColors.push(t),t=new Tt,t.R=0,t.G=0,t.B=0,t.A=1,this._channelColors.push(t)}release(){var t;const e=this;for(let e=0;e<this._clippingContextListForMask.length;e++)this._clippingContextListForMask[e]&&(null==(t=this._clippingContextListForMask[e])||t.release());if(e._clippingContextListForMask=void 0,e._clippingContextListForDraw=void 0,this._maskTexture){for(let t=0;t<this._maskTexture.textures.length;t++)this.gl.deleteFramebuffer(this._maskTexture.textures[t]);this._maskTexture=void 0}if(e._channelColors=void 0,this._maskColorBuffers)for(let t=0;t<this._maskColorBuffers.length;t++)this.gl.deleteTexture(this._maskColorBuffers[t]);this._maskColorBuffers=void 0,this._maskRenderTextures=void 0,this._clearedFrameBufferflags=void 0}initialize(t,e,r,i,s){s%1!=0&&(Rt("The number of render textures must be specified as an integer. The decimal point is rounded down and corrected to an integer."),s=~~s),s<1&&Rt("The number of render textures must be an integer greater than or equal to 1. Set the number of render textures to 1."),this._renderTextureCount=s<1?1:s,this._clearedFrameBufferflags=[];for(let t=0;t<e;t++){if(i[t]<=0){this._clippingContextListForDraw.push(null);continue}let e=this.findSameClip(r[t],i[t]);null==e&&(e=new me(this,r[t],i[t]),this._clippingContextListForMask.push(e)),e.addClippedDrawable(t),this._clippingContextListForDraw.push(e)}}setupClippingContext(t,e){this._currentFrameNo++;let r=0;for(let e=0;e<this._clippingContextListForMask.length;e++){const i=this._clippingContextListForMask[e];this.calcClippedDrawTotalBounds(t,i),i._isUsing&&r++}if(r>0){this.setupLayoutBounds(e.isUsingHighPrecisionMask()?0:r),e.isUsingHighPrecisionMask()||(this.gl.viewport(0,0,this._clippingMaskBufferSize,this._clippingMaskBufferSize),this._currentMaskRenderTexture=this.getMaskRenderTexture()[0],e.preDraw(),this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,this._currentMaskRenderTexture)),this._clearedFrameBufferflags||(this._clearedFrameBufferflags=[]);for(let t=0;t<this._renderTextureCount;t++)this._clearedFrameBufferflags[t]=!1;for(let r=0;r<this._clippingContextListForMask.length;r++){const i=this._clippingContextListForMask[r],s=i._allClippedDrawRect,n=i._layoutBounds,o=.05;let a=0,h=0;const l=this.getMaskRenderTexture()[i._bufferIndex];if(this._currentMaskRenderTexture==l||e.isUsingHighPrecisionMask()||(this._currentMaskRenderTexture=l,e.preDraw(),this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,this._currentMaskRenderTexture)),e.isUsingHighPrecisionMask()){const e=t.getPixelsPerUnit(),r=i.getClippingManager()._clippingMaskBufferSize,l=n.width*r,u=n.height*r;this._tmpBoundsOnModel.setRect(s),this._tmpBoundsOnModel.width*e>l?(this._tmpBoundsOnModel.expand(s.width*o,0),a=n.width/this._tmpBoundsOnModel.width):a=e/l,this._tmpBoundsOnModel.height*e>u?(this._tmpBoundsOnModel.expand(0,s.height*o),h=n.height/this._tmpBoundsOnModel.height):h=e/u}else this._tmpBoundsOnModel.setRect(s),this._tmpBoundsOnModel.expand(s.width*o,s.height*o),a=n.width/this._tmpBoundsOnModel.width,h=n.height/this._tmpBoundsOnModel.height;if(this._tmpMatrix.loadIdentity(),this._tmpMatrix.translateRelative(-1,-1),this._tmpMatrix.scaleRelative(2,2),this._tmpMatrix.translateRelative(n.x,n.y),this._tmpMatrix.scaleRelative(a,h),this._tmpMatrix.translateRelative(-this._tmpBoundsOnModel.x,-this._tmpBoundsOnModel.y),this._tmpMatrixForMask.setMatrix(this._tmpMatrix.getArray()),this._tmpMatrix.loadIdentity(),this._tmpMatrix.translateRelative(n.x,n.y),this._tmpMatrix.scaleRelative(a,h),this._tmpMatrix.translateRelative(-this._tmpBoundsOnModel.x,-this._tmpBoundsOnModel.y),this._tmpMatrixForDraw.setMatrix(this._tmpMatrix.getArray()),i._matrixForMask.setMatrix(this._tmpMatrixForMask.getArray()),i._matrixForDraw.setMatrix(this._tmpMatrixForDraw.getArray()),!e.isUsingHighPrecisionMask()){const r=i._clippingIdCount;for(let s=0;s<r;s++){const r=i._clippingIdList[s];t.getDrawableDynamicFlagVertexPositionsDidChange(r)&&(e.setIsCulling(0!=t.getDrawableCulling(r)),this._clearedFrameBufferflags[i._bufferIndex]||(this.gl.clearColor(1,1,1,1),this.gl.clear(this.gl.COLOR_BUFFER_BIT),this._clearedFrameBufferflags[i._bufferIndex]=!0),e.setClippingContextBufferForMask(i),e.drawMesh(t.getDrawableTextureIndex(r),t.getDrawableVertexIndexCount(r),t.getDrawableVertexCount(r),t.getDrawableVertexIndices(r),t.getDrawableVertices(r),t.getDrawableVertexUvs(r),t.getMultiplyColor(r),t.getScreenColor(r),t.getDrawableOpacity(r),At.CubismBlendMode_Normal,!1))}}}e.isUsingHighPrecisionMask()||(this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,ce),e.setClippingContextBufferForMask(null),this.gl.viewport(ue[0],ue[1],ue[2],ue[3]))}}findSameClip(t,e){for(let r=0;r<this._clippingContextListForMask.length;r++){const i=this._clippingContextListForMask[r],s=i._clippingIdCount;if(s!=e)continue;let n=0;for(let e=0;e<s;e++){const r=i._clippingIdList[e];for(let e=0;e<s;e++)if(t[e]==r){n++;break}}if(n==s)return i}return null}setupLayoutBounds(t){const e=this._renderTextureCount<=1?36:32*this._renderTextureCount;if(t<=0||t>e){t>e&&Dt("not supported mask count : {0}\n[Details] render texture count : {1}, mask count : {2}",t-e,this._renderTextureCount,t);for(let t=0;t<this._clippingContextListForMask.length;t++){const e=this._clippingContextListForMask[t];e._layoutChannelNo=0,e._layoutBounds.x=0,e._layoutBounds.y=0,e._layoutBounds.width=1,e._layoutBounds.height=1,e._bufferIndex=0}return}const r=this._renderTextureCount<=1?9:8;let s=t/this._renderTextureCount,n=t%this._renderTextureCount;s=~~s,n=~~n;let o=s/4,a=s%4;o=~~o,a=~~a;let h=0;for(let s=0;s<this._renderTextureCount;s++)for(let l=0;l<4;l++){let u=o+(l<a?1:0);if(u<r&&l==(a+1>=4?0:a+1)&&(u+=s<n?1:0),0==u);else if(1==u){const t=this._clippingContextListForMask[h++];t._layoutChannelNo=l,t._layoutBounds.x=0,t._layoutBounds.y=0,t._layoutBounds.width=1,t._layoutBounds.height=1,t._bufferIndex=s}else if(2==u)for(let t=0;t<u;t++){let e=t%2;e=~~e;const r=this._clippingContextListForMask[h++];r._layoutChannelNo=l,r._layoutBounds.x=.5*e,r._layoutBounds.y=0,r._layoutBounds.width=.5,r._layoutBounds.height=1,r._bufferIndex=s}else if(u<=4)for(let t=0;t<u;t++){let e=t%2,r=t/2;e=~~e,r=~~r;const i=this._clippingContextListForMask[h++];i._layoutChannelNo=l,i._layoutBounds.x=.5*e,i._layoutBounds.y=.5*r,i._layoutBounds.width=.5,i._layoutBounds.height=.5,i._bufferIndex=s}else if(u<=r)for(let t=0;t<u;t++){let e=t%3,r=t/3;e=~~e,r=~~r;const i=this._clippingContextListForMask[h++];i._layoutChannelNo=l,i._layoutBounds.x=e/3,i._layoutBounds.y=r/3,i._layoutBounds.width=1/3,i._layoutBounds.height=1/3,i._bufferIndex=s}else if(i.supportMoreMaskDivisions&&u<=16)for(let t=0;t<u;t++){let e=t%4,r=t/4;e=~~e,r=~~r;const i=this._clippingContextListForMask[h++];i._layoutChannelNo=l,i._layoutBounds.x=e/4,i._layoutBounds.y=r/4,i._layoutBounds.width=1/4,i._layoutBounds.height=1/4,i._bufferIndex=s}else{Dt("not supported mask count : {0}\n[Details] render texture count : {1}, mask count : {2}",t-e,this._renderTextureCount,t);for(let t=0;t<u;t++){const t=this._clippingContextListForMask[h++];t._layoutChannelNo=0,t._layoutBounds.x=0,t._layoutBounds.y=0,t._layoutBounds.width=1,t._layoutBounds.height=1,t._bufferIndex=0}}}}getColorBuffer(){return this._maskColorBuffers}getClippingContextListForDraw(){return this._clippingContextListForDraw}getClippingMaskCount(){return this._clippingContextListForMask.length}setClippingMaskBufferSize(t){this._clippingMaskBufferSize=t}getClippingMaskBufferSize(){return this._clippingMaskBufferSize}getRenderTextureCount(){return this._renderTextureCount}}class _e{constructor(t,e){this.frameNo=t,this.textures=e}}class me{constructor(t,e,r){this._isUsing=!1,this._owner=t,this._clippingIdList=e,this._clippingIdCount=r,this._allClippedDrawRect=new fe,this._layoutBounds=new fe,this._clippedDrawableIndexList=[],this._matrixForMask=new vt,this._matrixForDraw=new vt,this._bufferIndex=0}release(){const t=this;t._layoutBounds=void 0,t._allClippedDrawRect=void 0,t._clippedDrawableIndexList=void 0}addClippedDrawable(t){this._clippedDrawableIndexList.push(t)}getClippingManager(){return this._owner}setGl(t){this._owner.setGL(t)}}class ge{setGlEnable(t,e){e?this.gl.enable(t):this.gl.disable(t)}setGlEnableVertexAttribArray(t,e){e?this.gl.enableVertexAttribArray(t):this.gl.disableVertexAttribArray(t)}save(){null!=this.gl?(this._lastArrayBufferBinding=this.gl.getParameter(this.gl.ARRAY_BUFFER_BINDING),this._lastArrayBufferBinding=this.gl.getParameter(this.gl.ELEMENT_ARRAY_BUFFER_BINDING),this._lastProgram=this.gl.getParameter(this.gl.CURRENT_PROGRAM),this._lastActiveTexture=this.gl.getParameter(this.gl.ACTIVE_TEXTURE),this.gl.activeTexture(this.gl.TEXTURE1),this._lastTexture1Binding2D=this.gl.getParameter(this.gl.TEXTURE_BINDING_2D),this.gl.activeTexture(this.gl.TEXTURE0),this._lastTexture0Binding2D=this.gl.getParameter(this.gl.TEXTURE_BINDING_2D),this._lastVertexAttribArrayEnabled[0]=this.gl.getVertexAttrib(0,this.gl.VERTEX_ATTRIB_ARRAY_ENABLED),this._lastVertexAttribArrayEnabled[1]=this.gl.getVertexAttrib(1,this.gl.VERTEX_ATTRIB_ARRAY_ENABLED),this._lastVertexAttribArrayEnabled[2]=this.gl.getVertexAttrib(2,this.gl.VERTEX_ATTRIB_ARRAY_ENABLED),this._lastVertexAttribArrayEnabled[3]=this.gl.getVertexAttrib(3,this.gl.VERTEX_ATTRIB_ARRAY_ENABLED),this._lastScissorTest=this.gl.isEnabled(this.gl.SCISSOR_TEST),this._lastStencilTest=this.gl.isEnabled(this.gl.STENCIL_TEST),this._lastDepthTest=this.gl.isEnabled(this.gl.DEPTH_TEST),this._lastCullFace=this.gl.isEnabled(this.gl.CULL_FACE),this._lastBlend=this.gl.isEnabled(this.gl.BLEND),this._lastFrontFace=this.gl.getParameter(this.gl.FRONT_FACE),this._lastColorMask=this.gl.getParameter(this.gl.COLOR_WRITEMASK),this._lastBlending[0]=this.gl.getParameter(this.gl.BLEND_SRC_RGB),this._lastBlending[1]=this.gl.getParameter(this.gl.BLEND_DST_RGB),this._lastBlending[2]=this.gl.getParameter(this.gl.BLEND_SRC_ALPHA),this._lastBlending[3]=this.gl.getParameter(this.gl.BLEND_DST_ALPHA),this._lastFBO=this.gl.getParameter(this.gl.FRAMEBUFFER_BINDING),this._lastViewport=this.gl.getParameter(this.gl.VIEWPORT)):Dt("'gl' is null. WebGLRenderingContext is required.\nPlease call 'CubimRenderer_WebGL.startUp' function.")}restore(){null!=this.gl?(this.gl.useProgram(this._lastProgram),this.setGlEnableVertexAttribArray(0,this._lastVertexAttribArrayEnabled[0]),this.setGlEnableVertexAttribArray(1,this._lastVertexAttribArrayEnabled[1]),this.setGlEnableVertexAttribArray(2,this._lastVertexAttribArrayEnabled[2]),this.setGlEnableVertexAttribArray(3,this._lastVertexAttribArrayEnabled[3]),this.setGlEnable(this.gl.SCISSOR_TEST,this._lastScissorTest),this.setGlEnable(this.gl.STENCIL_TEST,this._lastStencilTest),this.setGlEnable(this.gl.DEPTH_TEST,this._lastDepthTest),this.setGlEnable(this.gl.CULL_FACE,this._lastCullFace),this.setGlEnable(this.gl.BLEND,this._lastBlend),this.gl.frontFace(this._lastFrontFace),this.gl.colorMask(this._lastColorMask[0],this._lastColorMask[1],this._lastColorMask[2],this._lastColorMask[3]),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this._lastArrayBufferBinding),this.gl.bindBuffer(this.gl.ELEMENT_ARRAY_BUFFER,this._lastElementArrayBufferBinding),this.gl.activeTexture(this.gl.TEXTURE1),this.gl.bindTexture(this.gl.TEXTURE_2D,this._lastTexture1Binding2D),this.gl.activeTexture(this.gl.TEXTURE0),this.gl.bindTexture(this.gl.TEXTURE_2D,this._lastTexture0Binding2D),this.gl.activeTexture(this._lastActiveTexture),this.gl.blendFuncSeparate(this._lastBlending[0],this._lastBlending[1],this._lastBlending[2],this._lastBlending[3])):Dt("'gl' is null. WebGLRenderingContext is required.\nPlease call 'CubimRenderer_WebGL.startUp' function.")}setGl(t){this.gl=t}constructor(){this._lastVertexAttribArrayEnabled=new Array(4),this._lastColorMask=new Array(4),this._lastBlending=new Array(4),this._lastViewport=new Array(4)}}class ye{static getInstance(){return null==le?(le=new ye,le):le}static deleteInstance(){le&&(le.release(),le=void 0)}constructor(){this._shaderSets=[]}release(){this.releaseShaderProgram()}setupShaderProgram(t,e,r,i,s,n,o,a,h,l,u,c,d,f,p){let _,m,g,y;d||Dt("NoPremultipliedAlpha is not allowed"),0==this._shaderSets.length&&this.generateShaders();const b=t.getClippingContextBufferForMask();if(null!=b){const t=this._shaderSets[0];this.gl.useProgram(t.shaderProgram),this.gl.activeTexture(this.gl.TEXTURE0),this.gl.bindTexture(this.gl.TEXTURE_2D,e),this.gl.uniform1i(t.samplerTexture0Location,0),null==o.vertex&&(o.vertex=this.gl.createBuffer()),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,o.vertex),this.gl.bufferData(this.gl.ARRAY_BUFFER,i,this.gl.DYNAMIC_DRAW),this.gl.enableVertexAttribArray(t.attributePositionLocation),this.gl.vertexAttribPointer(t.attributePositionLocation,2,this.gl.FLOAT,!1,0,0),null==o.uv&&(o.uv=this.gl.createBuffer()),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,o.uv),this.gl.bufferData(this.gl.ARRAY_BUFFER,n,this.gl.DYNAMIC_DRAW),this.gl.enableVertexAttribArray(t.attributeTexCoordLocation),this.gl.vertexAttribPointer(t.attributeTexCoordLocation,2,this.gl.FLOAT,!1,0,0);const r=b._layoutChannelNo,s=b.getClippingManager().getChannelFlagAsColor(r);this.gl.uniform4f(t.uniformChannelFlagLocation,s.R,s.G,s.B,s.A),this.gl.uniformMatrix4fv(t.uniformClipMatrixLocation,!1,b._matrixForMask.getArray());const a=b._layoutBounds;this.gl.uniform4f(t.uniformBaseColorLocation,2*a.x-1,2*a.y-1,2*a.getRight()-1,2*a.getBottom()-1),this.gl.uniform4f(t.uniformMultiplyColorLocation,u.R,u.G,u.B,u.A),this.gl.uniform4f(t.uniformScreenColorLocation,c.R,c.G,c.B,c.A),_=this.gl.ZERO,m=this.gl.ONE_MINUS_SRC_COLOR,g=this.gl.ZERO,y=this.gl.ONE_MINUS_SRC_ALPHA}else{const r=t.getClippingContextBufferForDraw(),s=null!=r?p?2:1:0;let a;switch(h){case At.CubismBlendMode_Normal:default:a=this._shaderSets[1+s],_=this.gl.ONE,m=this.gl.ONE_MINUS_SRC_ALPHA,g=this.gl.ONE,y=this.gl.ONE_MINUS_SRC_ALPHA;break;case At.CubismBlendMode_Additive:a=this._shaderSets[4+s],_=this.gl.ONE,m=this.gl.ONE,g=this.gl.ZERO,y=this.gl.ONE;break;case At.CubismBlendMode_Multiplicative:a=this._shaderSets[7+s],_=this.gl.DST_COLOR,m=this.gl.ONE_MINUS_SRC_ALPHA,g=this.gl.ZERO,y=this.gl.ONE}if(this.gl.useProgram(a.shaderProgram),null==o.vertex&&(o.vertex=this.gl.createBuffer()),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,o.vertex),this.gl.bufferData(this.gl.ARRAY_BUFFER,i,this.gl.DYNAMIC_DRAW),this.gl.enableVertexAttribArray(a.attributePositionLocation),this.gl.vertexAttribPointer(a.attributePositionLocation,2,this.gl.FLOAT,!1,0,0),null==o.uv&&(o.uv=this.gl.createBuffer()),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,o.uv),this.gl.bufferData(this.gl.ARRAY_BUFFER,n,this.gl.DYNAMIC_DRAW),this.gl.enableVertexAttribArray(a.attributeTexCoordLocation),this.gl.vertexAttribPointer(a.attributeTexCoordLocation,2,this.gl.FLOAT,!1,0,0),null!=r){this.gl.activeTexture(this.gl.TEXTURE1);const e=r.getClippingManager().getColorBuffer()[t.getClippingContextBufferForDraw()._bufferIndex];this.gl.bindTexture(this.gl.TEXTURE_2D,e),this.gl.uniform1i(a.samplerTexture1Location,1),this.gl.uniformMatrix4fv(a.uniformClipMatrixLocation,!1,r._matrixForDraw.getArray());const i=r._layoutChannelNo,s=r.getClippingManager().getChannelFlagAsColor(i);this.gl.uniform4f(a.uniformChannelFlagLocation,s.R,s.G,s.B,s.A)}this.gl.activeTexture(this.gl.TEXTURE0),this.gl.bindTexture(this.gl.TEXTURE_2D,e),this.gl.uniform1i(a.samplerTexture0Location,0),this.gl.uniformMatrix4fv(a.uniformMatrixLocation,!1,f.getArray()),this.gl.uniform4f(a.uniformBaseColorLocation,l.R,l.G,l.B,l.A),this.gl.uniform4f(a.uniformMultiplyColorLocation,u.R,u.G,u.B,u.A),this.gl.uniform4f(a.uniformScreenColorLocation,c.R,c.G,c.B,c.A)}null==o.index&&(o.index=this.gl.createBuffer()),this.gl.bindBuffer(this.gl.ELEMENT_ARRAY_BUFFER,o.index),this.gl.bufferData(this.gl.ELEMENT_ARRAY_BUFFER,s,this.gl.DYNAMIC_DRAW),this.gl.blendFuncSeparate(_,m,g,y)}releaseShaderProgram(){for(let t=0;t<this._shaderSets.length;t++)this.gl.deleteProgram(this._shaderSets[t].shaderProgram),this._shaderSets[t].shaderProgram=0;this._shaderSets=[]}generateShaders(){for(let t=0;t<10;t++)this._shaderSets.push({});this._shaderSets[0].shaderProgram=this.loadShaderProgram(be,ve),this._shaderSets[1].shaderProgram=this.loadShaderProgram(xe,Te),this._shaderSets[2].shaderProgram=this.loadShaderProgram(Ae,Ee),this._shaderSets[3].shaderProgram=this.loadShaderProgram(Ae,we),this._shaderSets[4].shaderProgram=this._shaderSets[1].shaderProgram,this._shaderSets[5].shaderProgram=this._shaderSets[2].shaderProgram,this._shaderSets[6].shaderProgram=this._shaderSets[3].shaderProgram,this._shaderSets[7].shaderProgram=this._shaderSets[1].shaderProgram,this._shaderSets[8].shaderProgram=this._shaderSets[2].shaderProgram,this._shaderSets[9].shaderProgram=this._shaderSets[3].shaderProgram,this._shaderSets[0].attributePositionLocation=this.gl.getAttribLocation(this._shaderSets[0].shaderProgram,"a_position"),this._shaderSets[0].attributeTexCoordLocation=this.gl.getAttribLocation(this._shaderSets[0].shaderProgram,"a_texCoord"),this._shaderSets[0].samplerTexture0Location=this.gl.getUniformLocation(this._shaderSets[0].shaderProgram,"s_texture0"),this._shaderSets[0].uniformClipMatrixLocation=this.gl.getUniformLocation(this._shaderSets[0].shaderProgram,"u_clipMatrix"),this._shaderSets[0].uniformChannelFlagLocation=this.gl.getUniformLocation(this._shaderSets[0].shaderProgram,"u_channelFlag"),this._shaderSets[0].uniformBaseColorLocation=this.gl.getUniformLocation(this._shaderSets[0].shaderProgram,"u_baseColor"),this._shaderSets[0].uniformMultiplyColorLocation=this.gl.getUniformLocation(this._shaderSets[0].shaderProgram,"u_multiplyColor"),this._shaderSets[0].uniformScreenColorLocation=this.gl.getUniformLocation(this._shaderSets[0].shaderProgram,"u_screenColor"),this._shaderSets[1].attributePositionLocation=this.gl.getAttribLocation(this._shaderSets[1].shaderProgram,"a_position"),this._shaderSets[1].attributeTexCoordLocation=this.gl.getAttribLocation(this._shaderSets[1].shaderProgram,"a_texCoord"),this._shaderSets[1].samplerTexture0Location=this.gl.getUniformLocation(this._shaderSets[1].shaderProgram,"s_texture0"),this._shaderSets[1].uniformMatrixLocation=this.gl.getUniformLocation(this._shaderSets[1].shaderProgram,"u_matrix"),this._shaderSets[1].uniformBaseColorLocation=this.gl.getUniformLocation(this._shaderSets[1].shaderProgram,"u_baseColor"),this._shaderSets[1].uniformMultiplyColorLocation=this.gl.getUniformLocation(this._shaderSets[1].shaderProgram,"u_multiplyColor"),this._shaderSets[1].uniformScreenColorLocation=this.gl.getUniformLocation(this._shaderSets[1].shaderProgram,"u_screenColor"),this._shaderSets[2].attributePositionLocation=this.gl.getAttribLocation(this._shaderSets[2].shaderProgram,"a_position"),this._shaderSets[2].attributeTexCoordLocation=this.gl.getAttribLocation(this._shaderSets[2].shaderProgram,"a_texCoord"),this._shaderSets[2].samplerTexture0Location=this.gl.getUniformLocation(this._shaderSets[2].shaderProgram,"s_texture0"),this._shaderSets[2].samplerTexture1Location=this.gl.getUniformLocation(this._shaderSets[2].shaderProgram,"s_texture1"),this._shaderSets[2].uniformMatrixLocation=this.gl.getUniformLocation(this._shaderSets[2].shaderProgram,"u_matrix"),this._shaderSets[2].uniformClipMatrixLocation=this.gl.getUniformLocation(this._shaderSets[2].shaderProgram,"u_clipMatrix"),this._shaderSets[2].uniformChannelFlagLocation=this.gl.getUniformLocation(this._shaderSets[2].shaderProgram,"u_channelFlag"),this._shaderSets[2].uniformBaseColorLocation=this.gl.getUniformLocation(this._shaderSets[2].shaderProgram,"u_baseColor"),this._shaderSets[2].uniformMultiplyColorLocation=this.gl.getUniformLocation(this._shaderSets[2].shaderProgram,"u_multiplyColor"),this._shaderSets[2].uniformScreenColorLocation=this.gl.getUniformLocation(this._shaderSets[2].shaderProgram,"u_screenColor"),this._shaderSets[3].attributePositionLocation=this.gl.getAttribLocation(this._shaderSets[3].shaderProgram,"a_position"),this._shaderSets[3].attributeTexCoordLocation=this.gl.getAttribLocation(this._shaderSets[3].shaderProgram,"a_texCoord"),this._shaderSets[3].samplerTexture0Location=this.gl.getUniformLocation(this._shaderSets[3].shaderProgram,"s_texture0"),this._shaderSets[3].samplerTexture1Location=this.gl.getUniformLocation(this._shaderSets[3].shaderProgram,"s_texture1"),this._shaderSets[3].uniformMatrixLocation=this.gl.getUniformLocation(this._shaderSets[3].shaderProgram,"u_matrix"),this._shaderSets[3].uniformClipMatrixLocation=this.gl.getUniformLocation(this._shaderSets[3].shaderProgram,"u_clipMatrix"),this._shaderSets[3].uniformChannelFlagLocation=this.gl.getUniformLocation(this._shaderSets[3].shaderProgram,"u_channelFlag"),this._shaderSets[3].uniformBaseColorLocation=this.gl.getUniformLocation(this._shaderSets[3].shaderProgram,"u_baseColor"),this._shaderSets[3].uniformMultiplyColorLocation=this.gl.getUniformLocation(this._shaderSets[3].shaderProgram,"u_multiplyColor"),this._shaderSets[3].uniformScreenColorLocation=this.gl.getUniformLocation(this._shaderSets[3].shaderProgram,"u_screenColor"),this._shaderSets[4].attributePositionLocation=this.gl.getAttribLocation(this._shaderSets[4].shaderProgram,"a_position"),this._shaderSets[4].attributeTexCoordLocation=this.gl.getAttribLocation(this._shaderSets[4].shaderProgram,"a_texCoord"),this._shaderSets[4].samplerTexture0Location=this.gl.getUniformLocation(this._shaderSets[4].shaderProgram,"s_texture0"),this._shaderSets[4].uniformMatrixLocation=this.gl.getUniformLocation(this._shaderSets[4].shaderProgram,"u_matrix"),this._shaderSets[4].uniformBaseColorLocation=this.gl.getUniformLocation(this._shaderSets[4].shaderProgram,"u_baseColor"),this._shaderSets[4].uniformMultiplyColorLocation=this.gl.getUniformLocation(this._shaderSets[4].shaderProgram,"u_multiplyColor"),this._shaderSets[4].uniformScreenColorLocation=this.gl.getUniformLocation(this._shaderSets[4].shaderProgram,"u_screenColor"),this._shaderSets[5].attributePositionLocation=this.gl.getAttribLocation(this._shaderSets[5].shaderProgram,"a_position"),this._shaderSets[5].attributeTexCoordLocation=this.gl.getAttribLocation(this._shaderSets[5].shaderProgram,"a_texCoord"),this._shaderSets[5].samplerTexture0Location=this.gl.getUniformLocation(this._shaderSets[5].shaderProgram,"s_texture0"),this._shaderSets[5].samplerTexture1Location=this.gl.getUniformLocation(this._shaderSets[5].shaderProgram,"s_texture1"),this._shaderSets[5].uniformMatrixLocation=this.gl.getUniformLocation(this._shaderSets[5].shaderProgram,"u_matrix"),this._shaderSets[5].uniformClipMatrixLocation=this.gl.getUniformLocation(this._shaderSets[5].shaderProgram,"u_clipMatrix"),this._shaderSets[5].uniformChannelFlagLocation=this.gl.getUniformLocation(this._shaderSets[5].shaderProgram,"u_channelFlag"),this._shaderSets[5].uniformBaseColorLocation=this.gl.getUniformLocation(this._shaderSets[5].shaderProgram,"u_baseColor"),this._shaderSets[5].uniformMultiplyColorLocation=this.gl.getUniformLocation(this._shaderSets[5].shaderProgram,"u_multiplyColor"),this._shaderSets[5].uniformScreenColorLocation=this.gl.getUniformLocation(this._shaderSets[5].shaderProgram,"u_screenColor"),this._shaderSets[6].attributePositionLocation=this.gl.getAttribLocation(this._shaderSets[6].shaderProgram,"a_position"),this._shaderSets[6].attributeTexCoordLocation=this.gl.getAttribLocation(this._shaderSets[6].shaderProgram,"a_texCoord"),this._shaderSets[6].samplerTexture0Location=this.gl.getUniformLocation(this._shaderSets[6].shaderProgram,"s_texture0"),this._shaderSets[6].samplerTexture1Location=this.gl.getUniformLocation(this._shaderSets[6].shaderProgram,"s_texture1"),this._shaderSets[6].uniformMatrixLocation=this.gl.getUniformLocation(this._shaderSets[6].shaderProgram,"u_matrix"),this._shaderSets[6].uniformClipMatrixLocation=this.gl.getUniformLocation(this._shaderSets[6].shaderProgram,"u_clipMatrix"),this._shaderSets[6].uniformChannelFlagLocation=this.gl.getUniformLocation(this._shaderSets[6].shaderProgram,"u_channelFlag"),this._shaderSets[6].uniformBaseColorLocation=this.gl.getUniformLocation(this._shaderSets[6].shaderProgram,"u_baseColor"),this._shaderSets[6].uniformMultiplyColorLocation=this.gl.getUniformLocation(this._shaderSets[6].shaderProgram,"u_multiplyColor"),this._shaderSets[6].uniformScreenColorLocation=this.gl.getUniformLocation(this._shaderSets[6].shaderProgram,"u_screenColor"),this._shaderSets[7].attributePositionLocation=this.gl.getAttribLocation(this._shaderSets[7].shaderProgram,"a_position"),this._shaderSets[7].attributeTexCoordLocation=this.gl.getAttribLocation(this._shaderSets[7].shaderProgram,"a_texCoord"),this._shaderSets[7].samplerTexture0Location=this.gl.getUniformLocation(this._shaderSets[7].shaderProgram,"s_texture0"),this._shaderSets[7].uniformMatrixLocation=this.gl.getUniformLocation(this._shaderSets[7].shaderProgram,"u_matrix"),this._shaderSets[7].uniformBaseColorLocation=this.gl.getUniformLocation(this._shaderSets[7].shaderProgram,"u_baseColor"),this._shaderSets[7].uniformMultiplyColorLocation=this.gl.getUniformLocation(this._shaderSets[7].shaderProgram,"u_multiplyColor"),this._shaderSets[7].uniformScreenColorLocation=this.gl.getUniformLocation(this._shaderSets[7].shaderProgram,"u_screenColor"),this._shaderSets[8].attributePositionLocation=this.gl.getAttribLocation(this._shaderSets[8].shaderProgram,"a_position"),this._shaderSets[8].attributeTexCoordLocation=this.gl.getAttribLocation(this._shaderSets[8].shaderProgram,"a_texCoord"),this._shaderSets[8].samplerTexture0Location=this.gl.getUniformLocation(this._shaderSets[8].shaderProgram,"s_texture0"),this._shaderSets[8].samplerTexture1Location=this.gl.getUniformLocation(this._shaderSets[8].shaderProgram,"s_texture1"),this._shaderSets[8].uniformMatrixLocation=this.gl.getUniformLocation(this._shaderSets[8].shaderProgram,"u_matrix"),this._shaderSets[8].uniformClipMatrixLocation=this.gl.getUniformLocation(this._shaderSets[8].shaderProgram,"u_clipMatrix"),this._shaderSets[8].uniformChannelFlagLocation=this.gl.getUniformLocation(this._shaderSets[8].shaderProgram,"u_channelFlag"),this._shaderSets[8].uniformBaseColorLocation=this.gl.getUniformLocation(this._shaderSets[8].shaderProgram,"u_baseColor"),this._shaderSets[8].uniformMultiplyColorLocation=this.gl.getUniformLocation(this._shaderSets[8].shaderProgram,"u_multiplyColor"),this._shaderSets[8].uniformScreenColorLocation=this.gl.getUniformLocation(this._shaderSets[8].shaderProgram,"u_screenColor"),this._shaderSets[9].attributePositionLocation=this.gl.getAttribLocation(this._shaderSets[9].shaderProgram,"a_position"),this._shaderSets[9].attributeTexCoordLocation=this.gl.getAttribLocation(this._shaderSets[9].shaderProgram,"a_texCoord"),this._shaderSets[9].samplerTexture0Location=this.gl.getUniformLocation(this._shaderSets[9].shaderProgram,"s_texture0"),this._shaderSets[9].samplerTexture1Location=this.gl.getUniformLocation(this._shaderSets[9].shaderProgram,"s_texture1"),this._shaderSets[9].uniformMatrixLocation=this.gl.getUniformLocation(this._shaderSets[9].shaderProgram,"u_matrix"),this._shaderSets[9].uniformClipMatrixLocation=this.gl.getUniformLocation(this._shaderSets[9].shaderProgram,"u_clipMatrix"),this._shaderSets[9].uniformChannelFlagLocation=this.gl.getUniformLocation(this._shaderSets[9].shaderProgram,"u_channelFlag"),this._shaderSets[9].uniformBaseColorLocation=this.gl.getUniformLocation(this._shaderSets[9].shaderProgram,"u_baseColor"),this._shaderSets[9].uniformMultiplyColorLocation=this.gl.getUniformLocation(this._shaderSets[9].shaderProgram,"u_multiplyColor"),this._shaderSets[9].uniformScreenColorLocation=this.gl.getUniformLocation(this._shaderSets[9].shaderProgram,"u_screenColor")}loadShaderProgram(t,e){const r=this.gl.createProgram(),i=this.compileShaderSource(this.gl.VERTEX_SHADER,t);if(!i)return Dt("Vertex shader compile error!"),0;const s=this.compileShaderSource(this.gl.FRAGMENT_SHADER,e);return s?(this.gl.attachShader(r,i),this.gl.attachShader(r,s),this.gl.linkProgram(r),this.gl.getProgramParameter(r,this.gl.LINK_STATUS)?(this.gl.deleteShader(i),this.gl.deleteShader(s),r):(Dt("Failed to link program: {0}",r),this.gl.deleteShader(i),this.gl.deleteShader(s),r&&this.gl.deleteProgram(r),0)):(Dt("Vertex shader compile error!"),0)}compileShaderSource(t,e){const r=e,i=this.gl.createShader(t);return this.gl.shaderSource(i,r),this.gl.compileShader(i),i||Dt("Shader compile log: {0} ",this.gl.getShaderInfoLog(i)),this.gl.getShaderParameter(i,this.gl.COMPILE_STATUS)?i:(this.gl.deleteShader(i),null)}setGl(t){this.gl=t}}const be="attribute vec4     a_position;attribute vec2     a_texCoord;varying vec2       v_texCoord;varying vec4       v_myPos;uniform mat4       u_clipMatrix;void main(){   gl_Position = u_clipMatrix * a_position;   v_myPos = u_clipMatrix * a_position;   v_texCoord = a_texCoord;   v_texCoord.y = 1.0 - v_texCoord.y;}",ve="precision mediump float;varying vec2       v_texCoord;varying vec4       v_myPos;uniform vec4       u_baseColor;uniform vec4       u_channelFlag;uniform sampler2D  s_texture0;void main(){   float isInside =        step(u_baseColor.x, v_myPos.x/v_myPos.w)       * step(u_baseColor.y, v_myPos.y/v_myPos.w)       * step(v_myPos.x/v_myPos.w, u_baseColor.z)       * step(v_myPos.y/v_myPos.w, u_baseColor.w);   gl_FragColor = u_channelFlag * texture2D(s_texture0, v_texCoord).a * isInside;}",xe="attribute vec4     a_position;attribute vec2     a_texCoord;varying vec2       v_texCoord;uniform mat4       u_matrix;void main(){   gl_Position = u_matrix * a_position;   v_texCoord = a_texCoord;   v_texCoord.y = 1.0 - v_texCoord.y;}",Ae="attribute vec4     a_position;attribute vec2     a_texCoord;varying vec2       v_texCoord;varying vec4       v_clipPos;uniform mat4       u_matrix;uniform mat4       u_clipMatrix;void main(){   gl_Position = u_matrix * a_position;   v_clipPos = u_clipMatrix * a_position;   v_texCoord = a_texCoord;   v_texCoord.y = 1.0 - v_texCoord.y;}",Te="precision mediump float;varying vec2       v_texCoord;uniform vec4       u_baseColor;uniform sampler2D  s_texture0;uniform vec4       u_multiplyColor;uniform vec4       u_screenColor;void main(){   vec4 texColor = texture2D(s_texture0, v_texCoord);   texColor.rgb = texColor.rgb * u_multiplyColor.rgb;   texColor.rgb = (texColor.rgb + u_screenColor.rgb * texColor.a) - (texColor.rgb * u_screenColor.rgb);   vec4 color = texColor * u_baseColor;   gl_FragColor = vec4(color.rgb, color.a);}",Ee="precision mediump float;varying vec2       v_texCoord;varying vec4       v_clipPos;uniform vec4       u_baseColor;uniform vec4       u_channelFlag;uniform sampler2D  s_texture0;uniform sampler2D  s_texture1;uniform vec4       u_multiplyColor;uniform vec4       u_screenColor;void main(){   vec4 texColor = texture2D(s_texture0, v_texCoord);   texColor.rgb = texColor.rgb * u_multiplyColor.rgb;   texColor.rgb = (texColor.rgb + u_screenColor.rgb * texColor.a) - (texColor.rgb * u_screenColor.rgb);   vec4 col_formask = texColor * u_baseColor;   vec4 clipMask = (1.0 - texture2D(s_texture1, v_clipPos.xy / v_clipPos.w)) * u_channelFlag;   float maskVal = clipMask.r + clipMask.g + clipMask.b + clipMask.a;   col_formask = col_formask * maskVal;   gl_FragColor = col_formask;}",we="precision mediump float;varying vec2      v_texCoord;varying vec4      v_clipPos;uniform sampler2D s_texture0;uniform sampler2D s_texture1;uniform vec4      u_channelFlag;uniform vec4      u_baseColor;uniform vec4      u_multiplyColor;uniform vec4      u_screenColor;void main(){   vec4 texColor = texture2D(s_texture0, v_texCoord);   texColor.rgb = texColor.rgb * u_multiplyColor.rgb;   texColor.rgb = (texColor.rgb + u_screenColor.rgb * texColor.a) - (texColor.rgb * u_screenColor.rgb);   vec4 col_formask = texColor * u_baseColor;   vec4 clipMask = (1.0 - texture2D(s_texture1, v_clipPos.xy / v_clipPos.w)) * u_channelFlag;   float maskVal = clipMask.r + clipMask.g + clipMask.b + clipMask.a;   col_formask = col_formask * (1.0 - maskVal);   gl_FragColor = col_formask;}";class Se extends xt{initialize(t,e=1){t.isUsingMasking()&&(this._clippingManager=new pe,this._clippingManager.initialize(t,t.getDrawableCount(),t.getDrawableMasks(),t.getDrawableMaskCounts(),e));for(let e=t.getDrawableCount()-1;e>=0;e--)this._sortedDrawableIndexList[e]=0;super.initialize(t)}bindTexture(t,e){this._textures[t]=e}getBindedTextures(){return this._textures}setClippingMaskBufferSize(t){if(!this._model.isUsingMasking())return;const e=this._clippingManager.getRenderTextureCount();this._clippingManager.release(),this._clippingManager=new pe,this._clippingManager.setClippingMaskBufferSize(t),this._clippingManager.initialize(this.getModel(),this.getModel().getDrawableCount(),this.getModel().getDrawableMasks(),this.getModel().getDrawableMaskCounts(),e)}getClippingMaskBufferSize(){return this._model.isUsingMasking()?this._clippingManager.getClippingMaskBufferSize():-1}getRenderTextureCount(){return this._model.isUsingMasking()?this._clippingManager.getRenderTextureCount():-1}constructor(){super(),this._clippingContextBufferForMask=null,this._clippingContextBufferForDraw=null,this._rendererProfile=new ge,this.firstDraw=!0,this._textures={},this._sortedDrawableIndexList=[],this._bufferData={vertex:null,uv:null,index:null}}release(){var t,e,r;const i=this;this._clippingManager.release(),i._clippingManager=void 0,null==(t=this.gl)||t.deleteBuffer(this._bufferData.vertex),this._bufferData.vertex=null,null==(e=this.gl)||e.deleteBuffer(this._bufferData.uv),this._bufferData.uv=null,null==(r=this.gl)||r.deleteBuffer(this._bufferData.index),this._bufferData.index=null,i._bufferData=void 0,i._textures=void 0}doDrawModel(){if(null==this.gl)return void Dt("'gl' is null. WebGLRenderingContext is required.\nPlease call 'CubimRenderer_WebGL.startUp' function.");null!=this._clippingManager&&(this.preDraw(),this._clippingManager.setupClippingContext(this.getModel(),this)),this.preDraw();const t=this.getModel().getDrawableCount(),e=this.getModel().getDrawableRenderOrders();for(let r=0;r<t;++r){const t=e[r];this._sortedDrawableIndexList[t]=r}for(let e=0;e<t;++e){const t=this._sortedDrawableIndexList[e];if(!this.getModel().getDrawableDynamicFlagIsVisible(t))continue;const r=null!=this._clippingManager?this._clippingManager.getClippingContextListForDraw()[t]:null;if(null!=r&&this.isUsingHighPrecisionMask()){r._isUsing&&(this.gl.viewport(0,0,this._clippingManager.getClippingMaskBufferSize(),this._clippingManager.getClippingMaskBufferSize()),this.preDraw(),this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,r.getClippingManager().getMaskRenderTexture()[r._bufferIndex]),this.gl.clearColor(1,1,1,1),this.gl.clear(this.gl.COLOR_BUFFER_BIT));{const t=r._clippingIdCount;for(let e=0;e<t;e++){const t=r._clippingIdList[e];this._model.getDrawableDynamicFlagVertexPositionsDidChange(t)&&(this.setIsCulling(0!=this._model.getDrawableCulling(t)),this.setClippingContextBufferForMask(r),this.drawMesh(this.getModel().getDrawableTextureIndex(t),this.getModel().getDrawableVertexIndexCount(t),this.getModel().getDrawableVertexCount(t),this.getModel().getDrawableVertexIndices(t),this.getModel().getDrawableVertices(t),this.getModel().getDrawableVertexUvs(t),this.getModel().getMultiplyColor(t),this.getModel().getScreenColor(t),this.getModel().getDrawableOpacity(t),At.CubismBlendMode_Normal,!1))}}this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,ce),this.setClippingContextBufferForMask(null),this.gl.viewport(ue[0],ue[1],ue[2],ue[3]),this.preDraw()}this.setClippingContextBufferForDraw(r),this.setIsCulling(this.getModel().getDrawableCulling(t)),this.drawMesh(this.getModel().getDrawableTextureIndex(t),this.getModel().getDrawableVertexIndexCount(t),this.getModel().getDrawableVertexCount(t),this.getModel().getDrawableVertexIndices(t),this.getModel().getDrawableVertices(t),this.getModel().getDrawableVertexUvs(t),this.getModel().getMultiplyColor(t),this.getModel().getScreenColor(t),this.getModel().getDrawableOpacity(t),this.getModel().getDrawableBlendMode(t),this.getModel().getDrawableInvertedMaskBit(t))}}drawMesh(t,e,r,i,s,n,o,a,h,l,u){this.isCulling()?this.gl.enable(this.gl.CULL_FACE):this.gl.disable(this.gl.CULL_FACE),this.gl.frontFace(this.gl.CCW);const c=this.getModelColor();null==this.getClippingContextBufferForMask()&&(c.A*=h,this.isPremultipliedAlpha()&&(c.R*=c.A,c.G*=c.A,c.B*=c.A));let d=null;null!=this._textures[t]&&(d=this._textures[t]),ye.getInstance().setupShaderProgram(this,d,r,s,i,n,this._bufferData,h,l,c,o,a,this.isPremultipliedAlpha(),this.getMvpMatrix(),u),this.gl.drawElements(this.gl.TRIANGLES,e,this.gl.UNSIGNED_SHORT,0),this.gl.useProgram(null),this.setClippingContextBufferForDraw(null),this.setClippingContextBufferForMask(null)}saveProfile(){this._rendererProfile.save()}restoreProfile(){this._rendererProfile.restore()}static doStaticRelease(){ye.deleteInstance()}setRenderState(t,e){ce=t,ue=e}preDraw(){if(this.firstDraw&&(this.firstDraw=!1),this.gl.disable(this.gl.SCISSOR_TEST),this.gl.disable(this.gl.STENCIL_TEST),this.gl.disable(this.gl.DEPTH_TEST),this.gl.frontFace(this.gl.CW),this.gl.enable(this.gl.BLEND),this.gl.colorMask(!0,!0,!0,!0),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,null),this.gl.bindBuffer(this.gl.ELEMENT_ARRAY_BUFFER,null),this.getAnisotropy()>0&&this._extension)for(const t of Object.entries(this._textures))this.gl.bindTexture(this.gl.TEXTURE_2D,t),this.gl.texParameterf(this.gl.TEXTURE_2D,this._extension.TEXTURE_MAX_ANISOTROPY_EXT,this.getAnisotropy())}setClippingContextBufferForMask(t){this._clippingContextBufferForMask=t}getClippingContextBufferForMask(){return this._clippingContextBufferForMask}setClippingContextBufferForDraw(t){this._clippingContextBufferForDraw=t}getClippingContextBufferForDraw(){return this._clippingContextBufferForDraw}startUp(t){this.gl=t,this._clippingManager&&this._clippingManager.setGL(t),ye.getInstance().setGl(t),this._rendererProfile.setGl(t),this._extension=this.gl.getExtension("EXT_texture_filter_anisotropic")||this.gl.getExtension("WEBKIT_EXT_texture_filter_anisotropic")||this.gl.getExtension("MOZ_EXT_texture_filter_anisotropic")}}xt.staticRelease=()=>{Se.doStaticRelease()};const Ce=new vt;class Pe extends M{constructor(t,r,i){super(),a(this,"settings"),a(this,"coreModel"),a(this,"motionManager"),a(this,"lipSync",!0),a(this,"breath",oe.create()),a(this,"eyeBlink"),a(this,"userData"),a(this,"renderer",new Se),a(this,"idParamAngleX","ParamAngleX"),a(this,"idParamAngleY","ParamAngleY"),a(this,"idParamAngleZ","ParamAngleZ"),a(this,"idParamEyeBallX","ParamEyeBallX"),a(this,"idParamEyeBallY","ParamEyeBallY"),a(this,"idParamBodyAngleX","ParamBodyAngleX"),a(this,"idParamBreath","ParamBreath"),a(this,"idParamMouthForm","ParamMouthForm"),a(this,"pixelsPerUnit",1),a(this,"centeringTransform",new e.Matrix),this.coreModel=t,this.settings=r,this.motionManager=new ne(r,i),this.init()}init(){var t;super.init(),(null==(t=this.settings.getEyeBlinkParameters())?void 0:t.length)&&(this.eyeBlink=de.create(this.settings)),this.breath.setParameters([new ae(this.idParamAngleX,0,15,6.5345,.5),new ae(this.idParamAngleY,0,8,3.5345,.5),new ae(this.idParamAngleZ,0,10,5.5345,.5),new ae(this.idParamBodyAngleX,0,4,15.5345,.5),new ae(this.idParamBreath,0,.5,3.2345,.5)]),this.renderer.initialize(this.coreModel),this.renderer.setIsPremultipliedAlpha(!0)}getSize(){return[this.coreModel.getModel().canvasinfo.CanvasWidth,this.coreModel.getModel().canvasinfo.CanvasHeight]}getLayout(){const t={};if(this.settings.layout)for(const[e,r]of Object.entries(this.settings.layout))t[e.charAt(0).toLowerCase()+e.slice(1)]=r;return t}setupLayout(){super.setupLayout(),this.pixelsPerUnit=this.coreModel.getModel().canvasinfo.PixelsPerUnit,this.centeringTransform.scale(this.pixelsPerUnit,this.pixelsPerUnit).translate(this.originalWidth/2,this.originalHeight/2)}updateWebGLContext(t,e){this.renderer.firstDraw=!0,this.renderer._bufferData={vertex:null,uv:null,index:null},this.renderer.startUp(t),this.renderer._clippingManager._currentFrameNo=e,this.renderer._clippingManager._maskTexture=void 0,ye.getInstance()._shaderSets=[]}bindTexture(t,e){this.renderer.bindTexture(t,e)}getHitAreaDefs(){var t,e;return null!=(e=null==(t=this.settings.hitAreas)?void 0:t.map((t=>({id:t.Id,name:t.Name,index:this.coreModel.getDrawableIndex(t.Id)}))))?e:[]}getDrawableIDs(){return this.coreModel.getDrawableIds()}getDrawableIndex(t){return this.coreModel.getDrawableIndex(t)}getDrawableVertices(t){if("string"==typeof t&&-1===(t=this.coreModel.getDrawableIndex(t)))throw new TypeError("Unable to find drawable ID: "+t);const e=this.coreModel.getDrawableVertices(t).slice();for(let t=0;t<e.length;t+=2)e[t]=e[t]*this.pixelsPerUnit+this.originalWidth/2,e[t+1]=-e[t+1]*this.pixelsPerUnit+this.originalHeight/2;return e}updateTransform(t){this.drawingMatrix.copyFrom(this.centeringTransform).prepend(this.localTransform).prepend(t)}update(t,e){var r,i,s,n;super.update(t,e),t/=1e3,e/=1e3;const o=this.coreModel;this.emit("beforeMotionUpdate");const a=this.motionManager.update(this.coreModel,e);if(this.emit("afterMotionUpdate"),o.saveParameters(),null==(r=this.motionManager.expressionManager)||r.update(o,e),a||null==(i=this.eyeBlink)||i.updateParameters(o,t),this.updateFocus(),this.updateNaturalMovements(1e3*t,1e3*e),this.lipSync&&this.motionManager.currentAudio){let t=this.motionManager.mouthSync(),e=0;t>0&&(e=.4),t=c(1.2*t,e,1);for(let e=0;e<this.motionManager.lipSyncIds.length;++e)o.addParameterValueById(this.motionManager.lipSyncIds[e],t,.8)}null==(s=this.physics)||s.evaluate(o,t),null==(n=this.pose)||n.updateParameters(o,t),this.emit("beforeModelUpdate"),o.update(),o.loadParameters()}updateFocus(){this.coreModel.addParameterValueById(this.idParamEyeBallX,this.focusController.x),this.coreModel.addParameterValueById(this.idParamEyeBallY,this.focusController.y),this.coreModel.addParameterValueById(this.idParamAngleX,30*this.focusController.x),this.coreModel.addParameterValueById(this.idParamAngleY,30*this.focusController.y),this.coreModel.addParameterValueById(this.idParamAngleZ,this.focusController.x*this.focusController.y*-30),this.coreModel.addParameterValueById(this.idParamBodyAngleX,10*this.focusController.x)}updateFacialEmotion(t){this.coreModel.addParameterValueById(this.idParamMouthForm,t)}updateNaturalMovements(t,e){var r;null==(r=this.breath)||r.updateParameters(this.coreModel,t/1e3)}draw(t){const e=this.drawingMatrix,r=Ce.getArray();r[0]=e.a,r[1]=e.b,r[4]=-e.c,r[5]=-e.d,r[12]=e.tx,r[13]=e.ty,this.renderer.setMvpMatrix(Ce),this.renderer.setRenderState(t.getParameter(t.FRAMEBUFFER_BINDING),this.viewport),this.renderer.drawModel()}destroy(){super.destroy(),this.renderer.release(),this.coreModel.release(),this.renderer=void 0,this.coreModel=void 0}}class Me{constructor(t){this.groups=t.Groups,this.hitAreas=t.HitAreas,this.layout=t.Layout,this.moc=t.FileReferences.Moc,this.expressions=t.FileReferences.Expressions,this.motions=t.FileReferences.Motions,this.textures=t.FileReferences.Textures,this.physics=t.FileReferences.Physics,this.pose=t.FileReferences.Pose}getEyeBlinkParameters(){var t,e;return null==(e=null==(t=this.groups)?void 0:t.find((t=>"EyeBlink"===t.Name)))?void 0:e.Ids}getLipSyncParameters(){var t,e;return null==(e=null==(t=this.groups)?void 0:t.find((t=>"LipSync"===t.Name)))?void 0:e.Ids}}class $e extends A{constructor(t){if(super(t),a(this,"moc"),a(this,"textures"),!$e.isValidJSON(t))throw new TypeError("Invalid JSON.");Object.assign(this,new Me(t))}static isValidJSON(t){var e;return!!(null==t?void 0:t.FileReferences)&&"string"==typeof t.FileReferences.Moc&&(null==(e=t.FileReferences.Textures)?void 0:e.length)>0&&t.FileReferences.Textures.every((t=>"string"==typeof t))}replaceFiles(t){if(super.replaceFiles(t),this.motions)for(const[e,r]of Object.entries(this.motions))for(let i=0;i<r.length;i++)r[i].File=t(r[i].File,`motions.${e}[${i}].File`),void 0!==r[i].Sound&&(r[i].Sound=t(r[i].Sound,`motions.${e}[${i}].Sound`));if(this.expressions)for(let e=0;e<this.expressions.length;e++)this.expressions[e].File=t(this.expressions[e].File,`expressions[${e}].File`)}}let Ie;_($e,[Me]);let Re=20;function De(){return Ct.isStarted()?Promise.resolve():(null!=Ie||(Ie=new Promise(((t,e)=>{!function r(){try{Le(),t()}catch(t){if(Re--,Re<0){const r=new Error("Failed to start up Cubism 4 framework.");return r.cause=t,void e(r)}u.log("Cubism4","Startup failed, retrying 10ms later..."),setTimeout(r,10)}}()}))),Ie)}function Le(t){t=Object.assign({logFunction:console.log,loggingLevel:Pt.LogLevel_Verbose},t),Ct.startUp(t),Ct.initialize()}class Fe{static create(t){const e=new Fe;"number"==typeof t.FadeInTime&&(e._fadeTimeSeconds=t.FadeInTime,e._fadeTimeSeconds<=0&&(e._fadeTimeSeconds=.5));const r=t.Groups,i=r.length;for(let t=0;t<i;++t){const i=r[t],s=i.length;let n=0;for(let t=0;t<s;++t){const r=i[t],s=new Oe;s.partId=r.Id;const o=r.Link;if(o){const t=o.length;for(let e=0;e<t;++e){const t=new Oe;t.partId=o[e],s.link.push(t)}}e._partGroups.push(s),++n}e._partGroupCounts.push(n)}return e}updateParameters(t,e){t!=this._lastModel&&this.reset(t),this._lastModel=t,e<0&&(e=0);let r=0;for(let i=0;i<this._partGroupCounts.length;i++){const s=this._partGroupCounts[i];this.doFade(t,e,r,s),r+=s}this.copyPartOpacities(t)}reset(t){let e=0;for(let r=0;r<this._partGroupCounts.length;++r){const i=this._partGroupCounts[r];for(let r=e;r<e+i;++r){this._partGroups[r].initialize(t);const i=this._partGroups[r].partIndex,s=this._partGroups[r].parameterIndex;if(!(i<0)){t.setPartOpacityByIndex(i,r==e?1:0),t.setParameterValueByIndex(s,r==e?1:0);for(let e=0;e<this._partGroups[r].link.length;++e)this._partGroups[r].link[e].initialize(t)}}e+=i}}copyPartOpacities(t){for(let e=0;e<this._partGroups.length;++e){const r=this._partGroups[e];if(0==r.link.length)continue;const i=this._partGroups[e].partIndex,s=t.getPartOpacityByIndex(i);for(let e=0;e<r.link.length;++e){const i=r.link[e].partIndex;i<0||t.setPartOpacityByIndex(i,s)}}}doFade(t,e,r,i){let s=-1,n=1;for(let o=r;o<r+i;++o){const r=this._partGroups[o].partIndex,i=this._partGroups[o].parameterIndex;if(t.getParameterValueByIndex(i)>.001){if(s>=0)break;s=o,n=t.getPartOpacityByIndex(r),n+=e/this._fadeTimeSeconds,n>1&&(n=1)}}s<0&&(s=0,n=1);for(let e=r;e<r+i;++e){const r=this._partGroups[e].partIndex;if(s==e)t.setPartOpacityByIndex(r,n);else{let e,i=t.getPartOpacityByIndex(r);e=n<.5?-.5*n/.5+1:.5*(1-n)/.5,(1-e)*(1-n)>.15&&(e=1-.15/(1-n)),i>e&&(i=e),t.setPartOpacityByIndex(r,i)}}}constructor(){this._fadeTimeSeconds=.5,this._lastModel=void 0,this._partGroups=[],this._partGroupCounts=[]}}class Oe{constructor(t){this.parameterIndex=0,this.partIndex=0,this.partId="",this.link=[],null!=t&&this.assignment(t)}assignment(t){return this.partId=t.partId,this.link=t.link.map((t=>t.clone())),this}initialize(t){this.parameterIndex=t.getParameterIndex(this.partId),this.partIndex=t.getPartIndex(this.partId),t.setParameterValueByIndex(this.parameterIndex,1)}clone(){const t=new Oe;return t.partId=this.partId,t.parameterIndex=this.parameterIndex,t.partIndex=this.partIndex,t.link=this.link.map((t=>t.clone())),t}}class ke{constructor(t=!1,e=new Tt){this.isOverwritten=t,this.Color=e}}class Be{constructor(t=!1,e=new Tt){this.isOverwritten=t,this.Color=e}}class Ne{constructor(t=!1,e=!1){this.isOverwritten=t,this.isCulling=e}}class Ue{update(){this._model.update(),this._model.drawables.resetDynamicFlags()}getPixelsPerUnit(){return null==this._model?0:this._model.canvasinfo.PixelsPerUnit}getCanvasWidth(){return null==this._model?0:this._model.canvasinfo.CanvasWidth/this._model.canvasinfo.PixelsPerUnit}getCanvasHeight(){return null==this._model?0:this._model.canvasinfo.CanvasHeight/this._model.canvasinfo.PixelsPerUnit}saveParameters(){const t=this._model.parameters.count,e=this._savedParameters.length;for(let r=0;r<t;++r)r<e?this._savedParameters[r]=this._parameterValues[r]:this._savedParameters.push(this._parameterValues[r])}getMultiplyColor(t){return this.getOverwriteFlagForModelMultiplyColors()||this.getOverwriteFlagForDrawableMultiplyColors(t)?this._userMultiplyColors[t].Color:this.getDrawableMultiplyColor(t)}getScreenColor(t){return this.getOverwriteFlagForModelScreenColors()||this.getOverwriteFlagForDrawableScreenColors(t)?this._userScreenColors[t].Color:this.getDrawableScreenColor(t)}setMultiplyColorByTextureColor(t,e){this.setMultiplyColorByRGBA(t,e.R,e.G,e.B,e.A)}setMultiplyColorByRGBA(t,e,r,i,s=1){this._userMultiplyColors[t].Color.R=e,this._userMultiplyColors[t].Color.G=r,this._userMultiplyColors[t].Color.B=i,this._userMultiplyColors[t].Color.A=s}setScreenColorByTextureColor(t,e){this.setScreenColorByRGBA(t,e.R,e.G,e.B,e.A)}setScreenColorByRGBA(t,e,r,i,s=1){this._userScreenColors[t].Color.R=e,this._userScreenColors[t].Color.G=r,this._userScreenColors[t].Color.B=i,this._userScreenColors[t].Color.A=s}getPartMultiplyColor(t){return this._userPartMultiplyColors[t].Color}getPartScreenColor(t){return this._userPartScreenColors[t].Color}setPartColor(t,e,r,i,s,n,o){if(n[t].Color.R=e,n[t].Color.G=r,n[t].Color.B=i,n[t].Color.A=s,n[t].isOverwritten)for(let n=0;n<this._partChildDrawables[t].length;++n){const a=this._partChildDrawables[t][n];o[a].Color.R=e,o[a].Color.G=r,o[a].Color.B=i,o[a].Color.A=s}}setPartMultiplyColorByTextureColor(t,e){this.setPartMultiplyColorByRGBA(t,e.R,e.G,e.B,e.A)}setPartMultiplyColorByRGBA(t,e,r,i,s){this.setPartColor(t,e,r,i,s,this._userPartMultiplyColors,this._userMultiplyColors)}setPartScreenColorByTextureColor(t,e){this.setPartScreenColorByRGBA(t,e.R,e.G,e.B,e.A)}setPartScreenColorByRGBA(t,e,r,i,s){this.setPartColor(t,e,r,i,s,this._userPartScreenColors,this._userScreenColors)}getOverwriteFlagForModelMultiplyColors(){return this._isOverwrittenModelMultiplyColors}getOverwriteFlagForModelScreenColors(){return this._isOverwrittenModelScreenColors}setOverwriteFlagForModelMultiplyColors(t){this._isOverwrittenModelMultiplyColors=t}setOverwriteFlagForModelScreenColors(t){this._isOverwrittenModelScreenColors=t}getOverwriteFlagForDrawableMultiplyColors(t){return this._userMultiplyColors[t].isOverwritten}getOverwriteFlagForDrawableScreenColors(t){return this._userScreenColors[t].isOverwritten}setOverwriteFlagForDrawableMultiplyColors(t,e){this._userMultiplyColors[t].isOverwritten=e}setOverwriteFlagForDrawableScreenColors(t,e){this._userScreenColors[t].isOverwritten=e}getOverwriteColorForPartMultiplyColors(t){return this._userPartMultiplyColors[t].isOverwritten}getOverwriteColorForPartScreenColors(t){return this._userPartScreenColors[t].isOverwritten}setOverwriteColorForPartColors(t,e,r,i){r[t].isOverwritten=e;for(let s=0;s<this._partChildDrawables[t].length;++s){const n=this._partChildDrawables[t][s];i[n].isOverwritten=e,e&&(i[n].Color.R=r[t].Color.R,i[n].Color.G=r[t].Color.G,i[n].Color.B=r[t].Color.B,i[n].Color.A=r[t].Color.A)}}setOverwriteColorForPartMultiplyColors(t,e){this._userPartMultiplyColors[t].isOverwritten=e,this.setOverwriteColorForPartColors(t,e,this._userPartMultiplyColors,this._userMultiplyColors)}setOverwriteColorForPartScreenColors(t,e){this._userPartScreenColors[t].isOverwritten=e,this.setOverwriteColorForPartColors(t,e,this._userPartScreenColors,this._userScreenColors)}getDrawableCulling(t){if(this.getOverwriteFlagForModelCullings()||this.getOverwriteFlagForDrawableCullings(t))return this._userCullings[t].isCulling;const e=this._model.drawables.constantFlags;return!Live2DCubismCore.Utils.hasIsDoubleSidedBit(e[t])}setDrawableCulling(t,e){this._userCullings[t].isCulling=e}getOverwriteFlagForModelCullings(){return this._isOverwrittenCullings}setOverwriteFlagForModelCullings(t){this._isOverwrittenCullings=t}getOverwriteFlagForDrawableCullings(t){return this._userCullings[t].isOverwritten}setOverwriteFlagForDrawableCullings(t,e){this._userCullings[t].isOverwritten=e}getModelOapcity(){return this._modelOpacity}setModelOapcity(t){this._modelOpacity=t}getModel(){return this._model}getPartIndex(t){let e;const r=this._model.parts.count;for(e=0;e<r;++e)if(t==this._partIds[e])return e;return t in this._notExistPartId?this._notExistPartId[t]:(e=r+this._notExistPartId.length,this._notExistPartId[t]=e,this._notExistPartOpacities[e]=0,e)}getPartId(t){return this._model.parts.ids[t]}getPartCount(){return this._model.parts.count}setPartOpacityByIndex(t,e){t in this._notExistPartOpacities?this._notExistPartOpacities[t]=e:(Mt(0<=t&&t<this.getPartCount()),this._partOpacities[t]=e)}setPartOpacityById(t,e){const r=this.getPartIndex(t);r<0||this.setPartOpacityByIndex(r,e)}getPartOpacityByIndex(t){return t in this._notExistPartOpacities?this._notExistPartOpacities[t]:(Mt(0<=t&&t<this.getPartCount()),this._partOpacities[t])}getPartOpacityById(t){const e=this.getPartIndex(t);return e<0?0:this.getPartOpacityByIndex(e)}getParameterIndex(t){let e;const r=this._model.parameters.count;for(e=0;e<r;++e)if(t==this._parameterIds[e])return e;return t in this._notExistParameterId?this._notExistParameterId[t]:(e=this._model.parameters.count+Object.keys(this._notExistParameterId).length,this._notExistParameterId[t]=e,this._notExistParameterValues[e]=0,e)}getParameterCount(){return this._model.parameters.count}getParameterType(t){return this._model.parameters.types[t]}getParameterMaximumValue(t){return this._model.parameters.maximumValues[t]}getParameterMinimumValue(t){return this._model.parameters.minimumValues[t]}getParameterDefaultValue(t){return this._model.parameters.defaultValues[t]}getParameterValueByIndex(t){return t in this._notExistParameterValues?this._notExistParameterValues[t]:(Mt(0<=t&&t<this.getParameterCount()),this._parameterValues[t])}getParameterValueById(t){const e=this.getParameterIndex(t);return this.getParameterValueByIndex(e)}setParameterValueByIndex(t,e,r=1){t in this._notExistParameterValues?this._notExistParameterValues[t]=1==r?e:this._notExistParameterValues[t]*(1-r)+e*r:(Mt(0<=t&&t<this.getParameterCount()),this._model.parameters.maximumValues[t]<e&&(e=this._model.parameters.maximumValues[t]),this._model.parameters.minimumValues[t]>e&&(e=this._model.parameters.minimumValues[t]),this._parameterValues[t]=1==r?e:this._parameterValues[t]=this._parameterValues[t]*(1-r)+e*r)}setParameterValueById(t,e,r=1){const i=this.getParameterIndex(t);this.setParameterValueByIndex(i,e,r)}addParameterValueByIndex(t,e,r=1){this.setParameterValueByIndex(t,this.getParameterValueByIndex(t)+e*r)}addParameterValueById(t,e,r=1){const i=this.getParameterIndex(t);this.addParameterValueByIndex(i,e,r)}multiplyParameterValueById(t,e,r=1){const i=this.getParameterIndex(t);this.multiplyParameterValueByIndex(i,e,r)}multiplyParameterValueByIndex(t,e,r=1){this.setParameterValueByIndex(t,this.getParameterValueByIndex(t)*(1+(e-1)*r))}getDrawableIds(){return this._drawableIds.slice()}getDrawableIndex(t){const e=this._model.drawables.count;for(let r=0;r<e;++r)if(this._drawableIds[r]==t)return r;return-1}getDrawableCount(){return this._model.drawables.count}getDrawableId(t){return this._model.drawables.ids[t]}getDrawableRenderOrders(){return this._model.drawables.renderOrders}getDrawableTextureIndices(t){return this.getDrawableTextureIndex(t)}getDrawableTextureIndex(t){return this._model.drawables.textureIndices[t]}getDrawableDynamicFlagVertexPositionsDidChange(t){const e=this._model.drawables.dynamicFlags;return Live2DCubismCore.Utils.hasVertexPositionsDidChangeBit(e[t])}getDrawableVertexIndexCount(t){return this._model.drawables.indexCounts[t]}getDrawableVertexCount(t){return this._model.drawables.vertexCounts[t]}getDrawableVertices(t){return this.getDrawableVertexPositions(t)}getDrawableVertexIndices(t){return this._model.drawables.indices[t]}getDrawableVertexPositions(t){return this._model.drawables.vertexPositions[t]}getDrawableVertexUvs(t){return this._model.drawables.vertexUvs[t]}getDrawableOpacity(t){return this._model.drawables.opacities[t]}getDrawableMultiplyColor(t){const e=this._model.drawables.multiplyColors,r=4*t,i=new Tt;return i.R=e[r],i.G=e[r+1],i.B=e[r+2],i.A=e[r+3],i}getDrawableScreenColor(t){const e=this._model.drawables.screenColors,r=4*t,i=new Tt;return i.R=e[r],i.G=e[r+1],i.B=e[r+2],i.A=e[r+3],i}getDrawableParentPartIndex(t){return this._model.drawables.parentPartIndices[t]}getDrawableBlendMode(t){const e=this._model.drawables.constantFlags;return Live2DCubismCore.Utils.hasBlendAdditiveBit(e[t])?At.CubismBlendMode_Additive:Live2DCubismCore.Utils.hasBlendMultiplicativeBit(e[t])?At.CubismBlendMode_Multiplicative:At.CubismBlendMode_Normal}getDrawableInvertedMaskBit(t){const e=this._model.drawables.constantFlags;return Live2DCubismCore.Utils.hasIsInvertedMaskBit(e[t])}getDrawableMasks(){return this._model.drawables.masks}getDrawableMaskCounts(){return this._model.drawables.maskCounts}isUsingMasking(){for(let t=0;t<this._model.drawables.count;++t)if(!(this._model.drawables.maskCounts[t]<=0))return!0;return!1}getDrawableDynamicFlagIsVisible(t){const e=this._model.drawables.dynamicFlags;return Live2DCubismCore.Utils.hasIsVisibleBit(e[t])}getDrawableDynamicFlagVisibilityDidChange(t){const e=this._model.drawables.dynamicFlags;return Live2DCubismCore.Utils.hasVisibilityDidChangeBit(e[t])}getDrawableDynamicFlagOpacityDidChange(t){const e=this._model.drawables.dynamicFlags;return Live2DCubismCore.Utils.hasOpacityDidChangeBit(e[t])}getDrawableDynamicFlagRenderOrderDidChange(t){const e=this._model.drawables.dynamicFlags;return Live2DCubismCore.Utils.hasRenderOrderDidChangeBit(e[t])}getDrawableDynamicFlagBlendColorDidChange(t){const e=this._model.drawables.dynamicFlags;return Live2DCubismCore.Utils.hasBlendColorDidChangeBit(e[t])}loadParameters(){let t=this._model.parameters.count;const e=this._savedParameters.length;t>e&&(t=e);for(let e=0;e<t;++e)this._parameterValues[e]=this._savedParameters[e]}initialize(){this._parameterValues=this._model.parameters.values,this._partOpacities=this._model.parts.opacities,this._parameterMaximumValues=this._model.parameters.maximumValues,this._parameterMinimumValues=this._model.parameters.minimumValues;{const t=this._model.parameters.ids,e=this._model.parameters.count;for(let r=0;r<e;++r)this._parameterIds.push(t[r])}const t=this._model.parts.count;{const e=this._model.parts.ids;for(let r=0;r<t;++r)this._partIds.push(e[r])}{const e=this._model.drawables.ids,r=this._model.drawables.count,i=new Ne(!1,!1);for(let e=0;e<t;++e){const t=new Tt(1,1,1,1),e=new Tt(0,0,0,1),r=new Be(!1,t),i=new Be(!1,e);this._userPartMultiplyColors.push(r),this._userPartScreenColors.push(i),this._partChildDrawables.push([])}for(let t=0;t<r;++t){const r=new Tt(1,1,1,1),s=new Tt(0,0,0,1),n=new ke(!1,r),o=new ke(!1,s);this._drawableIds.push(e[t]),this._userMultiplyColors.push(n),this._userScreenColors.push(o),this._userCullings.push(i);const a=this.getDrawableParentPartIndex(t);a>=0&&this._partChildDrawables[a].push(t)}}}constructor(t){this._model=t,this._savedParameters=[],this._parameterIds=[],this._drawableIds=[],this._partIds=[],this._isOverwrittenModelMultiplyColors=!1,this._isOverwrittenModelScreenColors=!1,this._isOverwrittenCullings=!1,this._modelOpacity=1,this._userMultiplyColors=[],this._userScreenColors=[],this._userCullings=[],this._userPartMultiplyColors=[],this._userPartScreenColors=[],this._partChildDrawables=[],this._notExistPartId={},this._notExistParameterId={},this._notExistParameterValues={},this._notExistPartOpacities={},this.initialize()}release(){this._model.release(),this._model=void 0}}class Ge{static create(t,e){if(e&&!this.hasMocConsistency(t))throw new Error("Inconsistent MOC3.");const r=Live2DCubismCore.Moc.fromArrayBuffer(t);if(r){const e=new Ge(r);return e._mocVersion=Live2DCubismCore.Version.csmGetMocVersion(r,t),e}throw new Error("Failed to CubismMoc.create().")}createModel(){let t;const e=Live2DCubismCore.Model.fromMoc(this._moc);if(e)return t=new Ue(e),++this._modelCount,t;throw new Error("Unknown error")}deleteModel(t){null!=t&&--this._modelCount}constructor(t){this._moc=t,this._modelCount=0,this._mocVersion=0}release(){this._moc._release(),this._moc=void 0}getLatestMocVersion(){return Live2DCubismCore.Version.csmGetLatestMocVersion()}getMocVersion(){return this._mocVersion}static hasMocConsistency(t){return 1===Live2DCubismCore.Moc.prototype.hasMocConsistency(t)}}var Ve=(t=>(t[t.CubismPhysicsTargetType_Parameter=0]="CubismPhysicsTargetType_Parameter",t))(Ve||{}),He=(t=>(t[t.CubismPhysicsSource_X=0]="CubismPhysicsSource_X",t[t.CubismPhysicsSource_Y=1]="CubismPhysicsSource_Y",t[t.CubismPhysicsSource_Angle=2]="CubismPhysicsSource_Angle",t))(He||{});class ze{constructor(){this.initialPosition=new gt(0,0),this.position=new gt(0,0),this.lastPosition=new gt(0,0),this.lastGravity=new gt(0,0),this.force=new gt(0,0),this.velocity=new gt(0,0)}}class Xe{constructor(){this.normalizationPosition={},this.normalizationAngle={}}}class We{constructor(){this.source={}}}class Ye{constructor(){this.destination={},this.translationScale=new gt(0,0)}}class je{constructor(){this.settings=[],this.inputs=[],this.outputs=[],this.particles=[],this.gravity=new gt(0,0),this.wind=new gt(0,0),this.fps=0}}class qe{constructor(t){this._json=t}release(){this._json=void 0}getGravity(){const t=new gt(0,0);return t.x=this._json.Meta.EffectiveForces.Gravity.X,t.y=this._json.Meta.EffectiveForces.Gravity.Y,t}getWind(){const t=new gt(0,0);return t.x=this._json.Meta.EffectiveForces.Wind.X,t.y=this._json.Meta.EffectiveForces.Wind.Y,t}getFps(){return this._json.Meta.Fps||0}getSubRigCount(){return this._json.Meta.PhysicsSettingCount}getTotalInputCount(){return this._json.Meta.TotalInputCount}getTotalOutputCount(){return this._json.Meta.TotalOutputCount}getVertexCount(){return this._json.Meta.VertexCount}getNormalizationPositionMinimumValue(t){return this._json.PhysicsSettings[t].Normalization.Position.Minimum}getNormalizationPositionMaximumValue(t){return this._json.PhysicsSettings[t].Normalization.Position.Maximum}getNormalizationPositionDefaultValue(t){return this._json.PhysicsSettings[t].Normalization.Position.Default}getNormalizationAngleMinimumValue(t){return this._json.PhysicsSettings[t].Normalization.Angle.Minimum}getNormalizationAngleMaximumValue(t){return this._json.PhysicsSettings[t].Normalization.Angle.Maximum}getNormalizationAngleDefaultValue(t){return this._json.PhysicsSettings[t].Normalization.Angle.Default}getInputCount(t){return this._json.PhysicsSettings[t].Input.length}getInputWeight(t,e){return this._json.PhysicsSettings[t].Input[e].Weight}getInputReflect(t,e){return this._json.PhysicsSettings[t].Input[e].Reflect}getInputType(t,e){return this._json.PhysicsSettings[t].Input[e].Type}getInputSourceId(t,e){return this._json.PhysicsSettings[t].Input[e].Source.Id}getOutputCount(t){return this._json.PhysicsSettings[t].Output.length}getOutputVertexIndex(t,e){return this._json.PhysicsSettings[t].Output[e].VertexIndex}getOutputAngleScale(t,e){return this._json.PhysicsSettings[t].Output[e].Scale}getOutputWeight(t,e){return this._json.PhysicsSettings[t].Output[e].Weight}getOutputDestinationId(t,e){return this._json.PhysicsSettings[t].Output[e].Destination.Id}getOutputType(t,e){return this._json.PhysicsSettings[t].Output[e].Type}getOutputReflect(t,e){return this._json.PhysicsSettings[t].Output[e].Reflect}getParticleCount(t){return this._json.PhysicsSettings[t].Vertices.length}getParticleMobility(t,e){return this._json.PhysicsSettings[t].Vertices[e].Mobility}getParticleDelay(t,e){return this._json.PhysicsSettings[t].Vertices[e].Delay}getParticleAcceleration(t,e){return this._json.PhysicsSettings[t].Vertices[e].Acceleration}getParticleRadius(t,e){return this._json.PhysicsSettings[t].Vertices[e].Radius}getParticlePosition(t,e){const r=new gt(0,0);return r.x=this._json.PhysicsSettings[t].Vertices[e].Position.X,r.y=this._json.PhysicsSettings[t].Vertices[e].Position.Y,r}}const Ze="Angle";class Qe{static create(t){const e=new Qe;return e.parse(t),e._physicsRig.gravity.y=0,e}static delete(t){null!=t&&t.release()}parse(t){this._physicsRig=new je;const e=new qe(t);this._physicsRig.gravity=e.getGravity(),this._physicsRig.wind=e.getWind(),this._physicsRig.subRigCount=e.getSubRigCount(),this._physicsRig.fps=e.getFps(),this._currentRigOutputs=[],this._previousRigOutputs=[];let r=0,i=0,s=0;for(let t=0;t<this._physicsRig.subRigCount;++t){const n=new Xe;n.normalizationPosition.minimum=e.getNormalizationPositionMinimumValue(t),n.normalizationPosition.maximum=e.getNormalizationPositionMaximumValue(t),n.normalizationPosition.defalut=e.getNormalizationPositionDefaultValue(t),n.normalizationAngle.minimum=e.getNormalizationAngleMinimumValue(t),n.normalizationAngle.maximum=e.getNormalizationAngleMaximumValue(t),n.normalizationAngle.defalut=e.getNormalizationAngleDefaultValue(t),n.inputCount=e.getInputCount(t),n.baseInputIndex=r,r+=n.inputCount;for(let r=0;r<n.inputCount;++r){const i=new We;switch(i.sourceParameterIndex=-1,i.weight=e.getInputWeight(t,r),i.reflect=e.getInputReflect(t,r),e.getInputType(t,r)){case"X":i.type=He.CubismPhysicsSource_X,i.getNormalizedParameterValue=tr;break;case"Y":i.type=He.CubismPhysicsSource_Y,i.getNormalizedParameterValue=er;break;case Ze:i.type=He.CubismPhysicsSource_Angle,i.getNormalizedParameterValue=rr}i.source.targetType=Ve.CubismPhysicsTargetType_Parameter,i.source.id=e.getInputSourceId(t,r),this._physicsRig.inputs.push(i)}n.outputCount=e.getOutputCount(t),n.baseOutputIndex=i;const o=new Ke,a=new Ke;for(let r=0;r<n.outputCount;++r){o.outputs[r]=0,a.outputs[r]=0;let s=this._physicsRig.outputs[i+r];switch(s||(s=new Ye,this._physicsRig.outputs[i+r]=s),s.destinationParameterIndex=-1,s.vertexIndex=e.getOutputVertexIndex(t,r),s.angleScale=e.getOutputAngleScale(t,r),s.weight=e.getOutputWeight(t,r),s.destination.targetType=Ve.CubismPhysicsTargetType_Parameter,s.destination.id=e.getOutputDestinationId(t,r),e.getOutputType(t,r)){case"X":s.type=He.CubismPhysicsSource_X,s.getValue=ir,s.getScale=or;break;case"Y":s.type=He.CubismPhysicsSource_Y,s.getValue=sr,s.getScale=ar;break;case Ze:s.type=He.CubismPhysicsSource_Angle,s.getValue=nr,s.getScale=hr}s.reflect=e.getOutputReflect(t,r)}this._currentRigOutputs.push(o),this._previousRigOutputs.push(a),i+=n.outputCount,n.particleCount=e.getParticleCount(t),n.baseParticleIndex=s,s+=n.particleCount;for(let r=0;r<n.particleCount;++r){const i=new ze;i.mobility=e.getParticleMobility(t,r),i.delay=e.getParticleDelay(t,r),i.acceleration=e.getParticleAcceleration(t,r),i.radius=e.getParticleRadius(t,r),i.position=e.getParticlePosition(t,r),this._physicsRig.particles.push(i)}this._physicsRig.settings.push(n)}this.initialize(),e.release()}stabilization(t){var e,r,i,s;let n,o,a,h;const l=new gt;let u,c,d,f,p,_,m,g;p=t.getModel().parameters.values,_=t.getModel().parameters.maximumValues,m=t.getModel().parameters.minimumValues,g=t.getModel().parameters.defaultValues,(null!=(r=null==(e=this._parameterCaches)?void 0:e.length)?r:0)<t.getParameterCount()&&(this._parameterCaches=new Float32Array(t.getParameterCount())),(null!=(s=null==(i=this._parameterInputCaches)?void 0:i.length)?s:0)<t.getParameterCount()&&(this._parameterInputCaches=new Float32Array(t.getParameterCount()));for(let e=0;e<t.getParameterCount();++e)this._parameterCaches[e]=p[e],this._parameterInputCaches[e]=p[e];for(let e=0;e<this._physicsRig.subRigCount;++e){n={angle:0},l.x=0,l.y=0,u=this._physicsRig.settings[e],c=this._physicsRig.inputs.slice(u.baseInputIndex),d=this._physicsRig.outputs.slice(u.baseOutputIndex),f=this._physicsRig.particles.slice(u.baseParticleIndex);for(let e=0;e<u.inputCount;++e)o=c[e].weight/100,-1==c[e].sourceParameterIndex&&(c[e].sourceParameterIndex=t.getParameterIndex(c[e].source.id)),c[e].getNormalizedParameterValue(l,n,p[c[e].sourceParameterIndex],m[c[e].sourceParameterIndex],_[c[e].sourceParameterIndex],g[c[e].sourceParameterIndex],u.normalizationPosition,u.normalizationAngle,c[e].reflect,o),this._parameterCaches[c[e].sourceParameterIndex]=p[c[e].sourceParameterIndex];a=bt.degreesToRadian(-n.angle),l.x=l.x*bt.cos(a)-l.y*bt.sin(a),l.y=l.x*bt.sin(a)+l.y*bt.cos(a),ur(f,u.particleCount,l,n.angle,this._options.wind,.001*u.normalizationPosition.maximum);for(let r=0;r<u.outputCount;++r){const i=d[r].vertexIndex;if(-1==d[r].destinationParameterIndex&&(d[r].destinationParameterIndex=t.getParameterIndex(d[r].destination.id)),i<1||i>=u.particleCount)continue;let s=new gt;s=f[i].position.substract(f[i-1].position),h=d[r].getValue(s,f,i,d[r].reflect,this._options.gravity),this._currentRigOutputs[e].outputs[r]=h,this._previousRigOutputs[e].outputs[r]=h;const n=d[r].destinationParameterIndex,o=!Float32Array.prototype.slice&&"subarray"in Float32Array.prototype?JSON.parse(JSON.stringify(p.subarray(n))):p.slice(n);cr(o,m[n],_[n],h,d[r]);for(let t=n,e=0;t<this._parameterCaches.length;t++,e++)p[t]=this._parameterCaches[t]=o[e]}}}evaluate(t,e){var r,i,s,n;let o,a,h,l;const u=new gt;let c,d,f,p,_,m,g,y,b;if(0>=e)return;if(this._currentRemainTime+=e,this._currentRemainTime>5&&(this._currentRemainTime=0),_=t.getModel().parameters.values,m=t.getModel().parameters.maximumValues,g=t.getModel().parameters.minimumValues,y=t.getModel().parameters.defaultValues,(null!=(i=null==(r=this._parameterCaches)?void 0:r.length)?i:0)<t.getParameterCount()&&(this._parameterCaches=new Float32Array(t.getParameterCount())),(null!=(n=null==(s=this._parameterInputCaches)?void 0:s.length)?n:0)<t.getParameterCount()){this._parameterInputCaches=new Float32Array(t.getParameterCount());for(let e=0;e<t.getParameterCount();++e)this._parameterInputCaches[e]=_[e]}for(b=this._physicsRig.fps>0?1/this._physicsRig.fps:e;this._currentRemainTime>=b;){for(let t=0;t<this._physicsRig.subRigCount;++t){c=this._physicsRig.settings[t],f=this._physicsRig.outputs.slice(c.baseOutputIndex);for(let e=0;e<c.outputCount;++e)this._previousRigOutputs[t].outputs[e]=this._currentRigOutputs[t].outputs[e]}const e=b/this._currentRemainTime;for(let r=0;r<t.getParameterCount();++r)this._parameterCaches[r]=this._parameterInputCaches[r]*(1-e)+_[r]*e,this._parameterInputCaches[r]=this._parameterCaches[r];for(let e=0;e<this._physicsRig.subRigCount;++e){o={angle:0},u.x=0,u.y=0,c=this._physicsRig.settings[e],d=this._physicsRig.inputs.slice(c.baseInputIndex),f=this._physicsRig.outputs.slice(c.baseOutputIndex),p=this._physicsRig.particles.slice(c.baseParticleIndex);for(let e=0;e<c.inputCount;++e)a=d[e].weight/100,-1==d[e].sourceParameterIndex&&(d[e].sourceParameterIndex=t.getParameterIndex(d[e].source.id)),d[e].getNormalizedParameterValue(u,o,this._parameterCaches[d[e].sourceParameterIndex],g[d[e].sourceParameterIndex],m[d[e].sourceParameterIndex],y[d[e].sourceParameterIndex],c.normalizationPosition,c.normalizationAngle,d[e].reflect,a);h=bt.degreesToRadian(-o.angle),u.x=u.x*bt.cos(h)-u.y*bt.sin(h),u.y=u.x*bt.sin(h)+u.y*bt.cos(h),lr(p,c.particleCount,u,o.angle,this._options.wind,.001*c.normalizationPosition.maximum,b,5);for(let r=0;r<c.outputCount;++r){const i=f[r].vertexIndex;if(-1==f[r].destinationParameterIndex&&(f[r].destinationParameterIndex=t.getParameterIndex(f[r].destination.id)),i<1||i>=c.particleCount)continue;const s=new gt;s.x=p[i].position.x-p[i-1].position.x,s.y=p[i].position.y-p[i-1].position.y,l=f[r].getValue(s,p,i,f[r].reflect,this._options.gravity),this._currentRigOutputs[e].outputs[r]=l;const n=f[r].destinationParameterIndex,o=!Float32Array.prototype.slice&&"subarray"in Float32Array.prototype?JSON.parse(JSON.stringify(this._parameterCaches.subarray(n))):this._parameterCaches.slice(n);cr(o,g[n],m[n],l,f[r]);for(let t=n,e=0;t<this._parameterCaches.length;t++,e++)this._parameterCaches[t]=o[e]}}this._currentRemainTime-=b}const v=this._currentRemainTime/b;this.interpolate(t,v)}interpolate(t,e){let r,i,s,n,o;s=t.getModel().parameters.values,n=t.getModel().parameters.maximumValues,o=t.getModel().parameters.minimumValues;for(let t=0;t<this._physicsRig.subRigCount;++t){i=this._physicsRig.settings[t],r=this._physicsRig.outputs.slice(i.baseOutputIndex);for(let a=0;a<i.outputCount;++a){if(-1==r[a].destinationParameterIndex)continue;const i=r[a].destinationParameterIndex,h=!Float32Array.prototype.slice&&"subarray"in Float32Array.prototype?JSON.parse(JSON.stringify(s.subarray(i))):s.slice(i);cr(h,o[i],n[i],this._previousRigOutputs[t].outputs[a]*(1-e)+this._currentRigOutputs[t].outputs[a]*e,r[a]);for(let t=i,e=0;t<s.length;t++,e++)s[t]=h[e]}}}setOptions(t){this._options=t}getOption(){return this._options}constructor(){this._options=new Je,this._options.gravity.y=-1,this._options.gravity.x=0,this._options.wind.x=0,this._options.wind.y=0,this._currentRigOutputs=[],this._previousRigOutputs=[],this._currentRemainTime=0}release(){this._physicsRig=void 0}initialize(){let t,e,r;for(let i=0;i<this._physicsRig.subRigCount;++i){e=this._physicsRig.settings[i],t=this._physicsRig.particles.slice(e.baseParticleIndex),t[0].initialPosition=new gt(0,0),t[0].lastPosition=new gt(t[0].initialPosition.x,t[0].initialPosition.y),t[0].lastGravity=new gt(0,-1),t[0].lastGravity.y*=-1,t[0].velocity=new gt(0,0),t[0].force=new gt(0,0);for(let i=1;i<e.particleCount;++i)r=new gt(0,0),r.y=t[i].radius,t[i].initialPosition=new gt(t[i-1].initialPosition.x+r.x,t[i-1].initialPosition.y+r.y),t[i].position=new gt(t[i].initialPosition.x,t[i].initialPosition.y),t[i].lastPosition=new gt(t[i].initialPosition.x,t[i].initialPosition.y),t[i].lastGravity=new gt(0,-1),t[i].lastGravity.y*=-1,t[i].velocity=new gt(0,0),t[i].force=new gt(0,0)}}}class Je{constructor(){this.gravity=new gt(0,0),this.wind=new gt(0,0)}}class Ke{constructor(){this.outputs=[]}}function tr(t,e,r,i,s,n,o,a,h,l){t.x+=dr(r,i,s,n,o.minimum,o.maximum,o.defalut,h)*l}function er(t,e,r,i,s,n,o,a,h,l){t.y+=dr(r,i,s,n,o.minimum,o.maximum,o.defalut,h)*l}function rr(t,e,r,i,s,n,o,a,h,l){e.angle+=dr(r,i,s,n,a.minimum,a.maximum,a.defalut,h)*l}function ir(t,e,r,i,s){let n=t.x;return i&&(n*=-1),n}function sr(t,e,r,i,s){let n=t.y;return i&&(n*=-1),n}function nr(t,e,r,i,s){let n;return s=r>=2?e[r-1].position.substract(e[r-2].position):s.multiplyByScaler(-1),n=bt.directionToRadian(s,t),i&&(n*=-1),n}function or(t,e){return t.x}function ar(t,e){return t.y}function hr(t,e){return e}function lr(t,e,r,i,s,n,o,a){let h,l,u,c,d=new gt(0,0),f=new gt(0,0),p=new gt(0,0),_=new gt(0,0);t[0].position=new gt(r.x,r.y),h=bt.degreesToRadian(i),c=bt.radianToDirection(h),c.normalize();for(let r=1;r<e;++r)t[r].force=c.multiplyByScaler(t[r].acceleration).add(s),t[r].lastPosition=new gt(t[r].position.x,t[r].position.y),l=t[r].delay*o*30,d=t[r].position.substract(t[r-1].position),u=bt.directionToRadian(t[r].lastGravity,c)/a,d.x=bt.cos(u)*d.x-d.y*bt.sin(u),d.y=bt.sin(u)*d.x+d.y*bt.cos(u),t[r].position=t[r-1].position.add(d),f=t[r].velocity.multiplyByScaler(l),p=t[r].force.multiplyByScaler(l).multiplyByScaler(l),t[r].position=t[r].position.add(f).add(p),_=t[r].position.substract(t[r-1].position),_.normalize(),t[r].position=t[r-1].position.add(_.multiplyByScaler(t[r].radius)),bt.abs(t[r].position.x)<n&&(t[r].position.x=0),0!=l&&(t[r].velocity=t[r].position.substract(t[r].lastPosition),t[r].velocity=t[r].velocity.divisionByScalar(l),t[r].velocity=t[r].velocity.multiplyByScaler(t[r].mobility)),t[r].force=new gt(0,0),t[r].lastGravity=new gt(c.x,c.y)}function ur(t,e,r,i,s,n){let o,a,h=new gt(0,0);t[0].position=new gt(r.x,r.y),o=bt.degreesToRadian(i),a=bt.radianToDirection(o),a.normalize();for(let r=1;r<e;++r)t[r].force=a.multiplyByScaler(t[r].acceleration).add(s),t[r].lastPosition=new gt(t[r].position.x,t[r].position.y),t[r].velocity=new gt(0,0),h=t[r].force,h.normalize(),h=h.multiplyByScaler(t[r].radius),t[r].position=t[r-1].position.add(h),bt.abs(t[r].position.x)<n&&(t[r].position.x=0),t[r].force=new gt(0,0),t[r].lastGravity=new gt(a.x,a.y)}function cr(t,e,r,i,s){let n,o,a;n=s.getScale(s.translationScale,s.angleScale),o=i*n,o<e?(o<s.valueBelowMinimum&&(s.valueBelowMinimum=o),o=e):o>r&&(o>s.valueExceededMaximum&&(s.valueExceededMaximum=o),o=r),a=s.weight/100,a>=1||(o=t[0]*(1-a)+o*a),t[0]=o}function dr(t,e,r,i,s,n,o,a){let h=0;const l=bt.max(r,e);l<t&&(t=l);const u=bt.min(r,e);u>t&&(t=u);const c=bt.min(s,n),d=bt.max(s,n),f=o,p=function(t,e){return Math.min(t,e)+function(t,e){return Math.abs(Math.max(t,e)-Math.min(t,e))}(t,e)/2}(u,l),_=t-p;switch(Math.sign(_)){case 1:{const t=l-p;0!=t&&(h=_*((d-f)/t),h+=f);break}case-1:{const t=u-p;0!=t&&(h=_*((c-f)/t),h+=f);break}case 0:h=f}return a?h:-1*h}function fr(){var t;null==(t=this.__moc)||t.release()}j.registerRuntime({version:4,ready:De,test:t=>t instanceof $e||$e.isValidJSON(t),isValidMoc(t){if(t.byteLength<4)return!1;const e=new Int8Array(t,0,4);return"MOC3"===String.fromCharCode(...e)},createModelSettings:t=>new $e(t),createCoreModel(t,e){const r=Ge.create(t,!!(null==e?void 0:e.checkMocConsistency));try{const t=r.createModel();return t.__moc=r,t}catch(t){try{r.release()}catch(t){}throw t}},createInternalModel(t,e,r){const i=new Pe(t,e,r),s=t;return s.__moc&&(i.__moc=s.__moc,delete s.__moc,i.once("destroy",fr)),i},createPhysics:(t,e)=>Qe.create(e),createPose:(t,e)=>Fe.create(e)}),t.Cubism2ExpressionManager=ot,t.Cubism2InternalModel=ut,t.Cubism2ModelSettings=ct,t.Cubism2MotionManager=at,t.Cubism4ExpressionManager=Ut,t.Cubism4InternalModel=Pe,t.Cubism4ModelSettings=$e,t.Cubism4MotionManager=ne,t.ExpressionManager=y,t.FileLoader=W,t.FocusController=x,t.InternalModel=M,t.LOGICAL_HEIGHT=2,t.LOGICAL_WIDTH=2,t.Live2DExpression=nt,t.Live2DEyeBlink=ht,t.Live2DFactory=j,t.Live2DLoader=L,t.Live2DModel=it,t.Live2DPhysics=pt,t.Live2DPose=mt,t.Live2DTransform=tt,t.ModelSettings=A,t.MotionManager=C,t.MotionPreloadStrategy=S,t.MotionPriority=T,t.MotionState=E,t.SoundManager=w,t.VERSION="v0.5.0-beta",t.VOLUME=.5,t.XHRLoader=R,t.ZipLoader=z,t.applyMixins=_,t.clamp=c,t.config=l,t.copyArray=p,t.copyProperty=f,t.cubism4Ready=De,t.folderName=m,t.logger=u,t.rand=d,t.remove=g,t.startUpCubism4=Le,Object.defineProperty(t,Symbol.toStringTag,{value:"Module"})}));const cubism4Model="https://cdn.jsdelivr.net/gh/guansss/pixi-live2d-display/test/assets/haru/haru_greeter_t03.model3.json";async function initializeAvatar(){app=new PIXI.Application({view:document.getElementById("canvas"),autoStart:!0,resizeTo:window,backgroundColor:16777215}),model4=await PIXI.live2d.Live2DModel.from(cubism4Model),app.stage.addChild(model4),model4.scale.set(.2),model4.x=-50,window.dispatchEvent(new Event("avatarInitialized"))}window.avatarSpeak=function(t,e,r){model4.speak(t,{volume:0,expression:4,resetExpression:!0,crossOrigin:"anonymous",onFinish:e,onError:r})},window.setAvatarBackground=function(t){app&&("string"==typeof t&&t.startsWith("#")&&(t=parseInt(t.replace("#",""),16)),app.renderer.backgroundColor=t)},window.stopAvatarSpeaking=function(){model4&&model4.stopSpeaking()},initializeAvatar().catch((t=>{console.error("Failed to initialize avatar:",t)}));